<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"louis-me.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":true,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="一个正经的测试工程师">
<meta property="og:type" content="website">
<meta property="og:title" content="施坤的博客">
<meta property="og:url" content="https://louis-me.github.io/page/3/index.html">
<meta property="og:site_name" content="施坤的博客">
<meta property="og:description" content="一个正经的测试工程师">
<meta property="og:locale" content="zh_CN">
<meta property="article:tag" content="自动化测试,安全测试,性能测试,渗透测试,大数据测试,python,jmeter,airtest,appium,monkey">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://louis-me.github.io/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>施坤的博客 </title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">施坤的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-简历">

    <a href="/resume/" rel="section"><i class="fa fa-address-card fa-fw"></i>简历</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
  
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://louis-me.github.io/aposts/4d2d858d/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="一个正经的测试工程师">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="施坤的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/aposts/4d2d858d/" class="post-title-link" itemprop="url">go-zero实战系列一</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-07-17 17:07:17" itemprop="dateCreated datePublished" datetime="2023-07-17T17:07:17+08:00">2023-07-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-07-26 17:16:52" itemprop="dateModified" datetime="2023-07-26T17:16:52+08:00">2023-07-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
                </span>
            </span>

          
            <span id="/aposts/4d2d858d/" class="post-meta-item leancloud_visitors" data-flag-title="go-zero实战系列一" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/aposts/4d2d858d/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/aposts/4d2d858d/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>本次主要按照这个博主的<a target="_blank" rel="noopener" href="https://www.cnblogs.com/kevinwan/tag/go-zero/">go-zero微服务实战</a>进行学习</p>
<h2 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h2><ul>
<li>安装依赖go-zero: <code>go get -u github.com/zeromicro/go-zero@latest</code></li>
<li>安装依赖goctl，用命令进行安装：<code>go install github.com/zeromicro/go-zero/tools/goctl@latest</code><ul>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/kevinwan/p/16325802.html">微服务效率工具 goctl 深度解析</a></li>
</ul>
</li>
<li>安装成功后，输入<code>go env</code> 找到<code>GOPATH</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">E:\proj\gowork\studyGoZero&gt;go env</span><br><span class="line">set GO111MODULE=on</span><br><span class="line">set GOPATH=C:\Users\Administrator\go</span><br><span class="line">set GOROOT=E:\app\Go</span><br><span class="line">....</span><br></pre></td></tr></table></figure>

<ul>
<li>把<code>C:\Users\Administrator\go\bin\goctl.exe</code> 拷贝到GOROOT\bin目录下</li>
<li>查看版本成功</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS E:\proj\gowork\studyGoZero\apps\order&gt; goctl --version</span><br><span class="line">goctl version 1.5.4 windows/amd64</span><br></pre></td></tr></table></figure>

<ul>
<li>安装<code>protoc</code> ，查看他的<a target="_blank" rel="noopener" href="https://go-zero.dev/docs/tasks/installation/protoc">作用</a></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">goctl env check --install --verbose --force</span><br></pre></td></tr></table></figure>

<ul>
<li>安装<code>protoc</code> 成功后，把<code>C:\Users\Administrator\go\bin\</code> 的相关文件拷贝到<code>GOROOT\bin</code></li>
</ul>
<h2 id="服务划分"><a href="#服务划分" class="headerlink" title="服务划分"></a>服务划分</h2><p><img src="/aposts/4d2d858d/image-20230721102332169.png" alt="image-20230721102332169"></p>
<p>从以上思维导图可以看出整个电商系统功能还是比较多的，我们根据业务职能做如下微服务的划分：</p>
<ul>
<li>商品服务(product) - 商品的添加、信息查询、库存管理等功能</li>
<li>购物车服务(cart) - 购物车的增删改查</li>
<li>订单服务(order) - 生成订单，订单管理</li>
<li>支付服务(pay) - 通过调用第三方支付实现支付功能</li>
<li>账号服务(user) - 用户信息、等级、封禁、地址管理</li>
<li>推荐服务(recommend) - 首页商品推荐</li>
<li>评论服务(reply) - 商品的评论功能、评论的回复功能</li>
</ul>
<h2 id="BFF层"><a href="#BFF层" class="headerlink" title="BFF层"></a>BFF层</h2><ul>
<li>但对于一个复杂的高并发的系统来说，我们需要处理各种异常的场景，比如某个页面需要依赖多个微服务提供的数据，为了避免串行请求导致的耗时过长，我们一般会并行的请求多个微服务，这个时候其中的某个服务请求异常的话我们可能需要做一些特殊的处理，比如提供一些降级的数据等。我们的解决方案就是加一层，即BFF层，通过BFF对外提供HTTP接口，客户端只与BFF进行交互，<strong>我们的这个项目为了简化只会采用一个BFF服务</strong></li>
</ul>
<p><img src="/aposts/4d2d858d/image-20230721102651764.png" alt="image-20230721102651764"></p>
<ul>
<li>我们可以提供多个BFF吗？答案是当然可以。BFF的目的是为客户端提供一个集中的接口，例如移动端页面和浏览器页面的数据协议不同，这种情况下为了更好的表示数据，可以使用两个BFF，同时只供一个BFF如果该BFF异常就会导致所有的业务受影响，提供多个BFF也可以提高服务的可用性，降低业务异常的影响面。多个BFF架构图如下：</li>
</ul>
<p><img src="/aposts/4d2d858d/image-20230721102751280.png" alt="image-20230721102751280"></p>
<h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><ul>
<li>初始化项目</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd E:\proj\gowork</span><br><span class="line">mkdir studyGoZero</span><br><span class="line">cd studyGoZero</span><br><span class="line">go mod init example.com/studyGoZero</span><br></pre></td></tr></table></figure>

<ul>
<li>目录结构如下</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">─apps</span><br><span class="line">│  ├─app</span><br><span class="line">│  │  └─api</span><br><span class="line">│  ├─cart</span><br><span class="line">│  │  ├─admin</span><br><span class="line">│  │  ├─rmq</span><br><span class="line">│  │  └─rpc</span><br><span class="line">│  ├─order</span><br><span class="line">│  │  ├─admin</span><br><span class="line">│  │  ├─rmq</span><br><span class="line">│  │  └─rpc</span><br><span class="line">│  ├─paly</span><br><span class="line">│  │  ├─admin</span><br><span class="line">│  │  ├─rmq</span><br><span class="line">│  │  └─rpc</span><br><span class="line">│  ├─product</span><br><span class="line">│  │  ├─admin</span><br><span class="line">│  │  ├─rmq</span><br><span class="line">│  │  └─rpc</span><br><span class="line">│  ├─recommend</span><br><span class="line">│  │  ├─admin</span><br><span class="line">│  │  ├─rmq</span><br><span class="line">│  │  └─rpc</span><br><span class="line">│  ├─reply</span><br><span class="line">│  │  ├─admin</span><br><span class="line">│  │  ├─rmq</span><br><span class="line">│  │  └─rpc</span><br><span class="line">│  └─user</span><br><span class="line">│      ├─admin</span><br><span class="line">│      ├─rmq</span><br><span class="line">│      └─rpc</span><br><span class="line">└─pkg</span><br></pre></td></tr></table></figure>

<ul>
<li>其中apps存放的是我们所有的微服务，比如order为订单相关的微服务，pkg目录为所有服务共同依赖的包的存放路径，比如所有的服务都需要依赖鉴权就可以放到pkg目录下</li>
<li>app - BFF服务</li>
<li>cart - 购物车服务</li>
<li>order - 订单服务</li>
<li>pay - 支付服务</li>
<li>product - 商品服务</li>
<li>recommend - 推荐服务</li>
<li>reply - 评论服务</li>
<li>user - 账号服务</li>
</ul>
<p>在每个服务目录下我们又会分为多个服务，主要会有如下几类服务：</p>
<ul>
<li>api - 对外的BFF服务，接受来自客户端的请求，暴露HTTP接口</li>
<li>rpc - 对内的微服务，仅接受来自内部其他微服务或者BFF的请求，暴露gRPC接口</li>
<li>rmq - 负责进行流式任务处理，上游一般依赖消息队列，比如kafka等</li>
<li>admin - 也是对内的服务，区别于rpc，更多的是面向运营侧的且数据权限较高，通过隔离可带来更好的代码级别的安全，直接提供HTTP接口</li>
</ul>
<h2 id="API-定义"><a href="#API-定义" class="headerlink" title="API 定义"></a>API 定义</h2><h3 id="首页API"><a href="#首页API" class="headerlink" title="首页API"></a>首页API</h3><p>首页功能主要分为四个部分，<strong>搜索、Banner图、限时抢购和推荐商品</strong>列表，点击搜索框会跳转到搜索页，推荐部分是分页展示的，用户通过不断地往上滑动可以加载下一页。通过分析首页我们大致需要提供三个接口，分别是Banner接口，限时抢购接口和推荐接口。</p>
<p><img src="/aposts/4d2d858d/image-20230720110620328.png" alt="image-20230720110620328"></p>
<ul>
<li>打开<code>apps\app\api\api.api</code>文件，写入对外api的代码定义</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">syntax = &quot;v1&quot;</span><br><span class="line">type (</span><br><span class="line">	// 首页的banner响应请求</span><br><span class="line">	HomeBannerResponse &#123;</span><br><span class="line">		Banners []*Banner `json:&quot;banners&quot;`</span><br><span class="line">	&#125;</span><br><span class="line">.....</span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">service api-api &#123;</span><br><span class="line"></span><br><span class="line">	@doc &quot;首页Banner&quot;</span><br><span class="line">	@handler HomeBannerHandler</span><br><span class="line">	get /v1/home/banner returns (HomeBannerResponse)</span><br><span class="line"></span><br><span class="line">	@doc &quot;限时抢购&quot;</span><br><span class="line">	@handler FlashSaleHandler</span><br><span class="line">	get /v1/flashsale returns (FlashSaleResponse)</span><br><span class="line"></span><br><span class="line">	@doc &quot;推荐商品列表&quot;</span><br><span class="line">	@handler RecommendHandler</span><br><span class="line">	get /v1/recommend (RecommendRequest) returns (RecommendResponse)</span><br><span class="line"></span><br><span class="line">	@doc &quot;分类商品列表&quot;</span><br><span class="line">	@handler CategoryListHandler</span><br><span class="line">	get /v1/category/list (CategoryListRequest) returns (CategoryListResponse)</span><br><span class="line">	@doc &quot;购物车列表&quot;</span><br><span class="line">	@handler CartListHandler</span><br><span class="line">	get /v1/cart/list (CartListRequest) returns (CartListResponse)</span><br><span class="line"></span><br><span class="line">	@doc &quot;商品评论列表&quot;</span><br><span class="line">	@handler ProductCommentHandler</span><br><span class="line">	get /v1/product/comment (ProductCommentRequest) returns (ProductCommentResponse)</span><br><span class="line"></span><br><span class="line">	@doc &quot;订单列表&quot;</span><br><span class="line">	@handler OrderListHandler</span><br><span class="line">	get /v1/order/list (OrderListRequest) returns (OrderListResponse)</span><br><span class="line"></span><br><span class="line">	@doc &quot;商品详情&quot;</span><br><span class="line">	@handler ProductDetailHandler</span><br><span class="line">	get /v1/product/detail (ProductDetailRequest) returns (ProductDetailResponse)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>定义好api后，我们使用如下命令重新生成项目代码，输出如下信息表明生成成功</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">PS E:\proj\gowork\studyGoZero\apps\app\api&gt; goctl api go -api api.api -dir .</span><br><span class="line">Done.</span><br><span class="line"></span><br><span class="line">// 查看目录</span><br><span class="line">PS E:\proj\gowork\studyGoZero\apps\app\api&gt; tree /f</span><br><span class="line">E:.</span><br><span class="line">│  api.api</span><br><span class="line">│  api.go</span><br><span class="line">│</span><br><span class="line">├─etc</span><br><span class="line">│      api-api.yaml</span><br><span class="line">│</span><br><span class="line">└─internal</span><br><span class="line">    ├─config</span><br><span class="line">    │      config.go</span><br><span class="line">    │</span><br><span class="line">    ├─handler</span><br><span class="line">    │      cartlisthandler.go</span><br><span class="line">    │      categorylisthandler.go</span><br><span class="line">    │      flashsalehandler.go</span><br><span class="line">    │      homebannerhandler.go</span><br><span class="line">    │      orderlisthandler.go</span><br><span class="line">    │      productcommenthandler.go</span><br><span class="line">    │      productdetailhandler.go</span><br><span class="line">    │      recommendhandler.go</span><br><span class="line">    │      routes.go</span><br><span class="line">    │</span><br><span class="line">    ├─logic</span><br><span class="line">    │      cartlistlogic.go</span><br><span class="line">    │      categorylistlogic.go</span><br><span class="line">    │      flashsalelogic.go</span><br><span class="line">    │      homebannerlogic.go</span><br><span class="line">    │      orderlistlogic.go</span><br><span class="line">    │      productcommentlogic.go</span><br><span class="line">    │      productdetaillogic.go</span><br><span class="line">    │      recommendlogic.go</span><br><span class="line">    │</span><br><span class="line">    ├─svc</span><br><span class="line">    │      servicecontext.go</span><br><span class="line">    │</span><br><span class="line">    └─types</span><br><span class="line">            types.go</span><br></pre></td></tr></table></figure>

<h2 id="admin-层代码"><a href="#admin-层代码" class="headerlink" title="admin 层代码"></a>admin 层代码</h2><h3 id="order目录"><a href="#order目录" class="headerlink" title="order目录"></a>order目录</h3><ul>
<li><p>目录为： E:\proj\gowork\studyGoZero\apps\order</p>
</li>
<li><p>执行如下命令即可初始化<code>order admin</code>代码，注意<code>order admin</code>为<code>api</code>服务，<strong>直接对前端提供HTTP接口</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E:\proj\gowork\studyGoZero\apps\order&gt; goctl api new admin</span><br></pre></td></tr></table></figure>
</li>
<li><p>代码结构如下</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">─admin</span><br><span class="line">│  │  admin.api</span><br><span class="line">│  │  admin.go</span><br><span class="line">│  │</span><br><span class="line">│  ├─etc</span><br><span class="line">│  │      admin-api.yaml</span><br><span class="line">│  │</span><br></pre></td></tr></table></figure>

<ul>
<li><p>生成的服务代码我们可以直接运行<code>go run admin.go</code>，默认侦听在8888端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS E:\proj\gowork\studyGoZero\apps\order\admin&gt; go run .\admin.go </span><br><span class="line">Starting server at 0.0.0.0:8888...</span><br></pre></td></tr></table></figure>
</li>
<li><p>对于rmq服务我们会使用go-zero提供的 <a target="_blank" rel="noopener" href="https://github.com/zeromicro/go-queue/tree/master/kq">kq</a> 功能，这里先初始化<code>main.go</code></p>
</li>
</ul>
<h3 id="其他层"><a href="#其他层" class="headerlink" title="其他层"></a>其他层</h3><ul>
<li>pay、pruduct、recommend、reply、user 等按照同样的方式进行初始化</li>
</ul>
<h2 id="rpc服务层"><a href="#rpc服务层" class="headerlink" title="rpc服务层"></a>rpc服务层</h2><ul>
<li><p>Goctl Rpc是<code>goctl</code>脚手架下的一个rpc服务代码生成模块，支持proto模板生成和rpc服务代码生成，通过此工具生成代码你只需要关注业务逻辑编写而不用去编写一些重复性的代码</p>
</li>
<li><p>作者博客中初始化rpc使用的这种 <code>goctl rpc new rpc</code> ，并不推荐，研究代码后发现和作者提供的仓库代码不一致，使用的第二种方式生成的rpc服务层的代码和目录：<code>通过指定proto生成rpc服务</code></p>
</li>
<li><p>因为BFF只负责数据的组装工作，数据真正的来源是各个微服务通过RPC接口提供，接下来我们来定义各个微服务的proto。如下展示的订单列表页面由两部分数据组成，分别是订单数据和商品数据，也就是我们的BFF需要依赖order-rpc和product-rpc来完成该页面数据的组装，下面我们分别来定义order-rpc和product-rpc</p>
</li>
</ul>
<p><img src="/aposts/4d2d858d/image-20230725100643383.png" alt="image-20230725100643383"></p>
<h3 id="order层"><a href="#order层" class="headerlink" title="order层"></a>order层</h3><ul>
<li>在<code>E:\proj\gowork\studyGoZero\apps\order\rpc\order.proto</code>，定义如下，<code>service</code>名字为<code>Order</code>，添加了<code>Orders</code>获取订单列表<code>rpc</code>接口。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">syntax = &quot;proto3&quot;;</span><br><span class="line"></span><br><span class="line">package order;</span><br><span class="line">option go_package = &quot;./order&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">service Order &#123;</span><br><span class="line">  rpc Orders(OrdersRequest) returns(OrdersResponse);</span><br><span class="line">  rpc CreateOrder(CreateOrderRequest) returns (CreateOrderResponse);</span><br><span class="line">  rpc CreateOrderCheck(CreateOrderRequest) returns (CreateOrderResponse);</span><br><span class="line">  rpc RollbackOrder (CreateOrderRequest) returns (CreateOrderResponse);</span><br><span class="line">  rpc CreateOrderDTM(AddOrderReq) returns (AddOrderResp);</span><br><span class="line">  rpc CreateOrderDTMRevert(AddOrderReq) returns(AddOrderResp);</span><br><span class="line">  rpc GetOrderById(GetOrderByIdReq) returns (GetOrderByIdResp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">....</span><br></pre></td></tr></table></figure>

<p>使用如下命令重新生成代码，注意这里需要依赖<strong>protoc-gen-go</strong>和<strong>protoc-gen-go-grpc</strong>两个插件，木有安装的话执行下面命令会报错:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS E:\proj\gowork\studyGoZero\apps\order\rpc&gt;  goctl rpc protoc order.proto --go_out=. --go-grpc_out=. --zrpc_out=.</span><br><span class="line">Done.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意最终生成的服务端的代码目录为：E:\proj\gowork\studyGoZero\apps\order\rpc\orderclient\order.go</p>
</blockquote>
<p>目录结构如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">PS E:\proj\gowork\studyGoZero\apps\order\rpc&gt; tree /f</span><br><span class="line">卷 软件盘 的文件夹 PATH 列表</span><br><span class="line">卷序列号为 240F-1787</span><br><span class="line">E:.</span><br><span class="line">│  order.go</span><br><span class="line">│  order.proto</span><br><span class="line">│</span><br><span class="line">├─etc</span><br><span class="line">│      order.yaml</span><br><span class="line">│</span><br><span class="line">├─internal</span><br><span class="line">│  ├─config</span><br><span class="line">│  │      config.go</span><br><span class="line">│  │</span><br><span class="line">│  ├─logic</span><br><span class="line">│  │      createorderchecklogic.go</span><br><span class="line">│  │      createorderdtmlogic.go</span><br><span class="line">│  │      createorderdtmrevertlogic.go</span><br><span class="line">│  │      createorderlogic.go</span><br><span class="line">│  │      getorderbyidlogic.go</span><br><span class="line">│  │      orderslogic.go</span><br><span class="line">│  │      rollbackorderlogic.go</span><br><span class="line">│  │</span><br><span class="line">│  ├─server</span><br><span class="line">│  │      orderserver.go</span><br><span class="line">│  │</span><br><span class="line">│  └─svc</span><br><span class="line">│          servicecontext.go</span><br><span class="line">│</span><br><span class="line">├─order</span><br><span class="line">│      order.pb.go</span><br><span class="line">│      order_grpc.pb.go</span><br><span class="line">│</span><br><span class="line">└─orderclient</span><br><span class="line">        order.go</span><br></pre></td></tr></table></figure>

<ul>
<li>本地安装<a target="_blank" rel="noopener" href="https://github.com/etcd-io/etcd/releases">etcd</a>，打开<code>E:\app\etcd-v3.4.27-windows-amd64\etcd.exe</code>启动服务</li>
</ul>
<blockquote>
<p> etcd是一个分布式一致性键值存储，其主要用于分布式系统的共享配置和服务发现。</p>
<p> etcd由Go语言编写</p>
</blockquote>
<ul>
<li>生成好后然后启动<code>order-rpc</code>服务，需要连接etcd服务</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PS E:\proj\gowork\studyGoZero\apps\order\rpc&gt; go run .\order.go</span><br><span class="line">Starting rpc server at 0.0.0.0:8080...</span><br><span class="line">&#123;&quot;@timestamp&quot;:&quot;2023-07-24T17:03:51.723+08:00&quot;,&quot;caller&quot;:&quot;stat/usage.go:61&quot;,&quot;content&quot;:&quot;CPU: 0m, MEMORY: Alloc=3.2Mi, TotalAlloc=6.1Mi, Sys=17.9Mi, NumGC=3&quot;,&quot;level&quot;:&quot;stat&quot;&#125;</span><br><span class="line">&#123;&quot;@timestamp&quot;:&quot;2023-07-24T17:03:51.737+08:00&quot;,&quot;caller&quot;:&quot;load/sheddingstat.go:61&quot;,&quot;content&quot;:&quot;(rpc) shedding_stat [1m], cpu: 0, total: 0, pass: 0, drop: 0&quot;,&quot;level&quot;:&quot;stat&quot;&#125;</span><br><span class="line">&#123;&quot;@timestamp&quot;:&quot;2023-07-24T17:04:51.711+08:00&quot;,&quot;caller&quot;:&quot;stat/usage.go:61&quot;,&quot;content&quot;:</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在E:\proj\gowork\studyGoZero\apps\order\rpc\etc\order.yaml中，可以看到etcd的连接服务器地址，和order-rpc启动的地址信息：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Name:</span> <span class="string">order.rpc</span></span><br><span class="line"><span class="attr">ListenOn:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:8080</span></span><br><span class="line"><span class="attr">Etcd:</span></span><br><span class="line"><span class="attr">Hosts:</span></span><br><span class="line">	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:2379</span></span><br><span class="line"><span class="attr">Key:</span> <span class="string">order.rpc</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="product"><a href="#product" class="headerlink" title="product"></a>product</h3><p>在<code>E:\proj\gowork\studyGoZero\apps\product\rpc\product.proto</code>，定义如下，<code>service</code>名字为<code>Order</code>，添加了<code>product</code>产品的<code>rpc</code>接口。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">syntax = &quot;proto3&quot;;</span><br><span class="line"></span><br><span class="line">package product;</span><br><span class="line">option go_package = &quot;./product&quot;;</span><br><span class="line"></span><br><span class="line">service Product &#123;</span><br><span class="line">  rpc Product(ProductItemRequest) returns (ProductItem) ;</span><br><span class="line">  rpc Products(ProductRequest) returns(ProductResponse);</span><br><span class="line">  rpc ProductList(ProductListRequest) returns(ProductListResponse);</span><br><span class="line">  rpc OperationProducts(OperationProductsRequest) returns (OperationProductsResponse);</span><br><span class="line">  rpc UpdateProductStock(UpdateProductStockRequest) returns (UpdateProductStockResponse);</span><br><span class="line">  rpc CheckAndUpdateStock(CheckAndUpdateStockRequest) returns (CheckAndUpdateStockResponse);</span><br><span class="line">  rpc CheckProductStock(UpdateProductStockRequest) returns (UpdateProductStockResponse);</span><br><span class="line">  rpc RollbackProductStock(UpdateProductStockRequest) returns (UpdateProductStockResponse);</span><br><span class="line">  rpc DecrStock(DecrStockRequest) returns(DecrStockResponse);</span><br><span class="line">  rpc DecrStockRevert(DecrStockRequest) returns(DecrStockResponse);</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>在<code>E:\proj\gowork\studyGoZero\apps\product\rpc\etc\product.yaml</code>配置启动服务地址端口为8081</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Name: product.rpc</span><br><span class="line">ListenOn: 0.0.0.0:8081</span><br><span class="line">Etcd:</span><br><span class="line">  Hosts:</span><br><span class="line">  - 127.0.0.1:2379</span><br><span class="line">  Key: product.rpc</span><br></pre></td></tr></table></figure>

<ul>
<li>启动<code>product-rpc</code>服务，需要连接etcd服务</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS E:\proj\gowork\studyGoZero\apps\product\rpc&gt; go run .\product.go</span><br><span class="line">Starting rpc server at 0.0.0.0:8081...</span><br></pre></td></tr></table></figure>

<h2 id="BUFF-层配置"><a href="#BUFF-层配置" class="headerlink" title="BUFF 层配置"></a>BUFF 层配置</h2><ul>
<li><p>因为我们的BFF需要依赖order.rpc和product.rpc，我们需要先添加配置文件(<code>E:\proj\gowork\studyGoZero\apps\app\api\etc\api-api.yaml</code>)，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Name: api-api</span><br><span class="line">Host: 0.0.0.0</span><br><span class="line">Port: 8888</span><br><span class="line">OrderRPC:</span><br><span class="line">    Etcd:</span><br><span class="line">        Hosts:</span><br><span class="line">          - 127.0.0.1:2379</span><br><span class="line">        Key: order.rpc</span><br><span class="line">ProductRPC:</span><br><span class="line">  Etcd:</span><br><span class="line">    Hosts:</span><br><span class="line">      - 127.0.0.1:2379</span><br><span class="line">    Key: product.rpc</span><br></pre></td></tr></table></figure>
</li>
<li><p>然后在<code>E:\proj\gowork\studyGoZero\apps\app\api\internal\svc\servicecontext.go</code>中添加RPC的客户端，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">package svc</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;example.com/studyGoZero/apps/app/api/internal/config&quot;</span><br><span class="line">	&quot;example.com/studyGoZero/apps/order/rpc/orderclient&quot;</span><br><span class="line">	&quot;example.com/studyGoZero/apps/product/rpc/productclient&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">type ServiceContext struct &#123;</span><br><span class="line">	Config     config.Config</span><br><span class="line">	OrderRPC   orderclient.Order</span><br><span class="line">	ProductRPC productclient.Product</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func NewServiceContext(c config.Config) *ServiceContext &#123;</span><br><span class="line">	return &amp;ServiceContext&#123;</span><br><span class="line">		Config: c,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<p>最后只要在订单接口的<code>E:\proj\gowork\studyGoZero\apps\app\api\internal\logic\orderlistlogic.go</code>方法中添加逻辑就可以啦，这里只是演示，所以会比较简单：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">func (l *OrderListLogic) OrderList(req *types.OrderListRequest) (resp *types.OrderListResponse, err error) &#123;</span><br><span class="line">	orderRet, err := l.svcCtx.OrderRPC.Orders(l.ctx, &amp;order.OrdersRequest&#123;UserId: req.UID&#125;)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		return nil, err</span><br><span class="line">	&#125;</span><br><span class="line">	var pids []string</span><br><span class="line">	for _, o := range orderRet.Orders &#123;</span><br><span class="line">		pids = append(pids, strconv.Itoa(int(o.Id)))</span><br><span class="line">	&#125;</span><br><span class="line">	productRet, err := l.svcCtx.ProductRPC.Products(l.ctx, &amp;product.ProductRequest&#123;ProductIds: strings.Join(pids, &quot;,&quot;)&#125;)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		return nil, err</span><br><span class="line">	&#125;</span><br><span class="line">	var orders []*types.Order</span><br><span class="line">	for _, o := range orderRet.Orders &#123;</span><br><span class="line">		if p, ok := productRet.Products[o.Id]; ok &#123;</span><br><span class="line">			orders = append(orders, &amp;types.Order&#123;</span><br><span class="line">				OrderID:     o.Orderid,</span><br><span class="line">				ProductName: p.Name,</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	return &amp;types.OrderListResponse&#123;Orders: orders&#125;, nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><ul>
<li>请确保order、product 的rpc服务器已经启动</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PS E:\proj\gowork\studyGoZero\apps\product\rpc&gt; go run .\product.go</span><br><span class="line">Starting rpc server at 0.0.0.0:8081...</span><br><span class="line"></span><br><span class="line">PS E:\proj\gowork\studyGoZero\apps\order\rpc&gt; go run .\order.go</span><br><span class="line">Starting rpc server at 0.0.0.0:8080...</span><br></pre></td></tr></table></figure>

<ul>
<li>启动api层服务</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">E:\proj\gowork\studyGoZero\apps\app\api&gt;go run .\api.go</span><br><span class="line">Starting rpc server at 0.0.0.0:8888...</span><br></pre></td></tr></table></figure>

<ul>
<li>浏览器打开<code>http://127.0.0.1:8888/v1/order/list?uid=123</code> 发现报错空指针</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;content&quot;:&quot;(/v1/order/list?uid=123 - 127.0.0.1:57933) runtime error: invalid memory address or nil pointer dereference\ngoroutine 57 [running]:\nruntime/debug.Stack()\n\tE:/app/Go/src/runtime/debug/stack.go:24 +0x65\ngithub.com/zeromicro/go-zero/rest/handler.RecoverHandler.func1.1()\n\tC:/Users/Administrator/go/pkg/mod/github.com/zeromicro/go-zero@v1.5.4/rest/handler/recoverhandler.go:16 +0x66\npanic(&#123;0x1f56680, 0x331f9d0&#125;)\n\tE:/app/Go/src/runtime/panic.go:884 +0x213\nexample.com/studyGoZero/apps/app/api/internal/logic.(*OrderListLogic).OrderList(0xc0002cfcf8, 0xc00011e380)\n\tE:/proj/gowork/studyGoZero/apps/app/api/internal/logic/orderlistlogic.go:31</span><br></pre></td></tr></table></figure>

<ul>
<li>虽然报错 了，但是可以知道整个服务已经是通的，因为现在并没有订单的任何数据</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li>api层- 对外的BFF服务。接受来自客户端的请求，暴露HTTP接口。本次实例启动了api.go，并且连接了order和product的rpc</li>
<li><code>api/api.api</code> 为具体的对我暴露的请求</li>
<li><code>app\api\internal\logic</code> 对应<code>api/api.api</code>为对外暴露请求的具体逻辑，具体代码又调用了order和product的rpc的逻辑</li>
</ul>
<p><img src="/aposts/4d2d858d/image-20230725145056412.png" alt="image-20230725145056412"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://louis-me.github.io/aposts/f076e5a8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="一个正经的测试工程师">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="施坤的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/aposts/f076e5a8/" class="post-title-link" itemprop="url">go操作mongodb</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-07-12 16:25:39" itemprop="dateCreated datePublished" datetime="2023-07-12T16:25:39+08:00">2023-07-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-07-13 17:39:13" itemprop="dateModified" datetime="2023-07-13T17:39:13+08:00">2023-07-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
                </span>
            </span>

          
            <span id="/aposts/f076e5a8/" class="post-meta-item leancloud_visitors" data-flag-title="go操作mongodb" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/aposts/f076e5a8/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/aposts/f076e5a8/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><ul>
<li>本次主要在win10, go 1.20.4下，利用go 操作mongodb</li>
</ul>
<h3 id="安装启动"><a href="#安装启动" class="headerlink" title="安装启动"></a>安装启动</h3><ul>
<li>打开<a target="_blank" rel="noopener" href="https://www.mongodb.com/download-center/community/releases/archive">地址</a>下载安装包</li>
<li>解压后目录如下，添加两个文件夹data和logs文件夹，用来存储mongodb的数据和日志文件</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">D:\app\mongodb-win32-x86_64-windows-6.0.6&gt;tree</span><br><span class="line">卷 项目盘 的文件夹 PATH 列表</span><br><span class="line">卷序列号为 8C07-3198</span><br><span class="line">D:.</span><br><span class="line">├─bin</span><br><span class="line">├─data</span><br><span class="line">│  ├─diagnostic.data</span><br><span class="line">│  └─journal</span><br><span class="line">└─logs</span><br></pre></td></tr></table></figure>

<ul>
<li>启动服务</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D:\app\mongodb-win32-x86_64-windows-6.0.6\bin&gt;mongod.exe --dbpath D:\app\mongodb-win32-x86_64-windows-6.0.6\data --logpath D:\app\mongodb-win32-x86_64-windows-6.0.6\logs\mongodb.log</span><br></pre></td></tr></table></figure>

<ul>
<li><p>启动成功后data目录下会自动生成MongoDB数据库的一些信息，logs目录下存的则是日志文件，文件内容是启动信息</p>
</li>
<li><p>安装<a target="_blank" rel="noopener" href="https://www.mongodb.com/try/download/compass">连接工具mongodb compass</a>，连接mongodb，地址是本地<code>127.0.0.1</code>，默认端口是27017</p>
</li>
</ul>
<p><img src="/aposts/f076e5a8/image-20230712171639801.png" alt="image-20230712171639801"></p>
<ul>
<li>默认连接没有用户名和密码，需要进行设置</li>
<li>点击底部菜单，输入<code>use admin</code></li>
</ul>
<p><img src="/aposts/f076e5a8/image-20230712180544757.png" alt="image-20230712180544757"></p>
<ul>
<li>然后输入</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">db.createUser(&#123;</span><br><span class="line">  user: &#x27;admin&#x27;,  // 用户名</span><br><span class="line">  pwd: &#x27;123456&#x27;,  // 密码</span><br><span class="line">  roles:[&#123;</span><br><span class="line">    role: &#x27;root&#x27;,  // 角色---超级管理员才可以使用该角色</span><br><span class="line">    db: &#x27;admin&#x27;  // 数据库</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="/aposts/f076e5a8/image-20230712180758846.png" alt="image-20230712180758846"></p>
<ul>
<li>其他常用语句</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; show dbs</span><br><span class="line">admin   132.00 KiB</span><br><span class="line">config  108.00 KiB</span><br><span class="line">local    72.00 KiB</span><br><span class="line">user     40.00 KiB</span><br><span class="line">&gt;db.auth(&quot;admin&quot;,&quot;123456&quot;) -- 授权</span><br><span class="line">&#123; ok: 1 &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>mongodb compass 中为admin数据库中加入users的collection</li>
</ul>
<p><img src="/aposts/f076e5a8/image-20230712194613916.png" alt="image-20230712194613916"></p>
<h2 id="代码编写"><a href="#代码编写" class="headerlink" title="代码编写"></a>代码编写</h2><h3 id="服务端代码"><a href="#服务端代码" class="headerlink" title="服务端代码"></a>服务端代码</h3><ul>
<li>初始化项目</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd E:\proj\gowork</span><br><span class="line">mkdir studyMongoDB</span><br><span class="line">cd studyMongoDB</span><br><span class="line">go mod init example.com/studyMongoDB</span><br></pre></td></tr></table></figure>

<ul>
<li>用vscode 打开文件夹，安装依赖</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">go get -u github.com/gin-gonic/gin</span><br><span class="line">go get go.mongodb.org/mongo-driver/mongo</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>编写测试代码</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//main.go</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;go.mongodb.org/mongo-driver/bson&quot;</span></span><br><span class="line">	<span class="string">&quot;go.mongodb.org/mongo-driver/mongo&quot;</span></span><br><span class="line">	<span class="string">&quot;go.mongodb.org/mongo-driver/mongo/options&quot;</span></span><br><span class="line">	<span class="string">&quot;go.mongodb.org/mongo-driver/mongo/readpref&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">	Id   <span class="type">int32</span></span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line">	Age  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// pool 连接池模式</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ConnectToDB</span><span class="params">(uri, name <span class="type">string</span>, timeout time.Duration, num <span class="type">uint64</span>)</span></span> (*mongo.Database, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="comment">// 设置连接超时时间</span></span><br><span class="line">	ctx, cancel := context.WithTimeout(context.Background(), timeout)</span><br><span class="line">	<span class="keyword">defer</span> cancel()</span><br><span class="line">	<span class="comment">// 通过传进来的uri连接相关的配置</span></span><br><span class="line">	o := options.Client().ApplyURI(uri)</span><br><span class="line">	<span class="comment">// 设置最大连接数 - 默认是100 ，不设置就是最大 max 64</span></span><br><span class="line">	o.SetMaxPoolSize(num)</span><br><span class="line">	<span class="comment">// 发起链接</span></span><br><span class="line">	client, err := mongo.Connect(ctx, o)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(err)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 判断服务是不是可用</span></span><br><span class="line">	<span class="keyword">if</span> err = client.Ping(context.Background(), readpref.Primary()); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 返回 client</span></span><br><span class="line">	<span class="keyword">return</span> client.Database(name), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	toDB, err := ConnectToDB(<span class="string">&quot;mongodb://admin:123456@localhost:27017&quot;</span>, <span class="string">&quot;admin&quot;</span>, time.Duration(<span class="number">2</span>), <span class="number">50</span>)</span><br><span class="line">	fmt.Println(err)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(err)</span><br><span class="line">		fmt.Println(toDB)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;sussces&quot;</span>)</span><br><span class="line">	doc := Student&#123;Name: <span class="string">&quot;刘刘&quot;</span>, Age: <span class="number">18</span>, Id: <span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line">	coll := toDB.Collection(<span class="string">&quot;users&quot;</span>)</span><br><span class="line">	objId, err := coll.InsertOne(context.TODO(), doc)</span><br><span class="line">	fmt.Println(objId)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;新增成功&quot;</span>)</span><br><span class="line">	<span class="keyword">var</span> one Student</span><br><span class="line">	filter := bson.D&#123;&#123;<span class="string">&quot;id&quot;</span>, <span class="number">1</span>&#125;&#125;</span><br><span class="line">	<span class="keyword">var</span> ctx context.Context</span><br><span class="line">	<span class="keyword">var</span> cancel <span class="function"><span class="keyword">func</span><span class="params">()</span></span></span><br><span class="line">	ctx, cancel = context.WithTimeout(context.Background(), <span class="number">5</span>*time.Second)</span><br><span class="line">	<span class="keyword">defer</span> cancel()</span><br><span class="line">	err = coll.FindOne(ctx, filter).Decode(&amp;one)</span><br><span class="line">	<span class="keyword">if</span> err == mongo.ErrNoDocuments &#123;</span><br><span class="line">		<span class="comment">// Do something when no record was found</span></span><br><span class="line">		fmt.Println(<span class="string">&quot;record does not exist&quot;</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(one)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>运行结果</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PS E:\proj\gowork\studyMongoDb&gt; <span class="keyword">go</span> run .\main.<span class="keyword">go</span></span><br><span class="line">&lt;<span class="literal">nil</span>&gt;</span><br><span class="line">sussces</span><br><span class="line">&amp;&#123;ObjectID(<span class="string">&quot;64ae992a5063fc95642035ed&quot;</span>)&#125;</span><br><span class="line">新增成功</span><br><span class="line">&#123;<span class="number">1</span> 刘刘 <span class="number">18</span>&#125;</span><br><span class="line">PS E:\proj\gowork\studyMongoDb&gt; </span><br></pre></td></tr></table></figure>

<h3 id="gin和mongodb"><a href="#gin和mongodb" class="headerlink" title="gin和mongodb"></a>gin和mongodb</h3><ul>
<li><code>dbs\db.go</code>为连接数据库代码</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> dbs</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;go.mongodb.org/mongo-driver/mongo&quot;</span></span><br><span class="line">	<span class="string">&quot;go.mongodb.org/mongo-driver/mongo/options&quot;</span></span><br><span class="line">	<span class="string">&quot;go.mongodb.org/mongo-driver/mongo/readpref&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	Client     *mongo.Client     <span class="comment">// database 话柄</span></span><br><span class="line">	Collection *mongo.Collection <span class="comment">// collection 话柄</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// pool 连接池模式</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ConnectToDB</span><span class="params">(uri, name <span class="type">string</span>)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	cb := context.Background()</span><br><span class="line">	<span class="comment">// 设置连接超时时间</span></span><br><span class="line">	ctx1, cancel := context.WithTimeout(cb, time.Duration(<span class="number">2</span>))</span><br><span class="line">	<span class="keyword">defer</span> cancel()</span><br><span class="line">	<span class="comment">// 通过传进来的uri连接相关的配置</span></span><br><span class="line">	o := options.Client().ApplyURI(uri)</span><br><span class="line">	<span class="comment">// 设置最大连接数 - 默认是100 ，不设置就是最大 max 64</span></span><br><span class="line">	o.SetMaxPoolSize(<span class="number">50</span>)</span><br><span class="line">	<span class="comment">// 发起链接</span></span><br><span class="line">	client, err := mongo.Connect(ctx1, o)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 判断服务是不是可用</span></span><br><span class="line">	<span class="keyword">if</span> err = client.Ping(cb, readpref.Primary()); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 默认连接的数据库</span></span><br><span class="line">	_db := client.Database(name)</span><br><span class="line"></span><br><span class="line">	Client = client</span><br><span class="line">	<span class="comment">// 默认连接集合为users</span></span><br><span class="line">	Collection = _db.Collection(<span class="string">&quot;users&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>models/user.go</code> 操作实体类</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;example.com/studyMongoDb/dbs&quot;</span></span><br><span class="line">	<span class="string">&quot;go.mongodb.org/mongo-driver/bson&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Key      <span class="type">string</span> <span class="string">`json:&quot;key&quot;`</span></span><br><span class="line">	Name     <span class="type">string</span> <span class="string">`json:&quot;name&quot;`</span></span><br><span class="line">	Password <span class="type">string</span> <span class="string">`json:&quot;password&quot;`</span></span><br><span class="line">	Id       <span class="type">int</span>    <span class="string">`json:&quot;id&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span></span> GetList(ctx context.Context) (users []User, err1 <span class="type">error</span>) &#123;</span><br><span class="line">	cur, err := dbs.Collection.Find(ctx, bson.D&#123;&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> err := cur.Err(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	err = cur.All(ctx, &amp;users)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	cur.Close(ctx)</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span></span> Query() (user []User, err1 <span class="type">error</span>) &#123;</span><br><span class="line">	cb := context.Background()</span><br><span class="line">	fil := bson.M&#123;<span class="string">&quot;key&quot;</span>: u.Key&#125;</span><br><span class="line">	<span class="comment">// 模糊查询</span></span><br><span class="line">	<span class="comment">// bson.M&#123;&quot;Name&quot;: primitive.Regex&#123;Pattern: u.name&#125;&#125;</span></span><br><span class="line">	cur, err := dbs.Collection.Find(cb, fil)</span><br><span class="line">	<span class="comment">// dbs.Collection.FindOne(cb, fil).Decode(&amp;user)</span></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> err := cur.Err(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	err = cur.All(cb, &amp;user)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	cur.Close(cb)</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span></span> Add() (err <span class="type">error</span>) &#123;</span><br><span class="line">	objId, err1 := dbs.Collection.InsertOne(context.TODO(), &amp;u)</span><br><span class="line">	<span class="keyword">if</span> err1 != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;insert into error:&quot;</span>, err)</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;录入数据成功,&quot;</span>, objId)</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span></span> EditOne() (err1 <span class="type">error</span>) &#123;</span><br><span class="line">	fil := bson.M&#123;<span class="string">&quot;key&quot;</span>: u.Key&#125;</span><br><span class="line">	update := bson.M&#123;<span class="string">&quot;$set&quot;</span>: u&#125;</span><br><span class="line">	<span class="comment">// .update(&#123;条件&#125;,&#123;修改后的数据&#125;)</span></span><br><span class="line">	updateResult, err := dbs.Collection.UpdateOne(context.Background(), fil, update)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line">	log.Println(<span class="string">&quot;collection.UpdateOne:&quot;</span>, updateResult)</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span></span> Delete() (err1 <span class="type">error</span>) &#123;</span><br><span class="line">	fil := bson.M&#123;<span class="string">&quot;key&quot;</span>: u.Key&#125;</span><br><span class="line">	deleteResult, err := dbs.Collection.DeleteOne(context.Background(), fil)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line">	log.Println(<span class="string">&quot;collection.DeleteOne:&quot;</span>, deleteResult)</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><code>api\users.go</code> 调用model层代码</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> api</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;example.com/studyMongoDb/models&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">UserAdd</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> user models.User</span><br><span class="line">	<span class="keyword">if</span> c.Bind(&amp;user) == <span class="literal">nil</span> &#123; <span class="comment">//把客户端格式传过来的数据绑定到结构体user中去</span></span><br><span class="line">		fmt.Println(<span class="string">&quot;data=&quot;</span>, user)</span><br><span class="line">		err := user.Add() <span class="comment">// 调用model层的对应方法</span></span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line">			c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">				<span class="string">&quot;msg&quot;</span>:  <span class="string">&quot;新增失败&quot;</span>,</span><br><span class="line">				<span class="string">&quot;code&quot;</span>: <span class="number">-1</span>,</span><br><span class="line">			&#125;)</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">				<span class="string">&quot;msg&quot;</span>:  <span class="string">&quot;新增成功&quot;</span>,</span><br><span class="line">				<span class="string">&quot;code&quot;</span>: <span class="number">1</span>,</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		c.JSON(<span class="number">400</span>, gin.H&#123;<span class="string">&quot;JSON=== status&quot;</span>: <span class="string">&quot;binding JSON error!&quot;</span>&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">UserList</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> user models.User</span><br><span class="line">	<span class="keyword">if</span> c.Bind(&amp;user) == <span class="literal">nil</span> &#123; <span class="comment">//把客户端格式传过来的数据绑定到结构体user中去</span></span><br><span class="line">		users, err := user.GetList(context.Background()) <span class="comment">// 调用model层的对应方法</span></span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line">			c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">				<span class="string">&quot;msg&quot;</span>:  <span class="string">&quot;获取列表失败&quot;</span>,</span><br><span class="line">				<span class="string">&quot;code&quot;</span>: <span class="number">-1</span>,</span><br><span class="line">			&#125;)</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">				<span class="string">&quot;msg&quot;</span>:   <span class="string">&quot;获取列表成功&quot;</span>,</span><br><span class="line">				<span class="string">&quot;code&quot;</span>:  <span class="number">1</span>,</span><br><span class="line">				<span class="string">&quot;users&quot;</span>: users,</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		c.JSON(<span class="number">400</span>, gin.H&#123;<span class="string">&quot;JSON=== status&quot;</span>: <span class="string">&quot;binding JSON error!&quot;</span>&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">UserEditOne</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> user models.User</span><br><span class="line">	<span class="keyword">if</span> c.Bind(&amp;user) == <span class="literal">nil</span> &#123;</span><br><span class="line">		err := user.EditOne()</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line">			c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">				<span class="string">&quot;msg&quot;</span>:  <span class="string">&quot;编辑失败&quot;</span>,</span><br><span class="line">				<span class="string">&quot;code&quot;</span>: <span class="number">-1</span>,</span><br><span class="line">			&#125;)</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">				<span class="string">&quot;msg&quot;</span>:  <span class="string">&quot;编辑成功&quot;</span>,</span><br><span class="line">				<span class="string">&quot;code&quot;</span>: <span class="number">1</span>,</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		c.JSON(<span class="number">400</span>, gin.H&#123;<span class="string">&quot;JSON=== status&quot;</span>: <span class="string">&quot;binding JSON error!&quot;</span>&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">UserDelete</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> user models.User</span><br><span class="line">	<span class="keyword">if</span> c.Bind(&amp;user) == <span class="literal">nil</span> &#123;</span><br><span class="line">		err := user.Delete()</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line">			c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">				<span class="string">&quot;msg&quot;</span>:  <span class="string">&quot;删除失败&quot;</span>,</span><br><span class="line">				<span class="string">&quot;code&quot;</span>: <span class="number">-1</span>,</span><br><span class="line">			&#125;)</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">				<span class="string">&quot;msg&quot;</span>:  <span class="string">&quot;删除成功&quot;</span>,</span><br><span class="line">				<span class="string">&quot;code&quot;</span>: <span class="number">1</span>,</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		c.JSON(<span class="number">400</span>, gin.H&#123;<span class="string">&quot;JSON=== status&quot;</span>: <span class="string">&quot;binding JSON error!&quot;</span>&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">UserQuery</span><span class="params">(c *gin.Context, key <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">	user := models.User&#123;</span><br><span class="line">		Key: key,</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> c.Bind(&amp;user) == <span class="literal">nil</span> &#123;</span><br><span class="line">		user, err := user.Query()</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line">			c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">				<span class="string">&quot;msg&quot;</span>:  <span class="string">&quot;查询失败&quot;</span>,</span><br><span class="line">				<span class="string">&quot;code&quot;</span>: <span class="number">-1</span>,</span><br><span class="line">			&#125;)</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">				<span class="string">&quot;msg&quot;</span>:  <span class="string">&quot;查询成功&quot;</span>,</span><br><span class="line">				<span class="string">&quot;code&quot;</span>: <span class="number">1</span>,</span><br><span class="line">				<span class="string">&quot;user&quot;</span>: user,</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		c.JSON(<span class="number">400</span>, gin.H&#123;<span class="string">&quot;JSON=== status&quot;</span>: <span class="string">&quot;binding JSON error!&quot;</span>&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><code>routers/router.go</code> 路由层，调用api层的代码</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> routers</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;example.com/studyMongoDb/api&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitRouter</span><span class="params">()</span></span> *gin.Engine &#123;</span><br><span class="line"></span><br><span class="line">	router := gin.Default()</span><br><span class="line">	router.POST(<span class="string">&quot;/UserAdd&quot;</span>, api.UserAdd)</span><br><span class="line">	router.GET(<span class="string">&quot;/UserList&quot;</span>, api.UserList)</span><br><span class="line">	router.POST(<span class="string">&quot;/UserEditOne&quot;</span>, api.UserEditOne)</span><br><span class="line">	router.POST(<span class="string">&quot;/UserDelete&quot;</span>, api.UserDelete)</span><br><span class="line">	router.GET(<span class="string">&quot;/UserQuery/:key&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		key := c.Param(<span class="string">&quot;key&quot;</span>)</span><br><span class="line">		api.UserQuery(c, key)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> router</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><code>main.go</code> 代码入口</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;example.com/studyMongoDb/dbs&quot;</span></span><br><span class="line">	<span class="string">&quot;example.com/studyMongoDb/routers&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	dbs.ConnectToDB(<span class="string">&quot;mongodb://admin:123456@localhost:27017&quot;</span>, <span class="string">&quot;admin&quot;</span>)</span><br><span class="line">	router := routers.InitRouter()</span><br><span class="line">	router.Run(<span class="string">&quot;:8000&quot;</span>)</span><br><span class="line">	<span class="comment">// 优雅关闭连接</span></span><br><span class="line">	<span class="keyword">defer</span> dbs.Client.Disconnect(context.TODO())</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>运行<code>main.go</code></li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">PS E:\proj\gowork\studyMongoDb&gt; <span class="keyword">go</span> run .\main.<span class="keyword">go</span></span><br><span class="line">[GIN-debug] [WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached.</span><br><span class="line"></span><br><span class="line">[GIN-debug] [WARNING] Running in <span class="string">&quot;debug&quot;</span> mode. Switch to <span class="string">&quot;release&quot;</span> mode in production.</span><br><span class="line"> - using env:   export GIN_MODE=release</span><br><span class="line"> - using code:  gin.SetMode(gin.ReleaseMode)</span><br><span class="line"></span><br><span class="line">[GIN-debug] POST   /UserAdd                  --&gt; example.com/studyMongoDb/api.UserAdd (<span class="number">3</span> handlers) </span><br><span class="line">[GIN-debug] GET    /UserList                 --&gt; example.com/studyMongoDb/api.UserList (<span class="number">3</span> handlers)</span><br><span class="line">[GIN-debug] POST   /UserEditOne              --&gt; example.com/studyMongoDb/api.UserEditOne (<span class="number">3</span> handlers)</span><br><span class="line">[GIN-debug] POST   /UserDelete               --&gt; example.com/studyMongoDb/api.UserDelete (<span class="number">3</span> handlers)</span><br><span class="line">[GIN-debug] GET    /UserQuery/:key           --&gt; example.com/studyMongoDb/routers.InitRouter.func1 (<span class="number">3</span> handlers)</span><br><span class="line">[GIN-debug] [WARNING] You trusted all proxies, this is NOT safe. We recommend you to set a value.</span><br><span class="line">Please check https:<span class="comment">//pkg.go.dev/github.com/gin-gonic/gin#readme-don-t-trust-all-proxies for details.</span></span><br><span class="line">[GIN-debug] Listening and serving HTTP on :<span class="number">8000</span></span><br></pre></td></tr></table></figure>

<h3 id="客户端代码"><a href="#客户端代码" class="headerlink" title="客户端代码"></a>客户端代码</h3><ul>
<li>测试的客户端代码，使用python</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">data =&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;test111&quot;</span>, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;1123456&quot;</span>, <span class="string">&quot;id&quot;</span>: <span class="number">2</span>, <span class="string">&quot;key&quot;</span>: <span class="string">&quot;t_key2&quot;</span>&#125;</span><br><span class="line">resp = requests.post(<span class="string">&quot;http://127.0.0.1:8000/UserAdd&quot;</span>, json=data)</span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data =&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;test1131&quot;</span>, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;123456811&quot;</span>, <span class="string">&quot;id&quot;</span>: <span class="number">1112</span>, <span class="string">&quot;key&quot;</span>: <span class="string">&quot;t_key1&quot;</span>&#125;</span><br><span class="line">resp = requests.post(<span class="string">&quot;http://127.0.0.1:8000/UserEditOne&quot;</span>, json=data)</span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">data =&#123;<span class="string">&quot;key&quot;</span>: <span class="string">&quot;t_key1&quot;</span>&#125;</span><br><span class="line">resp = requests.post(<span class="string">&quot;http://127.0.0.1:8000/UserDelete&quot;</span>, json=data)</span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">resp = requests.get(<span class="string">&quot;http://127.0.0.1:8000/UserQuery/t_key2/&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br><span class="line"></span><br><span class="line">resp = requests.get(<span class="string">&quot;http://127.0.0.1:8000/UserList&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://louis-me.github.io/aposts/c5af2022/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="一个正经的测试工程师">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="施坤的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/aposts/c5af2022/" class="post-title-link" itemprop="url">go操作redis</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-07-10 17:02:57" itemprop="dateCreated datePublished" datetime="2023-07-10T17:02:57+08:00">2023-07-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-07-29 20:51:57" itemprop="dateModified" datetime="2023-07-29T20:51:57+08:00">2023-07-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
                </span>
            </span>

          
            <span id="/aposts/c5af2022/" class="post-meta-item leancloud_visitors" data-flag-title="go操作redis" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/aposts/c5af2022/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/aposts/c5af2022/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>本次主要时在windows下，利用go 操作redis</p>
<h2 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><ul>
<li>Redis（Remote Dictionary Server )，即远程字典服务，它是一个开源的，使用ANSI C语言编写、遵守BSD协议、支持网络、可<strong>基于内存</strong>亦可持久化的日志型、<strong>Key-Value数据库</strong>，并提供多种语言的API。Redis 默认端口为 6379，是一个NoSQL数据库</li>
</ul>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><ul>
<li>打开<a target="_blank" rel="noopener" href="https://github.com/MicrosoftArchive/redis/releases">地址</a>下载安装包并安装，安装成功后在环境变量中可以看到，安装目录已经加入到了PATH中</li>
</ul>
<h3 id="启动服务端"><a href="#启动服务端" class="headerlink" title="启动服务端"></a>启动服务端</h3><ul>
<li>执行命令启动服务端</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">D:\app\Redis&gt;redis-server.exe redis.windows.conf</span><br><span class="line">[6436] 10 Jul 17:44:10.177 # Creating Server TCP listening socket *:6379: bind: No error</span><br></pre></td></tr></table></figure>

<ul>
<li>查看服务端口是否正常</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">D:\app\Redis&gt;netstat -an | findstr &quot;6379&quot;</span><br><span class="line">  TCP    0.0.0.0:6379           0.0.0.0:0              LISTENING</span><br><span class="line">  TCP    [::]:6379              [::]:0                 LISTENING</span><br></pre></td></tr></table></figure>

<h3 id="启动客户端"><a href="#启动客户端" class="headerlink" title="启动客户端"></a>启动客户端</h3><p>打开redis目录中的<code>redis.windows.conf</code></p>
<ul>
<li>配置Redis的设置最大占用内存，设置maxmemory参数，maxmemory是字节字节类型，如果不设置maxmemory或者设置为0,64位系统不限制内存，32位系统最多使用3GB内存。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># maxmemory &lt;bytes&gt;</span><br><span class="line"># 设置最大的内存为1G</span><br><span class="line">maxmemory 1000000000</span><br></pre></td></tr></table></figure>

<ul>
<li>执行命令</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D:\app\Redis&gt;redis-cli.exe -h 127.0.0.1 -p 6379</span><br></pre></td></tr></table></figure>

<ul>
<li>进行set和get操作</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set username hello</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get username</span><br><span class="line">&quot;hello&quot;</span><br><span class="line">127.0.0.1:6379&gt;SCAN 0 MATCH *  // 查询所有key</span><br><span class="line">127.0.0.1:6379&gt; FLUSHDB   //删除所有Key</span><br><span class="line">127.0.0.1:6379&gt; keys *  // 查询所有key</span><br><span class="line">1) &quot;cache:user:id:23&quot;</span><br><span class="line">127.0.0.1:6379&gt; del &quot;cache:user:id:admin&quot; // 删除指定key</span><br><span class="line">(integer) 1</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="go"><a href="#go" class="headerlink" title="go"></a>go</h2><h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><ul>
<li><p>使用gin框架</p>
</li>
<li><p>自定义Person结构体</p>
</li>
<li><p>实现对Person的增删改查。</p>
</li>
<li><p>根据id查询或查询所有、插入、修改、删除</p>
</li>
</ul>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><ul>
<li>先安装依赖文件</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">go get -u github.com/gin-gonic/gin</span><br><span class="line">go get github.com/redis/go-redis/v9</span><br></pre></td></tr></table></figure>

<ul>
<li>新建并初始化项目</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd E:\proj\gowork</span><br><span class="line">mkdir studyGin</span><br><span class="line">cd studyGin</span><br><span class="line">go mod init example.com/goRedis</span><br></pre></td></tr></table></figure>

<ul>
<li>用vscode ide编写代码</li>
<li><code>db\dbs.go</code>  主要存放连接redis的代码</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> db</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/redis/go-redis/v9&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Rdbs *redis.Client</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitRedis</span><span class="params">(ctx context.Context)</span></span> &#123;</span><br><span class="line">	rd := redis.NewClient(&amp;redis.Options&#123;</span><br><span class="line">		Addr:     <span class="string">&quot;localhost:6379&quot;</span>,</span><br><span class="line">		Password: <span class="string">&quot;&quot;</span>,</span><br><span class="line">		DB:       <span class="number">0</span>,</span><br><span class="line">	&#125;)</span><br><span class="line">	Rdbs = rd</span><br><span class="line">	<span class="comment">//清空当前数据库中的所有key，只要加了这个每次重新启动服务器，所有数据被清空</span></span><br><span class="line">	<span class="comment">// Rdbs.FlushDB(ctx)</span></span><br><span class="line">	_, err := Rdbs.Ping(ctx).Result() <span class="comment">// PING, &lt;nil&gt;</span></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;connect redis failed:&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Close</span><span class="params">()</span></span> &#123;</span><br><span class="line">	Rdbs.Close()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><code>model\users.go</code>  操作user的实体类，如曾删改查</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;example.com/goRedis/db&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Key      <span class="type">string</span> <span class="string">`json:&quot;key&quot;`</span></span><br><span class="line">	Name     <span class="type">string</span> <span class="string">`json:&quot;name&quot;`</span></span><br><span class="line">	Password <span class="type">string</span> <span class="string">`json:&quot;password&quot;`</span></span><br><span class="line">	Id       <span class="type">int</span>    <span class="string">`json:&quot;id&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 存储和读取redis时，不能直接存入结构体，必须进行序列号和反序列化</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 序列化</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span></span> MarshalBinary() (data []<span class="type">byte</span>, err <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> json.Marshal(u)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 反序列化</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span></span> UnmarshalBinary(data []<span class="type">byte</span>) (err <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> json.Unmarshal(data, u)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新增数据</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span></span> Add(ctx *context.Context) (err <span class="type">error</span>) &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// HMSet 批量设置 map[string]interface&#123;&#125;&#123;&quot;name&quot;: &quot;张&quot;, &quot;password&quot;: &quot;11111&quot;, &quot;id&quot;: 123&#125;</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">&quot;json.=&quot;</span>, u)</span><br><span class="line">	<span class="comment">// 必须转为[]byte, redis不支持直接存结构体</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 0 表示key永不过期</span></span><br><span class="line">	_, err = db.Rdbs.Set(*ctx, u.Key, u, <span class="number">0</span>).Result()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;db.Rdbs.Set,&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据key 获取到数据</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span></span> GetUser(ctx *context.Context) (user1 User, err <span class="type">error</span>) &#123;</span><br><span class="line"></span><br><span class="line">	err = db.Rdbs.Get(*ctx, u.Key).Scan(u)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;GetUser error&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	user1 = *u</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询所有</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span></span> QueryAll(ctx *context.Context) (user1 []User, er <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="comment">// keys, err := db.Rdbs.Keys(*ctx, &quot;[1-9]*&quot;)).Result()</span></span><br><span class="line">	keys, err := db.Rdbs.Keys(*ctx, <span class="string">&quot;*&quot;</span>).Result()</span><br><span class="line">	fmt.Println(<span class="string">&quot;key=&quot;</span>, keys)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;db.Rdbs.Keys error:&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> _, key := <span class="keyword">range</span> keys &#123;</span><br><span class="line">		err = db.Rdbs.Get(*ctx, key).Scan(u)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			fmt.Print(<span class="string">&quot;Rdbs.Get error&quot;</span>, err)</span><br><span class="line">			fmt.Println(<span class="string">&quot;key=&quot;</span>, key)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Println(<span class="string">&quot;query=&quot;</span>, *u)</span><br><span class="line">		user1 = <span class="built_in">append</span>(user1, *u)</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span></span> DeleteUser(ctx *context.Context) (err <span class="type">bool</span>) &#123;</span><br><span class="line">	<span class="comment">// 先判断key是否存在</span></span><br><span class="line">	<span class="keyword">if</span> db.Rdbs.Exists(*ctx, u.Key).Val() == <span class="number">1</span> &#123;</span><br><span class="line">		_, er := db.Rdbs.Del(*ctx, u.Key).Result()</span><br><span class="line">		<span class="keyword">if</span> er != <span class="literal">nil</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">&quot;DeleteUser error: &quot;</span>, err)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span></span> UpdateUser(ctx *context.Context) (err <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="comment">// 先判断key是否存在</span></span><br><span class="line">	<span class="keyword">if</span> db.Rdbs.Exists(*ctx, u.Key).Val() == <span class="number">1</span> &#123;</span><br><span class="line">		<span class="comment">// 必须转为[]byte, redis不支持直接存结构体</span></span><br><span class="line">		u1, _ := json.Marshal(u)</span><br><span class="line">		_, err = db.Rdbs.Set(*ctx, u.Key, u1, <span class="number">0</span>).Result()</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">&quot;UpdateUser error:&quot;</span>, err)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><code>api/users.go</code>  调用model层代码</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> api</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;example.com/goRedis/models&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">UserAdd</span><span class="params">(c *gin.Context, ctx *context.Context)</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;add=&quot;</span>, c)</span><br><span class="line">	<span class="keyword">var</span> user models.User</span><br><span class="line">	<span class="keyword">if</span> c.Bind(&amp;user) == <span class="literal">nil</span> &#123; <span class="comment">//把客户端格式传过来的数据绑定到结构体user中去</span></span><br><span class="line">		fmt.Println(<span class="string">&quot;data=&quot;</span>, user)</span><br><span class="line">		err := user.Add(ctx) <span class="comment">// 调用model层的对应方法</span></span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line">			c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">				<span class="string">&quot;msg&quot;</span>:  <span class="string">&quot;新增失败&quot;</span>,</span><br><span class="line">				<span class="string">&quot;code&quot;</span>: <span class="number">-1</span>,</span><br><span class="line">			&#125;)</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">				<span class="string">&quot;msg&quot;</span>:  <span class="string">&quot;新增成功&quot;</span>,</span><br><span class="line">				<span class="string">&quot;code&quot;</span>: <span class="number">1</span>,</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		c.JSON(<span class="number">400</span>, gin.H&#123;<span class="string">&quot;JSON=== status&quot;</span>: <span class="string">&quot;binding JSON error!&quot;</span>&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">UserGet</span><span class="params">(c *gin.Context, ctx *context.Context, key <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">	<span class="comment">// 接受key</span></span><br><span class="line">	users := models.User&#123;</span><br><span class="line">		Key: key,</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> c.Bind(&amp;users) == <span class="literal">nil</span> &#123;</span><br><span class="line">		users, err := users.GetUser(ctx)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line">			c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">				<span class="string">&quot;msg&quot;</span>:  <span class="string">&quot;获取失败&quot;</span>,</span><br><span class="line">				<span class="string">&quot;code&quot;</span>: <span class="number">-1</span>,</span><br><span class="line">				<span class="string">&quot;user&quot;</span>: users,</span><br><span class="line">			&#125;)</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">				<span class="string">&quot;msg&quot;</span>:  <span class="string">&quot;获取成功&quot;</span>,</span><br><span class="line">				<span class="string">&quot;code&quot;</span>: <span class="number">1</span>,</span><br><span class="line">				<span class="string">&quot;user&quot;</span>: users,</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		c.JSON(<span class="number">400</span>, gin.H&#123;<span class="string">&quot;JSON=== status&quot;</span>: <span class="string">&quot;binding JSON error!&quot;</span>&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">UserAll</span><span class="params">(c *gin.Context, ctx *context.Context)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> user models.User</span><br><span class="line">	<span class="keyword">if</span> c.Bind(&amp;user) == <span class="literal">nil</span> &#123;</span><br><span class="line">		users, err := user.QueryAll(ctx)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line">			c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">				<span class="string">&quot;msg&quot;</span>:  <span class="string">&quot;获取失败&quot;</span>,</span><br><span class="line">				<span class="string">&quot;code&quot;</span>: <span class="number">-1</span>,</span><br><span class="line">				<span class="string">&quot;user&quot;</span>: users,</span><br><span class="line">			&#125;)</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">				<span class="string">&quot;msg&quot;</span>:  <span class="string">&quot;获取成功&quot;</span>,</span><br><span class="line">				<span class="string">&quot;code&quot;</span>: <span class="number">1</span>,</span><br><span class="line">				<span class="string">&quot;user&quot;</span>: users,</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		c.JSON(<span class="number">400</span>, gin.H&#123;<span class="string">&quot;JSON=== status&quot;</span>: <span class="string">&quot;binding JSON error!&quot;</span>&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">UserDel</span><span class="params">(c *gin.Context, ctx *context.Context)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> user models.User</span><br><span class="line">	<span class="keyword">if</span> c.Bind(&amp;user) == <span class="literal">nil</span> &#123;</span><br><span class="line">		err := user.DeleteUser(ctx)</span><br><span class="line">		fmt.Println(<span class="string">&quot;del=&quot;</span>, err)</span><br><span class="line">		<span class="keyword">if</span> !err &#123;</span><br><span class="line"></span><br><span class="line">			c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">				<span class="string">&quot;msg&quot;</span>:  <span class="string">&quot;删除失败1&quot;</span>,</span><br><span class="line">				<span class="string">&quot;code&quot;</span>: <span class="number">-1</span>,</span><br><span class="line">			&#125;)</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">				<span class="string">&quot;msg&quot;</span>:  <span class="string">&quot;删除成功1&quot;</span>,</span><br><span class="line">				<span class="string">&quot;code&quot;</span>: <span class="number">1</span>,</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		c.JSON(<span class="number">400</span>, gin.H&#123;<span class="string">&quot;JSON=== status&quot;</span>: <span class="string">&quot;binding JSON error!&quot;</span>&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">UserUpdate</span><span class="params">(c *gin.Context, ctx *context.Context)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> user models.User</span><br><span class="line">	<span class="keyword">if</span> c.Bind(&amp;user) == <span class="literal">nil</span> &#123;</span><br><span class="line">		err := user.UpdateUser(ctx)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line">			c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">				<span class="string">&quot;msg&quot;</span>:  <span class="string">&quot;修改失败&quot;</span>,</span><br><span class="line">				<span class="string">&quot;code&quot;</span>: <span class="number">-1</span>,</span><br><span class="line">			&#125;)</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">				<span class="string">&quot;msg&quot;</span>:  <span class="string">&quot;修改成功&quot;</span>,</span><br><span class="line">				<span class="string">&quot;code&quot;</span>: <span class="number">1</span>,</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		c.JSON(<span class="number">400</span>, gin.H&#123;<span class="string">&quot;JSON=== status&quot;</span>: <span class="string">&quot;binding JSON error!&quot;</span>&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>main.go 代码</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;example.com/goRedis/api&quot;</span></span><br><span class="line">	<span class="string">&quot;example.com/goRedis/db&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	ctx := context.Background()</span><br><span class="line">	db.InitRedis(ctx)</span><br><span class="line">	<span class="keyword">defer</span> db.Close()</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	r.POST(<span class="string">&quot;/userAdd&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		api.UserAdd(c, &amp;ctx)</span><br><span class="line">	&#125;)</span><br><span class="line">	r.GET(<span class="string">&quot;/userAll&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		api.UserAll(c, &amp;ctx)</span><br><span class="line">	&#125;)</span><br><span class="line">	r.GET(<span class="string">&quot;/userGet/:key&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		key := c.Param(<span class="string">&quot;key&quot;</span>)</span><br><span class="line"></span><br><span class="line">		api.UserGet(c, &amp;ctx, key)</span><br><span class="line">	&#125;)</span><br><span class="line">	r.POST(<span class="string">&quot;/userUpdate&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		api.UserUpdate(c, &amp;ctx)</span><br><span class="line">	&#125;)</span><br><span class="line">	r.POST(<span class="string">&quot;/userDel&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		api.UserDel(c, &amp;ctx)</span><br><span class="line">	&#125;)</span><br><span class="line">	r.Run(<span class="string">&quot;:8000&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h2><ul>
<li>使用python调用服务端代码</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">data =&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;test11&quot;</span>, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;1123456&quot;</span>, <span class="string">&quot;id&quot;</span>: <span class="number">1</span>, <span class="string">&quot;key&quot;</span>: <span class="string">&quot;t_key1&quot;</span>&#125;</span><br><span class="line">resp = requests.post(<span class="string">&quot;http://127.0.0.1:8000/userAdd&quot;</span>, json=data)</span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br><span class="line">resp = requests.get(<span class="string">&quot;http://127.0.0.1:8000/userGet/t_key2&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br><span class="line"></span><br><span class="line">resp = requests.get(<span class="string">&quot;http://127.0.0.1:8000/userAll&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data =&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;test1131&quot;</span>, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;123456811&quot;</span>, <span class="string">&quot;id&quot;</span>: <span class="number">111</span>, <span class="string">&quot;key&quot;</span>: <span class="string">&quot;t_key21&quot;</span>&#125;</span><br><span class="line">resp = requests.post(<span class="string">&quot;http://127.0.0.1:8000/userUpdate&quot;</span>, json=data)</span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br><span class="line"></span><br><span class="line">data =&#123;<span class="string">&quot;key&quot;</span>: <span class="string">&quot;t_key1&quot;</span>&#125;</span><br><span class="line">resp = requests.post(<span class="string">&quot;http://127.0.0.1:8000/userDel&quot;</span>, json=data)</span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br></pre></td></tr></table></figure>

<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://blog.51cto.com/u_15326986/5729402">Go使用Gin+Redis实现增删改查</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/ximenjianxue/article/details/100163938">Nosql之Redis详解</a></p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://louis-me.github.io/aposts/eb7d5a01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="一个正经的测试工程师">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="施坤的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/aposts/eb7d5a01/" class="post-title-link" itemprop="url">重装系统后环境重建总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-07-10 10:40:25 / 修改时间：11:52:34" itemprop="dateCreated datePublished" datetime="2023-07-10T10:40:25+08:00">2023-07-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" itemprop="url" rel="index"><span itemprop="name">环境搭建</span></a>
                </span>
            </span>

          
            <span id="/aposts/eb7d5a01/" class="post-meta-item leancloud_visitors" data-flag-title="重装系统后环境重建总结" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/aposts/eb7d5a01/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/aposts/eb7d5a01/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><ul>
<li>重装系统后，电脑上搭建的很多东西用不了，简单记录</li>
<li>本次系统win10</li>
</ul>
<h2 id="heox"><a href="#heox" class="headerlink" title="heox"></a>heox</h2><ul>
<li>本地搭建了hexo的博客，其中主要用的是node，只要把node的安装目录设置到环境变量中即可</li>
<li>然后再博客的目录，执行<code>hexo cl &amp;&amp; hexo g &amp;&amp; hexo s</code>执行成功</li>
<li>发现使用hexo d 提交到服务器后，内容没有变化，需要如下设置</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.email &#x27;284772894@qq.com&#x27;</span><br><span class="line"># 然后提交到服务器</span><br><span class="line">hexo cl &amp;&amp;  hexo g &amp;&amp; hexo d</span><br></pre></td></tr></table></figure>



<h2 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h2><ul>
<li>环境变量设置好了mysql的根目录后，直接开启服务提示无效</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator&gt;net start mysqld</span><br><span class="line">服务名无效。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>分别执行如下操作</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将mysql服务注册到win服务中</span></span><br><span class="line">C:\Users\Administrator&gt;mysqld --initialize</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装服务</span></span><br><span class="line">C:\Users\Administrator&gt;mysqld --install</span><br><span class="line">Service successfully installed.</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动服务</span></span><br><span class="line">C:\Users\Administrator&gt;net start mysql</span><br><span class="line">MySQL 服务正在启动 .</span><br><span class="line">MySQL 服务已经启动成功。</span><br></pre></td></tr></table></figure>

<ul>
<li>最终用<code>heidisql</code>连接数据库成功，库里面的数据正常</li>
</ul>
<h2 id="python"><a href="#python" class="headerlink" title="python"></a>python</h2><ul>
<li>直接在环境变量中设置python的根目录和<code>Script</code>目录</li>
<li>设置pip下载为国内镜像</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 临时使用</span><br><span class="line">pip install -i https://pypi.tuna.tsinghua.edu.cn/simple xxx</span><br><span class="line"># 永久使用，清华镜像</span><br><span class="line">C:\Users\Administrator&gt;pip3 config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line">Writing to C:\Users\Administrator\AppData\Roaming\pip\pip.ini</span><br></pre></td></tr></table></figure>

<ul>
<li>测试</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator&gt;pip install pip -U</span><br><span class="line">Looking in indexes: https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line">Requirement already satisfied: pip in d:\app\python37\lib\site-packages (23.1.2)</span><br></pre></td></tr></table></figure>

<h2 id="vue"><a href="#vue" class="headerlink" title="vue"></a>vue</h2><ul>
<li>需要安装node.js，安装hexo 时已经安装了node.js</li>
<li>打开本地的<code>Microsoft VS Code IDE</code> 然后打开本地项目</li>
<li>打开终端执行安装依赖</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure>

<ul>
<li>运行代码</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run serve</span><br></pre></td></tr></table></figure>

<h2 id="typora"><a href="#typora" class="headerlink" title="typora"></a>typora</h2><ul>
<li><p>下载并解压<code>typora1.2.4-Windows(破解包).7z</code></p>
</li>
<li><p>安装后，不打开typora</p>
</li>
<li><p>使用<code>app.asar</code> 文件替换<code>typora_home/resources </code>中文件</p>
</li>
<li><p>打开typora输入任意邮箱，序列号输入：<code>E8Q9Y5-KXMTL5-7578SL-4S5XKS</code></p>
</li>
</ul>
<h2 id="go"><a href="#go" class="headerlink" title="go"></a>go</h2><ul>
<li>设置<code>go_home\bin</code>到环境变量中</li>
<li>启动本地的Microsoft VS Code IDE，打开扩展安装中文</li>
<li>打开go项目文件夹，终端中输入：<code>go run main.go</code></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://louis-me.github.io/aposts/f7cb02d3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="一个正经的测试工程师">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="施坤的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/aposts/f7cb02d3/" class="post-title-link" itemprop="url">基于pythonsdk操作fisco-bcos</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-07-07 15:22:05" itemprop="dateCreated datePublished" datetime="2023-07-07T15:22:05+08:00">2023-07-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-08-21 15:28:37" itemprop="dateModified" datetime="2023-08-21T15:28:37+08:00">2023-08-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/" itemprop="url" rel="index"><span itemprop="name">区块链</span></a>
                </span>
            </span>

          
            <span id="/aposts/f7cb02d3/" class="post-meta-item leancloud_visitors" data-flag-title="基于pythonsdk操作fisco-bcos" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/aposts/f7cb02d3/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/aposts/f7cb02d3/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><ul>
<li>FISCO BCOS是由国内企业主导研发、对外开源、安全可控的企业级金融联盟链底层平台，由金链盟开源工作组协作打造，并于2017年正式对外开源</li>
<li>因为需要使用python sdk来操作FISCO BCOS，官方只支持FISCO BCOS2.0</li>
</ul>
<h2 id="概念介绍"><a href="#概念介绍" class="headerlink" title="概念介绍"></a>概念介绍</h2><ul>
<li>智能合约：可以理解为逻辑代码，比如此次实例中我的智能合约代码就是一个sol文件中</li>
<li>区块链网络：智能合约的代码若要运行，就要放在区块链网络上执行</li>
</ul>
<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><h3 id="区块链网络"><a href="#区块链网络" class="headerlink" title="区块链网络"></a>区块链网络</h3><ul>
<li><p>云服务器搭建成功后，发现无法外网访问，看<a target="_blank" rel="noopener" href="https://fisco-bcos-documentation.readthedocs.io/zh_CN/latest/docs/manual/configuration.html#rpc">这里的文档</a>说明云主机的公网IP均为虚拟IP造成的</p>
</li>
<li><p>也就是区块链的服务端，可以参考<a target="_blank" rel="noopener" href="https://fisco-bcos-documentation.readthedocs.io/zh_CN/latest/docs/installation.html">这里</a></p>
</li>
<li><p>不启用国密</p>
</li>
</ul>
<h3 id="Python-SDK"><a href="#Python-SDK" class="headerlink" title="Python SDK"></a>Python SDK</h3><ul>
<li><p>主要用来操作FISCO BCOS搭建的区块链网络</p>
</li>
<li><p>环境搭建参考<a target="_blank" rel="noopener" href="https://fisco-bcos-documentation.readthedocs.io/zh_CN/latest/docs/sdk/python_sdk/index.html">这里</a></p>
</li>
<li><p>我用的win10，使用的python版本为3.7.9，没有使用虚拟环境</p>
</li>
<li><p>没有安装Microsoft Visual C++ 14.0 </p>
</li>
<li><p>client_config.py 为配置文件：</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">channel_host = &quot;XXXXXX.121.XXX&quot;  # 填入channel通信ip</span><br><span class="line">channel_port = 20200  # 节点的channel 端口</span><br></pre></td></tr></table></figure>

<ul>
<li>把区块链网络层那边产生的证书文件放在bin目录下，一般为：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">channel_ca = &quot;bin/ca.crt&quot;</span><br><span class="line">channel_ca = &quot;bin/ca.crt&quot; </span><br></pre></td></tr></table></figure>

<h2 id="编写代码"><a href="#编写代码" class="headerlink" title="编写代码"></a>编写代码</h2><ul>
<li>合约文件一般放在contracts目录中，如<code>contracts\helloword.sol</code></li>
<li>合约代码采用的<a target="_blank" rel="noopener" href="https://www.w3cschool.cn/solidity/">solidity</a>的语法</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.24;</span><br><span class="line"></span><br><span class="line">contract HelloWorld&#123;</span><br><span class="line">    string name;</span><br><span class="line">    event onset(string newname);</span><br><span class="line">    constructor() public&#123;</span><br><span class="line">       name = &quot;Hello, World!&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function get() constant public returns(string)&#123;</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function set(string n) public&#123;</span><br><span class="line">	emit onset(n);</span><br><span class="line">    	name = n;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>编写部署合约文件，调用合约函数等</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> client.contractnote <span class="keyword">import</span> ContractNote</span><br><span class="line"><span class="keyword">from</span> client.bcosclient <span class="keyword">import</span> BcosClient</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> client.datatype_parser <span class="keyword">import</span> DatatypeParser</span><br><span class="line"><span class="keyword">from</span> client.common.compiler <span class="keyword">import</span> Compiler</span><br><span class="line"><span class="keyword">from</span> client_config <span class="keyword">import</span> client_config</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从文件加载abi定义</span></span><br><span class="line"></span><br><span class="line">PATH = <span class="keyword">lambda</span> p: os.path.abspath(</span><br><span class="line">    os.path.join(os.path.dirname(__file__), p)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">demo_config = client_config</span><br><span class="line">_sol = PATH(<span class="string">&quot;./contracts/HelloWord.sol&quot;</span>)  <span class="comment"># 合约文件</span></span><br><span class="line">_api = PATH(<span class="string">&quot;./contracts/HelloWord.abi&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> os.path.isfile(demo_config.solc_path) <span class="keyword">or</span> os.path.isfile(demo_config.solcjs_path):</span><br><span class="line">    Compiler.compile_file(_sol)</span><br><span class="line"><span class="comment">#     Compiler.compile_file(SimpleInfo_sol)</span></span><br><span class="line">_<span class="built_in">bin</span> = PATH(<span class="string">&quot;./contracts/HelloWord.bin&quot;</span>)</span><br><span class="line">abi_file = _api</span><br><span class="line">data_parser = DatatypeParser()</span><br><span class="line">data_parser.load_abi_file(abi_file)</span><br><span class="line">contract_abi = data_parser.contract_abi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">deploy</span>():</span><br><span class="line">    client = BcosClient()</span><br><span class="line">    <span class="built_in">print</span>(client.getinfo())</span><br><span class="line">    <span class="comment"># 部署合约</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&gt;&gt;Deploy:----------------------------------------------------------&quot;</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(_<span class="built_in">bin</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> load_f:</span><br><span class="line">        contract_bin = load_f.read()</span><br><span class="line">        load_f.close()</span><br><span class="line">    result = client.deploy(contract_bin)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;deploy&quot;</span>, result)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;new address : &quot;</span>, result[<span class="string">&quot;contractAddress&quot;</span>])</span><br><span class="line">    contract_name = os.path.splitext(os.path.basename(abi_file))[<span class="number">0</span>]</span><br><span class="line">    memo = <span class="string">&quot;tx:&quot;</span> + result[<span class="string">&quot;transactionHash&quot;</span>]</span><br><span class="line">    <span class="comment"># 把部署结果存入文件备查</span></span><br><span class="line">    ContractNote.save_address_to_contract_note(<span class="string">&quot;demo&quot;</span>, contract_name,</span><br><span class="line">                                               result[<span class="string">&quot;contractAddress&quot;</span>])</span><br><span class="line">    client.finish()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">call</span>():</span><br><span class="line">    client = BcosClient()</span><br><span class="line">    <span class="comment"># stat = StatTool.begin()</span></span><br><span class="line">    <span class="comment"># 调用一下call，获取数据</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&gt;&gt;Call:------------------------------------------------------------------------&quot;</span>)</span><br><span class="line">    to_address = <span class="string">&quot;xxxxxxxx&quot;</span></span><br><span class="line"></span><br><span class="line">   client.sendRawTransactionGetReceipt(to_address,contract_abi,<span class="string">&quot;set&quot;</span>,[<span class="string">&quot;hi&quot;</span>])</span><br><span class="line"></span><br><span class="line">    data = client.call(to_address, contract_abi, <span class="string">&quot;get&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line">    client.finish()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    deploy()</span><br><span class="line">    <span class="comment"># call()</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><code>client.deploy</code> 部署合约</li>
<li><code>sendRawTransactionGetReceipt</code> 执行修改操作</li>
<li><code>call</code> 执行查询操作</li>
</ul>
<h2 id="其他实例"><a href="#其他实例" class="headerlink" title="其他实例"></a>其他实例</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">// pragma solidity ^0.6.3;</span><br><span class="line">pragma solidity ^0.4.24;</span><br><span class="line">pragma experimental ABIEncoderV2;</span><br><span class="line"></span><br><span class="line">contract TestStruct &#123;</span><br><span class="line"></span><br><span class="line">      struct User &#123;</span><br><span class="line">          string name; // 对应的是item_id</span><br><span class="line">          string user_name;</span><br><span class="line">          string issue_date;</span><br><span class="line">          string  start_date;</span><br><span class="line">          string  end_date;</span><br><span class="line">     &#125;</span><br><span class="line">	 </span><br><span class="line">	 event onadd(string newname);</span><br><span class="line">	 event onadduser(string newname,User u);</span><br><span class="line">	 event onaddusers(uint256 len,User[] u);</span><br><span class="line"></span><br><span class="line">    mapping (string =&gt; User) users;</span><br><span class="line">	</span><br><span class="line">	  constructor() public</span><br><span class="line">    &#123;</span><br><span class="line">//		User memory u = User(&quot;alice&quot;,10001, &quot;2012-12-01&quot;, &quot;start&quot;);</span><br><span class="line">		User memory u = User(&quot;100001&quot;,&quot;lisa&quot;, &quot;2012-12-01&quot;, &quot;start&quot;, &quot;end&quot;);</span><br><span class="line">		addUser(u);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">     function addUser (User memory _user) public &#123;</span><br><span class="line"></span><br><span class="line">           addbyname(_user.name,_user);</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	function addbyname (string memory name,User memory _user) public &#123;</span><br><span class="line"></span><br><span class="line">       users[name] = _user;</span><br><span class="line">		emit onadd(name);</span><br><span class="line">		emit onadduser(name,_user);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function addUsers (User [] memory _users) public &#123;</span><br><span class="line"></span><br><span class="line">        for (uint i = 0; i &lt; _users.length; i++) &#123;</span><br><span class="line">           //users[_users[i].name] = _users[i];</span><br><span class="line">			addUser(_users[i]);</span><br><span class="line">        &#125;</span><br><span class="line">		emit onaddusers(_users.length,_users);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function getUser (string memory username) public view returns (User memory) &#123;</span><br><span class="line"></span><br><span class="line">        //bytes32 hash = keccak256(abi.encode(username));</span><br><span class="line">        return users[username];</span><br><span class="line">    &#125;</span><br><span class="line">    event on_putbytes(string n,bytes32 b);</span><br><span class="line">    function putbytes(string memory uname,bytes32 br) public</span><br><span class="line">    &#123;</span><br><span class="line">        emit on_putbytes(uname,br);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://louis-me.github.io/aposts/953abffc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="一个正经的测试工程师">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="施坤的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/aposts/953abffc/" class="post-title-link" itemprop="url">gin实践指南</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-21 15:08:05" itemprop="dateCreated datePublished" datetime="2023-06-21T15:08:05+08:00">2023-06-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-07-31 10:58:42" itemprop="dateModified" datetime="2023-07-31T10:58:42+08:00">2023-07-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
                </span>
            </span>

          
            <span id="/aposts/953abffc/" class="post-meta-item leancloud_visitors" data-flag-title="gin实践指南" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/aposts/953abffc/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/aposts/953abffc/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><ul>
<li>本次搭建环境为：<code>win10, go 1.20.4</code></li>
</ul>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ul>
<li>新建并初始化项目</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd E:\proj\gowork</span><br><span class="line">mkdir studyGin</span><br><span class="line">cd studyGin</span><br><span class="line">go mod init example.com/myGin</span><br></pre></td></tr></table></figure>

<ul>
<li>下载并安装 gin</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E:\proj\gowork\studyGin&gt; <span class="keyword">go</span> get -u github.com/gin-gonic/gin</span><br></pre></td></tr></table></figure>

<ul>
<li>在vscode中编写测试代码</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 1.创建路由</span></span><br><span class="line">	r := gin.Default()</span><br><span class="line">	<span class="comment">// 2.绑定路由规则，执行的函数</span></span><br><span class="line">	<span class="comment">// gin.Context，封装了request和response</span></span><br><span class="line">	r.GET(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		c.String(http.StatusOK, <span class="string">&quot;hello World!&quot;</span>)</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="comment">// 3.监听端口，默认在8080</span></span><br><span class="line">	<span class="comment">// Run(&quot;里面不指定端口号默认为8080&quot;)</span></span><br><span class="line">	r.Run(<span class="string">&quot;:8000&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>运行</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS E:\proj\gowork\studyGin&gt; go run .\main.go</span><br></pre></td></tr></table></figure>

<p><img src="/aposts/953abffc/image-20230621153207713.png" alt="image-20230621153207713"></p>
<h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><ul>
<li>分别新建文件夹，查看到<code>E:\proj\gowork\studyGin&gt;tree /F</code>文件结构如下：</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">│  <span class="keyword">go</span>.mod</span><br><span class="line">│  <span class="keyword">go</span>.sum</span><br><span class="line">│  main.<span class="keyword">go</span></span><br><span class="line">│</span><br><span class="line">├─apis # 存放具体的业务逻辑，比如users.<span class="keyword">go</span>中放的增删改查的逻辑</span><br><span class="line">├─database # 存放数据库的相关配置</span><br><span class="line">├─middleware # 存放中间件的内容</span><br><span class="line">│  ├─jwt</span><br><span class="line">│  └─middleware</span><br><span class="line">├─models # 存放结构体的文件</span><br><span class="line">└─routers # 存放路由，比如get,post等对应关系</span><br></pre></td></tr></table></figure>

<h2 id="代码结构"><a href="#代码结构" class="headerlink" title="代码结构"></a>代码结构</h2><ul>
<li><code>database/mysql.go</code>数据库连接</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> database</span><br><span class="line"></span><br><span class="line"><span class="comment">//安装gorm</span></span><br><span class="line"><span class="comment">//go get gorm.io/gorm</span></span><br><span class="line"><span class="comment">// 安装mysql驱动</span></span><br><span class="line"><span class="comment">//go get gorm.io/driver/mysql</span></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;gorm.io/driver/mysql&quot;</span></span><br><span class="line">	<span class="string">&quot;gorm.io/gorm&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Db *gorm.DB</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitDb</span><span class="params">()</span></span> &#123;</span><br><span class="line">	dsn := <span class="string">&quot;root:123456@tcp(127.0.0.1:3306)/test?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span></span><br><span class="line">	database, err := gorm.Open(mysql.Open(dsn), &amp;gorm.Config&#123;&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;open mysql error:&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	Db = database</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Close</span><span class="params">()</span></span> &#123;</span><br><span class="line">	sqlDB, _ := Db.DB()</span><br><span class="line">	sqlDB.Close()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><code>models\users.go</code> 存放的表结构，实现登录功能（对user实体类的逻辑处理）</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;example.com/myGin/database&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name     <span class="type">string</span> <span class="string">`form:&quot;name&quot;,json:&quot;name&quot;,bingding:&quot;required&quot;,gorm:&quot;unique;not null&quot;`</span></span><br><span class="line">	Password <span class="type">string</span> <span class="string">`form:&quot;password&quot;,json:&quot;password&quot;,bingding:&quot;required&quot;gorm:&quot;NOT NULL&quot;`</span></span><br><span class="line">	Id       <span class="type">int</span>    <span class="string">`form:&quot;id&quot;,gorm:&quot;PRIMARY_KEY&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span></span> Login() (user1 User, err <span class="type">error</span>) &#123;</span><br><span class="line">	obj := database.Db.Where(<span class="string">&quot;name=? and password=?&quot;</span>, u.Name, u.Password).First(&amp;user1)</span><br><span class="line">	<span class="keyword">if</span> err = obj.Error; err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;这是登陆错误  %v 和 %T&quot;</span>, err, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(user1)</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取用户列表</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span></span> UserList() (users []User, err <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> err = database.Db.Find(&amp;users).Error; err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意func (u *User)  UserList这里的用法，外面的函数要调用时，必须用User.UserList的方式进行调用</p>
</blockquote>
<ul>
<li><code>api/users.go</code> 主要对<code>models\users.go</code> 代码进行调用，并把json数据返回给前端</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apis</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;example.com/myGin/models&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">UserLogin</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> user models.User</span><br><span class="line">	<span class="comment">// c.ShouldBindJSON</span></span><br><span class="line">	<span class="keyword">if</span> c.Bind(&amp;user) == <span class="literal">nil</span> &#123; <span class="comment">//把客户端格式传过来的数据绑定到结构体user中去</span></span><br><span class="line">		msg, err := user.Login() <span class="comment">// 调用model层的对应方法</span></span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> err.Error() == <span class="string">&quot;record not found&quot;</span> &#123;</span><br><span class="line">				c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">					<span class="string">&quot;msg&quot;</span>:  <span class="string">&quot;用户不存在&quot;</span>,</span><br><span class="line">					<span class="string">&quot;user&quot;</span>: <span class="literal">nil</span>,</span><br><span class="line">				&#125;)</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">					<span class="string">&quot;msg&quot;</span>:  <span class="string">&quot;登陆错误&quot;</span>,</span><br><span class="line">					<span class="string">&quot;user&quot;</span>: <span class="literal">nil</span>,</span><br><span class="line">				&#125;)</span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">				<span class="string">&quot;msg&quot;</span>:  <span class="string">&quot;登陆成功&quot;</span>,</span><br><span class="line">				<span class="string">&quot;user&quot;</span>: msg,</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		c.JSON(<span class="number">400</span>, gin.H&#123;<span class="string">&quot;JSON=== status&quot;</span>: <span class="string">&quot;binding JSON error!&quot;</span>&#125;)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取用户列表</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetUserList</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> user models.User</span><br><span class="line">	users, err := user.UserList()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;get user list error:&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">		<span class="string">&quot;msg&quot;</span>: users,</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><code>routers/router.go</code> 对外的路由处理，比如<code>http,get</code>方法的处理</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> routers</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;example.com/myGin/apis&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitRouter</span><span class="params">()</span></span> *gin.Engine &#123;</span><br><span class="line"></span><br><span class="line">	router := gin.Default()</span><br><span class="line">	router.POST(<span class="string">&quot;/login&quot;</span>, apis.UserLogin)</span><br><span class="line">	router.GET(<span class="string">&quot;/GetUserList&quot;</span>, apis.GetUserList)</span><br><span class="line">	<span class="keyword">return</span> router</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><strong><code>main.go</code> 代码入口</strong></li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;example.com/myGin/database&quot;</span></span><br><span class="line">	<span class="string">&quot;example.com/myGin/routers&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	database.InitDb() <span class="comment">// 初始化数据库</span></span><br><span class="line">	<span class="keyword">defer</span> database.Close() </span><br><span class="line">	router := routers.InitRouter() <span class="comment">//指定路由</span></span><br><span class="line">	router.Run(<span class="string">&quot;:8000&quot;</span>)            <span class="comment">//在8000端口上运行</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>运行main.go，启动服务器</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PS E:\proj\gowork\studyGin&gt; <span class="keyword">go</span> run .\main.<span class="keyword">go</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">GIN-debug] POST   /login                    --&gt; example.com/myGin/apis.UserLogin (<span class="number">3</span> handlers)      </span><br><span class="line">[GIN-debug] [WARNING] You trusted all proxies, this is NOT safe. We recommend you to set a value.   </span><br><span class="line">Please check https:<span class="comment">//pkg.go.dev/github.com/gin-gonic/gin#readme-don-t-trust-all-proxies for details.</span></span><br><span class="line">[GIN-debug] Listening and serving HTTP on :<span class="number">8000</span></span><br></pre></td></tr></table></figure>

<h3 id="go编写客户端"><a href="#go编写客户端" class="headerlink" title="go编写客户端"></a>go编写客户端</h3><ul>
<li><code>client\client.go</code>用go编写客户端代码，包名为main，传递参数为json</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;bytes&quot;</span></span><br><span class="line">	<span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1、测试post请求的结构体</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestPostLogin</span><span class="params">()</span></span> &#123;</span><br><span class="line">	reqMap := <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line">		<span class="string">&quot;name&quot;</span>:     <span class="string">&quot;test1&quot;</span>,</span><br><span class="line">		<span class="string">&quot;password&quot;</span>: <span class="string">&quot;123456&quot;</span>,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	body, err := json.Marshal(reqMap)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;TestPostReq json.Marshal err:&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	url := <span class="string">&quot;http://127.0.0.1:8000/login&quot;</span></span><br><span class="line"></span><br><span class="line">	req, err := http.NewRequest(http.MethodPost, url, bytes.NewReader(body))</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;TestPostReq http.NewRequest err:&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	req.Header.Set(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span>)</span><br><span class="line"></span><br><span class="line">	client := &amp;http.Client&#123;Timeout: <span class="number">5</span> * time.Second&#125; <span class="comment">// 设置请求超时时长5s</span></span><br><span class="line">	resp, err := client.Do(req)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;TestPostReq http.DefaultClient.Do() err: &quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line"></span><br><span class="line">	respBody, err := ioutil.ReadAll(resp.Body)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;TestPostReq ioutil.ReadAll() err: &quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;respBody: &quot;</span>, <span class="type">string</span>(respBody))</span><br><span class="line"></span><br><span class="line">	rsp := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">	err = json.Unmarshal(respBody, &amp;rsp)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;TestPostReq json.Unmarshal() err: &quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;rsp: %+v&quot;</span>, rsp)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 最后经过字段筛选后，再序列化成json格式即可</span></span><br><span class="line">	<span class="comment">// result, err := json.Marshal(rsp)</span></span><br><span class="line">	<span class="comment">// if err != nil &#123;</span></span><br><span class="line">	<span class="comment">// 	fmt.Println(&quot;TestPostReq json.Marrshal() err2: &quot;, err)</span></span><br><span class="line">	<span class="comment">// 	return</span></span><br><span class="line">	<span class="comment">// &#125;</span></span><br><span class="line">	<span class="comment">// fmt.Println(string(result))</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestGetUserList</span><span class="params">()</span></span> &#123;</span><br><span class="line">	resp, err := http.Get(<span class="string">&quot;http://127.0.0.1:8000/GetUserList&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;http get error:&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line">	buf := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">1024</span>) <span class="comment">// 创建一个切片，用例接受服务器返回的数据</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		m, err := resp.Body.Read(buf)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &amp;&amp; err != io.EOF &#123;</span><br><span class="line">			fmt.Println(<span class="string">&quot;resp.Body.Read error:&quot;</span>, err)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		res := <span class="type">string</span>(buf[:m])</span><br><span class="line">		fmt.Println(<span class="string">&quot;get server content,&quot;</span>, res)</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	TestPostLogin()</span><br><span class="line">	TestGetUserList()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>运行<code>client.go</code></li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PS E:\proj\gowork\studyGin&gt; <span class="keyword">go</span> run .\client\client.<span class="keyword">go</span></span><br><span class="line">respBody:  &#123;<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;登陆成功&quot;</span>,<span class="string">&quot;user&quot;</span>:&#123;<span class="string">&quot;Name&quot;</span>:<span class="string">&quot;test1&quot;</span>,<span class="string">&quot;Password&quot;</span>:<span class="string">&quot;123456&quot;</span>,<span class="string">&quot;Id&quot;</span>:<span class="number">3</span>&#125;&#125;</span><br><span class="line">rsp: <span class="keyword">map</span>[msg:登陆成功 user:<span class="keyword">map</span>[Id:<span class="number">3</span> Name:test1 Password:<span class="number">123456</span>]]</span><br><span class="line"></span><br><span class="line">get server content, &#123;<span class="string">&quot;msg&quot;</span>:[&#123;<span class="string">&quot;Name&quot;</span>:<span class="string">&quot;test1&quot;</span>,<span class="string">&quot;Password&quot;</span>:<span class="string">&quot;123456&quot;</span>,<span class="string">&quot;Id&quot;</span>:<span class="number">3</span>&#125;,&#123;<span class="string">&quot;Name&quot;</span>:<span class="string">&quot;test2&quot;</span>,<span class="string">&quot;Password&quot;</span>:<span class="string">&quot;1234567&quot;</span>,<span class="string">&quot;Id&quot;</span>:<span class="number">4</span>&#125;]&#125;</span><br></pre></td></tr></table></figure>

<h3 id="python-发起请求"><a href="#python-发起请求" class="headerlink" title="python 发起请求"></a>python 发起请求</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">data =&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;test1&quot;</span>, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;123456&quot;</span>&#125;</span><br><span class="line">resp = requests.post(<span class="string">&quot;http://127.0.0.1:8000/login&quot;</span>, data=data)</span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br><span class="line"></span><br><span class="line">resp2 = requests.get(<span class="string">&quot;http://127.0.0.1:8000/GetUserList&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(resp2.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>得到结果如下</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;登陆成功&quot;</span><span class="punctuation">,</span><span class="attr">&quot;user&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span><span class="string">&quot;test1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;Password&quot;</span><span class="punctuation">:</span><span class="string">&quot;123456&quot;</span><span class="punctuation">,</span><span class="attr">&quot;Id&quot;</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span><span class="string">&quot;test1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;Password&quot;</span><span class="punctuation">:</span><span class="string">&quot;123456&quot;</span><span class="punctuation">,</span><span class="attr">&quot;Id&quot;</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span><span class="string">&quot;test2&quot;</span><span class="punctuation">,</span><span class="attr">&quot;Password&quot;</span><span class="punctuation">:</span><span class="string">&quot;1234567&quot;</span><span class="punctuation">,</span><span class="attr">&quot;Id&quot;</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="HTML-渲染"><a href="#HTML-渲染" class="headerlink" title="HTML 渲染"></a>HTML 渲染</h2><ul>
<li>gin 支持使用<code> LoadHTMLGlob()</code> 或者 <code>LoadHTMLFiles()</code> 对html进行渲染</li>
</ul>
<h3 id="用户列表"><a href="#用户列表" class="headerlink" title="用户列表"></a>用户列表</h3><ul>
<li>新建一个目录和文件：<code>template\user\list.tmpl</code>代码如下</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>用户列表<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>列表数据：<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 定义一个 结构体切片 --&gt;</span></span><br><span class="line">            &#123;&#123; $userList := . &#125;&#125;</span><br><span class="line"></span><br><span class="line">            &#123;&#123; range $index,$v := $userList.users &#125;&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; $index &#125;&#125;--&#123;&#123; $v.Name &#125;&#125;--&#123;&#123; $v.Password &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            &#123;&#123; end &#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>初始化路由器代码那里需要修改，新增加入加载 HTML 模板文件</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// routers/router.go</span></span><br><span class="line"><span class="keyword">package</span> routers</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;example.com/myGin/apis&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitRouter</span><span class="params">()</span></span> *gin.Engine &#123;</span><br><span class="line"></span><br><span class="line">	router := gin.Default()</span><br><span class="line"></span><br><span class="line">	router.POST(<span class="string">&quot;/login&quot;</span>, apis.UserLogin)</span><br><span class="line">	<span class="comment">// 加载 HTML 模板文件</span></span><br><span class="line">	router.LoadHTMLGlob(<span class="string">&quot;template/user/*&quot;</span>)</span><br><span class="line">	router.GET(<span class="string">&quot;/GetUserList&quot;</span>, apis.GetUserList)</span><br><span class="line">	<span class="keyword">return</span> router</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><code>apis.GetUserList</code> 中，返回的数据修改为采用html</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// apis/user.go</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取用户列表</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetUserList</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> user models.User</span><br><span class="line">	users, err := user.UserList()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;get user list error:&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// c.JSON(http.StatusOK, gin.H&#123;</span></span><br><span class="line">	<span class="comment">// 	&quot;msg&quot;: users,</span></span><br><span class="line">	<span class="comment">// &#125;)</span></span><br><span class="line">	c.HTML(http.StatusOK, <span class="string">&quot;list.tmpl&quot;</span>, gin.H&#123;</span><br><span class="line">		<span class="string">&quot;users&quot;</span>: users,</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>运行服务器端</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS E:\proj\gowork\studyGin&gt; go run .\main.go</span><br></pre></td></tr></table></figure>

<ul>
<li>打开浏览器，查看到结果</li>
</ul>
<p><img src="/aposts/953abffc/image-20230626103441913.png" alt="image-20230626103441913"></p>
<h2 id="登录验证"><a href="#登录验证" class="headerlink" title="登录验证"></a>登录验证</h2><ul>
<li><p>通过上面的实例，缺少一个登录验证的流程，一个典型的验证流程为：登录成功–生成token–获取用户列表（检查token存在，则获取成功，否则获取失败）</p>
</li>
<li><p>中间件中<code>middleware\jwt\jwt.go</code> 对登录后的token进行处理和验证</p>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> jwt</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;errors&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/golang-jwt/jwt/v5&quot;</span> <span class="comment">// go get -u github.com/golang-jwt/jwt/v5</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// JWTAuth 中间件，检查token</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">JWTAuth</span><span class="params">()</span></span> gin.HandlerFunc &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		<span class="comment">// //获取到请求头中的token</span></span><br><span class="line">		token := c.Request.Header.Get(<span class="string">&quot;token&quot;</span>)</span><br><span class="line">		<span class="keyword">if</span> token == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">			c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">				<span class="string">&quot;status&quot;</span>: <span class="number">-1</span>,</span><br><span class="line">				<span class="string">&quot;msg&quot;</span>:    <span class="string">&quot;请求未携带token无权限访问&quot;</span>,</span><br><span class="line">			&#125;)</span><br><span class="line">			c.Abort()</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		log.Print(<span class="string">&quot;get token: &quot;</span>, token)</span><br><span class="line"></span><br><span class="line">		j := NewJWT()</span><br><span class="line">		<span class="comment">// parseToken 解析token包含的信息</span></span><br><span class="line">		claims, err := j.ParseToken(token)</span><br><span class="line">		fmt.Println(<span class="string">&quot;claims&quot;</span>, claims)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> err == TokenExpired &#123;</span><br><span class="line">				c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">					<span class="string">&quot;status&quot;</span>: <span class="number">-1</span>,</span><br><span class="line">					<span class="string">&quot;msg&quot;</span>:    <span class="string">&quot;授权已过期&quot;</span>,</span><br><span class="line">				&#125;)</span><br><span class="line">				c.Abort()</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;</span><br><span class="line">			c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">				<span class="string">&quot;status&quot;</span>: <span class="number">-1</span>,</span><br><span class="line">				<span class="string">&quot;msg&quot;</span>:    err.Error(),</span><br><span class="line">			&#125;)</span><br><span class="line">			c.Abort()</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 继续交由下一个路由处理,并将解析出的信息传递下去</span></span><br><span class="line">		c.Set(<span class="string">&quot;claims&quot;</span>, claims)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// JWT 签名结构</span></span><br><span class="line"><span class="keyword">type</span> JWT <span class="keyword">struct</span> &#123;</span><br><span class="line">	SigningKey []<span class="type">byte</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 一些常量</span></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	TokenExpired     <span class="type">error</span>  = errors.New(<span class="string">&quot;Token is expired&quot;</span>)</span><br><span class="line">	TokenNotValidYet <span class="type">error</span>  = errors.New(<span class="string">&quot;Token not active yet&quot;</span>)</span><br><span class="line">	TokenMalformed   <span class="type">error</span>  = errors.New(<span class="string">&quot;That&#x27;s not even a token&quot;</span>)</span><br><span class="line">	TokenInvalid     <span class="type">error</span>  = errors.New(<span class="string">&quot;Couldn&#x27;t handle this token:&quot;</span>)</span><br><span class="line">	SignKey          <span class="type">string</span> = <span class="string">&quot;newtrekWang&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 载荷，可以加一些自己需要的信息</span></span><br><span class="line"><span class="keyword">type</span> CustomClaims <span class="keyword">struct</span> &#123;</span><br><span class="line">	ID       <span class="type">int</span>    <span class="string">`json:&quot;userId&quot;`</span></span><br><span class="line">	Name     <span class="type">string</span> <span class="string">`json:&quot;name&quot;`</span></span><br><span class="line">	Password <span class="type">string</span> <span class="string">`json:&quot;password&quot;`</span></span><br><span class="line">	jwt.RegisteredClaims <span class="comment">// 设置过期时间</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新建一个jwt实例</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewJWT</span><span class="params">()</span></span> *JWT &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;JWT&#123;</span><br><span class="line">		[]<span class="type">byte</span>(GetSignKey()),</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取signKey</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetSignKey</span><span class="params">()</span></span> <span class="type">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> SignKey</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这是SignKey</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SetSignKey</span><span class="params">(key <span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">	SignKey = key</span><br><span class="line">	<span class="keyword">return</span> SignKey</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CreateToken 生成一个token</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(j *JWT)</span></span> CreateToken(claims CustomClaims) (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	token := jwt.NewWithClaims(jwt.SigningMethodHS256, claims)</span><br><span class="line">	<span class="keyword">return</span> token.SignedString(j.SigningKey)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解析Tokne</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(j *JWT)</span></span> ParseToken(tokenString <span class="type">string</span>) (*CustomClaims, <span class="type">error</span>) &#123;</span><br><span class="line">	token, err := jwt.ParseWithClaims(tokenString, &amp;CustomClaims&#123;&#125;, <span class="function"><span class="keyword">func</span><span class="params">(token *jwt.Token)</span></span> (<span class="keyword">interface</span>&#123;&#125;, <span class="type">error</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> j.SigningKey, <span class="literal">nil</span></span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> claims, ok := token.Claims.(*CustomClaims); ok &amp;&amp; token.Valid &#123;</span><br><span class="line">		<span class="keyword">return</span> claims, <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span>, TokenInvalid</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新token</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(j *JWT)</span></span> RefreshToken(tokenString <span class="type">string</span>) (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line"></span><br><span class="line">	token, err := jwt.ParseWithClaims(tokenString, &amp;CustomClaims&#123;&#125;, <span class="function"><span class="keyword">func</span><span class="params">(token *jwt.Token)</span></span> (<span class="keyword">interface</span>&#123;&#125;, <span class="type">error</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> j.SigningKey, <span class="literal">nil</span></span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> claims, ok := token.Claims.(*CustomClaims); ok &amp;&amp; token.Valid &#123;</span><br><span class="line">		claims.RegisteredClaims.ExpiresAt = jwt.NewNumericDate(time.Now().Add(time.Hour * <span class="number">24</span>))</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> j.CreateToken(*claims)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;&quot;</span>, TokenInvalid</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><code>apis/user.go</code> 加入生成token代码</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	...</span><br><span class="line">	<span class="string">&quot;example.com/myGin/middleware/jwt&quot;</span> <span class="comment">// 引用中间件</span></span><br><span class="line">	<span class="string">&quot;example.com/myGin/models&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="comment">// 引用jwt-v5</span></span><br><span class="line">	jwtgo <span class="string">&quot;github.com/golang-jwt/jwt/v5&quot;</span> <span class="comment">// go get -u github.com/golang-jwt/jwt/v5 </span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成token</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GengerateToken</span><span class="params">(c *gin.Context, user models.User)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 调用中间件的初始化秘钥</span></span><br><span class="line">	j := &amp;jwt.JWT&#123; </span><br><span class="line">		[]<span class="type">byte</span>(<span class="string">&quot;newtrekWang&quot;</span>), <span class="comment">// 秘钥</span></span><br><span class="line">	&#125;</span><br><span class="line">	claims := jwt.CustomClaims&#123;</span><br><span class="line">		user.Id,</span><br><span class="line">		user.Name,</span><br><span class="line">		user.Password,</span><br><span class="line">		jwtgo.RegisteredClaims&#123;</span><br><span class="line">			ExpiresAt: jwtgo.NewNumericDate(time.Now().Add(time.Hour * <span class="number">24</span>)), <span class="comment">//定义过期时间为24小时</span></span><br><span class="line">			Issuer:    <span class="string">&quot;newtrekWang&quot;</span>,                                        <span class="comment">//签名的发行者</span></span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	token, err := j.CreateToken(claims)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">			<span class="string">&quot;status&quot;</span>: <span class="number">-1</span>,</span><br><span class="line">			<span class="string">&quot;msg&quot;</span>:    err.Error(),</span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	log.Println(token)</span><br><span class="line">	<span class="comment">// 登录成功后的结构体数据</span></span><br><span class="line">	data := LoginResult&#123;</span><br><span class="line">		User:  user,</span><br><span class="line">		Token: token,</span><br><span class="line">	&#125;</span><br><span class="line">	c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">		<span class="string">&quot;status&quot;</span>: <span class="number">0</span>,</span><br><span class="line">		<span class="string">&quot;msg&quot;</span>:    <span class="string">&quot;登录成功！&quot;</span>,</span><br><span class="line">		<span class="string">&quot;data&quot;</span>:   data,</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><code>routers\router.go</code> 对请求进行验证</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> routers</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;example.com/myGin/apis&quot;</span></span><br><span class="line">	<span class="string">&quot;example.com/myGin/middleware/jwt&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitRouter</span><span class="params">()</span></span> *gin.Engine &#123;</span><br><span class="line"></span><br><span class="line">	router := gin.Default()</span><br><span class="line">	<span class="comment">// 这样使用，并不能进行token验证</span></span><br><span class="line">	<span class="comment">// v1 := router.Group(&quot;/v1&quot;)</span></span><br><span class="line">	<span class="comment">// v1.Use(jwt.JWTAuth())</span></span><br><span class="line">	router.POST(<span class="string">&quot;/login&quot;</span>, apis.UserLogin)</span><br><span class="line">	<span class="comment">// 加载 HTML 模板文件</span></span><br><span class="line">	router.LoadHTMLGlob(<span class="string">&quot;template/user/*&quot;</span>)</span><br><span class="line">	<span class="comment">// 对接口进行token验证</span></span><br><span class="line">	router.GET(<span class="string">&quot;/GetUserList&quot;</span>, jwt.JWTAuth(), apis.GetUserList)</span><br><span class="line">	<span class="keyword">return</span> router</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>运行服务器端</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS E:\proj\gowork\studyGin&gt; <span class="keyword">go</span> run .\main.<span class="keyword">go</span></span><br></pre></td></tr></table></figure>

<h3 id="客户端发起请求"><a href="#客户端发起请求" class="headerlink" title="客户端发起请求"></a>客户端发起请求</h3><ul>
<li>采用python，不带token值，报错</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">resp2 = requests.get(<span class="string">&quot;http://127.0.0.1:8000/GetUserList&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(resp2.text)</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;请求未携带token无权限访问&quot;</span>,<span class="string">&quot;status&quot;</span>:-<span class="number">1</span>&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>登录后，读取token，填入token发送请求</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">data =&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;test1&quot;</span>, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;123456&quot;</span>&#125;</span><br><span class="line">resp = requests.post(<span class="string">&quot;http://127.0.0.1:8000/login&quot;</span>, data=data)</span><br><span class="line">dic = json.loads(resp.text)</span><br><span class="line">token = dic[<span class="string">&quot;data&quot;</span>][<span class="string">&quot;Token&quot;</span>]</span><br><span class="line">header = &#123;<span class="string">&quot;token&quot;</span>: token&#125;</span><br><span class="line"></span><br><span class="line">resp2 = requests.get(<span class="string">&quot;http://127.0.0.1:8000/GetUserList&quot;</span>, headers=header)</span><br><span class="line"><span class="built_in">print</span>(resp2.text)</span><br><span class="line"></span><br><span class="line">  &lt;p&gt;列表数据：&lt;/p&gt;</span><br><span class="line">  &lt;p&gt;<span class="number">0</span>--test1--<span class="number">123456</span>&lt;/p&gt;    </span><br><span class="line">   &lt;p&gt;<span class="number">1</span>--test11--<span class="number">1234567</span>&lt;/p&gt;  </span><br></pre></td></tr></table></figure>

<ul>
<li>直接传送正确的token，获取数据正常</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">token = <span class="string">&quot;yJhbGciOiJIUzI1Ni......&quot;</span></span><br><span class="line">header = &#123;<span class="string">&quot;token&quot;</span>: token&#125;</span><br><span class="line"></span><br><span class="line">resp2 = requests.get(<span class="string">&quot;http://127.0.0.1:8000/GetUserList&quot;</span>, headers=header)</span><br><span class="line"><span class="built_in">print</span>(resp2.text)</span><br><span class="line"></span><br><span class="line">&lt;p&gt;列表数据：&lt;/p&gt;</span><br><span class="line">&lt;p&gt;<span class="number">0</span>--test1--<span class="number">123456</span>&lt;/p&gt;    </span><br><span class="line">&lt;p&gt;<span class="number">1</span>--test11--<span class="number">1234567</span>&lt;/p&gt;  </span><br></pre></td></tr></table></figure>



<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><ul>
<li>代码来自<a target="_blank" rel="noopener" href="https://www.cnblogs.com/wangkun122/articles/11044328.html">gin框架实例</a>,其中jwt的验证这里，我用的v5版本，博主用的v4，</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://louis-me.github.io/aposts/7993dab5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="一个正经的测试工程师">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="施坤的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/aposts/7993dab5/" class="post-title-link" itemprop="url">go interface</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-06-21 10:28:36 / 修改时间：11:50:44" itemprop="dateCreated datePublished" datetime="2023-06-21T10:28:36+08:00">2023-06-21</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
                </span>
            </span>

          
            <span id="/aposts/7993dab5/" class="post-meta-item leancloud_visitors" data-flag-title="go interface" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/aposts/7993dab5/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/aposts/7993dab5/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h1><ul>
<li>在Go语言中接口（interface）是一种类型，一种抽象的类型。</li>
<li>interface(接口)是golang最重要的特性之一，实现多态。Interface类型可以定义<strong>一组方法</strong>，但是这些不需要实现。并且interface<strong>不能包含任何变量</strong>。</li>
<li>本篇主要来源<a target="_blank" rel="noopener" href="https://www.topgoer.com/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/%E6%8E%A5%E5%8F%A3.html">这里</a></li>
</ul>
<h2 id="接口定义和实现"><a href="#接口定义和实现" class="headerlink" title="接口定义和实现"></a>接口定义和实现</h2><h3 id="接口定义"><a href="#接口定义" class="headerlink" title="接口定义"></a>接口定义</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hello_work\iinterface\studyInterface.go</span></span><br><span class="line">/ 定义一个动物接口，接口中有个方法名称，但是不具体实现</span><br><span class="line"><span class="keyword">type</span> Animal <span class="keyword">interface</span> &#123;</span><br><span class="line">	Say()</span><br><span class="line">	GetName() <span class="type">string</span> <span class="comment">//返回内容为string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="接口实现"><a href="#接口实现" class="headerlink" title="接口实现"></a>接口实现</h3><ul>
<li>一个对象只要全部实现了接口中的方法，那么就实现了这个接口。换句话说，接口就是一个需要实现的方法列表。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">type</span> Dog <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Cat <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对应实现了接口中的方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d Dog)</span></span> Say() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;汪汪汪&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 对应实现了接口中的方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d Dog)</span></span> GetName() <span class="type">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> d.Name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Cat)</span></span> Say() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;喵喵喵&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Cat)</span></span> GetName() <span class="type">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> c.Name</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>完整代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">\\ hello_work/iinterface/studyInterface.<span class="keyword">go</span></span><br><span class="line"><span class="keyword">package</span> iinterface</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个动物接口，接口中有个方法</span></span><br><span class="line"><span class="keyword">type</span> Animal <span class="keyword">interface</span> &#123;</span><br><span class="line">	Say()</span><br><span class="line">	GetName() <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如下开始，为实现接口中的方法</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Dog <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Cat <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对应实现了接口中的方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d Dog)</span></span> Say() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;汪汪汪&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d Dog)</span></span> GetName() <span class="type">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> d.Name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Cat)</span></span> Say() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;喵喵喵&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Cat)</span></span> GetName() <span class="type">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> c.Name</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="接口类型变量"><a href="#接口类型变量" class="headerlink" title="接口类型变量"></a>接口类型变量</h2><ul>
<li>接口类型变量能够存储所有实现了该接口的实例</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hello_work\main.go</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;example.com/hello_work/hello_work/iinterface&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 声明一个Animal类型的变量animal</span></span><br><span class="line">	<span class="keyword">var</span> animal iinterface.Animal</span><br><span class="line">	<span class="comment">// 实例化一个dog结构体</span></span><br><span class="line">	dog := iinterface.Dog&#123;Name: <span class="string">&quot;旺财&quot;</span>&#125;</span><br><span class="line">	<span class="comment">// 可以把dog实例直接赋值给变量animal</span></span><br><span class="line">	animal = dog</span><br><span class="line">	dogName := animal.GetName()</span><br><span class="line">	fmt.Println(dogName)</span><br><span class="line">	animal.Say()</span><br><span class="line"></span><br><span class="line">	cat := iinterface.Cat&#123;Name: <span class="string">&quot;工程喵&quot;</span>&#125;</span><br><span class="line">	animal = cat</span><br><span class="line">	catName := animal.GetName()</span><br><span class="line">	fmt.Println(catName)</span><br><span class="line">	animal.Say()</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>运行结果</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PS E:\proj\gowork&gt; <span class="keyword">go</span> run .\hello_work\main.<span class="keyword">go</span></span><br><span class="line">旺财</span><br><span class="line">汪汪汪</span><br><span class="line">工程喵</span><br><span class="line">喵喵喵</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，如果实现了接口中的方法(studyInterface.go)用的是指针，如func (d *Dog)，那么对应实例化时也要传入指针,dog :&#x3D; &amp;iinterface.Dog{Name: “旺财”}</p>
</blockquote>
<h2 id="空接口"><a href="#空接口" class="headerlink" title="空接口"></a>空接口</h2><ul>
<li><p>空接口是指没有定义任何方法的接口。因此任何类型都实现了空接口。</p>
</li>
<li><p>空接口类型的变量可以存储任意类型的变量。</p>
</li>
</ul>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><ul>
<li>可以作为字符串，数字，bool类型等</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 定义一个空接口x</span></span><br><span class="line">    <span class="keyword">var</span> x <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">    s := <span class="string">&quot;pprof.cn&quot;</span></span><br><span class="line">    x = s</span><br><span class="line">    fmt.Printf(<span class="string">&quot;type:%T value:%v\n&quot;</span>, x, x)</span><br><span class="line">    i := <span class="number">100</span></span><br><span class="line">    x = i</span><br><span class="line">    fmt.Printf(<span class="string">&quot;type:%T value:%v\n&quot;</span>, x, x)</span><br><span class="line">    b := <span class="literal">true</span></span><br><span class="line">    x = b</span><br><span class="line">    fmt.Printf(<span class="string">&quot;type:%T value:%v\n&quot;</span>, x, x)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>空接口作为函数的参数</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 空接口作为函数参数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">show</span><span class="params">(a <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;type:%T value:%v\n&quot;</span>, a, a)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>空接口作为map的值</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 空接口作为map值</span></span><br><span class="line">    <span class="keyword">var</span> studentInfo = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">    studentInfo[<span class="string">&quot;name&quot;</span>] = <span class="string">&quot;李白&quot;</span></span><br><span class="line">    studentInfo[<span class="string">&quot;age&quot;</span>] = <span class="number">18</span></span><br><span class="line">    studentInfo[<span class="string">&quot;married&quot;</span>] = <span class="literal">false</span></span><br><span class="line">    fmt.Println(studentInfo)</span><br></pre></td></tr></table></figure>

<ul>
<li>综合运用可以参考此笔记中<a href="/aposts/43aefcf6/">go中字符串,切片,数组,map</a>中的map下空接口接受字符串json，然后反序列化的例子</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://louis-me.github.io/aposts/f9d23e4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="一个正经的测试工程师">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="施坤的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/aposts/f9d23e4/" class="post-title-link" itemprop="url">go 爬虫练习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-06-20 18:57:30 / 修改时间：20:41:18" itemprop="dateCreated datePublished" datetime="2023-06-20T18:57:30+08:00">2023-06-20</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
                </span>
            </span>

          
            <span id="/aposts/f9d23e4/" class="post-meta-item leancloud_visitors" data-flag-title="go 爬虫练习" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/aposts/f9d23e4/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/aposts/f9d23e4/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="分析网站"><a href="#分析网站" class="headerlink" title="分析网站"></a>分析网站</h2><ul>
<li><p>打开爬虫的目标网站：<a target="_blank" rel="noopener" href="http://www.52desktop.cn/html/DLZM/KPBZ/20191205/15898.html">http://www.52desktop.cn/html/DLZM/KPBZ/20191205/15898.html</a></p>
</li>
<li><p>点击下一张图片，发现后面多了个2，往后的下一张直接进行了累加，最终网站为：<code>.../KPBZ/20191205/15898_&#123;n&#125;.html</code></p>
</li>
</ul>
<p><img src="/aposts/f9d23e4/image-20230620190153496.png" alt="image-20230620190153496"></p>
<ul>
<li>点击下载图片时，经过分析最终的下载地址的n数量减一，为正则提取或者图片查找做准备<code>http://i.52desktop.cn:81/upimg/allimg/&#123;n&#125;/201912415221023477802.jpg</code></li>
</ul>
<p><img src="/aposts/f9d23e4/image-20230620190505925.png" alt="image-20230620190505925"></p>
<h2 id="单线程"><a href="#单线程" class="headerlink" title="单线程"></a>单线程</h2><ul>
<li><code>hello_work\craw\Craw1.go</code></li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hello_work\craw\Craw1.go</span></span><br><span class="line"><span class="keyword">package</span> crawl</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;bufio&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;io&quot;</span></span><br><span class="line">	<span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">	<span class="string">&quot;path&quot;</span></span><br><span class="line">	<span class="string">&quot;regexp&quot;</span></span><br><span class="line">	<span class="string">&quot;strconv&quot;</span></span><br><span class="line">	<span class="string">&quot;strings&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	<span class="comment">// 正则查找图片的地址</span></span><br><span class="line">	reImg = <span class="string">`http://i.52desktop.cn:81/upimg/allimg/[^&quot;]+?(\.((jpg)|(png)|(jpeg)|(gif)|(bmp)))`</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取链接中所有的内容</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetPageStr</span><span class="params">(url <span class="type">string</span>)</span></span> (pageStr <span class="type">string</span>) &#123;</span><br><span class="line"></span><br><span class="line">	resp, err := http.Get(url)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;http.Get error&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line">	<span class="comment">// 读取页面内容</span></span><br><span class="line">	pagebytes, err := ioutil.ReadAll(resp.Body)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;ioutil.ReadAll error&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 字节转换为字符串</span></span><br><span class="line">	pageStr = <span class="type">string</span>(pagebytes)</span><br><span class="line">	<span class="keyword">return</span> pageStr</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 下载图片，核心内容是获取图片的reader、write对象</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">downloadImg</span><span class="params">(savePath <span class="type">string</span>, url <span class="type">string</span>)</span></span> <span class="type">error</span> &#123;</span><br><span class="line"></span><br><span class="line">	v, err := http.Get(url)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;http.Get error&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> v.Body.Close()</span><br><span class="line">	fileName := path.Base(url) <span class="comment">// 获取文件名</span></span><br><span class="line">	<span class="comment">// 获得get请求响应的reader对象</span></span><br><span class="line">	reader := bufio.NewReaderSize(v.Body, <span class="number">32</span>*<span class="number">1024</span>)</span><br><span class="line">	<span class="comment">// 创建单个文件保存下来</span></span><br><span class="line">	file, err := os.Create(savePath + fileName)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;ioutil.WriteFile error&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// // 获得文件的writer对象</span></span><br><span class="line">	writer := bufio.NewWriter(file)</span><br><span class="line"></span><br><span class="line">	written, err := io.Copy(writer, reader)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;io.Copy error&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(fileName, <span class="string">&quot;download is success, Total length:&quot;</span>, written)</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 给main.go进行调用的外部地址</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetCrawl1Img</span><span class="params">()</span></span> &#123;</span><br><span class="line">	start := time.Now()</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">2</span>; i &lt;= <span class="number">21</span>; i++ &#123;</span><br><span class="line">		<span class="comment">// 根据观察规则，发现下载图片地址网站</span></span><br><span class="line">		url := <span class="string">&quot;http://www.52desktop.cn/html/DLZM/KPBZ/20191205/15898_&quot;</span> + strconv.Itoa(i) + <span class="string">&quot;.html&quot;</span></span><br><span class="line">		pageStr := GetPageStr(url)</span><br><span class="line">		re := regexp.MustCompile(reImg)</span><br><span class="line">		results := re.FindAllStringSubmatch(pageStr, <span class="number">-1</span>) <span class="comment">//  -1 表示搜索所有可能的匹配项。</span></span><br><span class="line">		<span class="keyword">for</span> _, result := <span class="keyword">range</span> results &#123;</span><br><span class="line">			<span class="keyword">if</span> strings.Contains(result[<span class="number">0</span>], <span class="string">&quot;20191204&quot;</span>) &#123; <span class="comment">// 过滤条件读取图片地址</span></span><br><span class="line">				downloadImg(<span class="string">&quot;E:\\proj\\gowork\\img\\&quot;</span>, result[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	elapse := time.Since(start)</span><br><span class="line">	fmt.Println(<span class="string">&quot;elapsed time is : &quot;</span>, elapse, <span class="string">&quot;s&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>hello_work&#x2F;main.go</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hello_work/main.go</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;example.com/hello_work/hello_work/crawl&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	crawl.GetCrawl1Img()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>调用,共下载了20张图片，耗时20秒</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> E:\proj\gowork&gt; <span class="keyword">go</span> run .\hello_work\main.<span class="keyword">go</span></span><br><span class="line"><span class="number">201912415221023477802.</span>jpg download is success, Total length: <span class="number">344218</span></span><br><span class="line"><span class="number">201912415221023477802.</span>jpg download is success, Total length: <span class="number">344218</span></span><br><span class="line"><span class="number">201912415221026577803.</span>jpg download is success, Total length: <span class="number">342307</span></span><br><span class="line">...</span><br><span class="line"><span class="number">2019124152210921778021.</span>jpg download is success, Total length: <span class="number">340471</span></span><br><span class="line">elapsed time is :  <span class="number">20.861619</span>s </span><br></pre></td></tr></table></figure>

<h2 id="并发爬虫"><a href="#并发爬虫" class="headerlink" title="并发爬虫"></a>并发爬虫</h2><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><ul>
<li>初始化一个数据管道</li>
<li>爬虫写出：创建多个协程用于添加图片</li>
<li>任务统计协程：检查多个个任务是否都完成，完成则关闭数据管道</li>
<li>下载协程：从管道里读取链接并下载</li>
</ul>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><ul>
<li><code>hello_work/crawl/Crawl2.go</code></li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> crawl</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;path&quot;</span></span><br><span class="line">	<span class="string">&quot;regexp&quot;</span></span><br><span class="line">	<span class="string">&quot;strconv&quot;</span></span><br><span class="line">	<span class="string">&quot;strings&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	<span class="comment">// 正则提取表达式</span></span><br><span class="line">	geReImg = <span class="string">`http://i.52desktop.cn:81/upimg/allimg/[^&quot;]+?(\.((jpg)|(png)|(jpeg)|(gif)|(bmp)))`</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 存放图片链接的数据管道</span></span><br><span class="line">	chanImageUrls <span class="keyword">chan</span> <span class="type">string</span></span><br><span class="line">	<span class="comment">// 启动多个goroutine，sync.WaitGroup来实现goroutine的同步</span></span><br><span class="line">	waitGroup sync.WaitGroup</span><br><span class="line">	<span class="comment">// 用于监控协程</span></span><br><span class="line">	chanTask <span class="keyword">chan</span> <span class="type">string</span></span><br><span class="line">	<span class="comment">// 监控协程总数</span></span><br><span class="line">	chanTaskCount = <span class="number">23</span></span><br><span class="line">	<span class="comment">// 监控当前的下载任务是否完成的总数</span></span><br><span class="line">	count <span class="type">int</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 爬取图片链接，获取当前页的所有图片链接</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getImgs</span><span class="params">(url <span class="type">string</span>)</span></span> (urls []<span class="type">string</span>) &#123;</span><br><span class="line">	pageStr := GetPageStr(url)</span><br><span class="line">	re := regexp.MustCompile(geReImg)</span><br><span class="line">	results := re.FindAllStringSubmatch(pageStr, <span class="number">-1</span>) <span class="comment">//  -1 表示搜索所有可能的匹配项。</span></span><br><span class="line">	fmt.Printf(<span class="string">&quot;共找到%d条结果\n&quot;</span>, <span class="built_in">len</span>(results))</span><br><span class="line">	<span class="keyword">for</span> _, result := <span class="keyword">range</span> results &#123;</span><br><span class="line">		url := result[<span class="number">0</span>]</span><br><span class="line">		<span class="keyword">if</span> strings.Contains(result[<span class="number">0</span>], <span class="string">&quot;20191204&quot;</span>) &#123; <span class="comment">// 过滤条件读取图片地址</span></span><br><span class="line">			urls = <span class="built_in">append</span>(urls, url)</span><br><span class="line">			<span class="comment">// fmt.Println(url)</span></span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> urls</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getImgUrls</span><span class="params">(url <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">	urls := getImgs(url)</span><br><span class="line">	<span class="comment">// 遍历切片里所有链接，存入数据管道</span></span><br><span class="line">	<span class="keyword">for</span> _, url := <span class="keyword">range</span> urls &#123;</span><br><span class="line">		<span class="comment">// 存放图片链接的数据管道，发送图片链接</span></span><br><span class="line">		chanImageUrls &lt;- url</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 标识当前协程完成</span></span><br><span class="line">	<span class="comment">// 每完成一个任务，写一条数据</span></span><br><span class="line">	<span class="comment">// 用于监控协程知道已经完成了几个任务</span></span><br><span class="line">	chanTask &lt;- url</span><br><span class="line">	waitGroup.Done()</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 任务统计</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CheckOk</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="comment">// 从chanTask中接收值并赋值给变量,url</span></span><br><span class="line">		url := &lt;-chanTask</span><br><span class="line">		fmt.Printf(<span class="string">&quot;%s 完成了爬虫任务\n&quot;</span>, url)</span><br><span class="line">		count++</span><br><span class="line">		<span class="comment">// 任务统计个协程是否全部完成,完成了久关闭通道</span></span><br><span class="line">		<span class="comment">// 因为的我循环起始地址的索引为2，所以这里减去2</span></span><br><span class="line">		<span class="keyword">if</span> count == chanTaskCount<span class="number">-2</span> &#123;</span><br><span class="line">			<span class="built_in">close</span>(chanImageUrls)</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	waitGroup.Done()</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">downloadFile</span><span class="params">(savePath <span class="type">string</span>, url <span class="type">string</span>)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	v, err := http.Get(url)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;http.Get error&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> v.Body.Close()</span><br><span class="line">	fileName := savePath + path.Base(url) <span class="comment">// 获取文件名</span></span><br><span class="line">	bytes, err := ioutil.ReadAll(v.Body)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;io.ReadAll error&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 直接写入内容，比Crawl1.go代码更简单</span></span><br><span class="line">	err = ioutil.WriteFile(fileName, bytes, <span class="number">0666</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;ioutil.WriteFile error&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(fileName, <span class="string">&quot; download is success&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 下载协程，从hanImageUrls管道中读取链接下载,读取的数据来自于这里函数getImgUrls，对chanImageUrls的写入</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">DownloadImg</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> url := <span class="keyword">range</span> chanImageUrls &#123;</span><br><span class="line">		downloadFile(<span class="string">&quot;E:\\proj\\gowork\\img\\&quot;</span>, url)</span><br><span class="line">	&#125;</span><br><span class="line">	waitGroup.Done()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetCrawl2Img</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 初始化管道</span></span><br><span class="line">	chanImageUrls = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>, <span class="number">100</span>)</span><br><span class="line">	chanTask = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>, chanTaskCount)</span><br><span class="line">	start := time.Now()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">2</span>; i &lt; chanTaskCount; i++ &#123;</span><br><span class="line">		waitGroup.Add(<span class="number">1</span>)</span><br><span class="line">		<span class="comment">// 根据观察规则，发现下载图片地址网站</span></span><br><span class="line">		<span class="keyword">go</span> getImgUrls(<span class="string">&quot;http://www.52desktop.cn/html/DLZM/KPBZ/20191205/15898_&quot;</span> + strconv.Itoa(i) + <span class="string">&quot;.html&quot;</span>)</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 任务统计个协程是否全部完成</span></span><br><span class="line">	waitGroup.Add(<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">go</span> CheckOk()</span><br><span class="line">	<span class="comment">// 创建一个新的协程来执行 Wait 后面的操作</span></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="comment">// 等待所有协程完成</span></span><br><span class="line">		waitGroup.Wait()</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 执行一些操作</span></span><br><span class="line">		fmt.Println(<span class="string">&quot;All workers have completed.&quot;</span>)</span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="comment">// 下载协程，从管道中读取链接下载</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">		waitGroup.Add(<span class="number">1</span>)</span><br><span class="line">		<span class="keyword">go</span> DownloadImg()</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	waitGroup.Wait()</span><br><span class="line">	elapse := time.Since(start)</span><br><span class="line">	fmt.Println(<span class="string">&quot;elapsed time is : &quot;</span>, elapse, <span class="string">&quot;s&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>hello_work&#x2F;main.go</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;example.com/hello_work/hello_work/crawl&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// crawl.GetCrawl1Img()</span></span><br><span class="line">	crawl.GetCrawl2Img()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>调用，下载了20张图片，共耗时7秒，大幅提升下载速度</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PS E:\proj\gowork&gt; <span class="keyword">go</span> run .\hello_work\main.<span class="keyword">go</span></span><br><span class="line">E:\proj\gowork\img\<span class="number">201912415221040677807.</span>jpg  download is success</span><br><span class="line">E:\proj\gowork\img\<span class="number">201912415221040677807.</span>jpg  download is success</span><br><span class="line">E:\proj\gowork\img\<span class="number">2019124152210546778011.</span>jpg  download is success</span><br><span class="line">All workers have completed.</span><br><span class="line">elapsed time is :  <span class="number">7.2002013</span>s s</span><br></pre></td></tr></table></figure>

<p><img src="/aposts/f9d23e4/image-20230620203609304.png" alt="image-20230620203609304"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li><p>代码主要来自<a target="_blank" rel="noopener" href="https://www.topgoer.com/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E7%88%AC%E8%99%AB%E5%B0%8F%E6%A1%88%E4%BE%8B.html">这里</a></p>
</li>
<li><p>其中<code>CheckOk</code>代码中的<code>count</code>计算不正确，无法关闭<code>close(chanImageUrls)</code>，导致<code>waitGroup</code>无法关闭，引起阻塞，本次代码中已经修复</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://louis-me.github.io/aposts/3fcd402/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="一个正经的测试工程师">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="施坤的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/aposts/3fcd402/" class="post-title-link" itemprop="url">win7 mysql安装详解</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-12 10:23:03" itemprop="dateCreated datePublished" datetime="2023-06-12T10:23:03+08:00">2023-06-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-06-14 09:25:52" itemprop="dateModified" datetime="2023-06-14T09:25:52+08:00">2023-06-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index"><span itemprop="name">mysql</span></a>
                </span>
            </span>

          
            <span id="/aposts/3fcd402/" class="post-meta-item leancloud_visitors" data-flag-title="win7 mysql安装详解" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/aposts/3fcd402/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/aposts/3fcd402/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="mysql准备"><a href="#mysql准备" class="headerlink" title="mysql准备"></a>mysql准备</h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/downloads/mysql/">官网</a>下载对应的zip包，我选择的(mysql-8.0.22-winx64.zip)</p>
</li>
<li><p>在mysql-8.0.22-winx64文件夹下面新建一个<code>my.ini</code>文件和一个<code>data</code>文件夹</p>
</li>
<li><p>my.ini中的内容</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">my.ini内容：</span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>mysqld<span class="punctuation">]</span></span><br><span class="line"># 设置<span class="number">3306</span>端口</span><br><span class="line">port=<span class="number">3306</span></span><br><span class="line"># 设置mysql的安装目录</span><br><span class="line">basedir=E<span class="punctuation">:</span>\\app\\mysql<span class="number">-8.0</span><span class="number">.22</span>-winx64</span><br><span class="line"># 设置mysql数据库的数据的存放目录</span><br><span class="line">datadir=E<span class="punctuation">:</span>\\app\\mysql<span class="number">-8.0</span><span class="number">.22</span>-winx64\\data</span><br><span class="line"># 允许最大连接数</span><br><span class="line">max_connections=<span class="number">200</span></span><br><span class="line"># 允许连接失败的次数。这是为了防止有人从该主机试图攻击数据库系统</span><br><span class="line">max_connect_errors=<span class="number">10</span></span><br><span class="line"># 服务端使用的字符集默认为UTF8</span><br><span class="line">character-set-server=utf8</span><br><span class="line"># 创建新表时将使用的默认存储引擎</span><br><span class="line">default-storage-engine=INNODB</span><br><span class="line"><span class="punctuation">[</span>mysql<span class="punctuation">]</span></span><br><span class="line"># 设置mysql客户端默认字符集</span><br><span class="line">default-character-set=utf8</span><br><span class="line"># 注意这里的配置，ONLY_FULL_GROUP_BY的报错问题</span><br><span class="line">sql_mode=&#x27;STRICT_TRANS_TABLES<span class="punctuation">,</span>NO_ENGINE_SUBSTITUTION&#x27;</span><br><span class="line"><span class="punctuation">[</span>client<span class="punctuation">]</span></span><br><span class="line"># 设置mysql客户端连接服务端时默认使用的端口</span><br><span class="line">port=<span class="number">3306</span></span><br><span class="line">default-character-set=utf8</span><br></pre></td></tr></table></figure>
<blockquote>
<p>5.7后的版本，使用了group by分组后，select后的字段必须也要是分组的，不然报错ONLY_FULL_GROUP_BY，因此需要设置sql_mode</p>
</blockquote>
</li>
<li><p>我的电脑设置环境变量</p>
<ul>
<li>MYSQL_HOME&#x3D;e:\app\mysql-8.0.22-winx64</li>
<li>在path中添加%MYSQL_HOME%\bin</li>
</ul>
</li>
</ul>
<h2 id="mysql安装"><a href="#mysql安装" class="headerlink" title="mysql安装"></a>mysql安装</h2><ul>
<li>已管理员身份打开cmd,输入<code>mysqld --initialize --user=mysql --console</code>发现弹出没有<code>vcruntime140_1.dll</code>文件<ul>
<li>找到<a target="_blank" rel="noopener" href="https://cn.dll-files.com/vcruntime140_1.dll.html">对应网站</a>下载此dll</li>
</ul>
</li>
<li><code>vcruntime140_1.dll</code>文件放到<code>C:\Windows\System32</code> 和 <code>C:\Windows\SysWOW64</code>下</li>
<li>运行下面的bat文件，进行注册<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@echo 开始注册</span><br><span class="line">copy vcruntime140_1.dll %windir%\system32\</span><br><span class="line">regsvr32 %windir%\system32\vcruntime140_1.dll /s</span><br><span class="line">@echo system32 vcruntime140_1.dll注册成功</span><br><span class="line"></span><br><span class="line">copy vcruntime140_1.dll %windir%\SysWOW64\</span><br><span class="line">regsvr32 %windir%\system32\vcruntime140_1.dll /s</span><br><span class="line">@echo SysWOW64 vcruntime140_1.dll注册成功</span><br><span class="line">@pause</span><br></pre></td></tr></table></figure></li>
<li>初始化数据库<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">E:\&gt;mysqld --initialize --user=mysql --console</span><br><span class="line">2020-11-28T03:32:30.871296Z 0 [System] [MY-013169] [Server] E:\app\mysql-8.0.22-</span><br><span class="line">winx64\bin\mysqld.exe (mysqld 8.0.22) initializing of server in progress as proc</span><br><span class="line">ess 6964</span><br><span class="line">2020-11-28T03:32:30.873294Z 0 [Warning] [MY-013242] [Server] --character-set-ser</span><br><span class="line">ver: &#x27;utf8&#x27; is currently an alias for the character set UTF8MB3, but will be an</span><br><span class="line">alias for UTF8MB4 in a future release. Please consider using UTF8MB4 in order to</span><br><span class="line"> be unambiguous.</span><br><span class="line">2020-11-28T03:32:30.884295Z 1 [System] [MY-013576] [InnoDB] InnoDB initializatio</span><br><span class="line">n has started.</span><br><span class="line">2020-11-28T03:32:33.331435Z 1 [System] [MY-013577] [InnoDB] InnoDB initializatio</span><br><span class="line">n has ended.</span><br><span class="line">2020-11-28T03:32:35.760574Z 6 [Note] [MY-010454] [Server] A temporary password i</span><br><span class="line">s generated for root@localhost: JoyfjqHL5)SO</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><code>JoyfjqHL5)SO</code>这个就是得到的数据库密码</li>
<li>输入命令安装mysql<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">E:\&gt;mysqld install</span><br><span class="line">Service successfully installed.</span><br></pre></td></tr></table></figure></li>
<li>启动mysql服务<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">E:\&gt;net start mysql</span><br><span class="line">MySQL 服务正在启动 .</span><br><span class="line">MySQL 服务已经启动成功</span><br></pre></td></tr></table></figure></li>
<li>登陆mysql,粘贴刚刚生成的密码<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E:\&gt;mysql -u root -p</span><br></pre></td></tr></table></figure></li>
<li>登陆成功后修改密码<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;123456&#x27;;</span><br></pre></td></tr></table></figure></li>
<li>刷新<code>FLUSH PRIVILEGES;</code></li>
</ul>
<h2 id="mysql连接"><a href="#mysql连接" class="headerlink" title="mysql连接"></a>mysql连接</h2><ul>
<li>我这里使用<a target="_blank" rel="noopener" href="https://www.heidisql.com/download.php">heidisql</a></li>
<li>新建会话，输入密码，打开下面页面就说明已经成功连接数据库<br><img src="/aposts/3fcd402/image-20230612102438254.png" alt="image-20230612102438254"></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://louis-me.github.io/aposts/a08a31/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="一个正经的测试工程师">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="施坤的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/aposts/a08a31/" class="post-title-link" itemprop="url">mysql查询练习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-12 10:19:02" itemprop="dateCreated datePublished" datetime="2023-06-12T10:19:02+08:00">2023-06-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-06-14 18:36:31" itemprop="dateModified" datetime="2023-06-14T18:36:31+08:00">2023-06-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index"><span itemprop="name">mysql</span></a>
                </span>
            </span>

          
            <span id="/aposts/a08a31/" class="post-meta-item leancloud_visitors" data-flag-title="mysql查询练习" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/aposts/a08a31/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/aposts/a08a31/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><ul>
<li>参考<a href="/aposts/3fcd402/">mysql安装详解</a></li>
</ul>
<h2 id="库表准备"><a href="#库表准备" class="headerlink" title="库表准备"></a>库表准备</h2><ul>
<li>创建一个数据库</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE Educational;</span><br></pre></td></tr></table></figure>

<ul>
<li>创建学生表</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">use Educational </span><br><span class="line"></span><br><span class="line">CREATE TABLE student </span><br><span class="line">(</span><br><span class="line">ID CHAR(9) PRIMARY KEY, # PRIMARY KEY表示id为主键</span><br><span class="line">name VARCHAR(10),</span><br><span class="line">gender CHAR(6), # 性别</span><br><span class="line">birthdate date # 出生年月</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>创建课程表</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE course</span><br><span class="line">(</span><br><span class="line"># 课程号,主键</span><br><span class="line">courseID CHAR(5) PRIMARY key,</span><br><span class="line"># 课程名</span><br><span class="line">coursename VARCHAR(36),</span><br><span class="line"># 课程简介</span><br><span class="line">Syllabus text,</span><br><span class="line"># 课时</span><br><span class="line">hours INT,</span><br><span class="line"># 学分</span><br><span class="line">credit TINYINT,</span><br><span class="line"># 开课学期</span><br><span class="line">semester text</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ul>
<li>创建一个成绩表，将学生表和课程表进行关联</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE Score </span><br><span class="line">(</span><br><span class="line"># 学号,关联学生表中id,作为外键</span><br><span class="line">ID CHAR(9) REFERENCES student(ID),</span><br><span class="line"># 课程号.关联课程表中id,作为外键</span><br><span class="line">courseID CHAR(5) REFERENCES course(CourseID),</span><br><span class="line"># 成绩</span><br><span class="line">Results DECIMAL(4,1) CHECK(results BETWEEN 0 AND 100)</span><br><span class="line"></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li>插入数据,学生表</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO student VALUES(&#x27;202201001&#x27;,&#x27;汤姆猫&#x27;,&#x27;男&#x27;,&#x27;2000-01-01&#x27;);</span><br><span class="line">INSERT INTO student VALUES(&#x27;202201002&#x27;,&#x27;风火轮&#x27;,&#x27;男&#x27;,&#x27;1998-11-03&#x27;);</span><br><span class="line">INSERT INTO student VALUES(&#x27;202201003&#x27;,&#x27;闪光弹&#x27;,&#x27;女&#x27;,&#x27;2000-08-21&#x27;);</span><br><span class="line">INSERT INTO student VALUES(&#x27;202201004&#x27;,&#x27;降世拳&#x27;,&#x27;女&#x27;,&#x27;2010-04-11&#x27;);</span><br><span class="line">INSERT INTO student VALUES(&#x27;202201005&#x27;,&#x27;流星腿&#x27;,&#x27;女&#x27;,&#x27;2010-09-23&#x27;);</span><br><span class="line">INSERT INTO student VALUES(&#x27;202201006&#x27;,&#x27;闪闪光&#x27;,&#x27;女&#x27;,&#x27;2010-02-02&#x27;);</span><br><span class="line">INSERT INTO student VALUES(&#x27;202201007&#x27;,&#x27;汤汤水&#x27;,&#x27;女&#x27;,&#x27;1999-03-29&#x27;);</span><br></pre></td></tr></table></figure>

<p><img src="/aposts/a08a31/image-20230612112157798.png" alt="image-20230612112157798"></p>
<ul>
<li>插入数据，课程表</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO course VALUES(&#x27;10001&#x27;,&#x27;英语&#x27;, &#x27;英语简介介绍&#x27;,28,20,&#x27;2023-07-01&#x27;);</span><br><span class="line">INSERT INTO course VALUES(&#x27;10002&#x27;,&#x27;数学&#x27;, &#x27;英语简介介绍&#x27;,32,17,&#x27;2023-07-01&#x27;);</span><br><span class="line">INSERT INTO course VALUES(&#x27;10003&#x27;,&#x27;语文&#x27;, &#x27;语文简介介绍&#x27;,29,25,&#x27;2023-07-01&#x27;);</span><br><span class="line">INSERT INTO course VALUES(&#x27;10004&#x27;,&#x27;物理&#x27;, &#x27;物理简介介绍&#x27;,21,20,&#x27;2023-08-05&#x27;)</span><br><span class="line">INSERT INTO course VALUES(&#x27;10005&#x27;,&#x27;媒体&#x27;, &#x27;摄像媒体简介介绍&#x27;,13,12,&#x27;2023-08-01&#x27;);</span><br><span class="line">INSERT INTO course VALUES(&#x27;10006&#x27;,&#x27;java&#x27;, &#x27;java简介介绍&#x27;,17,5,&#x27;2023-08-11&#x27;)</span><br></pre></td></tr></table></figure>

<ul>
<li>插入数据，成绩表</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO Score VALUES(&#x27;202201001&#x27;,&#x27;10001&#x27;,89);</span><br><span class="line">INSERT INTO Score VALUES(&#x27;202201002&#x27;,&#x27;10001&#x27;,76);</span><br><span class="line">INSERT INTO Score VALUES(&#x27;202201003&#x27;,&#x27;10001&#x27;,99);</span><br><span class="line">INSERT INTO Score VALUES(&#x27;202201004&#x27;,&#x27;10001&#x27;,88);</span><br><span class="line">INSERT INTO Score VALUES(&#x27;202201005&#x27;,&#x27;10001&#x27;,59);</span><br><span class="line">INSERT INTO Score VALUES(&#x27;202201006&#x27;,&#x27;10001&#x27;,69);</span><br><span class="line"></span><br><span class="line">INSERT INTO Score VALUES(&#x27;202201001&#x27;,&#x27;10002&#x27;,80);</span><br><span class="line">INSERT INTO Score VALUES(&#x27;202201002&#x27;,&#x27;10002&#x27;,77);</span><br><span class="line">INSERT INTO Score VALUES(&#x27;202201003&#x27;,&#x27;10002&#x27;,92);</span><br><span class="line">INSERT INTO Score VALUES(&#x27;202201004&#x27;,&#x27;10002&#x27;,83);</span><br><span class="line">INSERT INTO Score VALUES(&#x27;202201005&#x27;,&#x27;10002&#x27;,56);</span><br><span class="line">INSERT INTO Score VALUES(&#x27;202201006&#x27;,&#x27;10002&#x27;,100);</span><br><span class="line"></span><br><span class="line">INSERT INTO Score VALUES(&#x27;202201001&#x27;,&#x27;10003&#x27;,81);</span><br><span class="line">INSERT INTO Score VALUES(&#x27;202201002&#x27;,&#x27;10003&#x27;,72);</span><br><span class="line">INSERT INTO Score VALUES(&#x27;202201003&#x27;,&#x27;10003&#x27;,63);</span><br><span class="line">INSERT INTO Score VALUES(&#x27;202201004&#x27;,&#x27;10003&#x27;,81);</span><br><span class="line">INSERT INTO Score VALUES(&#x27;202201005&#x27;,&#x27;10003&#x27;,55);</span><br><span class="line">INSERT INTO Score VALUES(&#x27;202201006&#x27;,&#x27;10003&#x27;,93);</span><br><span class="line"></span><br><span class="line">INSERT INTO Score VALUES(&#x27;202201001&#x27;,&#x27;10004&#x27;,82);</span><br><span class="line">INSERT INTO Score VALUES(&#x27;202201002&#x27;,&#x27;10004&#x27;,71);</span><br><span class="line">INSERT INTO Score VALUES(&#x27;202201003&#x27;,&#x27;10004&#x27;,96);</span><br><span class="line">INSERT INTO Score VALUES(&#x27;202201004&#x27;,&#x27;10004&#x27;,75);</span><br><span class="line">INSERT INTO Score VALUES(&#x27;202201005&#x27;,&#x27;10004&#x27;,58);</span><br><span class="line">INSERT INTO Score VALUES(&#x27;202201006&#x27;,&#x27;10004&#x27;,89);</span><br><span class="line"></span><br><span class="line">INSERT INTO Score VALUES(&#x27;202201001&#x27;,&#x27;10005&#x27;,91);</span><br><span class="line">INSERT INTO Score VALUES(&#x27;202201002&#x27;,&#x27;10005&#x27;,86);</span><br><span class="line">INSERT INTO Score VALUES(&#x27;202201003&#x27;,&#x27;10005&#x27;,97);</span><br><span class="line">INSERT INTO Score VALUES(&#x27;202201004&#x27;,&#x27;10005&#x27;,38);</span><br><span class="line">INSERT INTO Score VALUES(&#x27;202201005&#x27;,&#x27;10005&#x27;,61);</span><br><span class="line">INSERT INTO Score VALUES(&#x27;202201006&#x27;,&#x27;10005&#x27;,18);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h2><ul>
<li>基础语法</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select 查询列表</span><br><span class="line">from 表1 别名，表2 别名</span><br><span class="line">where 表1.key=表2.key</span><br><span class="line">【and 筛选条件】</span><br><span class="line">【group by 分组字段】</span><br><span class="line">【having 分组后的筛选】</span><br><span class="line">【order by 排序字段】</span><br></pre></td></tr></table></figure>

<ul>
<li><p>关于group by 分组的理解</p>
<ul>
<li>合并数据，比如张三有两条数据分别为100,20，合并后就成了120</li>
<li>在使用聚合函数，如sum,avg等需要分组，比如张三有对应两条数据为10和20，李四对应两条数据为10和10，使用avg 求平均值时</li>
</ul>
<p><strong>不分组</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select name,avg(num),count(1) from table </span><br><span class="line"># 若不分组就是整张表的平均值，即：（10+20+10+10）/4=12.5</span><br><span class="line">#  count(1)，则是统计表中数据行，上述计算出为4</span><br><span class="line"># 而这里的name则是读取表中一条数据，张三</span><br><span class="line"></span><br><span class="line">张三  12.5  4</span><br></pre></td></tr></table></figure>

<p><strong>分组</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select name,avg(num),count(1) from table group name</span><br><span class="line"># 首先对张三、李四进行分组，各自的数据为10+20=30、10+10=20</span><br><span class="line"># 然后对分组后的数据进行平均计算，30/2=15、10/2=10</span><br><span class="line">张三 15 2</span><br><span class="line">李四 10 2</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h3><ul>
<li>不及格的学生姓名，性别，科目，分数</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT student.name, student.gender,course.coursename, score.Results FROM score, student,course WHERE score.ID=student.ID AND score.courseID=course.courseID and Results &lt;=60</span><br></pre></td></tr></table></figure>



<p><img src="/aposts/a08a31/image-20230614154352090.png" alt="image-20230614154352090"></p>
<ul>
<li>查询所有学生共参加了几门考试的信息，并且分数大于80，<strong>一定要分组,不分组就是查询的共有多少人参加了考试</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT student.ID,student.name,COUNT(1) FROM student,score WHERE student.ID = score.ID AND score.Results&gt;80 GROUP BY student.ID</span><br></pre></td></tr></table></figure>

<p><img src="/aposts/a08a31/image-20230614154417658.png" alt="image-20230614154417658"></p>
<ul>
<li>计算当前学生所有成绩的总分，<strong>使用的左连接</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT student.name,sum(score.Results),COUNT(1) FROM score LEFT JOIN student on score.ID=student.ID GROUP BY student.ID</span><br></pre></td></tr></table></figure>

<p><img src="/aposts/a08a31/image-20230614154453362.png" alt="image-20230614154453362"></p>
<ul>
<li>计算当前学生所有成绩的总分大于300的信息，<strong>分组后，使用having sum</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT student.name,sum(score.Results),COUNT(1) FROM score LEFT JOIN student on score.ID=student.ID GROUP BY student.ID HAVING SUM(score.Results)&gt;90</span><br><span class="line">  </span><br></pre></td></tr></table></figure>

<p><img src="/aposts/a08a31/image-20230614154545101.png" alt="image-20230614154545101"></p>
<ul>
<li>查询当前分数最高的学生名字、科目。<strong>注意这里and results&#x3D; 使用了子查询</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT student.name,course.coursename,results from course,score, student WHERE course.courseID=score.courseID AND student.ID=score.ID and results=(SELECT MAX(score.Results) FROM score)</span><br></pre></td></tr></table></figure>

<p><img src="/aposts/a08a31/image-20230614160341440.png" alt="image-20230614160341440"></p>
<ul>
<li>查询各个科目的平均成绩</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select course.coursename,avg(score.Results),COUNT(1) FROM course  JOIN score ON course.courseID = score.courseID GROUP BY course.courseID</span><br></pre></td></tr></table></figure>

<p><img src="/aposts/a08a31/image-20230614160434587.png" alt="image-20230614160434587"></p>
<ul>
<li>查询某个学生共参加了几门考试</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT student.name,count(score.Results) FROM student,score WHERE student.name=&quot;汤姆猫&quot; AND student.ID=score.ID</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>查看学生成绩总分为前三的数据。<strong>先对学生进行分组，然后用sum计算所有分数，然后取前3条数据</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT stu.name, sum(sc.Results) FROM student stu ,score sc WHERE sc.ID=stu.ID GROUP BY stu.ID ORDER BY sum(sc.Results) DESC LIMIT 3</span><br></pre></td></tr></table></figure>

<p><img src="/aposts/a08a31/image-20230614160553477.png" alt="image-20230614160553477"></p>
<ul>
<li>查询各科成绩前三的学生信息，这个自己写不出来，用<code>chatgpt</code>写的</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SELECT s.name AS student_name, c.coursename AS course_name, sc.Results AS course_score</span><br><span class="line">FROM score sc</span><br><span class="line">JOIN student s ON sc.ID = s.ID -- 连接score表和student表，获取学生姓名</span><br><span class="line">JOIN course c ON sc.courseID = c.courseID -- 连接score表和course表，获取课程名称</span><br><span class="line">WHERE (</span><br><span class="line">  SELECT COUNT(DISTINCT Results) -- 查询比当前成绩高的不同分数的数量</span><br><span class="line">  FROM score sc2 </span><br><span class="line">  WHERE sc2.courseID = sc.courseID AND sc2.Results &gt; sc.Results </span><br><span class="line">) &lt; 3 -- 只保留比当前成绩高的不同分数小于3个的记录，即前三名</span><br><span class="line">ORDER BY c.coursename, sc.Results DESC; -- 按照课程名称和成绩降序排序</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/aposts/a08a31/image-20230614173746372.png" alt="image-20230614173746372"></p>
<ul>
<li>查询所有课程最高分数的学生信息，<strong>用查询各科成绩前三的语句，把&lt;3给为&lt;1即可</strong></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">


    <div class="sidebar-inner">



      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt=""
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name"></p>
  <div class="site-description" itemprop="description">一个正经的测试工程师</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">155</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">64</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Louis-me" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Louis-me" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:shikun.job@foxmail.com" title="E-Mail → mailto:shikun.job@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>
  <!-- 标签云 -->

<script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script>
<div class="widget-wrap">
    <!--<h3 class="widget-title">Tag Cloud</h3> -->
    <div id="myCanvasContainer" class="widget tagcloud">
        <canvas width="250" height="250" id="resCanvas" style="width=100%">
            <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AWVS/" rel="tag">AWVS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/" rel="tag">Android</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Burp-Site/" rel="tag">Burp Site</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DVWA/" rel="tag">DVWA</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dependency-Check/" rel="tag">Dependency-Check</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/H5/" rel="tag">H5</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hadoop/" rel="tag">Hadoop</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hive/" rel="tag">Hive</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jenkins/" rel="tag">Jenkins</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Metasploit/" rel="tag">Metasploit</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nessus/" rel="tag">Nessus</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sonic/" rel="tag">Sonic</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/airtest/" rel="tag">airtest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/" rel="tag">android</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/" rel="tag">android性能测试</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/app%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/" rel="tag">app安全测试</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aritest/" rel="tag">aritest</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/centos/" rel="tag">centos</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/chrome/" rel="tag">chrome</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/datax/" rel="tag">datax</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/django/" rel="tag">django</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/drozer/" rel="tag">drozer</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fisco-bcos/" rel="tag">fisco-bcos</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flink/" rel="tag">flink</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gin/" rel="tag">gin</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go/" rel="tag">go</a><span class="tag-list-count">16</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go-zero/" rel="tag">go-zero</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hive/" rel="tag">hive</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/httprunner/" rel="tag">httprunner</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jmeter/" rel="tag">jmeter</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kafka/" rel="tag">kafka</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kail/" rel="tag">kail</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/leetcode/" rel="tag">leetcode</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/leetcode-%E6%95%B0%E7%BB%84/" rel="tag">leetcode-数组</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mitmproxy/" rel="tag">mitmproxy</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/" rel="tag">mongodb</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/monkey/" rel="tag">monkey</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pandas/" rel="tag">pandas</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pc%E8%87%AA%E5%8A%A8%E5%8C%96/" rel="tag">pc自动化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/playwright/" rel="tag">playwright</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pytest/" rel="tag">pytest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a><span class="tag-list-count">23</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/" rel="tag">redis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/selenium/" rel="tag">selenium</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring/" rel="tag">spring</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqlite/" rel="tag">sqlite</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqlmap/" rel="tag">sqlmap</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tkinter/" rel="tag">tkinter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue3/" rel="tag">vue3</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8/" rel="tag">云服务器</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/" rel="tag">区块链</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" rel="tag">大数据</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/" rel="tag">安全测试</a><span class="tag-list-count">29</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/" rel="tag">性能测试</a><span class="tag-list-count">17</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%88%AC%E8%99%AB/" rel="tag">爬虫</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" rel="tag">环境搭建</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/" rel="tag">自动化测试</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%8B%B1%E8%AF%AD%E5%AD%A6%E4%B9%A0/" rel="tag">英语学习</a><span class="tag-list-count">1</span></li></ul>
        </canvas>
    </div>
</div>

</div>
<!-- 标签云 -->
    </div>

  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  <a href="https://beian.miit.gov.cn/" target="_blank">湘ICP备2022002212号-1</a><br />
  <!--
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder"></span>
  -->
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>


        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


<script src='../../../js/src/av-min.js'></script>
<script src='../../../js/src/Valine.min.js'></script>

<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : true,
      notify     : false,
      appId      : 'mhSm1aOQmnVeiAUJxrsKIFg5-gzGzoHsz',
      appKey     : 'kW6GQVoeJac7wDgKvy9vXhn6',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

  
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
