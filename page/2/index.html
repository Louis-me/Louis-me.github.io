<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"louis-me.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":true,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="一个正经的测试工程师">
<meta property="og:type" content="website">
<meta property="og:title" content="施坤的博客">
<meta property="og:url" content="https://louis-me.github.io/page/2/index.html">
<meta property="og:site_name" content="施坤的博客">
<meta property="og:description" content="一个正经的测试工程师">
<meta property="og:locale" content="zh_CN">
<meta property="article:tag" content="自动化测试,安全测试,性能测试,渗透测试,大数据测试,python,jmeter,airtest,appium,monkey">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://louis-me.github.io/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>施坤的博客 </title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">施坤的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-简历">

    <a href="/resume/" rel="section"><i class="fa fa-address-card fa-fw"></i>简历</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
  
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://louis-me.github.io/aposts/a5664de/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="一个正经的测试工程师">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="施坤的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/aposts/a5664de/" class="post-title-link" itemprop="url">java中面向对象</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-11-09 15:18:19" itemprop="dateCreated datePublished" datetime="2023-11-09T15:18:19+08:00">2023-11-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-11-13 17:51:37" itemprop="dateModified" datetime="2023-11-13T17:51:37+08:00">2023-11-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
            </span>

          
            <span id="/aposts/a5664de/" class="post-meta-item leancloud_visitors" data-flag-title="java中面向对象" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/aposts/a5664de/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/aposts/a5664de/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>本次笔记主要记录面向对象中的继承、重载重写、多态、抽象、封装、接口、包等概念</p>
<p>java版本为：java version “1.8.0_381”</p>
<h2 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h2><ul>
<li>继承格式有两种，方式一：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class 父类 &#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">class 子类 extends 父类 &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>方式二</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sleep</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">B</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">C</span> <span class="keyword">implements</span> <span class="title class_">A</span>,B &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>代码实例</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 动物类为父类主要包的动作为吃、睡觉、介绍等方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="comment">// 重载，主要用来初始化name 和id</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Animal</span><span class="params">(String myName, <span class="type">int</span> myId)</span> &#123;</span><br><span class="line">        name = myName;</span><br><span class="line">        id = myId;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(name+<span class="string">&quot;正在吃&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sleep</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(name+<span class="string">&quot;正在睡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">introduction</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;大家好！我是&quot;</span>         + id + <span class="string">&quot;号&quot;</span> + name + <span class="string">&quot;.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 继承父类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Mouse</span> <span class="keyword">extends</span> <span class="title class_">Animal</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Mouse</span><span class="params">(String myName,<span class="type">int</span> myId)</span> &#123;</span><br><span class="line">        <span class="comment">// 调用的就是Animal父类的重载函数Animal(String myName, int myId)</span></span><br><span class="line">        <span class="built_in">super</span>(myName, myId);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;子类：我吃完了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eatTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 调用父类方法</span></span><br><span class="line">        <span class="built_in">super</span>.eat();</span><br><span class="line">        <span class="comment">// this指向子类本身</span></span><br><span class="line">        <span class="built_in">this</span>.eat();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//super用来调用父类方法</span></span><br><span class="line"><span class="comment">// this指向子类本身</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>得到结果</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args[])</span> &#123;</span><br><span class="line">        <span class="type">Mouse</span> <span class="variable">mose</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Mouse</span>(<span class="string">&quot;老鼠&quot;</span>,<span class="number">1</span>);</span><br><span class="line">        mose.eatTest();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">----</span><br><span class="line">老鼠正在吃</span><br><span class="line">子类：我吃完了</span><br></pre></td></tr></table></figure>

<h2 id="重写"><a href="#重写" class="headerlink" title="重写"></a>重写</h2><ul>
<li>重写是子类对父类的允许访问的方法的实现过程进行重新编写, 返回值和形参都不能改变。<strong>即外壳不变，核心重写！</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 动物类为父类主要包的动作为吃、睡觉、介绍等方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="comment">// 重载，主要用来初始化name 和id</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Animal</span><span class="params">(String myName, <span class="type">int</span> myId)</span> &#123;</span><br><span class="line">        name = myName;</span><br><span class="line">        id = myId;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(name+<span class="string">&quot;正在吃&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sleep</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(name+<span class="string">&quot;正在睡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">introduction</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;大家好！我是&quot;</span>         + id + <span class="string">&quot;号&quot;</span> + name + <span class="string">&quot;.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//子类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Mouse</span> <span class="keyword">extends</span> <span class="title class_">Animal</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String Name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> Id;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Mouse</span><span class="params">(String myName,<span class="type">int</span> myId)</span> &#123;</span><br><span class="line">        <span class="comment">// 调用的就是Animal父类的重载函数Animal(String myName, int myId)</span></span><br><span class="line">        <span class="built_in">super</span>(myName, myId);</span><br><span class="line">        <span class="built_in">this</span>.Name = myName;</span><br><span class="line">        <span class="built_in">this</span>.Id = myId;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="built_in">this</span>.Name+ <span class="string">&quot;：我吃完了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 自定义方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dark</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;老鼠可以在叫&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args[])</span> &#123;</span><br><span class="line">        <span class="type">Animal</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Animal</span>(<span class="string">&quot;我是动物父类&quot;</span>,<span class="number">1001</span>);</span><br><span class="line">        <span class="type">Animal</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Mouse</span>(<span class="string">&quot;老鼠&quot;</span>,<span class="number">1</span>);</span><br><span class="line">        a.eat();      <span class="comment">// 调用父类的eat方法，结果为：我是动物父类正在吃</span></span><br><span class="line">        b.eat();     <span class="comment">// 尽管b属于Animal类型，但是它运行的是 Mouse子类的eat，这里重写了父类的eat方法，结果为：老鼠：我吃完</span></span><br><span class="line">        b.sleep();  <span class="comment">//同时b调用分类本身的sleep</span></span><br><span class="line">        <span class="comment">// 总结：当分类指向子类时</span></span><br><span class="line">        <span class="comment">// 1.若子类和父类使用相同方法eat，那么子类中的方法eat重写了父类中的方法eat</span></span><br><span class="line">        <span class="comment">// 2.父类可直接调用父类中方法</span></span><br><span class="line">        <span class="comment">// 3.子类中的方法在父类中不存在，那么指定调用子类中的方法报错</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 这里标红报错了</span></span><br><span class="line">        b.dark();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>当需要在子类中调用父类的被重写方法时，要使用 super 关键字。继承中已经介绍</p>
</blockquote>
<h2 id="重载"><a href="#重载" class="headerlink" title="重载"></a>重载</h2><ul>
<li>重载(overloading) 是在一个类里面，<strong>方法名字相同，而参数不同</strong>。返回类型可以相同也可以不同</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Overloading</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;test1&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(<span class="type">int</span> a)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;test2&quot;</span>);</span><br><span class="line">    &#125;   </span><br><span class="line"> </span><br><span class="line">    <span class="comment">//以下两个参数类型顺序不同</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">test</span><span class="params">(<span class="type">int</span> a,String s)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;test3&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;returntest3&quot;</span>;</span><br><span class="line">    &#125;   </span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">test</span><span class="params">(String s,<span class="type">int</span> a)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;test4&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;returntest4&quot;</span>;</span><br><span class="line">    &#125;   </span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        <span class="type">Overloading</span> <span class="variable">o</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Overloading</span>();</span><br><span class="line">        System.out.println(o.test());</span><br><span class="line">        o.test(<span class="number">1</span>);</span><br><span class="line">        System.out.println(o.test(<span class="number">1</span>,<span class="string">&quot;test3&quot;</span>));</span><br><span class="line">        System.out.println(o.test(<span class="string">&quot;test4&quot;</span>,<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>实例中重载方法为test</p>
</blockquote>
<h2 id="多态"><a href="#多态" class="headerlink" title="多态"></a>多态</h2><ul>
<li>多态存在的三个条件：继承、重写、父类引用指向子类对象，在重写实例中刚好包含了这三要素。</li>
</ul>
<h2 id="抽象"><a href="#抽象" class="headerlink" title="抽象"></a>抽象</h2><h3 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h3><ul>
<li><p>如果一个类中没有包含足够的信息来描绘一个具体的对象，这样的类就是抽象类。</p>
</li>
<li><p>抽象类除了<strong>不能实例化对象</strong>之外，类的其它功能依然存在，抽象类必须被继承，才能被使</p>
</li>
<li><p>一个类只能继承一个抽象类，而一个类却可以实现多个接口（留作后续）</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 动物类为父类主要包的动作为吃、睡觉、介绍等方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="comment">// 重载，主要用来初始化name 和id</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Animal</span><span class="params">(String myName, <span class="type">int</span> myId)</span> &#123;</span><br><span class="line">        name = myName;</span><br><span class="line">        id = myId;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(name+<span class="string">&quot;正在吃&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sleep</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(name+<span class="string">&quot;正在睡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">introduction</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;大家好！我是&quot;</span>         + id + <span class="string">&quot;号&quot;</span> + name + <span class="string">&quot;.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Mouse</span> <span class="keyword">extends</span> <span class="title class_">Animal</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String Name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> Id;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Mouse</span><span class="params">(String myName,<span class="type">int</span> myId)</span> &#123;</span><br><span class="line">        <span class="comment">// 调用的就是Animal父类的重载函数Animal(String myName, int myId)</span></span><br><span class="line">        <span class="built_in">super</span>(myName, myId);</span><br><span class="line">        <span class="built_in">this</span>.Name = myName;</span><br><span class="line">        <span class="built_in">this</span>.Id = myId;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="built_in">this</span>.Name+ <span class="string">&quot;：我吃完了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 自定义方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dark</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;老鼠可以在叫&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args[])</span> &#123;</span><br><span class="line">        <span class="comment">// 这样不行报错了，不可用直接实例化</span></span><br><span class="line"><span class="comment">//        Animal a = new Animal(&quot;我是动物父类&quot;,1001);</span></span><br><span class="line">        <span class="type">Mouse</span> <span class="variable">mouse</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Mouse</span>(<span class="string">&quot;老鼠&quot;</span>, <span class="number">1001</span>);</span><br><span class="line">        <span class="type">Animal</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Mouse</span>(<span class="string">&quot;老鼠2号&quot;</span>, <span class="number">1002</span>);</span><br><span class="line">        a.eat(); <span class="comment">//老鼠2号：我吃完了</span></span><br><span class="line">        mouse.eat(); <span class="comment">// 老鼠：我吃完了</span></span><br><span class="line">        mouse.sleep();</span><br><span class="line">        <span class="comment">// 子类中的方法在父类中不存在，调用子类中的方法报错</span></span><br><span class="line">        <span class="comment">//a.dark();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>和重写的那个实例非常接近，唯一区别就是不用实例化父类</li>
<li>根据本实例发现既然无法实例化父类，<strong>那么父类中的里具体逻辑存在没有必要</strong>，只要存在一个方法名就可以了</li>
</ul>
<h3 id="抽象方法"><a href="#抽象方法" class="headerlink" title="抽象方法"></a>抽象方法</h3><ul>
<li>如果你想设计这样一个类，该类包含一个特别的成员方法，该方法的具体实现由它的子类确定，那么你可以在父类中声明该方法为抽象方法。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 分类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="comment">// 重载，主要用来初始化name 和id</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">sleep</span><span class="params">(String myName)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title function_">test</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Mouse</span> <span class="keyword">extends</span> <span class="title class_">Animal</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String Name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> Id;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Mouse</span><span class="params">(String myName,<span class="type">int</span> myId)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.Name = myName;</span><br><span class="line">        <span class="built_in">this</span>.Id = myId;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="built_in">this</span>.Name+ <span class="string">&quot;：我吃完了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sleep</span><span class="params">(String myName)</span> &#123;</span><br><span class="line">        System.out.println(myName+ <span class="string">&quot;在睡觉&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dark</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;老鼠可以在叫&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;我是一只老鼠&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args[])</span> &#123;</span><br><span class="line">        <span class="type">Mouse</span> <span class="variable">mouse</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Mouse</span>(<span class="string">&quot;老鼠&quot;</span>, <span class="number">1001</span>);</span><br><span class="line">        <span class="type">Animal</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Mouse</span>(<span class="string">&quot;老鼠2号&quot;</span>, <span class="number">1002</span>);</span><br><span class="line">        a.eat(); <span class="comment">//老鼠2号：我吃完了</span></span><br><span class="line">        mouse.eat(); <span class="comment">// 老鼠：我吃完了</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">ts</span> <span class="operator">=</span> a.test();</span><br><span class="line">        System.out.println(ts); <span class="comment">// 我是一只老鼠</span></span><br><span class="line">        a.sleep(<span class="string">&quot;我是老鼠啊&quot;</span>);<span class="comment">// 我是老鼠啊在睡觉</span></span><br><span class="line">        mouse.dark();</span><br><span class="line">        <span class="comment">// a.dark(); 子类中的方法在父类中不存在，调用子类中的方法报错</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>抽象类中不一定包含抽象方法，但是有抽象方法的类必定是抽象类。</li>
<li>抽象类中的抽象方法只是声明，不包含方法体，就是不给出方法的具体实现也就是方法的具体功能</li>
<li>抽象类的子类必须给出抽象类中的抽象方法的具体实现，除非该子类也是抽象类</li>
</ul>
<h2 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h2><ul>
<li><p>接口和抽象类很像，他们是有区别的</p>
</li>
<li><p>接口和抽象类区别</p>
<ul>
<li><p>抽象类中的方法可以有方法体，就是能实现方法的具体功能，但是接口中的方法不行</p>
</li>
<li><p>抽象类中的成员变量可以是各种类型的，而接口中的成员变量只能是 <strong>public static final</strong> 类型的</p>
</li>
<li><p>一个类只能继承一个抽象类，而一个类却可以实现多个接口</p>
</li>
<li><p>接口是隐式抽象的，当声明一个接口和方法的时候，不必使用<strong>abstract</strong>关键字</p>
</li>
</ul>
</li>
<li><p>实战代码</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">sleep</span><span class="params">(String myName)</span>;</span><br><span class="line">    <span class="keyword">public</span>  String <span class="title function_">test</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Mouse</span> <span class="keyword">implements</span> <span class="title class_">Animal</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String Name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> Id;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Mouse</span><span class="params">(String myName,<span class="type">int</span> myId)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.Name = myName;</span><br><span class="line">        <span class="built_in">this</span>.Id = myId;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="built_in">this</span>.Name+ <span class="string">&quot;：我吃完了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sleep</span><span class="params">(String myName)</span> &#123;</span><br><span class="line">        System.out.println(myName+ <span class="string">&quot;在睡觉&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dark</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;老鼠可以在叫&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="comment">//如果不实现接口中的test方法，那么就报错了</span></span><br><span class="line">     <span class="keyword">public</span> String <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">     	<span class="keyword">return</span> <span class="string">&quot;我是一只老鼠&quot;</span>;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args[])</span> &#123;</span><br><span class="line">        <span class="type">Mouse</span> <span class="variable">mouse</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Mouse</span>(<span class="string">&quot;老鼠&quot;</span>, <span class="number">1001</span>);</span><br><span class="line">        mouse.eat(); <span class="comment">// 老鼠：我吃完了</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">ts</span> <span class="operator">=</span> mouse.test();</span><br><span class="line">        System.out.println(ts); <span class="comment">// 我是一只老鼠</span></span><br><span class="line">        mouse.sleep(<span class="string">&quot;我是老鼠啊&quot;</span>);<span class="comment">// 我是老鼠啊在睡觉</span></span><br><span class="line">        mouse.dark(); <span class="comment">// 老鼠可以在叫</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>当类实现接口的时候，类要实现（重写）接口中所有的方法，不然报错。否则，类必须声明为抽象的类</p>
</blockquote>
<h3 id="接口继承"><a href="#接口继承" class="headerlink" title="接口继承"></a>接口继承</h3><ul>
<li>感觉这里太复杂，不做详细介绍，做个简单笔记。</li>
<li>一个接口能继承另一个接口，和类之间的继承方式比较相似。接口的继承使用extends关键字，子接口继承父接口的方法。</li>
</ul>
<p>下面的Sports接口被Hockey和Football接口继承：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// 文件名: Sports.java</span><br><span class="line">public interface Sports</span><br><span class="line">&#123;</span><br><span class="line">   public void setHomeTeam(String name);</span><br><span class="line">   public void setVisitingTeam(String name);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">// 文件名: Football.java</span><br><span class="line">public interface Football extends Sports</span><br><span class="line">&#123;</span><br><span class="line">   public void homeTeamScored(int points);</span><br><span class="line">   public void visitingTeamScored(int points);</span><br><span class="line">   public void endOfQuarter(int quarter);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">// 文件名: Hockey.java</span><br><span class="line">public interface Hockey extends Sports</span><br><span class="line">&#123;</span><br><span class="line">   public void homeGoalScored();</span><br><span class="line">   public void visitingGoalScored();</span><br><span class="line">   public void endOfPeriod(int period);</span><br><span class="line">   public void overtimePeriod(int ot);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在Java中，类的多继承是不合法，但接口允许多继承。</p>
<p>在接口的多继承中extends关键字只需要使用一次，在其后跟着继承接口。 如下所示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public interface Hockey extends Sports, Event</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://louis-me.github.io/aposts/b435d821/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="一个正经的测试工程师">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="施坤的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/aposts/b435d821/" class="post-title-link" itemprop="url">vue3实践笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-08-04 11:08:32" itemprop="dateCreated datePublished" datetime="2023-08-04T11:08:32+08:00">2023-08-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-08-30 09:20:22" itemprop="dateModified" datetime="2023-08-30T09:20:22+08:00">2023-08-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/vue3/" itemprop="url" rel="index"><span itemprop="name">vue3</span></a>
                </span>
            </span>

          
            <span id="/aposts/b435d821/" class="post-meta-item leancloud_visitors" data-flag-title="vue3实践笔记" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/aposts/b435d821/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/aposts/b435d821/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><ul>
<li><a target="_blank" rel="noopener" href="https://nodejs.org/en">node.js</a> 安装16.0以上的版本</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator&gt;node -v</span><br><span class="line">v18.17.0</span><br></pre></td></tr></table></figure>

<ul>
<li>你的当前工作目录正是打算创建项目的目录。在命令行中运行以下命令</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E:\proj\StudyVue&gt;npm init vue@latest</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这一指令将会安装并执行 <a target="_blank" rel="noopener" href="https://github.com/vuejs/create-vue">create-vue</a>，它是 Vue 官方的项目脚手架工具</p>
<p>如果不确定是否要开启某个功能，你可以直接按下回车键选择 <code>No</code>。在项目被创建后，通过以下步骤安装依赖并启动开发服务器1：</p>
</blockquote>
<ul>
<li>在项目被创建后，通过以下步骤安装依赖并启动开发服务器：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; cd vue-project</span><br><span class="line">&gt; npm install</span><br><span class="line">&gt; npm run dev</span><br></pre></td></tr></table></figure>

<p><img src="/aposts/b435d821/image-20230804152932990.png" alt="image-20230804152932990"></p>
<h2 id="vue配置"><a href="#vue配置" class="headerlink" title="vue配置"></a>vue配置</h2><ul>
<li>安装依赖文件</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// elementUI 3.0 版本</span><br><span class="line">npm install element-plus --save</span><br><span class="line">// http请求</span><br><span class="line">npm install axios  --save</span><br><span class="line">// 路由</span><br><span class="line">npm install vue-router@4 --save</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<ul>
<li><code>src\router\routers.js </code>  手动新建自定义路由</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">const routes = [</span><br><span class="line">    &#123;</span><br><span class="line">        name: &quot;login&quot;,</span><br><span class="line">        path: &quot;/login&quot;,</span><br><span class="line">        component: () =&gt; import(&quot;../components/Login.vue&quot;)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        name: &quot;home&quot;,</span><br><span class="line">        path: &quot;/home&quot;,</span><br><span class="line">        component: () =&gt; import(&quot;../components/Home.vue&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">export default routes;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>src\router\index.js</code>  对外暴露路由</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createRouter, createWebHistory &#125; from &quot;vue-router&quot;</span><br><span class="line">import routes from &quot;./routes&quot;</span><br><span class="line">var router=createRouter(&#123;</span><br><span class="line">    history:createWebHistory(),</span><br><span class="line">    routes</span><br><span class="line">&#125;)</span><br><span class="line">export default router</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><code>src/index.js</code>  为全局配置文件</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import &#x27;./assets/main.css&#x27;</span><br><span class="line">import &#123; createApp &#125; from &#x27;vue&#x27;</span><br><span class="line">import App from &#x27;./App.vue&#x27;</span><br><span class="line">// 导入我的路由</span><br><span class="line">import router from &quot;./router/index&quot;</span><br><span class="line">// 导入ElementPlus</span><br><span class="line">import ElementPlus from &#x27;element-plus&#x27;</span><br><span class="line">// 引用element的css</span><br><span class="line">import &#x27;element-plus/dist/index.css&#x27;</span><br><span class="line">const app = createApp(App)</span><br><span class="line">app.use(ElementPlus)</span><br><span class="line">app.use(router)</span><br><span class="line">app.mount(&#x27;#app&#x27;)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>App.vue</code> 代码修改如下</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">&lt;template&gt;</span><br><span class="line"> &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"> </span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>按需导入elementUI，在2.0版本中可以需要手动管理elementUI中各个组件，3.0中现在可以自动导入，安装如下插件：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install -D unplugin-vue-components unplugin-auto-import</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后把下列代码插入到你的 <code>Vite</code> 或 <code>Webpack</code> 的配置文件中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">//vite.config.js</span><br><span class="line"></span><br><span class="line">import &#123; fileURLToPath, URL &#125; from &#x27;node:url&#x27;</span><br><span class="line"></span><br><span class="line">import &#123; defineConfig &#125; from &#x27;vite&#x27;</span><br><span class="line">import vue from &#x27;@vitejs/plugin-vue&#x27;</span><br><span class="line">// 新增</span><br><span class="line">import AutoImport from &#x27;unplugin-auto-import/vite&#x27;</span><br><span class="line">import Components from &#x27;unplugin-vue-components/vite&#x27;</span><br><span class="line">import &#123; ElementPlusResolver &#125; from &#x27;unplugin-vue-components/resolvers&#x27;</span><br><span class="line"></span><br><span class="line">// https://vitejs.dev/config/</span><br><span class="line">export default defineConfig(&#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    vue(),</span><br><span class="line">    // 新增下面两个</span><br><span class="line">    AutoImport(&#123;</span><br><span class="line">      resolvers: [ElementPlusResolver()],</span><br><span class="line">    &#125;),</span><br><span class="line">    Components(&#123;</span><br><span class="line">      resolvers: [ElementPlusResolver()],</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    alias: &#123;</span><br><span class="line">      &#x27;@&#x27;: fileURLToPath(new URL(&#x27;./src&#x27;, import.meta.url))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><code>src\utils\ajax.js</code> 拦截<code>axios</code>  设置请求url</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">import axios from &#x27;axios&#x27;</span><br><span class="line"></span><br><span class="line">const ajax = axios.create(&#123;</span><br><span class="line">    baseURL: &#x27;http://127.0.0.1:8100/testModel&#x27;,</span><br><span class="line">    timeout: 10000,</span><br><span class="line">    withCredentials: true</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">ajax.interceptors.response.use(</span><br><span class="line">    response =&gt; &#123;</span><br><span class="line">      //拦截响应，如果发现接口返回400做统一处理跳转到登陆</span><br><span class="line">      if (response.data.code) &#123;</span><br><span class="line">        switch (response.data.code) &#123;</span><br><span class="line">          case 400:</span><br><span class="line">            window.location.href=&#x27;/login/&#x27;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">      const headers = response.headers</span><br><span class="line"></span><br><span class="line">      return response</span><br><span class="line">    &#125;,</span><br><span class="line">    //接口错误状态处理，也就是说无响应时的处理</span><br><span class="line">    error =&gt; &#123;</span><br><span class="line">        console.log(&quot;Please check your internet connection.&quot;);</span><br><span class="line">        console.log(error)</span><br><span class="line">        return Promise.reject(error) // 返回接口返回的错误信息</span><br><span class="line">    &#125;)</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">//导出我们建立的axios实例模块，ES6 export用法</span><br><span class="line">export default ajax;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">//导出我们建立的axios实例模块，ES6 export用法</span><br><span class="line">export default ajax;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>src\utils\html.js</code> 所有请求都编写到这里</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import ajax from &quot;./ajax&quot;;</span><br><span class="line">// export const GetPosts = () =&gt; ajax.get(&#x27;posts/1&#x27;)</span><br><span class="line">// export const GetsearchData = (params) =&gt; ajax.get(&#x27;/list&#x27;,&#123;params&#125;)</span><br><span class="line">// export const PostPosts = (params) =&gt; ajax.post(&#x27;posts&#x27;,params)</span><br><span class="line"></span><br><span class="line">export const LoginPost = (params) =&gt; ajax.post(&#x27;/login/&#x27;,params)</span><br><span class="line">export const CsrfGet = () =&gt; ajax.get(&#x27;/get_csrf_token/&#x27;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>修改<code>package.json</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;dev&quot;: &quot;vite --host 0.0.0.0&quot;, // 修改为这样，不然无法用ip访问</span><br><span class="line">  &quot;build&quot;: &quot;vite build&quot;,</span><br><span class="line">  &quot;preview&quot;: &quot;vite preview&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>



<h2 id="登录界面"><a href="#登录界面" class="headerlink" title="登录界面"></a>登录界面</h2><ul>
<li>编写登录界面<code>src\componets\Login</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;login-wrap&quot;&gt;</span><br><span class="line">    &lt;!--</span><br><span class="line">        :rules=&quot;rules&quot;为表单自定义规则</span><br><span class="line">        :model=&quot;loginForm&quot; 绑定js中的return 参数</span><br><span class="line">      --&gt;</span><br><span class="line">    &lt;el-form ref=&quot;loginFormRef&quot; :rules=&quot;rules&quot; :model=&quot;loginForm&quot; class=&quot;login_form&quot;&gt;</span><br><span class="line">      &lt;h1 class=&quot;title&quot;&gt;用户登录&lt;/h1&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;用户名&quot; prop=&quot;username&quot;&gt;</span><br><span class="line">        &lt;el-input type=&quot;text&quot; placeholder=&quot;用户账号&quot; v-model=&quot;loginForm.username&quot; auto-complete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;密码&quot; prop=&quot;password&quot; style=&quot;margin-left:10px;&quot;&gt;</span><br><span class="line">        &lt;el-input type=&quot;password&quot; placeholder=&quot;密码&quot; v-model=&quot;loginForm.password&quot; auto-complete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;submitForm(loginFormRef)&quot; style=&quot;width: 100%;&quot;&gt;登录&lt;/el-button&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;resetForm(loginFormRef)&quot; style=&quot;width: 100%;&quot;&gt;重置&lt;/el-button&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">   </span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import &#123; reactive, ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import type &#123; FormInstance, FormRules &#125; from &#x27;element-plus&#x27;</span><br><span class="line">import &#123; ElMessage &#125; from &#x27;element-plus&#x27;</span><br><span class="line"></span><br><span class="line">// 引用登录请求</span><br><span class="line">import &#123; LoginPost &#125; from &quot;../utils/html.js&quot;</span><br><span class="line"></span><br><span class="line">//引入路由函数</span><br><span class="line">import &#123; useRouter &#125; from &quot;vue-router&quot;;</span><br><span class="line">const router = useRouter()</span><br><span class="line"></span><br><span class="line">interface LoginForm &#123;</span><br><span class="line">  username: string</span><br><span class="line">  password: string</span><br><span class="line">&#125;</span><br><span class="line">const loginFormRef = ref&lt;FormInstance&gt;()</span><br><span class="line">// 定义表单绑定的model</span><br><span class="line">const loginForm = reactive(&#123;</span><br><span class="line">  username: &quot;test&quot;,</span><br><span class="line">  password: &quot;&quot;,</span><br><span class="line">&#125;)</span><br><span class="line">// 定义规则</span><br><span class="line">const rules = reactive&lt;FormRules&lt;LoginForm&gt;&gt;(&#123;</span><br><span class="line">  username: [</span><br><span class="line">    &#123; required: true, message: &#x27;请输入用户名&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    // &#123; min: 3, max: 5, message: &#x27;Length should be 3 to 5&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  password: [</span><br><span class="line">    &#123;</span><br><span class="line">      required: true,</span><br><span class="line">      message: &#x27;请输入密码&#x27;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const submitForm = (formEl: FormInstance | undefined) =&gt; &#123;</span><br><span class="line">  if (!formEl) return</span><br><span class="line">  formEl.validate(async (valid, fields) =&gt; &#123;</span><br><span class="line">    if (valid) &#123;</span><br><span class="line">      console.log(&#x27;submit!&#x27;)</span><br><span class="line">      LoginPost(JSON.stringify(loginForm)).then(res =&gt; &#123;</span><br><span class="line">        console.log(res)</span><br><span class="line">        if (res[&quot;data&quot;][&quot;code&quot;] == 1) &#123;</span><br><span class="line">          // console.log(&quot;登录成功&quot;)</span><br><span class="line">          ElMessage(&#123;</span><br><span class="line">            message: &#x27;登录成功.&#x27;,</span><br><span class="line">            type: &#x27;success&#x27;,</span><br><span class="line">          &#125;)</span><br><span class="line">          localStorage.setItem(&#x27;username&#x27;, loginForm.username);</span><br><span class="line">          router.push(&quot;/home&quot;)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          ElMessage(&#123;</span><br><span class="line">            message: res.data.msg,</span><br><span class="line">            type: &#x27;error&#x27;,</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      console.log(&#x27;error submit!&#x27;, fields)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">const resetForm = (formEl: FormInstance | undefined) =&gt; &#123;</span><br><span class="line">  if (!formEl) return</span><br><span class="line">  formEl.resetFields()</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">   </span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.login-wrap &#123;</span><br><span class="line">  box-sizing: border-box;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 100%;</span><br><span class="line">  padding-top: 10%;</span><br><span class="line">  background-image: url(zdmc+);</span><br><span class="line">  /* background-color: #112346; */</span><br><span class="line">  background-repeat: no-repeat;</span><br><span class="line">  background-position: center right;</span><br><span class="line">  background-size: 100%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.login-container &#123;</span><br><span class="line">  border-radius: 10px;</span><br><span class="line">  margin: 0px auto;</span><br><span class="line">  width: 350px;</span><br><span class="line">  padding: 30px 35px 15px 35px;</span><br><span class="line">  background: #fff;</span><br><span class="line">  border: 1px solid #eaeaea;</span><br><span class="line">  text-align: left;</span><br><span class="line">  box-shadow: 0 0 20px 2px rgba(0, 0, 0, 0.1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.title &#123;</span><br><span class="line">  margin: 0px auto 40px auto;</span><br><span class="line">  text-align: center;</span><br><span class="line">  color: #505458;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="django后台"><a href="#django后台" class="headerlink" title="django后台"></a>django后台</h2><ul>
<li>代码来自<a href="aposts/8d0d1e49/">这里</a></li>
</ul>
<h3 id="跨域配置"><a href="#跨域配置" class="headerlink" title="跨域配置"></a>跨域配置</h3><ul>
<li><code>StudyDjango/StudyDjango/settings.py</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">   	....</span><br><span class="line">    &#x27;TestModel&#x27;,  # 添加此项</span><br><span class="line">    &#x27;corsheaders&#x27;,  # 跨域</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">MIDDLEWARE = [</span><br><span class="line">    &#x27;django.middleware.security.SecurityMiddleware&#x27;,</span><br><span class="line">    &#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;,</span><br><span class="line">    # &#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;,</span><br><span class="line">    # 加入这个</span><br><span class="line">    &#x27;corsheaders.middleware.CorsMiddleware&#x27;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#跨域增加忽略</span><br><span class="line">CORS_ALLOW_CREDENTIALS = True</span><br><span class="line">CORS_ORIGIN_ALLOW_ALL = True</span><br><span class="line">CORS_ORIGIN_WHITELIST = (</span><br><span class="line"> &#x27;http://localhost:5173&#x27;,</span><br><span class="line"> &#x27;http://127.0.0.1:5173&#x27;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">CORS_ALLOW_METHODS = (</span><br><span class="line"> &#x27;DELETE&#x27;,</span><br><span class="line"> &#x27;GET&#x27;,</span><br><span class="line"> &#x27;OPTIONS&#x27;,</span><br><span class="line"> &#x27;PATCH&#x27;,</span><br><span class="line"> &#x27;POST&#x27;,</span><br><span class="line"> &#x27;PUT&#x27;,</span><br><span class="line"> &#x27;VIEW&#x27;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">CORS_ALLOW_HEADERS = (</span><br><span class="line"> &#x27;XMLHttpRequest&#x27;,</span><br><span class="line"> &#x27;X_FILENAME&#x27;,</span><br><span class="line"> &#x27;accept-encoding&#x27;,</span><br><span class="line"> &#x27;authorization&#x27;,</span><br><span class="line"> &#x27;content-type&#x27;,</span><br><span class="line"> &#x27;dnt&#x27;,</span><br><span class="line"> &#x27;origin&#x27;,</span><br><span class="line"> &#x27;user-agent&#x27;,</span><br><span class="line"> &#x27;x-csrftoken&#x27;,</span><br><span class="line"> &#x27;x-requested-with&#x27;,</span><br><span class="line"> &#x27;Pragma&#x27;,</span><br><span class="line">&#x27;json&#x27;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li>登录代码</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">def user_login(request):</span><br><span class="line">    if request.method != &quot;POST&quot;:</span><br><span class="line">        return JsonResponse(&#123;&#x27;code&#x27;: -1, &#x27;msg&#x27;: &#x27;method must is POST&#x27;&#125;)</span><br><span class="line"></span><br><span class="line">    data = json.loads(request.body)</span><br><span class="line">    user_name = data.get(&#x27;username&#x27;)</span><br><span class="line">    pwd = data.get(&quot;password&quot;)</span><br><span class="line">    print(data)</span><br><span class="line">    try:</span><br><span class="line">        user_entry = Users.objects.get(name=user_name, pwd=pwd)</span><br><span class="line">        if user_entry:</span><br><span class="line">            # 设置登录的session</span><br><span class="line">            request.session[&quot;user&quot;] = user_name</span><br><span class="line">            return JsonResponse(&#123;&#x27;code&#x27;: 1, &#x27;msg&#x27;: &#x27;login is success&#x27;&#125;)</span><br><span class="line">        else:</span><br><span class="line">            return JsonResponse(&#123;&#x27;code&#x27;: -1, &#x27;msg&#x27;: &#x27;login is fail221&#x27;&#125;)</span><br><span class="line">    except ObjectDoesNotExist:</span><br><span class="line">        return JsonResponse(&#123;&#x27;code&#x27;: -1, &#x27;msg&#x27;: &#x27;login is fail111&#x27;&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li>运行代码</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br><span class="line"></span><br><span class="line">&gt; vue-project@0.0.0 dev</span><br><span class="line">&gt; vite</span><br></pre></td></tr></table></figure>

<p><img src="/aposts/b435d821/image-20230808190806334.png" alt="image-20230808190806334"></p>
<ul>
<li>输入用户名和密码登录成功后，跳转到了home页面</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li><p>本次用的setup，和vue2.0 区别比较大，比如调用方法不在放到method中</p>
</li>
<li><p>解决了vue和django 交互的跨域问题</p>
</li>
<li><p>自定义路由</p>
</li>
<li><p>封装<code>axios</code></p>
</li>
<li><p>客户端一定要用127.0.0.1 访问，需要和django中设置的白名单ip保持一致</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://louis-me.github.io/aposts/8d0d1e49/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="一个正经的测试工程师">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="施坤的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/aposts/8d0d1e49/" class="post-title-link" itemprop="url">python django实践二</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-08-02 16:35:27" itemprop="dateCreated datePublished" datetime="2023-08-02T16:35:27+08:00">2023-08-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-08-03 18:09:09" itemprop="dateModified" datetime="2023-08-03T18:09:09+08:00">2023-08-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
                </span>
            </span>

          
            <span id="/aposts/8d0d1e49/" class="post-meta-item leancloud_visitors" data-flag-title="python django实践二" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/aposts/8d0d1e49/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/aposts/8d0d1e49/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>紧接<a href="/aposts/dbc9f282">python django实践</a></p>
<h2 id="聚合和分组查询"><a href="#聚合和分组查询" class="headerlink" title="聚合和分组查询"></a>聚合和分组查询</h2><h3 id="聚合查询（aggregate）"><a href="#聚合查询（aggregate）" class="headerlink" title="聚合查询（aggregate）"></a>聚合查询（aggregate）</h3><ul>
<li><p>聚合查询函数是对一组值执行计算，<strong>并返回单个值</strong>。</p>
</li>
<li><p><code>Django</code> 使用聚合查询前要先从 <code>django.db.models</code> 引入<code> Avg、Max、Min、Count、Sum</code>（首字母大写）。</p>
</li>
<li><p>计算所有图书的平均价格:</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from django.db.models import Avg,Max,Min,Count,Sum  #   引入函数</span><br><span class="line">...</span><br><span class="line">res = models.Book.objects.aggregate(Avg(&quot;price&quot;))</span><br><span class="line">print(res, type(res))</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<ul>
<li>计算所有图书的数量、最贵价格和最便宜价格:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res=models.Book.objects.aggregate(c=Count(&quot;id&quot;),max=Max(&quot;price&quot;),min=Min(&quot;price&quot;))</span><br><span class="line">print(res,type(res)</span><br></pre></td></tr></table></figure>

<h3 id="分组查询（annotate）"><a href="#分组查询（annotate）" class="headerlink" title="分组查询（annotate）"></a>分组查询（annotate）</h3><ul>
<li>分组查询一般会用到聚合函数，所以使用前要先从<code> django.db.models</code> 引入 Avg,Max,Min,Count,Sum（首字母大写）</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from django.db.models import Avg,Max,Min,Count,Sum  #   引入函数</span><br></pre></td></tr></table></figure>

<p><strong>返回值：</strong></p>
<ul>
<li>分组后，用 values 取值，则返回值是 QuerySet 数据类型里面为一个个字典；</li>
<li>分组后，用 values_list 取值，则返回值是 QuerySet 数据类型里面为一个个元组。</li>
</ul>
<p>MySQL 中的 limit 相当于 ORM 中的 QuerySet 数据类型的切片。</p>
<blockquote>
<p>annotate 里面放聚合函数。</p>
<ul>
<li><strong>values 或者 values_list 放在 annotate 前面：</strong>values 或者 values_list 是声明以什么字段分组，annotate 执行分组。</li>
<li><strong>values 或者 values_list 放在annotate后面：</strong> annotate 表示直接以当前表的pk执行分组，values 或者 values_list 表示查询哪些字段， 并且要将 annotate 里的聚合函数起别名，在 values 或者 values_list 里写其别名。</li>
</ul>
</blockquote>
<h4 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h4><ul>
<li>统计每一个出版社的最便宜的书的价格：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">res = models.Publish.objects.values(&quot;name&quot;).annotate(in_price = Min(&quot;book__price&quot;))</span><br><span class="line">print(res)</span><br><span class="line"></span><br><span class="line">&lt;QuerySet [&#123;&#x27;name&#x27;: &#x27;菜鸟出版社&#x27;, &#x27;in_price&#x27;: Decimal(&#x27;100.00&#x27;)&#125;, &#123;&#x27;name&#x27;: &#x27;明教出版社&#x27;, &#x27;in_price&#x27;: Decimal(&#x27;300.00&#x27;)&#125;]&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>统计每一本书的作者个数：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">res = models.Book.objects.annotate(c = Count(&quot;authors__name&quot;)).values(&quot;title&quot;,&quot;c&quot;)</span><br><span class="line">print(res)</span><br><span class="line"></span><br><span class="line">&lt;QuerySet [&#123;&#x27;title&#x27;: &#x27;菜鸟教程&#x27;, &#x27;c&#x27;: 1&#125;, &#123;&#x27;title&#x27;: &#x27;吸星大法&#x27;, &#x27;c&#x27;: 1&#125;, &#123;&#x27;title&#x27;: &#x27;冲灵剑法&#x27;, &#x27;c&#x27;: 1&#125;]&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>统计每一本以”菜”开头的书籍的作者个数：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res = models.Book.objects.filter(title__startswith=&quot;菜&quot;).annotate(c = Count(&quot;authors__name&quot;)).values(&quot;title&quot;,&quot;c&quot;)</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>

<ul>
<li>统计不止一个作者的图书名称：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">res = models.Book.objects.annotate(c = Count(&quot;authors__name&quot;)).filter(c__gt=0).values(&quot;title&quot;,&quot;c&quot;)</span><br><span class="line">print(res)</span><br><span class="line"></span><br><span class="line">&lt;QuerySet [&#123;&#x27;title&#x27;: &#x27;菜鸟教程&#x27;, &#x27;c&#x27;: 1&#125;, &#123;&#x27;title&#x27;: &#x27;吸星大法&#x27;, &#x27;c&#x27;: 1&#125;, &#123;&#x27;title&#x27;: &#x27;冲灵剑法&#x27;, &#x27;c&#x27;: 1&#125;]&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>根据一本图书作者数量的多少对查询集 QuerySet 进行降序排序:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res = models.Book.objects.annotate(c = Count(&quot;authors__name&quot;)).order_by(&quot;-c&quot;).values(&quot;title&quot;,&quot;c&quot;)</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>

<ul>
<li>查询各个作者出的书的总价格:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res = models.Author.objects.annotate(all = Sum(&quot;book__price&quot;)).values(&quot;name&quot;,&quot;all&quot;)</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>

<h3 id="F-查询"><a href="#F-查询" class="headerlink" title="F() 查询"></a>F() 查询</h3><ul>
<li><p>F() 的实例可以在查询中引用字段，来比较同一个 model 实例中两个不同字段的值</p>
</li>
<li><p>F 动态获取对象字段的值，可以进行运算。</p>
</li>
<li><p>Django 支持 F() 对象之间以及 F() 对象和常数之间的加减乘除和取余的操作。</p>
</li>
<li><p>修改操作（update）也可以使用 F() 函数。</p>
</li>
</ul>
<h4 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h4><ul>
<li>查询工资大于年龄的人：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">from django.db.models import F</span><br><span class="line">...</span><br><span class="line">book=models.Emp.objects.filter(salary__gt=F(&quot;age&quot;)).values(&quot;name&quot;,&quot;age&quot;)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<ul>
<li>将每一本书的价格提高100元:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res = models.Book.objects.update(price=F(&quot;price&quot;)+100)</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>

<h3 id="Q-查询"><a href="#Q-查询" class="headerlink" title="Q() 查询"></a>Q() 查询</h3><ul>
<li><p>之前构造的过滤器里的多个条件的关系都是 and，如果需要执行更复杂的查询（例如 or 语句），就可以使用 Q 。</p>
</li>
<li><p>Q 对象可以使用 &amp; | ~ （与 或 非）操作符进行组合。优先级从高到低：~ &amp; |。</p>
</li>
</ul>
<h4 id="实例-2"><a href="#实例-2" class="headerlink" title="实例"></a>实例</h4><ul>
<li>查询价格大于 350 或者名称以菜开头的书籍的名称和价格。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">from django.db.models import Q</span><br><span class="line"></span><br><span class="line">res=models.Book.objects.filter(Q(price__gt=350)|Q(title__startswith=&quot;菜&quot;)).values(&quot;title&quot;,&quot;price&quot;)</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>

<ul>
<li>查询以”菜”结尾或者不是 2010 年 10 月份的书籍:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res = models.Book.objects.filter(Q(title__endswith=&quot;菜&quot;) | ~Q(Q(pub_date__year=2010) &amp; Q(pub_date__month=10)))</span><br><span class="line">print(res) </span><br></pre></td></tr></table></figure>

<ul>
<li>查询出版日期是 2004 或者 1999 年，并且书名中包含有”菜”的书籍。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res = models.Book.objects.filter(Q(pub_date__year=2004) | Q(pub_date__year=1999), title__contains=&quot;菜&quot;)</span><br><span class="line">print(res) </span><br></pre></td></tr></table></figure>

<blockquote>
<p>Q 对象和关键字混合使用，Q 对象要在所有关键字的前面:</p>
</blockquote>
<h2 id="中间件-验证登录"><a href="#中间件-验证登录" class="headerlink" title="中间件-验证登录"></a>中间件-验证登录</h2><ul>
<li><code>StudyDjanog/TestModel/model.py</code> 加入user</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class Users(models.Model):</span><br><span class="line">    name = models.CharField(max_length=32)</span><br><span class="line">    pwd = models.CharField(max_length=32)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>生成表结构</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations TestModel  </span><br><span class="line">python manage.py migrate TestModel </span><br></pre></td></tr></table></figure>

<ul>
<li>登录代码 <code>TestModel\views.py</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">def user_login(request):</span><br><span class="line">    if request.method != &quot;POST&quot;:</span><br><span class="line">        return JsonResponse(&#123;&#x27;code&#x27;: -1, &#x27;msg&#x27;: &#x27;method must is POST&#x27;&#125;)</span><br><span class="line"></span><br><span class="line">    data = json.loads(request.body)</span><br><span class="line">    user_name = data.get(&#x27;username&#x27;)</span><br><span class="line">    pwd = data.get(&quot;pwd&quot;)</span><br><span class="line">    print(data)</span><br><span class="line">    try:</span><br><span class="line">        user_entry = Users.objects.get(name=user_name, pwd=pwd)</span><br><span class="line">        if user_entry:</span><br><span class="line">            # 设置登录的session</span><br><span class="line">            request.session[&quot;user&quot;] = user_name</span><br><span class="line">            return JsonResponse(&#123;&#x27;code&#x27;: 1, &#x27;msg&#x27;: &#x27;login is success&#x27;&#125;)</span><br><span class="line">    except ObjectDoesNotExist:</span><br><span class="line">        return JsonResponse(&#123;&#x27;code&#x27;: -1, &#x27;msg&#x27;: &#x27;login is fail111&#x27;&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>编写中间件<code> TestModel\middleware\authen.py</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">from django.http import JsonResponse</span><br><span class="line">from django.shortcuts import redirect,render</span><br><span class="line">from django.utils.deprecation import MiddlewareMixin</span><br><span class="line">import re</span><br><span class="line"></span><br><span class="line">#白名单</span><br><span class="line">#将登陆、登出、验证登陆请求设为白名单，不进行用户验证。</span><br><span class="line">#这里设置了/static/静态文件，因为我这个项目静态文件没走nginx，如果静态文件通过nginx访问，可以不需要设置</span><br><span class="line">exclued_path = [&quot;/login/&quot;,&quot;/testModel/login/&quot;,&quot;/logout/&quot;,&quot;/login_ajax_check&quot;,&quot;/static/&quot;]</span><br><span class="line"></span><br><span class="line">#用来验证用户是否有权限登陆的中间件</span><br><span class="line">class AuthenticationMiddle(MiddlewareMixin):</span><br><span class="line">    def process_request(self, request):</span><br><span class="line">        url_path = request.path</span><br><span class="line">        #如果不在请求在白名单里</span><br><span class="line">        if url_path not in exclued_path:</span><br><span class="line">            #如果未登陆，则调转到登陆页面，将请求的url作为next参数</span><br><span class="line">            # if  not request.user.is_authenticated:</span><br><span class="line">            if not request.session.get(&quot;user&quot;):</span><br><span class="line">                # return redirect(&quot;/login/?next=&#123;url_path&#125;&quot;.format(url_path=url_path))</span><br><span class="line">                return JsonResponse(&#123;&#x27;code&#x27;: -1, &#x27;msg&#x27;: &#x27;login is failed2222&#x27;&#125;)</span><br><span class="line">        #如果已经登陆，则通过</span><br><span class="line">        else:</span><br><span class="line">            pass</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>引用中间件  <code>StudyDjanog\StudyDjanog\settings.py</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    &#x27;django.middleware.security.SecurityMiddleware&#x27;,</span><br><span class="line">    &#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;,</span><br><span class="line">    &#x27;django.middleware.common.CommonMiddleware&#x27;,</span><br><span class="line">    # &#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;,</span><br><span class="line">    &#x27;django.contrib.auth.middleware.AuthenticationMiddleware&#x27;,</span><br><span class="line">    &#x27;django.contrib.messages.middleware.MessageMiddleware&#x27;,</span><br><span class="line">    &#x27;django.middleware.clickjacking.XFrameOptionsMiddleware&#x27;,</span><br><span class="line">    &#x27;TestModel.middleware.authen.AuthenticationMiddle&#x27;, # 引用自定义中间件</span><br><span class="line"></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<ul>
<li>测试</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">data =&#123;&quot;username&quot;: &quot;admin&quot;, &quot;pwd&quot;: &quot;123456&quot;&#125;</span><br><span class="line">rs = requests.session()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">resp = rs.post(&quot;http://127.0.0.1:8000/testModel/login/&quot;, json=data)</span><br><span class="line">print(resp.text)</span><br><span class="line"></span><br><span class="line">resp1 = rs.get(&quot;http://127.0.0.1:8000/testModel/userQuery&quot;)</span><br><span class="line">print(resp1.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;&quot;code&quot;: 1, &quot;msg&quot;: &quot;login is success&quot;&#125;</span><br><span class="line">&lt;p&gt;runoob runoob &lt;/p&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>最终的session内容在django_session表中自动存储了</li>
</ul>
<p><img src="/aposts/8d0d1e49/image-20230803172250422.png" alt="image-20230803172250422"></p>
<ul>
<li>与<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_38206656/article/details/105389058">vue结合实例</a></li>
</ul>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ul>
<li><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/zh-hans/4.2/topics/">更多内容</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://louis-me.github.io/aposts/dbc9f282/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="一个正经的测试工程师">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="施坤的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/aposts/dbc9f282/" class="post-title-link" itemprop="url">python django实践</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-08-01 11:26:14" itemprop="dateCreated datePublished" datetime="2023-08-01T11:26:14+08:00">2023-08-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-08-02 17:03:29" itemprop="dateModified" datetime="2023-08-02T17:03:29+08:00">2023-08-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
                </span>
            </span>

          
            <span id="/aposts/dbc9f282/" class="post-meta-item leancloud_visitors" data-flag-title="python django实践" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/aposts/dbc9f282/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/aposts/dbc9f282/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><ul>
<li><p>本次系列教程来自于<a target="_blank" rel="noopener" href="https://www.runoob.com/django/django-tutorial.html">这里</a></p>
</li>
<li><p>本地环境</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator&gt;python --version</span><br><span class="line">Python 3.7.9</span><br></pre></td></tr></table></figure>



<h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><ul>
<li>安装django</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator&gt;python -m pip install Django</span><br></pre></td></tr></table></figure>

<ul>
<li>查看版本</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">python</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; import django</span><br><span class="line">&gt;&gt;&gt; django.get_version()</span><br><span class="line">&#x27;3.1.3&#x27;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用django-admin 创建项目</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E:\proj&gt;django-admin startproject StudyDjango</span><br></pre></td></tr></table></figure>

<ul>
<li>查看创建好的目录</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">E:\proj\StudyDjango&gt;tree /f</span><br><span class="line">│  manage.py</span><br><span class="line">│</span><br><span class="line">└─StudyDjango</span><br><span class="line">        asgi.py</span><br><span class="line">        settings.py</span><br><span class="line">        urls.py</span><br><span class="line">        wsgi.py</span><br><span class="line">        __init__.py</span><br></pre></td></tr></table></figure>

<ul>
<li>启动服务器</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E:\proj\StudyDjango&gt;python manage.py runserver 0.0.0.0:8000</span><br></pre></td></tr></table></figure>

<ul>
<li>浏览器打开<code>127.0.0.1:8000</code></li>
</ul>
<p><img src="/aposts/dbc9f282/image-20230801144936413.png" alt="image-20230801144936413"></p>
<h3 id="视图和-URL-配置"><a href="#视图和-URL-配置" class="headerlink" title="视图和 URL 配置"></a>视图和 URL 配置</h3><p>在先前创建的 <code>StudyDjango</code>目录下的 <code>StudyDjango</code>目录新建一个 <code>views.py </code>文件，并输入代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//StudyDjango/StudyDjango/views.py 文件代码：</span><br><span class="line"></span><br><span class="line">from django.http import HttpResponse</span><br><span class="line"> </span><br><span class="line">def hello(request):</span><br><span class="line">    return HttpResponse(&quot;Hello world ! &quot;)</span><br></pre></td></tr></table></figure>

<p>接着，绑定 URL 与视图函数。打开 <code>urls.py</code> 文件，删除原来代码，将以下代码复制粘贴到 <code>urls.py </code>文件中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// StudyDjango/StudyDjango/urls.py</span><br><span class="line">from django.conf.urls import url</span><br><span class="line"></span><br><span class="line">from . import views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(r&#x27;^$&#x27;, views.hello),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>完成后，启动 Django 开发服务器，并在浏览器访问打开浏览器并访问：</p>
<p><img src="/aposts/dbc9f282/image-20230801150043592.png" alt="image-20230801150043592"></p>
<p>我们也可以修改以下规则：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// StudyDjango/StudyDjango/urls.py</span><br><span class="line">from django.conf.urls import url</span><br><span class="line">from django.urls import path</span><br><span class="line"></span><br><span class="line">from . import views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    # url(r&#x27;^$&#x27;, views.hello),</span><br><span class="line">    path(&#x27;hello/&#x27;, views.hello),</span><br><span class="line"></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>通过浏览器打开 <code>http://127.0.0.1:8000/hello</code>，输出结果如下：</p>
<p><img src="/aposts/dbc9f282/image-20230801150312911.png" alt="image-20230801150312911"></p>
<h2 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h2><ul>
<li><p>我们使用 <code>django.http.HttpResponse() </code>来输出 “Hello World！”。该方式将数据与视图混合在一起，不符合 Django 的 MVC 思想。</p>
</li>
<li><p>将在 <code>StudyDjango</code>目录底下创建 <code>templates </code>目录并建立<code> runoob.html</code>文件，runoob.html 文件代码如下：</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// StudyDjango/templates/runoob.html </span><br><span class="line"></span><br><span class="line">&lt;h1&gt;&#123;&#123; hello &#125;&#125;&lt;/h1&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>接下来我们需要向Django说明模板文件的路径，修改<code>HelloWorld/settings.py</code>，修改 TEMPLATES 中的 DIRS 为 <code>[os.path.join(BASE_DIR, &#39;templates&#39;)]</code>，如下所示:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// StudyDjango/StudyDjango/settings.py 文件代码：</span><br><span class="line"></span><br><span class="line">TEMPLATES = [</span><br><span class="line">    &#123;</span><br><span class="line">        &#x27;BACKEND&#x27;: &#x27;django.template.backends.django.DjangoTemplates&#x27;,</span><br><span class="line">        &#x27;DIRS&#x27;: [os.path.join(BASE_DIR, &#x27;templates&#x27;)],       # 修改位置</span><br><span class="line">        &#x27;APP_DIRS&#x27;: True,</span><br><span class="line">        &#x27;OPTIONS&#x27;: &#123;</span><br><span class="line">            &#x27;context_processors&#x27;: [</span><br><span class="line">                &#x27;django.template.context_processors.debug&#x27;,</span><br><span class="line">                &#x27;django.template.context_processors.request&#x27;,</span><br><span class="line">                &#x27;django.contrib.auth.context_processors.auth&#x27;,</span><br><span class="line">                &#x27;django.contrib.messages.context_processors.messages&#x27;,</span><br><span class="line">            ],</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<ul>
<li>我们现在修改 views.py，增加一个新的对象，用于向模板提交数据：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// StudyDjango/StudyDjango/views.py</span><br><span class="line"></span><br><span class="line">from django.shortcuts import render</span><br><span class="line"> </span><br><span class="line">def runoob(request):</span><br><span class="line">    context = &#123;&#125;</span><br><span class="line">    context[&#x27;hello&#x27;] = &#x27;Hello World!&#x27;</span><br><span class="line">    return render(request, &#x27;runoob.html&#x27;, context)</span><br></pre></td></tr></table></figure>

<ul>
<li>修改urls中的路由</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// StudyDjango/StudyDjango/urls.py</span><br><span class="line"></span><br><span class="line">from django.urls import path</span><br><span class="line"></span><br><span class="line">from . import views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    # url(r&#x27;^$&#x27;, views.hello),</span><br><span class="line">    # path(&#x27;hello/&#x27;, views.hello),</span><br><span class="line">    path(&#x27;runoob/&#x27;, views.runoob),</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>访问最新地址</li>
</ul>
<p><img src="/aposts/dbc9f282/image-20230801152821208.png" alt="image-20230801152821208"></p>
<ul>
<li>更多模板语法参考<a target="_blank" rel="noopener" href="https://www.runoob.com/django/django-template.html">这里</a></li>
</ul>
<h2 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h2><ul>
<li><p>Django 对各种数据库提供了很好的支持，包括：PostgreSQL、MySQL、SQLite、Oracle。</p>
</li>
<li><p>Django 为这些数据库提供了统一的调用API。 我们可以根据自己业务需求选择不同的数据库</p>
</li>
<li><p>本次模型使用mysql，需要安装mysq驱动</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E:\proj\StudyDjango&gt;pip3 install pymysql</span><br></pre></td></tr></table></figure>

<blockquote>
<p>本地需要搭建好Mysql环境</p>
</blockquote>
<h3 id="Django-ORM"><a href="#Django-ORM" class="headerlink" title="Django ORM"></a>Django ORM</h3><ul>
<li><p>本地数据库中需要提前创建数据库，因为ORM 无法操作到数据库级别，只能到表。</p>
</li>
<li><p>使用heidisql连接本地mysql数据库后，新建一个数据库，名称为：runoob </p>
</li>
<li><p>我们在项目的 settings.py 文件中找到 DATABASES 配置项，将其信息修改为：</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// StudyDjango/StudyDjango/settings.py</span><br><span class="line"></span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    # &#x27;default&#x27;: &#123;</span><br><span class="line">    #     &#x27;ENGINE&#x27;: &#x27;django.db.backends.sqlite3&#x27;,</span><br><span class="line">    #     &#x27;NAME&#x27;: BASE_DIR / &#x27;db.sqlite3&#x27;,</span><br><span class="line">    # &#125;</span><br><span class="line">    &#x27;default&#x27;:</span><br><span class="line">        &#123;</span><br><span class="line">            &#x27;ENGINE&#x27;: &#x27;django.db.backends.mysql&#x27;,  # 数据库引擎</span><br><span class="line">            &#x27;NAME&#x27;: &#x27;runoob&#x27;,  # 数据库名称</span><br><span class="line">            &#x27;HOST&#x27;: &#x27;127.0.0.1&#x27;,  # 数据库地址，本机 ip 地址 127.0.0.1 </span><br><span class="line">            &#x27;PORT&#x27;: 3306,  # 端口 </span><br><span class="line">            &#x27;USER&#x27;: &#x27;root&#x27;,  # 数据库用户名</span><br><span class="line">            &#x27;PASSWORD&#x27;: &#x27;123456&#x27;,  # 数据库密码</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在与<code> settings.py</code> 同级目录下的 <code>__init__.py </code>中引入模块和进行配置</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// StudyDjango/StudyDjango/__init__.py</span><br><span class="line"></span><br><span class="line">import pymysql</span><br><span class="line">pymysql.install_as_MySQLdb()</span><br></pre></td></tr></table></figure>

<h3 id="定义模型"><a href="#定义模型" class="headerlink" title="定义模型"></a>定义模型</h3><h4 id="创建APP"><a href="#创建APP" class="headerlink" title="创建APP"></a>创建APP</h4><ul>
<li>Django 规定，如果要使用模型，必须要创建一个 app。我们使用以下命令创建一个 TestModel 的 app:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E:\proj\StudyDjango&gt;django-admin startapp TestModel</span><br></pre></td></tr></table></figure>

<p><img src="/aposts/dbc9f282/image-20230801154926128.png" alt="image-20230801154926128"></p>
<ul>
<li>我们修改 <code>TestModel/models.py</code> 文件，代码如下：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Test(models.Model):</span><br><span class="line">    name = models.CharField(max_length=20)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>以上的类名代表了数据库表名(test)，且继承了models.Model，类里面的字段代表数据表中的字段(name)，数据类型则由CharField（相当于varchar）、DateField（相当于datetime）， max_length 参数限定长度。</p>
</blockquote>
<ul>
<li>接下来在 settings.py 中找到INSTALLED_APPS这一项，如下：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// StudyDjango\StudyDjango\settings.py</span><br><span class="line"></span><br><span class="line">INSTALLED_APPS = (</span><br><span class="line">    &#x27;django.contrib.admin&#x27;,</span><br><span class="line">    &#x27;django.contrib.auth&#x27;,</span><br><span class="line">    &#x27;django.contrib.contenttypes&#x27;,</span><br><span class="line">    &#x27;django.contrib.sessions&#x27;,</span><br><span class="line">    &#x27;django.contrib.messages&#x27;,</span><br><span class="line">    &#x27;django.contrib.staticfiles&#x27;,</span><br><span class="line">    &#x27;TestModel&#x27;,               # 添加此项</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li>在命令行中运行, 创建表结构,发现报错了</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">E:\proj\StudyDjango&gt;python manage.py migrate</span><br><span class="line"></span><br><span class="line">  File &quot;D:\app\Python37\lib\site-packages\django\db\backends\mysql\base.py&quot;, line 36, in &lt;module&gt;</span><br><span class="line">    raise ImproperlyConfigured(&#x27;mysqlclient 1.4.0 or newer is required; you have %s.&#x27; % Database.__version__)</span><br><span class="line">django.core.exceptions.ImproperlyConfigured: mysqlclient 1.4.0 or newer is required; you have 0.10.1.</span><br></pre></td></tr></table></figure>

<ul>
<li><p>原因是 MySQLclient 目前只支持到 Python3.4，因此如果使用的更高版本的 python，把<code>D:\app\Python37\Lib\site-packages\django\db\backends\mysql\base.py</code> 对应报错代码注释</p>
</li>
<li><p>再次执行</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">E:\proj\StudyDjango&gt; python manage.py migrate   # 创建表结构</span><br><span class="line"></span><br><span class="line">E:\proj\StudyDjango&gt; python manage.py makemigrations TestModel  # 让 Django 知道我们在我们的模型有一些变更</span><br><span class="line">E:\proj\StudyDjango&gt; python manage.py migrate TestModel   # 创建表结构</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>查看表已经生成成功</li>
</ul>
<p><img src="/aposts/dbc9f282/image-20230801163314750.png" alt="image-20230801163314750"></p>
<h2 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h2><h3 id="操作模型"><a href="#操作模型" class="headerlink" title="操作模型"></a>操作模型</h3><h4 id="新增数据"><a href="#新增数据" class="headerlink" title="新增数据"></a>新增数据</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// StudyDjango/StudyDjango/testdb.py</span><br><span class="line">from django.http import HttpResponse</span><br><span class="line"></span><br><span class="line">from TestModel.models import Test</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 数据库操作</span><br><span class="line">def testdb(request):</span><br><span class="line">    test1 = Test(name=&#x27;runoob&#x27;)</span><br><span class="line">    test1.save()</span><br><span class="line">    return HttpResponse(&quot;&lt;p&gt;数据添加成功！&lt;/p&gt;&quot;)</span><br></pre></td></tr></table></figure>

<ul>
<li>下来我们在 StudyDjango目录中添加 testdb.py 文件到urls.py中</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from django.urls import path</span><br><span class="line"></span><br><span class="line">from . import views,testdb</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    # url(r&#x27;^$&#x27;, views.hello),</span><br><span class="line">    # path(&#x27;hello/&#x27;, views.hello),</span><br><span class="line">    path(&#x27;runoob/&#x27;, views.runoob),</span><br><span class="line">    path(&#x27;testdb/&#x27;, testdb.testdb),</span><br><span class="line"></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<ul>
<li>访问 <code>http://127.0.0.1:8000/testdb</code> 就可以看到数据添加成功的提示。</li>
</ul>
<p><img src="/aposts/dbc9f282/image-20230801170113854.png" alt="image-20230801170113854"></p>
<h4 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">from django.http import HttpResponse</span><br><span class="line"> </span><br><span class="line">from TestModel.models import Test</span><br><span class="line"> </span><br><span class="line"># 数据库操作</span><br><span class="line">def testdb(request):</span><br><span class="line">    # 初始化</span><br><span class="line">    response = &quot;&quot;</span><br><span class="line">    response1 = &quot;&quot;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    # 通过objects这个模型管理器的all()获得所有数据行，相当于SQL中的SELECT * FROM</span><br><span class="line">    list = Test.objects.all()</span><br><span class="line">        </span><br><span class="line">    # filter相当于SQL中的WHERE，可设置条件过滤结果</span><br><span class="line">    response2 = Test.objects.filter(id=1) </span><br><span class="line">    </span><br><span class="line">    # 获取单个对象</span><br><span class="line">    response3 = Test.objects.get(id=1) </span><br><span class="line">    </span><br><span class="line">    # 限制返回的数据 相当于 SQL 中的 OFFSET 0 LIMIT 2;</span><br><span class="line">    Test.objects.order_by(&#x27;name&#x27;)[0:2]</span><br><span class="line">    </span><br><span class="line">    #数据排序</span><br><span class="line">    Test.objects.order_by(&quot;id&quot;)</span><br><span class="line">    </span><br><span class="line">    # 上面的方法可以连锁使用</span><br><span class="line">    Test.objects.filter(name=&quot;runoob&quot;).order_by(&quot;id&quot;)</span><br><span class="line">    </span><br><span class="line">    # 输出所有数据</span><br><span class="line">    for var in list:</span><br><span class="line">        response1 += var.name + &quot; &quot;</span><br><span class="line">    response = response1</span><br><span class="line">    return HttpResponse(&quot;&lt;p&gt;&quot; + response + &quot;&lt;/p&gt;&quot;)</span><br></pre></td></tr></table></figure>

<h4 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">from django.http import HttpResponse</span><br><span class="line"> </span><br><span class="line">from TestModel.models import Test</span><br><span class="line"> </span><br><span class="line"># 数据库操作</span><br><span class="line">def testdb(request):</span><br><span class="line">    # 修改其中一个id=1的name字段，再save，相当于SQL中的UPDATE</span><br><span class="line">    test1 = Test.objects.get(id=1)</span><br><span class="line">    test1.name = &#x27;Google&#x27;</span><br><span class="line">    test1.save()</span><br><span class="line">    </span><br><span class="line">    # 另外一种方式</span><br><span class="line">    #Test.objects.filter(id=1).update(name=&#x27;Google&#x27;)</span><br><span class="line">    </span><br><span class="line">    # 修改所有的列</span><br><span class="line">    # Test.objects.all().update(name=&#x27;Google&#x27;)</span><br><span class="line">    </span><br><span class="line">    return HttpResponse(&quot;&lt;p&gt;修改成功&lt;/p&gt;&quot;)</span><br></pre></td></tr></table></figure>

<h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">from django.http import HttpResponse</span><br><span class="line"> </span><br><span class="line">from TestModel.models import Test</span><br><span class="line"> </span><br><span class="line"># 数据库操作</span><br><span class="line">def testdb(request):</span><br><span class="line">    # 删除id=1的数据</span><br><span class="line">    test1 = Test.objects.get(id=1)</span><br><span class="line">    test1.delete()</span><br><span class="line">    </span><br><span class="line">    # 另外一种方式</span><br><span class="line">    # Test.objects.filter(id=1).delete()</span><br><span class="line">    </span><br><span class="line">    # 删除所有数据</span><br><span class="line">    # Test.objects.all().delete()</span><br><span class="line">    </span><br><span class="line">    return HttpResponse(&quot;&lt;p&gt;删除成功&lt;/p&gt;&quot;)</span><br></pre></td></tr></table></figure>

<h2 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h2><ul>
<li>Django 项目里多个app目录共用一个 urls 容易造成混淆，后期维护也不方便</li>
<li>在项目名（TestModel）中新增一个 <code>TestModel/urls.py</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from django.urls import path,re_path</span><br><span class="line">from django.conf.urls import url</span><br><span class="line"></span><br><span class="line">from TestModel import views # 从自己的 app 目录引入 views</span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(r&#x27;^userAdd/&#x27;, views.userAdd),</span><br><span class="line">    path(&#x27;userQuery/&#x27;, views.userQuery),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<ul>
<li>TestModel&#x2F;view.py 编写具体代码</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">from django.http import HttpResponse</span><br><span class="line">from django.shortcuts import render</span><br><span class="line"></span><br><span class="line"># Create your views here.</span><br><span class="line">from TestModel.models import Test</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def userAdd(request):</span><br><span class="line">    test1 = Test(name=&#x27;runoob&#x27;)</span><br><span class="line">    test1.save()</span><br><span class="line">    return HttpResponse(&quot;&lt;p&gt;数据添加成功！&lt;/p&gt;&quot;)</span><br><span class="line"></span><br><span class="line">def userQuery(request):</span><br><span class="line">    # 初始化</span><br><span class="line">    response = &quot;&quot;</span><br><span class="line">    response1 = &quot;&quot;</span><br><span class="line"></span><br><span class="line">    # 通过objects这个模型管理器的all()获得所有数据行，相当于SQL中的SELECT * FROM</span><br><span class="line">    list = Test.objects.all()</span><br><span class="line"></span><br><span class="line">    # filter相当于SQL中的WHERE，可设置条件过滤结果</span><br><span class="line">    response2 = Test.objects.filter(id=1)</span><br><span class="line"></span><br><span class="line">    # 获取单个对象</span><br><span class="line">    response3 = Test.objects.get(id=1)</span><br><span class="line"></span><br><span class="line">    # 限制返回的数据 相当于 SQL 中的 OFFSET 0 LIMIT 2;</span><br><span class="line">    Test.objects.order_by(&#x27;name&#x27;)[0:2]</span><br><span class="line"></span><br><span class="line">    # 数据排序</span><br><span class="line">    Test.objects.order_by(&quot;id&quot;)</span><br><span class="line"></span><br><span class="line">    # 上面的方法可以连锁使用</span><br><span class="line">    Test.objects.filter(name=&quot;runoob&quot;).order_by(&quot;id&quot;)</span><br><span class="line"></span><br><span class="line">    # 输出所有数据</span><br><span class="line">    for var in list:</span><br><span class="line">        response1 += var.name + &quot; &quot;</span><br><span class="line">    response = response1</span><br><span class="line">    return HttpResponse(&quot;&lt;p&gt;&quot; + response + &quot;&lt;/p&gt;&quot;)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>StudyDiango/StudyDiango/urls.py </code>中引用具体项目的url</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from django.conf.urls import url</span><br><span class="line">from django.urls import path, include</span><br><span class="line"></span><br><span class="line">from . import views,testdb</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    # url(r&#x27;^$&#x27;, views.hello),</span><br><span class="line">    # path(&#x27;hello/&#x27;, views.hello),</span><br><span class="line">    path(&#x27;runoob/&#x27;, views.runoob),</span><br><span class="line">    path(&#x27;testdb/&#x27;, testdb.testdb),</span><br><span class="line">    path(&#x27;testModel/&#x27;, include(&quot;TestModel.urls&quot;)),</span><br><span class="line"></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<ul>
<li>浏览器打开<code>http://127.0.0.1:8000/testModel/userQuery/</code></li>
</ul>
<p><img src="/aposts/dbc9f282/image-20230802105812991.png" alt="image-20230802105812991"></p>
<h2 id="ORM多表实践"><a href="#ORM多表实践" class="headerlink" title="ORM多表实践"></a>ORM多表实践</h2><h3 id="表结构"><a href="#表结构" class="headerlink" title="表结构"></a>表结构</h3><p><strong>书籍表 Book</strong>：title 、 price 、 pub_date 、 publish（外键，多对一） 、 authors（多对多）</p>
<p><strong>出版社表 Publish</strong>：name 、 city 、 email</p>
<p><strong>作者表 Author</strong>：name 、 age 、 au_detail（一对一）</p>
<p><strong>作者详情表 AuthorDetail</strong>：gender 、 tel 、 addr 、 birthday</p>
<ul>
<li>关系图</li>
</ul>
<p><img src="/aposts/dbc9f282/image-20230802104212169.png" alt="image-20230802104212169"></p>
<h3 id="创建模型"><a href="#创建模型" class="headerlink" title="创建模型"></a>创建模型</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">class Book(models.Model):</span><br><span class="line">    title = models.CharField(max_length=32)</span><br><span class="line">    price = models.DecimalField(max_digits=5, decimal_places=2)</span><br><span class="line">    pub_date = models.DateField()</span><br><span class="line">    # 关联出版社一对多，意思就是一个出版社可以有印刷多本书</span><br><span class="line">    publish = models.ForeignKey(&quot;Publish&quot;, on_delete=models.CASCADE)</span><br><span class="line">    # 多对多，意思就是多个作者可以编写多本书</span><br><span class="line">    authors = models.ManyToManyField(&quot;Author&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Publish(models.Model):</span><br><span class="line">    name = models.CharField(max_length=32)</span><br><span class="line">    city = models.CharField(max_length=64)</span><br><span class="line">    email = models.EmailField()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Author(models.Model):</span><br><span class="line">    name = models.CharField(max_length=32)</span><br><span class="line">    age = models.SmallIntegerField()</span><br><span class="line">    # 一对一，意思为一个作者对应一个作者详情</span><br><span class="line">    au_detail = models.OneToOneField(&quot;AuthorDetail&quot;, on_delete=models.CASCADE)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class AuthorDetail(models.Model):</span><br><span class="line">    gender_choices = (</span><br><span class="line">        (0, &quot;女&quot;),</span><br><span class="line">        (1, &quot;男&quot;),</span><br><span class="line">        (2, &quot;保密&quot;),</span><br><span class="line">    )</span><br><span class="line">    gender = models.SmallIntegerField(choices=gender_choices)</span><br><span class="line">    tel = models.CharField(max_length=32)</span><br><span class="line">    addr = models.CharField(max_length=64)</span><br><span class="line">    birthday = models.DateField()</span><br></pre></td></tr></table></figure>

<ul>
<li>生成表结构</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">E:\proj\StudyDjango&gt; python manage.py makemigrations TestModel  # 让 Django 知道我们在我们的模型有一些变更</span><br><span class="line">E:\proj\StudyDjango&gt; python manage.py migrate TestModel   # 创建表</span><br></pre></td></tr></table></figure>

<p><img src="/aposts/dbc9f282/image-20230802110229182.png" alt="image-20230802110229182"></p>
<blockquote>
<p> 注意testmode_book_authors 为book多对多authors的表</p>
</blockquote>
<h3 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 插入出版社</span><br><span class="line">insert into testmodel_publish(name,city,email) values (&quot;华山出版社&quot;, &quot;华山&quot;, &quot;hs@163.com&quot;), (&quot;明教出版社&quot;, &quot;黑木崖&quot;, &quot;mj@163.com&quot;)</span><br><span class="line"></span><br><span class="line"># 先插入 authordetail 表中多数据</span><br><span class="line">insert into testmodel_authordetail(gender,tel,addr,birthday) values (1,13432335433,&quot;华山&quot;,&quot;1994-5-23&quot;), (1,13943454554,&quot;黑木崖&quot;,&quot;1961-8-13&quot;), (0,13878934322,&quot;黑木崖&quot;,&quot;1996-5-20&quot;) </span><br><span class="line"></span><br><span class="line"># 再将数据插入 author，这样 author 才能找到 authordetail </span><br><span class="line">insert into testmodel_author(name,age,au_detail_id) values (&quot;令狐冲&quot;,25,1), (&quot;任我行&quot;,58,2), (&quot;任盈盈&quot;,23,3)</span><br></pre></td></tr></table></figure>

<h3 id="ORM添加数据"><a href="#ORM添加数据" class="headerlink" title="ORM添加数据"></a>ORM添加数据</h3><h4 id="一对多-外键-ForeignKey"><a href="#一对多-外键-ForeignKey" class="headerlink" title="一对多(外键 ForeignKey)"></a>一对多(外键 ForeignKey)</h4><p><strong>方式一:</strong> 传对象的形式，返回值的数据类型是对象，书籍对象。</p>
<p><strong>步骤：</strong></p>
<ul>
<li>a. 获取出版社对象</li>
<li>b. 给书籍的出版社属性 pulish 传出版社对象</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// testmode/views.py</span><br><span class="line"></span><br><span class="line">def add_book(request):</span><br><span class="line">    #  获取出版社对象</span><br><span class="line">    pub_obj = models.Publish.objects.filter(pk=1).first()</span><br><span class="line">    #  给书籍的出版社属性publish传出版社对象</span><br><span class="line">    book = models.Book.objects.create(title=&quot;菜鸟教程&quot;, price=200, pub_date=&quot;2010-10-10&quot;, publish=pub_obj)</span><br><span class="line">    print(book, type(book))</span><br><span class="line">    return HttpResponse(book)</span><br></pre></td></tr></table></figure>

<p><strong>方式二</strong>: 传对象 id 的形式(由于传过来的数据一般是 id,所以传对象 id 是常用的)。</p>
<p>一对多中，设置外键属性的类(多的表)中，MySQL 中显示的字段名是:<strong>外键属性名_id</strong>。</p>
<p>返回值的数据类型是对象，书籍对象。</p>
<p><strong>步骤：</strong></p>
<ul>
<li>a. 获取出版社对象的 id</li>
<li>b. 给书籍的关联出版社字段 pulish_id 传出版社对象的 id</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def add_book(request):</span><br><span class="line">    #  获取出版社对象</span><br><span class="line">    pub_obj = models.Publish.objects.filter(pk=1).first()</span><br><span class="line">    #  获取出版社对象的id</span><br><span class="line">    pk = pub_obj.pk</span><br><span class="line">    #  给书籍的关联出版社字段 publish_id 传出版社对象的id</span><br><span class="line">    book = models.Book.objects.create(title=&quot;冲灵剑法&quot;, price=100, pub_date=&quot;2004-04-04&quot;, publish_id=pk)</span><br><span class="line">    print(book, type(book))</span><br><span class="line">    return HttpResponse(book)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>testmodel/urls.py </code>引用<code>views.py</code>代码</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from django.urls import path,re_path</span><br><span class="line">from django.conf.urls import url</span><br><span class="line"></span><br><span class="line">from TestModel import views # 从自己的 app 目录引入 views</span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(r&#x27;^userAdd/&#x27;, views.userAdd),</span><br><span class="line">    path(&#x27;userQuery/&#x27;, views.userQuery),</span><br><span class="line">    path(&#x27;add_book/&#x27;, views.add_book),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h4 id="多对多-ManyToManyField-："><a href="#多对多-ManyToManyField-：" class="headerlink" title="多对多(ManyToManyField)："></a>多对多(ManyToManyField)：</h4><ul>
<li>在第三张关系表中新增数据</li>
</ul>
<p><strong>方式一:</strong> 传对象形式，无返回值。</p>
<p><strong>步骤：</strong></p>
<ul>
<li>a. 获取作者对象</li>
<li>b. 获取书籍对象</li>
<li>c. 给书籍对象的 authors 属性用 add 方法传作者对象</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">def add_books(request):</span><br><span class="line">    #  获取作者对象</span><br><span class="line">    chong = models.Author.objects.filter(name=&quot;令狐冲&quot;).first()</span><br><span class="line">    ying = models.Author.objects.filter(name=&quot;任盈盈&quot;).first()</span><br><span class="line">    #  获取书籍对象</span><br><span class="line">    book = models.Book.objects.filter(title=&quot;菜鸟教程&quot;).first()</span><br><span class="line">    #  给书籍对象的 authors 属性用 add 方法传作者对象</span><br><span class="line">    # 菜鸟教程这本书有两个作者</span><br><span class="line">    book.authors.add(chong, ying)</span><br><span class="line">    return HttpResponse(book)</span><br></pre></td></tr></table></figure>

<p><strong>方式二:</strong> 传对象id形式，无返回值。</p>
<p><strong>步骤：</strong></p>
<ul>
<li>a. 获取作者对象的 id</li>
<li>b. 获取书籍对象</li>
<li>c. 给书籍对象的 authors 属性用 add 方法传作者对象的 id</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def add_books_1(request):</span><br><span class="line">    #  获取作者对象</span><br><span class="line">    chong = models.Author.objects.filter(name=&quot;令狐冲&quot;).first()</span><br><span class="line">    #  获取作者对象的id</span><br><span class="line">    pk = chong.pk</span><br><span class="line">    #  获取书籍对象</span><br><span class="line">    book = models.Book.objects.filter(title=&quot;冲灵剑法&quot;).first()</span><br><span class="line">    #  给书籍对象的 authors 属性用 add 方法传作者对象的id</span><br><span class="line">    book.authors.add(pk)</span><br></pre></td></tr></table></figure>

<h3 id="关联管理器-对象调用"><a href="#关联管理器-对象调用" class="headerlink" title="关联管理器(对象调用)"></a>关联管理器(对象调用)</h3><p><strong>前提：</strong></p>
<ul>
<li>多对多（双向均有关联管理器）</li>
<li>一对多（只有多的那个类的对象有关联管理器，即反向才有）</li>
</ul>
<p><strong>语法格式：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">正向：属性名,如add,create等</span><br><span class="line">反向：小写类名加 _set</span><br></pre></td></tr></table></figure>

<blockquote>
<p>一对多只能反向</p>
</blockquote>
<ul>
<li><strong>add</strong>。用于多对多，把指定的模型对象添加到关联对象集（关系表）中。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 方式一：传对象</span><br><span class="line">book_obj = models.Book.objects.get(id=10)</span><br><span class="line">author_list = models.Author.objects.filter(id__gt=2)</span><br><span class="line">book_obj.authors.add(*author_list)  # 将 id 大于2的作者对象添加到这本书的作者集合中</span><br><span class="line"># 方式二：传对象 id</span><br><span class="line">book_obj.authors.add(*[1,3]) # 将 id=1 和 id=3 的作者对象添加到这本书的作者集合中</span><br><span class="line">return HttpResponse(&quot;ok&quot;)</span><br></pre></td></tr></table></figure>

<ul>
<li>反向：<strong>小写表名_set</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ying = models.Author.objects.filter(name=&quot;任盈盈&quot;).first()</span><br><span class="line">book = models.Book.objects.filter(title=&quot;冲灵剑法&quot;).first()</span><br><span class="line">ying.book_set.add(book)</span><br><span class="line">return HttpResponse(&quot;ok&quot;)</span><br></pre></td></tr></table></figure>

<p><strong>create</strong>：创建一个新的对象，并同时将它添加到关联对象集之中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pub = models.Publish.objects.filter(name=&quot;明教出版社&quot;).first()</span><br><span class="line">wo = models.Author.objects.filter(name=&quot;任我行&quot;).first()</span><br><span class="line">book = wo.book_set.create(title=&quot;吸星大法&quot;, price=300, pub_date=&quot;1999-9-19&quot;, publish=pub)</span><br><span class="line">print(book, type(book))</span><br><span class="line">return HttpResponse(&quot;ok&quot;)</span><br></pre></td></tr></table></figure>

<p><strong>remove</strong>：从关联对象集中移除执行的模型对象。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">author_obj =models.Author.objects.get(id=1)</span><br><span class="line">book_obj = models.Book.objects.get(id=11)</span><br><span class="line">author_obj.book_set.remove(book_obj)</span><br><span class="line">return HttpResponse(&quot;ok&quot;)</span><br></pre></td></tr></table></figure>

<p><strong>clear</strong>：从关联对象集中移除一切对象，删除关联，不会删除对象。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#  清空独孤九剑关联的所有作者</span><br><span class="line">book = models.Book.objects.filter(title=&quot;菜鸟教程&quot;).first()</span><br><span class="line">book.authors.clear()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>对于 ForeignKey 对象，这个方法仅在 null&#x3D;True（可以为空）时存在。</p>
</blockquote>
<h3 id="ORM-查询"><a href="#ORM-查询" class="headerlink" title="ORM 查询"></a>ORM 查询</h3><h4 id="一对多"><a href="#一对多" class="headerlink" title="一对多"></a>一对多</h4><p>查询主键为 10 的书籍的出版社所在的城市（<strong>正向</strong>）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">book = models.Book.objects.filter(pk=10).first()</span><br><span class="line">res = book.publish.city</span><br><span class="line">print(res, type(res))</span><br><span class="line">return HttpResponse(&quot;ok&quot;)</span><br></pre></td></tr></table></figure>

<ul>
<li>查询明教出版社出版的书籍名（<strong>反向</strong>）。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pub = models.Publish.objects.filter(name=&quot;明教出版社&quot;).first()</span><br><span class="line"># pub.book_set.all()：取出书籍表的所有书籍对象，在一个 QuerySet 里，遍历取出一个个书籍对象。</span><br><span class="line">res = pub.book_set.all()</span><br><span class="line">for i in res:</span><br><span class="line">    print(i.title)</span><br><span class="line">return HttpResponse(&quot;ok&quot;)</span><br></pre></td></tr></table></figure>

<h4 id="一对一"><a href="#一对一" class="headerlink" title="一对一"></a>一对一</h4><p>查询令狐冲的电话（<strong>正向</strong>）</p>
<p>正向：对象.属性 (author.au_detail) 可以跳转到关联的表(作者详情表)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">author = models.Author.objects.filter(name=&quot;令狐冲&quot;).first()</span><br><span class="line">res = author.au_detail.tel</span><br><span class="line">print(res, type(res))</span><br><span class="line">return HttpResponse(&quot;ok&quot;)</span><br></pre></td></tr></table></figure>

<p>查询所有住址在黑木崖的作者的姓名（<strong>反向</strong>）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">addr = models.AuthorDetail.objects.filter(addr=&quot;黑木崖&quot;).first()</span><br><span class="line">res = addr.author.name</span><br><span class="line">print(res, type(res))</span><br><span class="line">return HttpResponse(&quot;ok&quot;)</span><br></pre></td></tr></table></figure>

<h4 id="多对多"><a href="#多对多" class="headerlink" title="多对多"></a>多对多</h4><ul>
<li><p>菜鸟教程所有作者的名字以及手机号（<strong>正向</strong>）。</p>
</li>
<li><p>正向：**对象.属性(book.authors)**可以跳转到关联的表(作者表)。</p>
</li>
<li><p>作者表里没有作者电话，因此再次通过**对象.属性(i.au_detail)**跳转到关联的表（作者详情表）</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">book = models.Book.objects.filter(title=&quot;菜鸟教程&quot;).first()</span><br><span class="line">res = book.authors.all()</span><br><span class="line">for i in res:</span><br><span class="line">    print(i.name, i.au_detail.tel)</span><br><span class="line">return HttpResponse(&quot;ok&quot;)</span><br></pre></td></tr></table></figure>

<ul>
<li>查询任我行出过的所有书籍的名字（<strong>反向</strong>）。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">author = models.Author.objects.filter(name=&quot;任我行&quot;).first()</span><br><span class="line">res = author.book_set.all()</span><br><span class="line">for i in res:</span><br><span class="line">    print(i.title)</span><br><span class="line">return HttpResponse(&quot;ok&quot;)</span><br></pre></td></tr></table></figure>

<h3 id="基于双下划线的跨表查询"><a href="#基于双下划线的跨表查询" class="headerlink" title="基于双下划线的跨表查询"></a>基于双下划线的跨表查询</h3><p>正向：属性名称__跨表的属性名称</p>
<p>反向：小写类名__跨表的属性名称</p>
<h4 id="一对多-1"><a href="#一对多-1" class="headerlink" title="一对多"></a>一对多</h4><p>正向：查询菜鸟出版社出版过的所有书籍的名字与价格。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># publish__name 跨表中的name</span><br><span class="line">res = models.Book.objects.filter(publish__name=&quot;菜鸟出版社&quot;).values_list(&quot;title&quot;, &quot;price&quot;)</span><br></pre></td></tr></table></figure>

<p>反向：通过 小<strong>写类名__跨表的属性名称（book__title，book__price）</strong> 跨表获取数据。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res = models.Publish.objects.filter(name=&quot;菜鸟出版社&quot;).values_list(&quot;book__title&quot;,&quot;book__price&quot;)</span><br><span class="line">return HttpResponse(&quot;ok&quot;)</span><br></pre></td></tr></table></figure>

<h4 id="多对多-1"><a href="#多对多-1" class="headerlink" title="多对多"></a>多对多</h4><p>查询任我行出过的所有书籍的名字。</p>
<p><strong>正向</strong>：通过 属性名称__跨表的属性名称(authors__name) 跨表获取数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res = models.Book.objects.filter(authors__name=&quot;任我行&quot;).values_list(&quot;title&quot;)</span><br></pre></td></tr></table></figure>

<p><strong>反向</strong>：通过 小写类名__跨表的属性名称（book__title） 跨表获取数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res = models.Author.objects.filter(name=&quot;任我行&quot;).values_list(&quot;book__title&quot;)</span><br></pre></td></tr></table></figure>

<h4 id="一对一-1"><a href="#一对一-1" class="headerlink" title="一对一"></a>一对一</h4><p>查询任我行的手机号。</p>
<p><strong>正向</strong>：通过 <strong>属性名称__跨表的属性名称(au_detail__tel)</strong> 跨表获取数据。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res = models.Author.objects.filter(name=&quot;任我行&quot;).values_list(&quot;au_detail__tel&quot;)</span><br></pre></td></tr></table></figure>

<p><strong>反向</strong>：通过 <strong>小写类名__跨表的属性名称（author__name）</strong> 跨表获取数据。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res = models.AuthorDetail.objects.filter(author__name=&quot;任我行&quot;).values_list(&quot;tel&quot;)</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li>主要介绍了新建项目，应用，路由，连接数据库，对model进行增删改查等操作</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://louis-me.github.io/aposts/57a9c16f/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="一个正经的测试工程师">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="施坤的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/aposts/57a9c16f/" class="post-title-link" itemprop="url">go部署实践</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-07-31 09:42:05 / 修改时间：11:07:00" itemprop="dateCreated datePublished" datetime="2023-07-31T09:42:05+08:00">2023-07-31</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
                </span>
            </span>

          
            <span id="/aposts/57a9c16f/" class="post-meta-item leancloud_visitors" data-flag-title="go部署实践" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/aposts/57a9c16f/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/aposts/57a9c16f/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><ul>
<li>本次笔记主要记录部署go</li>
<li>服务信息为centos 7</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-24-13-centos home]# uname -a</span><br><span class="line">Linux VM-24-13-centos 3.10.0-1160.11.1.el7.x86_64 #1 SMP Fri Dec 18 16:34:56 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="直接部署"><a href="#直接部署" class="headerlink" title="直接部署"></a>直接部署</h2><ul>
<li>分别为下载，解压go</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-24-13-centos /]# cd home</span><br><span class="line">[root@VM-24-13-centos home]# wget https://dl.google.com/go/go1.20.4.linux-amd64.tar.gz</span><br><span class="line">[root@VM-24-13-centos home]# tar -zxvf go1.20.4.linux-amd64.tar.gz</span><br><span class="line">[root@VM-24-13-centos bin]# pwd</span><br><span class="line">/home/go/bin</span><br><span class="line">[root@VM-24-13-centos bin]# ./go version</span><br><span class="line">go version go1.20.4 linux/amd64</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>配置go的环境变量</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-24-13-centos bin]# vi /etc/profile </span><br><span class="line"></span><br><span class="line">export GOPATH=/home/go</span><br><span class="line">export PATH=$PATH:/usr/local/go/bin:$GOPATH/bin</span><br><span class="line"></span><br><span class="line"># 生效环境变量</span><br><span class="line">[root@VM-24-13-centos bin]# source profile</span><br><span class="line"></span><br><span class="line">[root@VM-24-13-centos etc]# go version</span><br><span class="line">go version go1.20.4 linux/amd64</span><br></pre></td></tr></table></figure>

<ul>
<li>服务器需要搭建好mysql环境，以及建好数据库，可以参考<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/e51a21388363">这篇文章</a>中的MySQL安装过程</li>
</ul>
<p><img src="/aposts/57a9c16f/image-20230731105226623.png" alt="image-20230731105226623"></p>
<ul>
<li>使用 Git 克隆你的 Gin 项目到服务器上，并设置go的代理</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-24-13-centos home]# git clone https://github.com/Louis-me/studyGin.git</span><br><span class="line"></span><br><span class="line">[root@VM-24-13-centos home]# cd studyGin/</span><br><span class="line">[root@VM-24-13-centos home]#go env -w GO111MODULE=on</span><br><span class="line">[root@VM-24-13-centos home]# go env -w GOPROXY=https://proxy.golang.com.cn,direct</span><br><span class="line"># 编译下载依赖文件</span><br><span class="line">[root@VM-24-13-centos studyGin]# go build</span><br><span class="line"># 启动项目</span><br><span class="line">[root@VM-24-13-centos studyGin]# ./myGin</span><br></pre></td></tr></table></figure>

<ul>
<li>注意gin的服务端口信息为8080，防火墙需要打开，若时云服务器那么规则端口也要打开</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=8080/tcp --permanent</span><br><span class="line">firewall-cmd --reload   # 配置立即生效</span><br><span class="line">firewall-cmd --zone=public --list-port # 查看防火墙所有开放的端口</span><br><span class="line"> firewall-cmd --state # 查看防火墙状态</span><br><span class="line">netstat -lnpt # 查看监听的端口</span><br><span class="line">netstat -lnpt |grep 8080 # 查看监听的具体端口</span><br></pre></td></tr></table></figure>

<ul>
<li>测试</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">data =&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;admin&quot;</span>, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;123456&quot;</span>&#125;</span><br><span class="line">resp = requests.post(<span class="string">&quot;http://182.XXX.XXX.XXX:8080/login&quot;</span>, data=data)</span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br><span class="line">dic = json.loads(resp.text)</span><br><span class="line">token = dic[<span class="string">&quot;data&quot;</span>][<span class="string">&quot;Token&quot;</span>]</span><br><span class="line">header = &#123;<span class="string">&quot;token&quot;</span>: token&#125;</span><br><span class="line">resp2 = requests.get(<span class="string">&quot;http://182.XXX.XXX.XXXX:8080/GetUserList&quot;</span>, headers=header)</span><br><span class="line"><span class="built_in">print</span>(resp2.text)</span><br></pre></td></tr></table></figure>

<ul>
<li>如果需要在后台运行项目，并且在关闭终端时项目依然保持运行状态，可以使用 <code>nohup</code> 命令：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-24-13-centos studyGin]# ./myGin</span><br><span class="line"></span><br><span class="line">[root@VM-24-13-centos studyGin]# nohup ./myGin &gt; gin.log &amp;</span><br><span class="line">[2] 16486</span><br><span class="line">[root@VM-24-13-centos studyGin]# nohup: 忽略输入重定向错误到标准输出端</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://louis-me.github.io/aposts/b06d40af/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="一个正经的测试工程师">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="施坤的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/aposts/b06d40af/" class="post-title-link" itemprop="url">go-zero入门实践三</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-07-30 11:23:15 / 修改时间：17:53:43" itemprop="dateCreated datePublished" datetime="2023-07-30T11:23:15+08:00">2023-07-30</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
                </span>
            </span>

          
            <span id="/aposts/b06d40af/" class="post-meta-item leancloud_visitors" data-flag-title="go-zero入门实践三" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/aposts/b06d40af/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/aposts/b06d40af/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><ul>
<li><a href="/aposts/93e757c2">入门实践一</a> 介绍了单体服务和微服务的简单实例，<a href="/aposts/f231d6a2">入门实践二</a> 介绍了单体服务结合mysql,redis,jwt等方便的知识</li>
<li>本篇主要介绍为微服务的具体使用场景</li>
</ul>
<h2 id="user-rpc"><a href="#user-rpc" class="headerlink" title="user rpc"></a>user rpc</h2><ul>
<li>把user&#x2F;rpc 目录内容清空</li>
<li><code>user/rpc/user.proto</code> 内容如下</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">syntax = &quot;proto3&quot;;</span><br><span class="line"></span><br><span class="line">package user;</span><br><span class="line"></span><br><span class="line">// protoc-gen-go 版本大于1.4.0, proto文件需要加上go_package,否则无法生成</span><br><span class="line">option go_package = &quot;./user&quot;;</span><br><span class="line"></span><br><span class="line">message IdRequest &#123;</span><br><span class="line">    int64 id = 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message UserResponse &#123;</span><br><span class="line">    // 用户id</span><br><span class="line">    int64 id = 1;</span><br><span class="line">    // 用户名称</span><br><span class="line">    string username = 2;</span><br><span class="line">    // 用户性别</span><br><span class="line">    string gender = 3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">service User &#123;</span><br><span class="line">    rpc getUser(IdRequest) returns(UserResponse);  //对外开发的接口</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>生成rpc目录和代码</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E:\proj\gowork\study-gozero-demo\mall\user\rpc&gt; goctl rpc protoc user.proto --go_out=. --go-grpc_out=. --zrpc_out=.</span><br></pre></td></tr></table></figure>

<ul>
<li>配置<code>user/rpc/internal/config/config.go</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">package config</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;github.com/zeromicro/go-zero/core/stores/cache&quot;</span><br><span class="line">	&quot;github.com/zeromicro/go-zero/zrpc&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">type Config struct &#123;</span><br><span class="line">	zrpc.RpcServerConf</span><br><span class="line"></span><br><span class="line">	// 添加mysql配置</span><br><span class="line">	Mysql struct &#123;</span><br><span class="line">		DataSource string</span><br><span class="line">	&#125;</span><br><span class="line">	CacheRedis cache.CacheConf</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>配置<code>/user/rpc/etc/user.yaml</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Name: user.rpc</span><br><span class="line">ListenOn: 0.0.0.0:8081</span><br><span class="line">Etcd:</span><br><span class="line">  Hosts:</span><br><span class="line">  - 127.0.0.1:2379</span><br><span class="line">  Key: user.rpc</span><br><span class="line"># 加入MySQL连接字符串  </span><br><span class="line">Mysql:</span><br><span class="line">  DataSource: root:123456@tcp(127.0.0.1:3306)/go_zero?charset=utf8mb4&amp;parseTime=true&amp;loc=Asia%2FShanghai</span><br><span class="line">CacheRedis:</span><br><span class="line">  - Host: 127.0.0.1:6379</span><br><span class="line">    Pass: &quot;&quot;</span><br><span class="line">    Type: node</span><br></pre></td></tr></table></figure>

<ul>
<li>添加资源依赖<code>/user/rpc/internal/svc/servicecontext.go</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">package svc</span><br><span class="line">import (</span><br><span class="line">	&quot;study-gozero-demo/mall/user/model&quot;</span><br><span class="line">	&quot;study-gozero-demo/mall/user/rpc/internal/config&quot;</span><br><span class="line">	&quot;github.com/zeromicro/go-zero/core/stores/sqlx&quot;</span><br><span class="line">)</span><br><span class="line">type ServiceContext struct &#123;</span><br><span class="line">	Config config.Config</span><br><span class="line">	// 引入model层的增删改查</span><br><span class="line">	UserModel model.UserModel</span><br><span class="line">&#125;</span><br><span class="line">func NewServiceContext(c config.Config) *ServiceContext &#123;</span><br><span class="line">	// 初始化mysql连接</span><br><span class="line">	conn := sqlx.NewMysql(c.Mysql.DataSource)</span><br><span class="line">	return &amp;ServiceContext&#123;</span><br><span class="line">		Config: c,</span><br><span class="line">		// 调用user/model层代码</span><br><span class="line">		UserModel: model.NewUserModel(conn, c.CacheRedis),</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>如上那些配置其实和api层的配置基本上一样，都是加入mysql,引用mode层的代码</p>
</blockquote>
<ul>
<li>添加rpc逻辑<code>user/rpc/internal/logic/getuserlogic.go</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">func (l *GetUserLogic) GetUser(in *user.IdRequest) (*user.UserResponse, error) &#123;</span><br><span class="line">	// todo: add your logic here and delete this line</span><br><span class="line">	one, err := l.svcCtx.UserModel.FindOne(l.ctx, in.Id)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		return nil, err</span><br><span class="line">	&#125;</span><br><span class="line">	return &amp;user.UserResponse&#123;</span><br><span class="line">		Id:       one.Id,</span><br><span class="line">		Username: one.Username.String,</span><br><span class="line">		Gender:   one.Gender.String,</span><br><span class="line">	&#125;, nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="order-api"><a href="#order-api" class="headerlink" title="order api"></a>order api</h2><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><ul>
<li>关于生成model代码，mysql等配置就省略了，和user api的配置一模一样，注意需要保留之前jwt配置</li>
<li>本地数据库需要加上order表，表中字段为：<code>id,productname,price,unit</code></li>
<li>编写<code>order/api/oder.api</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">type (</span><br><span class="line">	OrderReq &#123;</span><br><span class="line">		Id     int `json:&quot;id&quot;`</span><br><span class="line">		UserId int `json:&quot;userid&quot;`</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	OrderReply &#123;</span><br><span class="line">		Id          int    `json:&quot;id&quot;`</span><br><span class="line">		Productname string `json:&quot;productname&quot;`</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	OrderAddReq &#123;</span><br><span class="line">		Productname string `json:&quot;productname&quot;`</span><br><span class="line">		Price       string `json:&quot;price&quot;`</span><br><span class="line">		Unit        string `json:&quot;unit&quot;`</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	OrderAddRes &#123;</span><br><span class="line">		Code     int    `json:&quot;code&quot;`</span><br><span class="line">		Messsage string `json:&quot;message&quot;`</span><br><span class="line">	&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// 在哪个服务头上加这个验证，就是需要jwt鉴权</span><br><span class="line">@server(</span><br><span class="line">	jwt: Auth</span><br><span class="line">)</span><br><span class="line">service order &#123;</span><br><span class="line">	@handler orderAdd</span><br><span class="line">	post /api/order/OrderAdd (OrderAddReq) returns (OrderAddRes)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">service order &#123;</span><br><span class="line">	@handler getOrder</span><br><span class="line">	// get /api/order/get/:id (OrderReq) returns (OrderReply)</span><br><span class="line">	get /api/order/get (OrderReq) returns (OrderReply)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>添加UserRpc配置及yaml配置项，<code>order/api/internal/config/config.go</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">package config</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;github.com/zeromicro/go-zero/core/stores/cache&quot;</span><br><span class="line">	&quot;github.com/zeromicro/go-zero/rest&quot;</span><br><span class="line">	&quot;github.com/zeromicro/go-zero/zrpc&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">type Config struct &#123;</span><br><span class="line">	rest.RestConf</span><br><span class="line">	// 添加mysql配置</span><br><span class="line">	Mysql struct &#123;</span><br><span class="line">		DataSource string</span><br><span class="line">	&#125;</span><br><span class="line">	// 使用缓存</span><br><span class="line">	CacheRedis cache.CacheConf</span><br><span class="line">	Auth       struct &#123;</span><br><span class="line">		AccessSecret string</span><br><span class="line">		AccessExpire int64</span><br><span class="line">	&#125;</span><br><span class="line">	// 引用user rpc</span><br><span class="line">	UserRpc zrpc.RpcClientConf</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><code>order/api/etc/order.yaml</code> 加入user  rpc配置</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Name: order</span><br><span class="line">Host: 0.0.0.0</span><br><span class="line">Port: 8889</span><br><span class="line">Mysql:</span><br><span class="line">  DataSource: root:123456@tcp(127.0.0.1:3306)/go_zero?charset=utf8mb4&amp;parseTime=true&amp;loc=Asia%2FShanghai</span><br><span class="line">CacheRedis:</span><br><span class="line">  - Host: 127.0.0.1:6379</span><br><span class="line">    Pass: &quot;&quot;</span><br><span class="line">    Type: node</span><br><span class="line">Auth:</span><br><span class="line">  # 生成jwt token的密钥 一般格式为udid</span><br><span class="line">  AccessSecret: 0c891c78-9415-ec96-deb8-3b658f9e57f3</span><br><span class="line">  # jwt token有效期，单位：秒,现在设置的为1小时</span><br><span class="line">  AccessExpire: 3600</span><br><span class="line"># 加入user rpc</span><br><span class="line">UserRpc: </span><br><span class="line">  Etcd:</span><br><span class="line">    Hosts:</span><br><span class="line">    - 127.0.0.1:2379</span><br><span class="line">    Key: user.rpc</span><br></pre></td></tr></table></figure>

<ul>
<li><code>order/api/internal/svc/servicecontext.go</code>  添加依赖</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">package svc</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;study-gozero-demo/mall/order/api/internal/config&quot;</span><br><span class="line">	&quot;study-gozero-demo/mall/order/model&quot;</span><br><span class="line">	&quot;study-gozero-demo/mall/user/rpc/userclient&quot;</span><br><span class="line"></span><br><span class="line">	&quot;github.com/zeromicro/go-zero/core/stores/sqlx&quot;</span><br><span class="line">	&quot;github.com/zeromicro/go-zero/zrpc&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">type ServiceContext struct &#123;</span><br><span class="line">	Config config.Config</span><br><span class="line">	// 引入model层的增删改查</span><br><span class="line">	OrderModel model.OrderModel</span><br><span class="line">	// 引用最终生成user服务代码路径</span><br><span class="line">	UserRpc userclient.User</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func NewServiceContext(c config.Config) *ServiceContext &#123;</span><br><span class="line">	// 初始化mysql连接</span><br><span class="line">	conn := sqlx.NewMysql(c.Mysql.DataSource)</span><br><span class="line">	return &amp;ServiceContext&#123;</span><br><span class="line">		Config: c,</span><br><span class="line">		// 调用order/model层代码</span><br><span class="line">		OrderModel: model.NewOrderModel(conn, c.CacheRedis),</span><br><span class="line">		// 调用user rpc</span><br><span class="line">		UserRpc: userclient.NewUser(zrpc.MustNewClient(c.UserRpc)),</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="逻辑编写"><a href="#逻辑编写" class="headerlink" title="逻辑编写"></a>逻辑编写</h3><ul>
<li>编写<code>order\api\internal\logic\orderaddlogic.go</code> 业务代码</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">import (</span><br><span class="line">	&quot;context&quot;</span><br><span class="line">	&quot;errors&quot;</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line"></span><br><span class="line">	&quot;study-gozero-demo/mall/order/api/internal/svc&quot;</span><br><span class="line">	&quot;study-gozero-demo/mall/order/api/internal/types&quot;</span><br><span class="line">	&quot;study-gozero-demo/mall/order/model&quot;</span><br><span class="line"></span><br><span class="line">	&quot;github.com/jinzhu/copier&quot;</span><br><span class="line">	&quot;github.com/zeromicro/go-zero/core/logx&quot;</span><br><span class="line">)</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">func (l *OrderAddLogic) OrderAdd(req *types.OrderAddReq) (resp *types.OrderAddRes, err error) &#123;</span><br><span class="line">	// todo: add your logic here and delete this line</span><br><span class="line">	var addReq model.Order</span><br><span class="line">	errCopy := copier.Copy(&amp;addReq, req)</span><br><span class="line">	if errCopy != nil &#123;</span><br><span class="line">		return nil, errCopy</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	respd, err2 := l.svcCtx.OrderModel.Insert(l.ctx, &amp;addReq)</span><br><span class="line">	fmt.Println(&quot;------respd:&quot;, respd, &quot;error:&quot;, err2)</span><br><span class="line">	if err2 != nil &#123;</span><br><span class="line">		fmt.Println(&quot;insert into error:&quot;, err)</span><br><span class="line">		return nil, errors.New(err.Error())</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// 登录成功返回数据</span><br><span class="line">	return &amp;types.OrderAddRes&#123;</span><br><span class="line">		Code:     1,</span><br><span class="line">		Messsage: &quot;success&quot;,</span><br><span class="line">	&#125;, nil</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>编写<code>order\api\internal\logic\getorderlogic.go</code> 业务代码</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">import (</span><br><span class="line">	&quot;context&quot;</span><br><span class="line">	&quot;errors&quot;</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line"></span><br><span class="line">	&quot;study-gozero-demo/mall/order/api/internal/svc&quot;</span><br><span class="line">	&quot;study-gozero-demo/mall/order/api/internal/types&quot;</span><br><span class="line">	&quot;study-gozero-demo/mall/user/rpc/user&quot;</span><br><span class="line"></span><br><span class="line">	&quot;github.com/zeromicro/go-zero/core/logx&quot;</span><br><span class="line">)</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">func (l *GetOrderLogic) GetOrder(req *types.OrderReq) (resp *types.OrderReply, err error) &#123;</span><br><span class="line">	// todo: add your logic here and delete this line</span><br><span class="line"></span><br><span class="line">	// 使用user rpc</span><br><span class="line">	// 新增代码，注意这里的&amp;user，应用的是user rpc的user/user.pb.go中内容,IdRequest其实就是对应入参（user.proto定义的）</span><br><span class="line"></span><br><span class="line">	_, err = l.svcCtx.UserRpc.GetUser(l.ctx, &amp;user.IdRequest&#123;</span><br><span class="line">		Id: int64(req.UserId),</span><br><span class="line">	&#125;)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		return nil, errors.New(&quot;用户不存在&quot;)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	userInfo, err2 := l.svcCtx.OrderModel.FindOne(l.ctx, int64(req.Id))</span><br><span class="line">	fmt.Println(&quot;userInfo=&quot;, userInfo, &quot;error:&quot;, err2)</span><br><span class="line">	if userInfo == nil &#123;</span><br><span class="line">		fmt.Println(&quot;iiiiiiii&quot;)</span><br><span class="line">		return nil, errors.New(&quot;订单不存在&quot;)</span><br><span class="line">	&#125;</span><br><span class="line">	return &amp;types.OrderReply&#123;</span><br><span class="line">		Id:          req.Id,</span><br><span class="line">		ProductName: userInfo.Productname.String,</span><br><span class="line">	&#125;, nil</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="启动各个服务"><a href="#启动各个服务" class="headerlink" title="启动各个服务"></a>启动各个服务</h2><ul>
<li>启动user rpc，主要验证用户是否存在</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS E:\proj\gowork\study-gozero-demo\mall\user\rpc&gt; go run user.go</span><br><span class="line">Starting rpc server at 0.0.0.0:8080...</span><br></pre></td></tr></table></figure>

<ul>
<li>启动user api，用来登录返回token</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS E:\proj\gowork\study-gozero-demo\mall\user\api&gt; go run .\user.go</span><br><span class="line">Starting server at 0.0.0.0:8888.</span><br></pre></td></tr></table></figure>

<ul>
<li>启动order api，对外的接口</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PS E:\proj\gowork\study-gozero-demo\mall\order\api&gt; go run .\order.go</span><br><span class="line">Starting server at 0.0.0.0:8889...</span><br><span class="line">&#123;&quot;@timestamp&quot;:&quot;2023-07-30T16:03:50.226+08:00&quot;,&quot;cal</span><br></pre></td></tr></table></figure>

<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><ul>
<li>测试GetOrder的接口<ul>
<li>如果传递的userid错误，就返回用户不存在错误</li>
<li>如果传递的id错误，就返回的订单d不存在</li>
<li>如果userid和id正确，就返回订单的信息</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import json</span><br><span class="line"></span><br><span class="line">data2 = &#123;&quot;userid&quot;: 20, &quot;id&quot;: 1&#125;</span><br><span class="line">resp = requests.get(&quot;http://127.0.0.1:8889/api/order/get&quot;, json=data2)</span><br><span class="line">print(resp.text)</span><br><span class="line"></span><br><span class="line">&#123;&quot;id&quot;:1,&quot;productname&quot;:&quot;西瓜&quot;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>测试OrderAdd的接口<ul>
<li>如果不带正确token的头部，就返回401</li>
<li>如果传递带正确token的头部，就返回新增成功信息</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">data1 =&#123;&quot;productname&quot;:&quot;西瓜&quot;,&quot;price&quot;: &quot;122&quot;, &quot;unit&quot;: &quot;个&quot;&#125;</span><br><span class="line">resp = requests.post(&quot;http://127.0.0.1:8889/api/order/OrderAdd&quot;, json=data1)</span><br><span class="line">print(resp)</span><br><span class="line"></span><br><span class="line">&lt;Response [401]&gt;</span><br><span class="line"></span><br><span class="line">data =&#123;&quot;username&quot;: &quot;admin&quot;, &quot;password&quot;: &quot;123456&quot;&#125;</span><br><span class="line">resp = requests.post(&quot;http://127.0.0.1:8888/user/login&quot;, json=data)</span><br><span class="line">data = json.loads(resp.text)</span><br><span class="line">token = data[&quot;accessToken&quot;]</span><br><span class="line">header = &#123;&quot;Authorization&quot;: token&#125;</span><br><span class="line">data1 =&#123;&quot;productname&quot;:&quot;西瓜&quot;,&quot;price&quot;: &quot;122&quot;, &quot;unit&quot;: &quot;个&quot;&#125;</span><br><span class="line">resp = requests.post(&quot;http://127.0.0.1:8889/api/order/OrderAdd&quot;, headers=header,json=data1)</span><br><span class="line">print(resp.text)</span><br><span class="line"></span><br><span class="line">&#123;&quot;code&quot;:1,&quot;message&quot;:&quot;success&quot;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="自定义错误"><a href="#自定义错误" class="headerlink" title="自定义错误"></a>自定义错误</h2><h3 id="业务错误响应格式"><a href="#业务错误响应格式" class="headerlink" title="业务错误响应格式"></a>业务错误响应格式</h3><ul>
<li>业务处理正常</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;code&quot;: 0,</span><br><span class="line">  &quot;msg&quot;: &quot;successful&quot;,</span><br><span class="line">  &quot;data&quot;: &#123;</span><br><span class="line">    ....</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>业务处理异常</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;code&quot;: 10001,</span><br><span class="line">  &quot;msg&quot;: &quot;参数错误&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="user-api之login"><a href="#user-api之login" class="headerlink" title="user api之login"></a>user api之login</h4><ul>
<li>在之前，我们在登录逻辑中处理用户名不存在时，直接返回来一个error。我们来登录并传递一个不存在的用户名看看效果。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST \</span><br><span class="line">  http://127.0.0.1:8888/user/login \</span><br><span class="line">  -H &#x27;content-type: application/json&#x27; \</span><br><span class="line">  -d &#x27;&#123;</span><br><span class="line">    &quot;username&quot;:&quot;1&quot;,</span><br><span class="line">    &quot;password&quot;:&quot;123456&quot;</span><br><span class="line">&#125;&#x27;</span><br><span class="line"></span><br><span class="line">用户名不存在</span><br></pre></td></tr></table></figure>

<p>接下来我们将其以json格式进行返回</p>
<h3 id="自定义错误-1"><a href="#自定义错误-1" class="headerlink" title="自定义错误"></a>自定义错误</h3><ul>
<li>首先在common中添加一个baseerror.go文件，并填入代码</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir common</span><br><span class="line">cd common</span><br><span class="line">mkdir errorx&amp;&amp;cd errorx</span><br></pre></td></tr></table></figure>

<ul>
<li>编写自定义代码<code>mall\common\errorx\baseerror.go</code></li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> errorx</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> defaultCode = <span class="number">1001</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> CodeError <span class="keyword">struct</span> &#123;</span><br><span class="line">	Code <span class="type">int</span>    <span class="string">`json:&quot;code&quot;`</span></span><br><span class="line">	Msg  <span class="type">string</span> <span class="string">`json:&quot;msg&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> CodeErrorResponse <span class="keyword">struct</span> &#123;</span><br><span class="line">	Code <span class="type">int</span>    <span class="string">`json:&quot;code&quot;`</span></span><br><span class="line">	Msg  <span class="type">string</span> <span class="string">`json:&quot;msg&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewCodeError</span><span class="params">(code <span class="type">int</span>, msg <span class="type">string</span>)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;CodeError&#123;Code: code, Msg: msg&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewDefaultError</span><span class="params">(msg <span class="type">string</span>)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> NewCodeError(defaultCode, msg)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *CodeError)</span></span> Error() <span class="type">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> e.Msg</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *CodeError)</span></span> Data() *CodeErrorResponse &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;CodeErrorResponse&#123;</span><br><span class="line">		Code: e.Code,</span><br><span class="line">		Msg:  e.Msg,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>将登录逻辑中错误用CodeError自定义错误替换</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">func (l *LoginLogic) Login(req *types.LoginReq) (resp *types.LoginReply, err error) &#123;</span><br><span class="line">	// todo: add your logic here and delete this line</span><br><span class="line"></span><br><span class="line">	if len(strings.TrimSpace(req.Username)) == 0 || len(strings.TrimSpace(req.Password)) == 0 &#123;</span><br><span class="line">		// return nil, errors.New(&quot;参数错误&quot;)</span><br><span class="line">		return nil, errorx.NewDefaultError(&quot;参数错误&quot;)</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	userInfo, err := l.svcCtx.UserModel.FindOneByUsername(l.ctx, req.Username)</span><br><span class="line">	fmt.Println(&quot;userInfo=&quot;, userInfo, &quot;error:&quot;, err)</span><br><span class="line">	switch err &#123;</span><br><span class="line">	case nil:</span><br><span class="line">	case model.ErrNotFound:</span><br><span class="line">		// return nil, errors.New(&quot;用户名不存在&quot;)</span><br><span class="line">		return nil, errorx.NewDefaultError(&quot;用户名不存在&quot;)</span><br><span class="line"></span><br><span class="line">	default:</span><br><span class="line">		return nil, err</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(&quot;pwd:&quot;, userInfo.Password.String)</span><br><span class="line">	fmt.Println(&quot;pwd:&quot;, req.Password)</span><br><span class="line"></span><br><span class="line">	if userInfo.Password.String != req.Password &#123;</span><br><span class="line">		// return nil, errors.New(&quot;用户密码不正确&quot;)</span><br><span class="line">		return nil, errorx.NewDefaultError(&quot;用户密码不正确&quot;)</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// ---jwt-start---</span><br><span class="line"></span><br><span class="line">	now := time.Now().Unix()</span><br><span class="line">	accessExpire := l.svcCtx.Config.Auth.AccessExpire</span><br><span class="line">	jwtToken, err := l.getJwtToken(l.svcCtx.Config.Auth.AccessSecret, now, l.svcCtx.Config.Auth.AccessExpire, userInfo.Id)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		return nil, err</span><br><span class="line">	&#125;</span><br><span class="line">	// ---jwt-end---</span><br><span class="line"></span><br><span class="line">	// 登录成功返回数据</span><br><span class="line">	return &amp;types.LoginReply&#123;</span><br><span class="line">		Id:           userInfo.Id,</span><br><span class="line">		Username:     userInfo.Username.String,</span><br><span class="line">		AccessToken:  jwtToken,</span><br><span class="line">		AccessExpire: now + accessExpire,</span><br><span class="line">		RefreshAfter: now + accessExpire/2,</span><br><span class="line">	&#125;, nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>开启自定义错误，配置<code>user/api/user.go</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;flag&quot;</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	&quot;net/http&quot;</span><br><span class="line"></span><br><span class="line">	&quot;study-gozero-demo/mall/common/errorx&quot;</span><br><span class="line">	&quot;study-gozero-demo/mall/user/api/internal/config&quot;</span><br><span class="line">	&quot;study-gozero-demo/mall/user/api/internal/handler&quot;</span><br><span class="line">	&quot;study-gozero-demo/mall/user/api/internal/svc&quot;</span><br><span class="line"></span><br><span class="line">	&quot;github.com/zeromicro/go-zero/core/conf&quot;</span><br><span class="line">	&quot;github.com/zeromicro/go-zero/rest&quot;</span><br><span class="line">	&quot;github.com/zeromicro/go-zero/rest/httpx&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">var configFile = flag.String(&quot;f&quot;, &quot;etc/user-api.yaml&quot;, &quot;the config file&quot;)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	flag.Parse()</span><br><span class="line"></span><br><span class="line">	var c config.Config</span><br><span class="line">	conf.MustLoad(*configFile, &amp;c)</span><br><span class="line"></span><br><span class="line">	server := rest.MustNewServer(c.RestConf)</span><br><span class="line">	defer server.Stop()</span><br><span class="line"></span><br><span class="line">	ctx := svc.NewServiceContext(c)</span><br><span class="line">	handler.RegisterHandlers(server, ctx)</span><br><span class="line">	// 自定义错误</span><br><span class="line">	httpx.SetErrorHandler(func(err error) (int, interface&#123;&#125;) &#123;</span><br><span class="line">		switch e := err.(type) &#123;</span><br><span class="line">		case *errorx.CodeError:</span><br><span class="line">			return http.StatusOK, e.Data()</span><br><span class="line">		default:</span><br><span class="line">			return http.StatusInternalServerError, nil</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	fmt.Printf(&quot;Starting server at %s:%d...\n&quot;, c.Host, c.Port)</span><br><span class="line">	server.Start()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>重新运行<code>user\api\user.go</code></p>
</li>
<li><p>再次测试</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> curl -X POST   http://127.0.0.1:8888/user/login   -H &#x27;content-type: application/json&#x27;   -d &#x27;&#123;</span><br><span class="line">    &quot;username&quot;:&quot;1&quot;,</span><br><span class="line">    &quot;password&quot;:&quot;123456&quot;</span><br><span class="line">&#125;&#x27;</span><br><span class="line">&#123;&quot;code&quot;:1001,&quot;msg&quot;:&quot;用户名不存在&quot;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://louis-me.github.io/aposts/f231d6a2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="一个正经的测试工程师">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="施坤的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/aposts/f231d6a2/" class="post-title-link" itemprop="url">go-zero入门实践二</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-07-27 10:07:00" itemprop="dateCreated datePublished" datetime="2023-07-27T10:07:00+08:00">2023-07-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-07-29 20:58:48" itemprop="dateModified" datetime="2023-07-29T20:58:48+08:00">2023-07-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
                </span>
            </span>

          
            <span id="/aposts/f231d6a2/" class="post-meta-item leancloud_visitors" data-flag-title="go-zero入门实践二" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/aposts/f231d6a2/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/aposts/f231d6a2/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><ul>
<li>紧接<a href="/aposts/93e757c2">上篇文章</a></li>
<li>本篇文章开始接入mysql等具体的业务逻辑</li>
</ul>
<h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><ul>
<li>order 和 user 目录下分别新增model、api目录等</li>
</ul>
<p><img src="/aposts/f231d6a2/image-20230727101351298.png" alt="image-20230727101351298"></p>
<h2 id="单体服务"><a href="#单体服务" class="headerlink" title="单体服务"></a>单体服务</h2><ul>
<li>user为单体api服务，编写对外的增删改查接口</li>
<li><code>user/model</code>目录下的sql脚本，自动生成model代码</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `user` (</span><br><span class="line">	`id` INT(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">	`username` VARCHAR(50) NULL DEFAULT NULL COLLATE &#x27;utf8_general_ci&#x27;,</span><br><span class="line">	`password` TEXT NULL DEFAULT NULL COLLATE &#x27;utf8_general_ci&#x27;,</span><br><span class="line">	`gender` VARCHAR(50) NULL DEFAULT NULL COLLATE &#x27;utf8_general_ci&#x27;,</span><br><span class="line">	PRIMARY KEY (`id`) USING BTREE</span><br><span class="line">)</span><br><span class="line">COLLATE=&#x27;utf8_general_ci&#x27;</span><br><span class="line">ENGINE=InnoDB</span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<ul>
<li>执行命令生成user下的model代码</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E:\proj\gowork\study-gozero-demo\mall\user\model&gt; goctl model mysql ddl -src user.sql -dir . -c </span><br></pre></td></tr></table></figure>

<ul>
<li>在user&#x2F;model下面生成了对model中增删改查</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">E:\proj\gowork\study-gozero-demo\mall\user\model&gt;ls</span><br><span class="line">Mode                 LastWriteTime         Length Name</span><br><span class="line">----                 -------------         ------ ----</span><br><span class="line">-a----         2023/7/27     10:05            338 user.sql</span><br><span class="line">-a----         2023/7/27     10:35            623 usermodel.go</span><br><span class="line">-a----         2023/7/27     10:35           3995 usermodel_gen.go</span><br><span class="line">-a----         2023/7/27     10:35            106 vars.</span><br></pre></td></tr></table></figure>

<ul>
<li>发现<code>usermodel_gen.go</code> 中代码没有查询用户名和密码的函数，因此新增一个，同时新增一个查询所有用户的函数</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> (</span><br><span class="line">	userModel <span class="keyword">interface</span> &#123;</span><br><span class="line">		Insert(ctx context.Context, data *User) (sql.Result, <span class="type">error</span>)</span><br><span class="line">		FindOne(ctx context.Context, id <span class="type">int64</span>) (*User, <span class="type">error</span>)</span><br><span class="line">		<span class="comment">// 新增的查询用户名函数</span></span><br><span class="line">		FindOneByUsername(ctx context.Context, username <span class="type">string</span>) (*User, <span class="type">error</span>)</span><br><span class="line">        <span class="comment">// 查询所有的用户</span></span><br><span class="line">        FindAll(ctx context.Context, name <span class="type">string</span>) ([]*User, <span class="type">error</span>)</span><br><span class="line">		Update(ctx context.Context, data *User) <span class="type">error</span></span><br><span class="line">		Delete(ctx context.Context, id <span class="type">int64</span>) <span class="type">error</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	.....</span><br><span class="line"><span class="comment">// 查询用户名,若存在则返回user的数据</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *defaultUserModel)</span></span> FindOneByUsername(ctx context.Context, username <span class="type">string</span>) (*User, <span class="type">error</span>) &#123;</span><br><span class="line">	userUsernameKey := fmt.Sprintf(<span class="string">&quot;%s%v&quot;</span>, cacheUserIdPrefix, username)</span><br><span class="line">	<span class="keyword">var</span> resp User</span><br><span class="line">	err := m.QueryRowIndexCtx(ctx, &amp;resp, userUsernameKey, m.formatPrimary, <span class="function"><span class="keyword">func</span><span class="params">(ctx context.Context, conn sqlx.SqlConn, v <span class="keyword">interface</span>&#123;&#125;)</span></span> (i <span class="keyword">interface</span>&#123;&#125;, e <span class="type">error</span>) &#123;</span><br><span class="line">		query := fmt.Sprintf(<span class="string">&quot;select %s from %s where `username` = ? limit 1&quot;</span>, userRows, m.table)</span><br><span class="line">		<span class="keyword">if</span> err := conn.QueryRowCtx(ctx, &amp;resp, query, username); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> resp.Id, <span class="literal">nil</span></span><br><span class="line">	&#125;, m.queryPrimary)</span><br><span class="line">	<span class="keyword">switch</span> err &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="literal">nil</span>:</span><br><span class="line">		<span class="keyword">return</span> &amp;resp, <span class="literal">nil</span></span><br><span class="line">	<span class="keyword">case</span> sqlc.ErrNotFound:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, ErrNotFound</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *defaultUserModel)</span></span> FindAll(ctx context.Context, username <span class="type">string</span>) ([]*User, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">var</span> resp []*User</span><br><span class="line">	<span class="keyword">var</span> query <span class="type">string</span></span><br><span class="line">	<span class="keyword">var</span> err <span class="type">error</span></span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(strings.TrimSpace(username)) &gt; <span class="number">0</span> &#123;</span><br><span class="line">		query = fmt.Sprintf(<span class="string">&quot;select %s from %s where `username` = ?&quot;</span>, userRows, m.table)</span><br><span class="line">		err = m.QueryRowsNoCacheCtx(ctx, &amp;resp, query, username)</span><br><span class="line"></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		query = fmt.Sprintf(<span class="string">&quot;select %s from %s&quot;</span>, userRows, m.table)</span><br><span class="line">		err = m.QueryRowsNoCacheCtx(ctx, &amp;resp, query)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// fmt.Println(&quot;query=&quot;, query)</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;query=&quot;</span>, query, <span class="string">&quot;error:&quot;</span>, err)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">switch</span> err &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="literal">nil</span>:</span><br><span class="line">		<span class="keyword">return</span> resp, <span class="literal">nil</span></span><br><span class="line">	<span class="keyword">case</span> sqlc.ErrNotFound:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, ErrNotFound</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>需要注意的是，<code>moder_gen.go</code> 文件是由 <code>goctl</code> 工具自动生成的，每次执行 <code>goctl</code> 命令时都会重新生成该文件。因此，在修改表结构或需要重新生成代码时，应该先备份自定义的代码，并注意保留所需的代码或修改</p>
</blockquote>
<ul>
<li>修改<code>user/api/user.api </code>内容</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">type (</span><br><span class="line">	User &#123;</span><br><span class="line">		Id       int64  `json:&quot;id&quot;`</span><br><span class="line">		Username string `json:&quot;username&quot;`</span><br><span class="line">		Gender   string `json:&quot;gender&quot;`</span><br><span class="line">		Password string `json:&quot;password&quot;`</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	LoginReq &#123;</span><br><span class="line">		Username string `json:&quot;username&quot;`</span><br><span class="line">		Password string `json:&quot;password&quot;`</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	LoginReply &#123;</span><br><span class="line">		Id       int64  `json:&quot;id&quot;`</span><br><span class="line">		Username string `json:&quot;username&quot;`</span><br><span class="line">		Gender       string `json:&quot;gender&quot;`</span><br><span class="line">		// 下面三个为jwt鉴权需要用到</span><br><span class="line">		AccessToken  string `json:&quot;accessToken&quot;`</span><br><span class="line">		AccessExpire int64  `json:&quot;accessExpire&quot;`</span><br><span class="line">		RefreshAfter int64  `json:&quot;refreshAfter&quot;`</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	UserAddReq &#123;</span><br><span class="line">		Username string `json:&quot;username&quot;`</span><br><span class="line">		Password string `json:&quot;password&quot;`</span><br><span class="line">		Gender   string `json:&quot;gender&quot;`</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	UserAddRes &#123;</span><br><span class="line">		Id   int64  `json:&quot;id&quot;`</span><br><span class="line">		Name string `json:&quot;name&quot;`</span><br><span class="line">	&#125;</span><br><span class="line">	UserDelReq &#123;</span><br><span class="line">		Id int64 `json:&quot;id&quot;`</span><br><span class="line">	&#125;</span><br><span class="line">	UserDelRes &#123;</span><br><span class="line">		Id       int64  `json:&quot;id&quot;`</span><br><span class="line">		Username string `json:&quot;username&quot;`</span><br><span class="line">	&#125;</span><br><span class="line">	UserEditReq &#123;</span><br><span class="line">		Id       int64  `json:&quot;id&quot;`</span><br><span class="line">		Username string `json:&quot;username&quot;`</span><br><span class="line">		Password string `json:&quot;password&quot;`</span><br><span class="line">		Gender   string `json:&quot;gender&quot;`</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	UserEditRes &#123;</span><br><span class="line">		Id       int64  `json:&quot;id&quot;`</span><br><span class="line">		Username string `json:&quot;username&quot;`</span><br><span class="line">	&#125;</span><br><span class="line">	UserQueryReq &#123;</span><br><span class="line">		Username string `json:&quot;username&quot;`</span><br><span class="line">	&#125;</span><br><span class="line">	UserQueryRes &#123;</span><br><span class="line">		UserList []*User `json:&quot;products&quot;`</span><br><span class="line">	&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">service user-api &#123;</span><br><span class="line">	@handler login</span><br><span class="line">	post /user/login (LoginReq) returns (LoginReply)</span><br><span class="line">	@handler UserAdd</span><br><span class="line">	post /user/UserAdd (UserAddReq) returns (UserAddRes)</span><br><span class="line">	@handler UserDel</span><br><span class="line">	post /user/UserDel (UserDelReq) returns (UserDelRes)</span><br><span class="line">	@handler UserQuery</span><br><span class="line">	get /user/UserQuery (UserQueryReq) returns (UserQueryRes)</span><br><span class="line">	@handler UserEdit</span><br><span class="line">	post /user/UserEdit (UserEditReq) returns (UserEditRes)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>生成api服务</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E:\proj\gowork\study-gozero-demo\mall\user\api&gt; goctl api go -api user.api -dir . </span><br></pre></td></tr></table></figure>

<h3 id="编写业务代码"><a href="#编写业务代码" class="headerlink" title="编写业务代码"></a>编写业务代码</h3><ul>
<li>目录<code>E:\proj\gowork\study-gozero-demo\mall\user\api\internal\config\config.go</code>对添加mysql配置</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">package config</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;github.com/zeromicro/go-zero/core/stores/cache&quot;</span><br><span class="line">	&quot;github.com/zeromicro/go-zero/rest&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">type Config struct &#123;</span><br><span class="line">	rest.RestConf</span><br><span class="line">	// 添加mysql配置</span><br><span class="line">	Mysql struct &#123;</span><br><span class="line">		DataSource string</span><br><span class="line">	&#125;</span><br><span class="line">	// 使用缓存</span><br><span class="line">	CacheRedis cache.CacheConf</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>修改<code>E\proj\gowork\study-gozero-demo\mall\user\api\etc\user-api.yaml</code>配置文件</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Name: user-api</span><br><span class="line">Host: 0.0.0.0</span><br><span class="line">Port: 8888</span><br><span class="line">Mysql:</span><br><span class="line">  DataSource: root:123456@tcp(127.0.0.1:3306)/go_zero?charset=utf8mb4&amp;parseTime=true&amp;loc=Asia%2FShanghai</span><br><span class="line">CacheRedis:</span><br><span class="line">  - Host: 127.0.0.1:6379</span><br><span class="line">    Pass: &quot;&quot;</span><br><span class="line">    Type: node</span><br></pre></td></tr></table></figure>

<blockquote>
<p>本地环境你需要搭建好mysql和redis的环境</p>
</blockquote>
<ul>
<li>完善依赖服务<code>user/api/internal/svc/servicecontext.go</code></li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> svc</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;study-gozero-demo/mall/user/api/internal/config&quot;</span></span><br><span class="line">	<span class="string">&quot;study-gozero-demo/mall/user/model&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/zeromicro/go-zero/core/stores/sqlx&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ServiceContext <span class="keyword">struct</span> &#123;</span><br><span class="line">	Config config.Config</span><br><span class="line">	<span class="comment">// 引入model层的增删改查</span></span><br><span class="line">	UserModel model.UserModel</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewServiceContext</span><span class="params">(c config.Config)</span></span> *ServiceContext &#123;</span><br><span class="line">	<span class="comment">// 初始化mysql连接</span></span><br><span class="line">	conn := sqlx.NewMysql(c.Mysql.DataSource)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> &amp;ServiceContext&#123;</span><br><span class="line">		Config: c,</span><br><span class="line">		<span class="comment">// 调用user/model层代码</span></span><br><span class="line">		UserModel: model.NewUserModel(conn, c.CacheRedis),</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>编写<code>user/api/internal/logic </code>目录下的各接口信息</li>
</ul>
<h4 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//loginlogic.go</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *LoginLogic)</span></span> Login(req *types.LoginReq) (resp *types.LoginReply, err <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="comment">// todo: add your logic here and delete this line</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(strings.TrimSpace(req.Username)) == <span class="number">0</span> || <span class="built_in">len</span>(strings.TrimSpace(req.Password)) == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, errors.New(<span class="string">&quot;参数错误&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	userInfo, err := l.svcCtx.UserModel.FindOneByUsername(l.ctx, req.Username)</span><br><span class="line">	<span class="keyword">switch</span> err &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="literal">nil</span>:</span><br><span class="line">	<span class="keyword">case</span> model.ErrNotFound:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, errors.New(<span class="string">&quot;用户名不存在&quot;</span>)</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> userInfo.Pwd != req.Password &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, errors.New(<span class="string">&quot;用户密码不正确&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 登录成功返回数据</span></span><br><span class="line">	<span class="keyword">return</span> &amp;types.LoginReply&#123;</span><br><span class="line">		Id:       userInfo.Id,</span><br><span class="line">		Username: userInfo.Username,</span><br><span class="line">	&#125;, <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="新增用户"><a href="#新增用户" class="headerlink" title="新增用户"></a>新增用户</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// useraddlogic.go</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *UserAddLogic)</span></span> UserAdd(req *types.UserAddReq) (resp *types.UserAddRes, err <span class="type">error</span>) </span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(strings.TrimSpace(req.Username)) == <span class="number">0</span> || <span class="built_in">len</span>(strings.TrimSpace(req.Password)) == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, errors.New(<span class="string">&quot;参数错误&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	userInfo, err1 := l.svcCtx.UserModel.FindOneByUsername(l.ctx, req.Username)</span><br><span class="line">	fmt.Println(<span class="string">&quot;user_info&quot;</span>, userInfo)</span><br><span class="line">	<span class="comment">// 如果查到已存在用户名，则不能新增</span></span><br><span class="line">	<span class="keyword">if</span> err1 == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, errors.New(req.Username + <span class="string">&quot;用户已经存在&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 组装结构体</span></span><br><span class="line">	<span class="keyword">var</span> addReq model.User</span><br><span class="line">	errCopy := copier.Copy(&amp;addReq, req)</span><br><span class="line">	<span class="keyword">if</span> errCopy != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, errCopy</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	respd, err2 := l.svcCtx.UserModel.Insert(l.ctx, &amp;addReq)</span><br><span class="line">	fmt.Println(<span class="string">&quot;------respd:&quot;</span>, respd, <span class="string">&quot;error:&quot;</span>, err2)</span><br><span class="line">	<span class="keyword">if</span> err2 != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;insert into error:&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, errors.New(err.Error())</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 登录成功返回数据</span></span><br><span class="line">	<span class="keyword">return</span> &amp;types.UserAddRes&#123;</span><br><span class="line">		Name: req.Username,</span><br><span class="line">	&#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="编辑"><a href="#编辑" class="headerlink" title="编辑"></a>编辑</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// usereditlogic.go</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *UserEditLogic)</span></span> UserEdit(req *types.UserEditReq) (resp *types.UserEditRes, err <span class="type">error</span>) &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(strings.TrimSpace(req.Username)) == <span class="number">0</span> || <span class="built_in">len</span>(strings.TrimSpace(req.Password)) == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, errors.New(<span class="string">&quot;参数错误&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> strings.TrimSpace(req.Username) == <span class="string">&quot;admin&quot;</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, errors.New(<span class="string">&quot;此用户不许修改&quot;</span>)</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	userInfo, _ := l.svcCtx.UserModel.FindOne(l.ctx, req.Id)</span><br><span class="line">	<span class="keyword">if</span> userInfo == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, errors.New(<span class="string">&quot;用户不存在&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 组装结构体</span></span><br><span class="line">	<span class="keyword">var</span> editReq model.User</span><br><span class="line">	errCopy := copier.Copy(&amp;editReq, req)</span><br><span class="line">	<span class="keyword">if</span> errCopy != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, errCopy</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	err2 := l.svcCtx.UserModel.Update(l.ctx, &amp;editReq)</span><br><span class="line">	<span class="keyword">if</span> err2 != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;update  error:&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, errors.New(<span class="string">&quot;更新错误&quot;</span>)</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 返回数据</span></span><br><span class="line">	<span class="keyword">return</span> &amp;types.UserEditRes&#123;</span><br><span class="line">		Username: req.Username,</span><br><span class="line">		Id:       req.Id,</span><br><span class="line">	&#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>删除</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// userdellogic.go</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *UserDelLogic)</span></span> UserDel(req *types.UserDelReq) (resp *types.UserDelRes, err <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="comment">// todo: add your logic here and delete this line</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> req.Id == <span class="number">23</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, errors.New(<span class="string">&quot;此用户不可删除&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	userInfo, _ := l.svcCtx.UserModel.FindOne(l.ctx, req.Id)</span><br><span class="line">	<span class="keyword">if</span> userInfo == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, errors.New(<span class="string">&quot;用户不存在&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	err2 := l.svcCtx.UserModel.Delete(l.ctx, req.Id)</span><br><span class="line">	<span class="keyword">if</span> err2 != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;del  error:&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, errors.New(<span class="string">&quot;删除错误&quot;</span>)</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 返回数据</span></span><br><span class="line">	<span class="keyword">return</span> &amp;types.UserDelRes&#123;</span><br><span class="line">		Username: userInfo.Username.String,</span><br><span class="line">		Id:       userInfo.Id,</span><br><span class="line">	&#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>查询</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *UserQueryLogic)</span></span> UserQuery(req *types.UserQueryReq) (resp *types.UserQueryRes, err <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="comment">// todo: add your logic here and delete this line</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">&quot;username&quot;</span>, req.Username)</span><br><span class="line">	res1, err := l.svcCtx.UserModel.FindAll(l.ctx, req.Username)</span><br><span class="line">	fmt.Println(<span class="string">&quot;res1:&quot;</span>, res1, <span class="string">&quot;err:&quot;</span>, err)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, errors.New(<span class="string">&quot;查询错误&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">var</span> resList []*types.User</span><br><span class="line">	<span class="keyword">for</span> _, u := <span class="keyword">range</span> res1 &#123;</span><br><span class="line">		<span class="keyword">var</span> resVo types.User</span><br><span class="line">		_ = copier.Copy(&amp;resVo, u)</span><br><span class="line">		resList = <span class="built_in">append</span>(resList, &amp;resVo)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> &amp;types.UserQueryRes&#123;UserList: resList&#125;, <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="接口测试"><a href="#接口测试" class="headerlink" title="接口测试"></a>接口测试</h3><ul>
<li>本地数据库中的user表，需要有如下密码</li>
</ul>
<p><img src="/aposts/f231d6a2/image-20230727151305396.png" alt="image-20230727151305396"></p>
<ul>
<li>启动user&#x2F;api的服务</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E:\proj\gowork\study-gozero-demo\mall\user\api&gt; go run .\user.go</span><br></pre></td></tr></table></figure>

<ul>
<li>python客户端进行测试</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">data =&#123;&quot;username&quot;: &quot;admin&quot;, &quot;password&quot;: &quot;123456&quot;&#125;</span><br><span class="line">resp = requests.post(&quot;http://127.0.0.1:8888/user/login&quot;, json=data)</span><br><span class="line">print(resp.text)</span><br><span class="line"></span><br><span class="line">data =&#123;&quot;username&quot;: &quot;admin1&quot;, &quot;password&quot;: &quot;1234561&quot;, &quot;gender&quot;: &quot;男&quot;&#125;</span><br><span class="line">resp = requests.post(&quot;http://127.0.0.1:8888/user/UserAdd&quot;, json=data)</span><br><span class="line">print(resp.text)</span><br><span class="line"></span><br><span class="line">data =&#123;&quot;username&quot;: &quot;admin551&quot;, &quot;password&quot;: &quot;12345776&quot;, &quot;gender&quot;: &quot;男1&quot;, &quot;id&quot;: 24&#125;</span><br><span class="line">resp = requests.post(&quot;http://127.0.0.1:8888/user/UserEdit&quot;, json=data)</span><br><span class="line">print(resp.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data =&#123;&quot;username&quot;: &quot;&quot;&#125;</span><br><span class="line">resp = requests.get(&quot;http://127.0.0.1:8888/user/UserQuery&quot;, json=data)</span><br><span class="line">print(resp.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data =&#123;&quot;id&quot;: 23&#125;</span><br><span class="line">resp = requests.post(&quot;http://127.0.0.1:8888/user/UserDel&quot;, json=data)</span><br><span class="line">print(resp.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="业务鉴权jwt"><a href="#业务鉴权jwt" class="headerlink" title="业务鉴权jwt"></a>业务鉴权jwt</h3><ul>
<li>jwt鉴权一般在api层使用，我们这次演示工程中分别在user api登录时生成jwt token，在order api查模拟新增时验证用户jwt token。</li>
</ul>
<h4 id="user-api"><a href="#user-api" class="headerlink" title="user api"></a>user api</h4><ul>
<li>配置<code>mall/user/api/internal/config/config.go</code></li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> config</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/zeromicro/go-zero/core/stores/cache&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/zeromicro/go-zero/rest&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Config <span class="keyword">struct</span> &#123;</span><br><span class="line">	rest.RestConf</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 添加mysql配置</span></span><br><span class="line">	Mysql <span class="keyword">struct</span> &#123;</span><br><span class="line">		DataSource <span class="type">string</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 使用缓存</span></span><br><span class="line">	CacheRedis cache.CacheConf</span><br><span class="line">	<span class="comment">// jwt的配置字段</span></span><br><span class="line">	Auth <span class="keyword">struct</span> &#123;</span><br><span class="line">        AccessSecret <span class="type">string</span></span><br><span class="line">        AccessExpire <span class="type">int64</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>配置<code>/order/api/etc/api.yaml</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Name: user-api</span><br><span class="line">Host: 0.0.0.0</span><br><span class="line">Port: 8888</span><br><span class="line">Mysql:</span><br><span class="line">  DataSource: root:123456@tcp(127.0.0.1:3306)/go_zero?charset=utf8mb4&amp;parseTime=true&amp;loc=Asia%2FShanghai</span><br><span class="line">CacheRedis:</span><br><span class="line">  - Host: 127.0.0.1:6379</span><br><span class="line">    Pass: &quot;&quot;</span><br><span class="line">    Type: node</span><br><span class="line">Auth:</span><br><span class="line">  # 生成jwt token的密钥 一般格式为udid</span><br><span class="line">  AccessSecret: 0c891c78-9415-ec96-deb8-3b658f9e57f3</span><br><span class="line">  # jwt token有效期，单位：秒,现在设置的为1小时</span><br><span class="line">  AccessExpire: 3600</span><br></pre></td></tr></table></figure>

<ul>
<li>在user&#x2F;api&#x2F;internal&#x2F;logic&#x2F;loginlogic.go 中加上生成jwt内容的代码，并且在登录返回的数据返回jwt内容</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">func (l *LoginLogic) getJwtToken(secretKey string, iat, seconds, userId int64) (string, error) &#123;</span><br><span class="line">	claims := make(jwt.MapClaims)</span><br><span class="line">	claims[&quot;exp&quot;] = iat + seconds</span><br><span class="line">	claims[&quot;iat&quot;] = iat</span><br><span class="line">	claims[&quot;userId&quot;] = userId</span><br><span class="line">	token := jwt.New(jwt.SigningMethodHS256)</span><br><span class="line">	token.Claims = claims</span><br><span class="line">	return token.SignedString([]byte(secretKey))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (l *LoginLogic) Login(req *types.LoginReq) (resp *types.LoginReply, err error) &#123;</span><br><span class="line">	if len(strings.TrimSpace(req.Username)) == 0 || len(strings.TrimSpace(req.Password)) == 0 &#123;</span><br><span class="line">		return nil, errors.New(&quot;参数错误&quot;)</span><br><span class="line">	&#125;</span><br><span class="line">	userInfo, err := l.svcCtx.UserModel.FindOneByUsername(l.ctx, req.Username)</span><br><span class="line">	switch err &#123;</span><br><span class="line">	case nil:</span><br><span class="line">	case model.ErrNotFound:</span><br><span class="line">		return nil, errors.New(&quot;用户名不存在&quot;)</span><br><span class="line">	default:</span><br><span class="line">		return nil, err</span><br><span class="line">	&#125;</span><br><span class="line">	if userInfo.Password.String != req.Password &#123;</span><br><span class="line">		return nil, errors.New(&quot;用户密码不正确&quot;)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// ---jwt-start---</span><br><span class="line">	now := time.Now().Unix()</span><br><span class="line">	accessExpire := l.svcCtx.Config.Auth.AccessExpire</span><br><span class="line">	jwtToken, err := l.getJwtToken(l.svcCtx.Config.Auth.AccessSecret, now, l.svcCtx.Config.Auth.AccessExpire, userInfo.Id)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		return nil, err</span><br><span class="line">	&#125;</span><br><span class="line">	// ---jwt-end---</span><br><span class="line"></span><br><span class="line">	// 登录成功返回数据</span><br><span class="line">	return &amp;types.LoginReply&#123;</span><br><span class="line">		Id:           userInfo.Id,</span><br><span class="line">		Username:     userInfo.Username.String,</span><br><span class="line">		AccessToken:  jwtToken,</span><br><span class="line">		AccessExpire: now + accessExpire,</span><br><span class="line">		RefreshAfter: now + accessExpire/2,</span><br><span class="line">	&#125;, nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="order-api"><a href="#order-api" class="headerlink" title="order api"></a>order api</h4><ul>
<li><p>使用jwt鉴权校验</p>
</li>
<li><p>我们把之前的<code>order/api</code>目录内容清空</p>
</li>
<li><p>编写<code>mall/order/api/order.api</code></p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">type (</span><br><span class="line">	OrderReq &#123;</span><br><span class="line">		Id string `path:&quot;id&quot;`</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	OrderReply &#123;</span><br><span class="line">		Id          string `json:&quot;id&quot;`</span><br><span class="line">		ProductName string `json:&quot;productname&quot;`</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	OrderAddReq &#123;</span><br><span class="line">		ProductName string `json:&quot;productname&quot;`</span><br><span class="line">		Price       string `json:&quot;price&quot;`</span><br><span class="line">		Unit        string `json:&quot;unit&quot;`</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	OrderAddRes &#123;</span><br><span class="line">		Code     int    `json:&quot;code&quot;`</span><br><span class="line">		Messsage string `json:&quot;message&quot;`</span><br><span class="line">	&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// 在哪个服务头上加这个验证，就是需要jwt鉴权</span><br><span class="line">@server(</span><br><span class="line">	jwt: Auth</span><br><span class="line">)</span><br><span class="line">service order &#123;</span><br><span class="line">	@handler orderAdd</span><br><span class="line">	post /api/order/OrderAdd (OrderAddReq) returns (OrderAddRes)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">service order &#123;</span><br><span class="line">	@handler getOrder</span><br><span class="line">	get /api/order/get/:id (OrderReq) returns (OrderReply)</span><br><span class="line">&#125;</span><br><span class="line">// 在哪个服务头上加这个验证，就是需要jwt鉴权</span><br><span class="line">@server(</span><br><span class="line">	jwt: Auth</span><br><span class="line">)</span><br><span class="line">service order &#123;</span><br><span class="line">	@handler orderAdd</span><br><span class="line">	post /api/order/OrderAdd (OrderAddReq) returns (OrderAddRes)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">service order &#123;</span><br><span class="line">	@handler getOrder</span><br><span class="line">	get /api/order/get/:id (OrderReq) returns (OrderReply)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>生成order.api代码</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS E:\proj\gowork\study-gozero-demo\mall\order\api&gt;  goctl api go -api order.api -dir . </span><br></pre></td></tr></table></figure>

<ul>
<li>分别编写<code>mall\order\api\internal\logic</code> 下的测试代码</li>
</ul>
<p><code>getorderlogic.go</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">func (l *GetOrderLogic) GetOrder(req *types.OrderReq) (resp *types.OrderReply, err error) &#123;</span><br><span class="line">	fmt.Println(&quot;id=&quot;, req.Id)</span><br><span class="line"></span><br><span class="line">	return &amp;types.OrderReply&#123;</span><br><span class="line">		Id:          req.Id,</span><br><span class="line">		ProductName: &quot;test order&quot;,</span><br><span class="line">	&#125;, nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>orderaddlogic.go</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">func (l *OrderAddLogic) OrderAdd(req *types.OrderAddReq) (resp *types.OrderAddRes, err error) &#123;</span><br><span class="line">	fmt.Println(&quot;req=&quot;, req)</span><br><span class="line">	return &amp;types.OrderAddRes&#123;</span><br><span class="line">		Code:     1,</span><br><span class="line">		Messsage: &quot;success&quot;,</span><br><span class="line">	&#125;, nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>order/api/etc/order.yaml </code>端口修改和加上jwt的token</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Name: order</span><br><span class="line">Host: 0.0.0.0</span><br><span class="line">Port: 8889</span><br><span class="line">Auth:</span><br><span class="line">  # 生成jwt token的密钥 一般格式为udid</span><br><span class="line">  AccessSecret: 0c891c78-9415-ec96-deb8-3b658f9e57f3</span><br><span class="line">  # jwt token有效期，单位：秒,现在设置的为1小时</span><br><span class="line">  AccessExpire: 3600</span><br></pre></td></tr></table></figure>

<ul>
<li>分别启动<code>order/api/order.go</code> 和<code>user/api/user.go</code></li>
</ul>
<h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">resp = requests.get(&quot;http://127.0.0.1:8889/api/order/get/2&quot;)</span><br><span class="line">print(resp.text)</span><br><span class="line"></span><br><span class="line">data =&#123;&quot;productname&quot;: &quot;西瓜&quot;, &quot;price&quot;: &quot;122&quot;, &quot;unit&quot;: &quot;个&quot;&#125;</span><br><span class="line">resp = requests.post(&quot;http://127.0.0.1:8889/api/order/OrderAdd&quot;, json=data)</span><br><span class="line">print(resp)</span><br><span class="line"></span><br><span class="line">&#123;&quot;id&quot;:&quot;2&quot;,&quot;productname&quot;:&quot;test order&quot;&#125;</span><br><span class="line">&lt;Response [401]&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>发现OrderAdd 直接返回401</p>
</li>
<li><p>我们把token加到头部</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">data =&#123;&quot;username&quot;: &quot;admin&quot;, &quot;password&quot;: &quot;123456&quot;&#125;</span><br><span class="line">resp = requests.post(&quot;http://127.0.0.1:8888/user/login&quot;, json=data)</span><br><span class="line">data = json.loads(resp.text)</span><br><span class="line">token = data[&quot;accessToken&quot;]</span><br><span class="line">resp = requests.post(&quot;http://127.0.0.1:8889/api/order/OrderAdd&quot;, headers=header, json=data1)</span><br><span class="line">print(resp.text)</span><br><span class="line"></span><br><span class="line">&#123;&quot;code&quot;:1,&quot;message&quot;:&quot;success&quot;&#125;</span><br></pre></td></tr></table></figure>



<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li>本次主要用单机服务实现了user api层结合mysql的增删改查，同时在order层加上了jwt的校验</li>
<li>由于登录的数据缓存到了redis中，进行修改和删除时，可能出现删除不掉，因此可以在redis中删除可以</li>
<li>下篇文章将使用为微服务,mysql,jwt等结合起来</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://louis-me.github.io/aposts/93e757c2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="一个正经的测试工程师">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="施坤的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/aposts/93e757c2/" class="post-title-link" itemprop="url">go-zero入门实践</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-07-26 10:44:13 / 修改时间：17:36:33" itemprop="dateCreated datePublished" datetime="2023-07-26T10:44:13+08:00">2023-07-26</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
                </span>
            </span>

          
            <span id="/aposts/93e757c2/" class="post-meta-item leancloud_visitors" data-flag-title="go-zero入门实践" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/aposts/93e757c2/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/aposts/93e757c2/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>本次教程主要来自于<a target="_blank" rel="noopener" href="https://www.w3cschool.cn/gozero/">这里</a></p>
<h2 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h2><ul>
<li>安装依赖goctl，用命令进行安装：<code>go install github.com/zeromicro/go-zero/tools/goctl@latest</code><ul>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/kevinwan/p/16325802.html">微服务效率工具 goctl 深度解析</a></li>
</ul>
</li>
<li>安装成功后，输入<code>go env</code> 找到<code>GOPATH</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">E:\proj\gowork\studyGoZero&gt;go env</span><br><span class="line">set GO111MODULE=on</span><br><span class="line">set GOPATH=C:\Users\Administrator\go</span><br><span class="line">set GOROOT=E:\app\Go</span><br><span class="line">....</span><br></pre></td></tr></table></figure>

<ul>
<li>把<code>C:\Users\Administrator\go\bin\goctl.exe</code> 拷贝到GOROOT\bin目录下</li>
<li>查看版本成功</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">E:\proj\gowork&gt; goctl --version</span><br><span class="line">goctl version 1.5.4 windows/amd64</span><br></pre></td></tr></table></figure>

<ul>
<li>安装<code>protoc</code> ，查看他的<a target="_blank" rel="noopener" href="https://go-zero.dev/docs/tasks/installation/protoc">作用</a></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">goctl env check --install --verbose --force</span><br></pre></td></tr></table></figure>

<ul>
<li>安装<code>protoc</code> 成功后，把<code>C:\Users\Administrator\go\bin\</code> 的相关文件拷贝到<code>GOROOT\bin</code></li>
</ul>
<h2 id="go-zero单体服务"><a href="#go-zero单体服务" class="headerlink" title="go-zero单体服务"></a>go-zero单体服务</h2><ul>
<li>创建并初始化项目，生成greet服务为api层（对外接口）</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">E:\proj\gowork&gt;mkdir go-zero-demo</span><br><span class="line">E:\proj\gowork&gt;cd go-zero-demo</span><br><span class="line">E:\proj\gowork\go-zero-demo&gt;go mod init go-zero-demo</span><br><span class="line">go: creating new go.mod: module go-zero-demo</span><br><span class="line">E:\proj\gowork\go-zero-demo&gt;goctl api new greet</span><br><span class="line">Done.</span><br><span class="line">E:\proj\gowork\go-zero-demo&gt;go mod tidy</span><br></pre></td></tr></table></figure>

<ul>
<li>查看greet的服务目录</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">E:\proj\gowork\go-zero-demo&gt;tree /f</span><br><span class="line"></span><br><span class="line">│  go.mod</span><br><span class="line">│  go.sum</span><br><span class="line">│</span><br><span class="line">└─greet</span><br><span class="line">    │  greet.api</span><br><span class="line">    │  greet.go</span><br><span class="line">    │</span><br><span class="line">    ├─etc</span><br><span class="line">    │      greet-api.yaml</span><br><span class="line">    │</span><br><span class="line">    └─internal</span><br><span class="line">        ├─config</span><br><span class="line">        │      config.go</span><br><span class="line">        │</span><br><span class="line">        ├─handler</span><br><span class="line">        │      greethandler.go</span><br><span class="line">        │      routes.go</span><br><span class="line">        │</span><br><span class="line">        ├─logic</span><br><span class="line">        │      greetlogic.go</span><br><span class="line">        │</span><br><span class="line">        ├─svc</span><br><span class="line">        │      servicecontext.go</span><br><span class="line">        │</span><br><span class="line">        └─types</span><br><span class="line">                types.go</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><code> greet\greet.api</code> 中就是对外的接口</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">type Request &#123;</span><br><span class="line">	Name string `path:&quot;name,options=you|me&quot;`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type Response &#123;</span><br><span class="line">	Message string `json:&quot;message&quot;`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">service greet-api &#123;</span><br><span class="line">	@handler GreetHandler</span><br><span class="line">	get /from/:name(Request) returns (Response) // 对外访问接口路径为：/from/name</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="编写逻辑"><a href="#编写逻辑" class="headerlink" title="编写逻辑"></a>编写逻辑</h3><p><code>E:\proj\gowork\go-zero-demo\greet\internal\logic\greetlogic.go1</code> 代码中编写如下逻辑：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">func (l *GreetLogic) Greet(req *types.Request) (resp *types.Response, err error) &#123;</span><br><span class="line">	return &amp;types.Response&#123;</span><br><span class="line">		Message: &quot;Hello go-zero&quot;,</span><br><span class="line">	&#125;, nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="启动并访问服务"><a href="#启动并访问服务" class="headerlink" title="启动并访问服务"></a>启动并访问服务</h3><ul>
<li>启动服务</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">go run .\greet.go </span><br><span class="line">Starting server at 0.0.0.0:8888...</span><br></pre></td></tr></table></figure>

<ul>
<li>浏览器访问:<code>http://localhost:8888/from/you</code></li>
</ul>
<p><img src="/aposts/93e757c2/image-20230726113435097.png" alt="image-20230726113435097"></p>
<h2 id="go-zero-微服务"><a href="#go-zero-微服务" class="headerlink" title="go-zero 微服务"></a>go-zero 微服务</h2><ul>
<li><p>api部分其实和单体服务的创建逻辑是一样的，只是在单体服务中没有服务间的通讯而已， 且微服务中api服务会多一些rpc调用的配置。</p>
</li>
<li><p>假设我们在开发一个商城项目，而开发者小明负责**用户模块(user)<strong>和</strong>订单模块(order)**的开发，我们姑且将这两个模块拆分成两个微服务</p>
</li>
</ul>
<h3 id="演示功能目标"><a href="#演示功能目标" class="headerlink" title="演示功能目标"></a>演示功能目标</h3><ul>
<li>订单服务(order)提供一个查询接口</li>
<li>用户服务(user)提供一个方法供订单服务获取用户信息</li>
</ul>
<h3 id="服务设计分析"><a href="#服务设计分析" class="headerlink" title="服务设计分析"></a>服务设计分析</h3><p>根据情景提要我们可以得知，订单是直接面向用户，通过http协议访问数据，而订单内部需要获取用户的一些基础数据，既然我们的服务是采用微服务的架构设计， 那么两个服务（user, order）就必须要进行数据交换，服务间的数据交换即服务间的通讯，到了这里，采用合理的通讯协议也是一个开发人员需要 考虑的事情，可以通过http，rpc等方式来进行通讯，这里我们选择rpc来实现服务间的通讯，相信这里我已经对”rpc服务存在有什么作用？”已经作了一个比较好的场景描述。 当然，一个服务开发前远不止这点设计分析，我们这里就不详细描述了。从上文得知，我们需要一个</p>
<ul>
<li>user rpc</li>
<li>order api</li>
</ul>
<p>两个服务来初步实现这个小demo。</p>
<h3 id="创建工程"><a href="#创建工程" class="headerlink" title="创建工程"></a>创建工程</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">E:\proj\gowork&gt;mkdir study-gozero-demo</span><br><span class="line">E:\proj\gowork&gt;cd study-gozero-demo</span><br><span class="line">E:\proj\gowork\study-gozero-demo&gt;go mod init study-gozero-demo</span><br></pre></td></tr></table></figure>

<h3 id="创建user-rpc服务"><a href="#创建user-rpc服务" class="headerlink" title="创建user rpc服务"></a>创建user rpc服务</h3><ul>
<li>创建user rpc服务的目录里</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E:\proj\gowork\study-gozero-demo\&gt;mkdir -p mall/user/rpc</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意在win中，我使用的git窗口编写的mkdri命令，在cmd中这样创建有问题</p>
</blockquote>
<ul>
<li>添加<code>user.proto</code>文件，增加<code>getUser</code>方法</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">syntax = &quot;proto3&quot;;</span><br><span class="line"></span><br><span class="line">package user;</span><br><span class="line"></span><br><span class="line">// protoc-gen-go 版本大于1.4.0, proto文件需要加上go_package,否则无法生成</span><br><span class="line">option go_package = &quot;./user&quot;;</span><br><span class="line"></span><br><span class="line">message IdRequest &#123;</span><br><span class="line">    string id = 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message UserResponse &#123;</span><br><span class="line">    // 用户id</span><br><span class="line">    string id = 1;</span><br><span class="line">    // 用户名称</span><br><span class="line">    string name = 2;</span><br><span class="line">    // 用户性别</span><br><span class="line">    string gender = 3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">service User &#123;</span><br><span class="line">    rpc getUser(IdRequest) returns(UserResponse);  //对外开发的接口</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>生成rpc目录和代码</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">E:\proj\gowork\study-gozero-demo\mall\user\rpc&gt; goctl rpc protoc user.proto --go_out=. --go-grpc_out=. --zrpc_out=.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Done.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>vs code ide的终端中执行的此命令.最终生成的go服务源代码文件在目录：E:\proj\gowork\study-gozero-demo\mall\user\rpc\userclient\user.go</p>
</blockquote>
<ul>
<li>填充业务逻辑其实就是user.proto中生成的getUser，目录为：<code>E:\proj\gowork\study-gozero-demo\mall\user\rpc\internal\logic\getuserlogic.go</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">func (l *GetUserLogic) GetUser(in *user.IdRequest) (*user.UserResponse, error) &#123;</span><br><span class="line">	// todo: add your logic here and delete this line</span><br><span class="line"></span><br><span class="line">	// 新增的代码</span><br><span class="line"> return &amp;user.UserResponse&#123;</span><br><span class="line">            Id:   &quot;1&quot;,</span><br><span class="line">            Name: &quot;test&quot;,</span><br><span class="line">    &#125;, nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>若发现这里引用包报错，可以使用<code>go mod tidy</code> 下载依赖</p>
</blockquote>
<h3 id="创建order-api服务"><a href="#创建order-api服务" class="headerlink" title="创建order api服务"></a>创建order api服务</h3><ul>
<li>创建 <code>order api</code>服务</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Administrator@WIN-20230710BAT MINGW64 /e/proj/gowork/study-gozero-demo/mall</span><br><span class="line">$ mkdir -p order/api &amp;&amp; cd order/api</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>git 窗口执行</p>
</blockquote>
<ul>
<li>编写添加api文件目录为：<code>E:\proj\gowork\study-gozero-demo\mall\order\api\order.api</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">type(</span><br><span class="line">    OrderReq &#123;</span><br><span class="line">        Id string `path:&quot;id&quot;`</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    OrderReply &#123;</span><br><span class="line">        Id string `json:&quot;id&quot;`</span><br><span class="line">        Name string `json:&quot;name&quot;`</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line">service order &#123;</span><br><span class="line">    @handler getOrder</span><br><span class="line">    get /api/order/get/:id (OrderReq) returns (OrderReply)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>生成order服务，<strong>非rpc</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS E:\proj\gowork\study-gozero-demo\mall\order\api&gt; goctl api go -api order.api -dir .</span><br></pre></td></tr></table></figure>

<ul>
<li><p>添加user rpc配置目录地址为</p>
<p><code>E:\proj\gowork\study-gozero-demo\mall\order\api\internal\config\config.go</code></p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">package config</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;github.com/zeromicro/go-zero/rest&quot;</span><br><span class="line">	&quot;github.com/zeromicro/go-zero/zrpc&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">type Config struct &#123;</span><br><span class="line">	rest.RestConf</span><br><span class="line">	UserRpc zrpc.RpcClientConf // 这个就是新增的user rpc服务</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>添加yaml配置目录为<code>E\proj\gowork\study-gozero-demo\mall\order\api\etc\order.yaml</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Name: order</span><br><span class="line">Host: 0.0.0.0</span><br><span class="line">Port: 8888</span><br><span class="line">UserRpc: -- 从这里开始为新增</span><br><span class="line">  Etcd:</span><br><span class="line">    Hosts:</span><br><span class="line">    - 127.0.0.1:2379</span><br><span class="line">    Key: user.rpc</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ul>
<li><p>完善服务依赖目录为</p>
<p><code>E:\proj\gowork\study-gozero-demo\mall\order\api\internal\svc\servicecontext.go</code></p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">package svc</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;study-gozero-demo/mall/order/api/internal/config&quot;</span><br><span class="line">	&quot;study-gozero-demo/mall/user/rpc/userclient&quot; // 引用最终生成user服务代码路径</span><br><span class="line"></span><br><span class="line">	&quot;github.com/zeromicro/go-zero/zrpc&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">type ServiceContext struct &#123;</span><br><span class="line">	Config  config.Config</span><br><span class="line">	UserRpc userclient.User // 引用User服务中的GetUser函数</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func NewServiceContext(c config.Config) *ServiceContext &#123;</span><br><span class="line">	return &amp;ServiceContext&#123;</span><br><span class="line">		Config: c,</span><br><span class="line">		//加入user rpc服务</span><br><span class="line">		UserRpc: userclient.NewUser(zrpc.MustNewClient(c.UserRpc)),</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>添加order演示逻辑</p>
<p>给<code>E:\proj\gowork\study-gozero-demo\mall\order\api\internal\logic\getorderlogic</code> 添加业务逻辑</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">package logic</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;context&quot;</span><br><span class="line">	&quot;errors&quot;</span><br><span class="line"></span><br><span class="line">	&quot;study-gozero-demo/mall/order/api/internal/svc&quot;</span><br><span class="line">	&quot;study-gozero-demo/mall/order/api/internal/types&quot;</span><br><span class="line"></span><br><span class="line">	// 引用</span><br><span class="line">	&quot;study-gozero-demo/mall/user/rpc/user&quot;</span><br><span class="line"></span><br><span class="line">	&quot;github.com/zeromicro/go-zero/core/logx&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">type GetOrderLogic struct &#123;</span><br><span class="line">	logx.Logger</span><br><span class="line">	ctx    context.Context</span><br><span class="line">	svcCtx *svc.ServiceContext</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func NewGetOrderLogic(ctx context.Context, svcCtx *svc.ServiceContext) *GetOrderLogic &#123;</span><br><span class="line">	return &amp;GetOrderLogic&#123;</span><br><span class="line">		Logger: logx.WithContext(ctx),</span><br><span class="line">		ctx:    ctx,</span><br><span class="line">		svcCtx: svcCtx, // 引用order的服务，然后才能调用order服务中的user rpc</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (l *GetOrderLogic) GetOrder(req *types.OrderReq) (resp *types.OrderReply, err error) &#123;</span><br><span class="line">	// todo: add your logic here and delete this line</span><br><span class="line"></span><br><span class="line">	// 新增代码，注意这里的&amp;user，应用的是user rpc的user/user.pb.go中内容,IdRequest其实就是对应入参（user.proto定义的）</span><br><span class="line">		// 获取订单之前，需要盘点用户的id是否存在，若不存在则返回用户不存在报错，若存在则返回test order</span><br><span class="line">	user, err := l.svcCtx.UserRpc.GetUser(l.ctx, &amp;user.IdRequest&#123;</span><br><span class="line">		Id: &quot;1&quot;,</span><br><span class="line">	&#125;)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		return nil, err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	if user.Name != &quot;test&quot; &#123;</span><br><span class="line">		return nil, errors.New(&quot;用户不存在&quot;)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	return &amp;types.OrderReply&#123;</span><br><span class="line">		Id:   req.Id,</span><br><span class="line">		Name: &quot;test order&quot;,</span><br><span class="line">	&#125;, nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="启动服务并验证"><a href="#启动服务并验证" class="headerlink" title="启动服务并验证"></a>启动服务并验证</h3><ul>
<li>启动本地etcd</li>
</ul>
<blockquote>
<p> 注意本地安装<a target="_blank" rel="noopener" href="https://github.com/etcd-io/etcd/releases">etcd</a>，打开<code>E:\app\etcd-v3.4.27-windows-amd64\etcd.exe</code>启动服务</p>
<p>etcd是一个分布式一致性键值存储，其主要用于分布式系统的共享配置和服务发现。</p>
</blockquote>
<ul>
<li>启动user rpc</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E:\proj\gowork\study-gozero-demo\mall\user\rpc&gt; go run .\user.go</span><br></pre></td></tr></table></figure>

<ul>
<li>启动order api</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PS E:\proj\gowork\study-gozero-demo\mall\order\api&gt; go run order.go</span><br><span class="line">Starting server at 0.0.0.0:8888...</span><br><span class="line">&#123;&quot;@timestamp&quot;:&quot;2023-07-26T16:36:58.057+08:00&quot;,&quot;caller&quot;:&quot;stat/usage.go:61&quot;,&quot;content&quot;:&quot;CPU: 0m, MEMORY: Alloc=3.2Mi, TotalAlloc=6.1Mi, Sys=17.9Mi, NumGC=3&quot;,&quot;level&quot;:&quot;stat&quot;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>访问order api</li>
</ul>
<p><img src="/aposts/93e757c2/image-20230726164009157.png" alt="image-20230726164009157"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>如上代码展示了，单体服务和微服务分别运用，下一篇文章我们将会加上数据库、jwt鉴权、以及具体的增删改查</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://louis-me.github.io/aposts/76adab24/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="一个正经的测试工程师">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="施坤的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/aposts/76adab24/" class="post-title-link" itemprop="url">go-zero实战系列二</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-07-25 15:00:00 / 修改时间：15:12:54" itemprop="dateCreated datePublished" datetime="2023-07-25T15:00:00+08:00">2023-07-25</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
                </span>
            </span>

          
            <span id="/aposts/76adab24/" class="post-meta-item leancloud_visitors" data-flag-title="go-zero实战系列二" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/aposts/76adab24/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/aposts/76adab24/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><ul>
<li><a href="/aposts/4d2d858d/">go-zero实战系列一</a> 中已经编写好api代码、order、product的rpc服务等，下面我们开始绩继续的实践过程</li>
<li>本章主要对数据库的表新建，以及常见的增删改查</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://louis-me.github.io/aposts/4d2d858d/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="一个正经的测试工程师">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="施坤的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/aposts/4d2d858d/" class="post-title-link" itemprop="url">go-zero实战系列一</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-07-17 17:07:17" itemprop="dateCreated datePublished" datetime="2023-07-17T17:07:17+08:00">2023-07-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-07-26 17:16:52" itemprop="dateModified" datetime="2023-07-26T17:16:52+08:00">2023-07-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
                </span>
            </span>

          
            <span id="/aposts/4d2d858d/" class="post-meta-item leancloud_visitors" data-flag-title="go-zero实战系列一" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/aposts/4d2d858d/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/aposts/4d2d858d/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>本次主要按照这个博主的<a target="_blank" rel="noopener" href="https://www.cnblogs.com/kevinwan/tag/go-zero/">go-zero微服务实战</a>进行学习</p>
<h2 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h2><ul>
<li>安装依赖go-zero: <code>go get -u github.com/zeromicro/go-zero@latest</code></li>
<li>安装依赖goctl，用命令进行安装：<code>go install github.com/zeromicro/go-zero/tools/goctl@latest</code><ul>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/kevinwan/p/16325802.html">微服务效率工具 goctl 深度解析</a></li>
</ul>
</li>
<li>安装成功后，输入<code>go env</code> 找到<code>GOPATH</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">E:\proj\gowork\studyGoZero&gt;go env</span><br><span class="line">set GO111MODULE=on</span><br><span class="line">set GOPATH=C:\Users\Administrator\go</span><br><span class="line">set GOROOT=E:\app\Go</span><br><span class="line">....</span><br></pre></td></tr></table></figure>

<ul>
<li>把<code>C:\Users\Administrator\go\bin\goctl.exe</code> 拷贝到GOROOT\bin目录下</li>
<li>查看版本成功</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS E:\proj\gowork\studyGoZero\apps\order&gt; goctl --version</span><br><span class="line">goctl version 1.5.4 windows/amd64</span><br></pre></td></tr></table></figure>

<ul>
<li>安装<code>protoc</code> ，查看他的<a target="_blank" rel="noopener" href="https://go-zero.dev/docs/tasks/installation/protoc">作用</a></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">goctl env check --install --verbose --force</span><br></pre></td></tr></table></figure>

<ul>
<li>安装<code>protoc</code> 成功后，把<code>C:\Users\Administrator\go\bin\</code> 的相关文件拷贝到<code>GOROOT\bin</code></li>
</ul>
<h2 id="服务划分"><a href="#服务划分" class="headerlink" title="服务划分"></a>服务划分</h2><p><img src="/aposts/4d2d858d/image-20230721102332169.png" alt="image-20230721102332169"></p>
<p>从以上思维导图可以看出整个电商系统功能还是比较多的，我们根据业务职能做如下微服务的划分：</p>
<ul>
<li>商品服务(product) - 商品的添加、信息查询、库存管理等功能</li>
<li>购物车服务(cart) - 购物车的增删改查</li>
<li>订单服务(order) - 生成订单，订单管理</li>
<li>支付服务(pay) - 通过调用第三方支付实现支付功能</li>
<li>账号服务(user) - 用户信息、等级、封禁、地址管理</li>
<li>推荐服务(recommend) - 首页商品推荐</li>
<li>评论服务(reply) - 商品的评论功能、评论的回复功能</li>
</ul>
<h2 id="BFF层"><a href="#BFF层" class="headerlink" title="BFF层"></a>BFF层</h2><ul>
<li>但对于一个复杂的高并发的系统来说，我们需要处理各种异常的场景，比如某个页面需要依赖多个微服务提供的数据，为了避免串行请求导致的耗时过长，我们一般会并行的请求多个微服务，这个时候其中的某个服务请求异常的话我们可能需要做一些特殊的处理，比如提供一些降级的数据等。我们的解决方案就是加一层，即BFF层，通过BFF对外提供HTTP接口，客户端只与BFF进行交互，<strong>我们的这个项目为了简化只会采用一个BFF服务</strong></li>
</ul>
<p><img src="/aposts/4d2d858d/image-20230721102651764.png" alt="image-20230721102651764"></p>
<ul>
<li>我们可以提供多个BFF吗？答案是当然可以。BFF的目的是为客户端提供一个集中的接口，例如移动端页面和浏览器页面的数据协议不同，这种情况下为了更好的表示数据，可以使用两个BFF，同时只供一个BFF如果该BFF异常就会导致所有的业务受影响，提供多个BFF也可以提高服务的可用性，降低业务异常的影响面。多个BFF架构图如下：</li>
</ul>
<p><img src="/aposts/4d2d858d/image-20230721102751280.png" alt="image-20230721102751280"></p>
<h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><ul>
<li>初始化项目</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd E:\proj\gowork</span><br><span class="line">mkdir studyGoZero</span><br><span class="line">cd studyGoZero</span><br><span class="line">go mod init example.com/studyGoZero</span><br></pre></td></tr></table></figure>

<ul>
<li>目录结构如下</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">─apps</span><br><span class="line">│  ├─app</span><br><span class="line">│  │  └─api</span><br><span class="line">│  ├─cart</span><br><span class="line">│  │  ├─admin</span><br><span class="line">│  │  ├─rmq</span><br><span class="line">│  │  └─rpc</span><br><span class="line">│  ├─order</span><br><span class="line">│  │  ├─admin</span><br><span class="line">│  │  ├─rmq</span><br><span class="line">│  │  └─rpc</span><br><span class="line">│  ├─paly</span><br><span class="line">│  │  ├─admin</span><br><span class="line">│  │  ├─rmq</span><br><span class="line">│  │  └─rpc</span><br><span class="line">│  ├─product</span><br><span class="line">│  │  ├─admin</span><br><span class="line">│  │  ├─rmq</span><br><span class="line">│  │  └─rpc</span><br><span class="line">│  ├─recommend</span><br><span class="line">│  │  ├─admin</span><br><span class="line">│  │  ├─rmq</span><br><span class="line">│  │  └─rpc</span><br><span class="line">│  ├─reply</span><br><span class="line">│  │  ├─admin</span><br><span class="line">│  │  ├─rmq</span><br><span class="line">│  │  └─rpc</span><br><span class="line">│  └─user</span><br><span class="line">│      ├─admin</span><br><span class="line">│      ├─rmq</span><br><span class="line">│      └─rpc</span><br><span class="line">└─pkg</span><br></pre></td></tr></table></figure>

<ul>
<li>其中apps存放的是我们所有的微服务，比如order为订单相关的微服务，pkg目录为所有服务共同依赖的包的存放路径，比如所有的服务都需要依赖鉴权就可以放到pkg目录下</li>
<li>app - BFF服务</li>
<li>cart - 购物车服务</li>
<li>order - 订单服务</li>
<li>pay - 支付服务</li>
<li>product - 商品服务</li>
<li>recommend - 推荐服务</li>
<li>reply - 评论服务</li>
<li>user - 账号服务</li>
</ul>
<p>在每个服务目录下我们又会分为多个服务，主要会有如下几类服务：</p>
<ul>
<li>api - 对外的BFF服务，接受来自客户端的请求，暴露HTTP接口</li>
<li>rpc - 对内的微服务，仅接受来自内部其他微服务或者BFF的请求，暴露gRPC接口</li>
<li>rmq - 负责进行流式任务处理，上游一般依赖消息队列，比如kafka等</li>
<li>admin - 也是对内的服务，区别于rpc，更多的是面向运营侧的且数据权限较高，通过隔离可带来更好的代码级别的安全，直接提供HTTP接口</li>
</ul>
<h2 id="API-定义"><a href="#API-定义" class="headerlink" title="API 定义"></a>API 定义</h2><h3 id="首页API"><a href="#首页API" class="headerlink" title="首页API"></a>首页API</h3><p>首页功能主要分为四个部分，<strong>搜索、Banner图、限时抢购和推荐商品</strong>列表，点击搜索框会跳转到搜索页，推荐部分是分页展示的，用户通过不断地往上滑动可以加载下一页。通过分析首页我们大致需要提供三个接口，分别是Banner接口，限时抢购接口和推荐接口。</p>
<p><img src="/aposts/4d2d858d/image-20230720110620328.png" alt="image-20230720110620328"></p>
<ul>
<li>打开<code>apps\app\api\api.api</code>文件，写入对外api的代码定义</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">syntax = &quot;v1&quot;</span><br><span class="line">type (</span><br><span class="line">	// 首页的banner响应请求</span><br><span class="line">	HomeBannerResponse &#123;</span><br><span class="line">		Banners []*Banner `json:&quot;banners&quot;`</span><br><span class="line">	&#125;</span><br><span class="line">.....</span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">service api-api &#123;</span><br><span class="line"></span><br><span class="line">	@doc &quot;首页Banner&quot;</span><br><span class="line">	@handler HomeBannerHandler</span><br><span class="line">	get /v1/home/banner returns (HomeBannerResponse)</span><br><span class="line"></span><br><span class="line">	@doc &quot;限时抢购&quot;</span><br><span class="line">	@handler FlashSaleHandler</span><br><span class="line">	get /v1/flashsale returns (FlashSaleResponse)</span><br><span class="line"></span><br><span class="line">	@doc &quot;推荐商品列表&quot;</span><br><span class="line">	@handler RecommendHandler</span><br><span class="line">	get /v1/recommend (RecommendRequest) returns (RecommendResponse)</span><br><span class="line"></span><br><span class="line">	@doc &quot;分类商品列表&quot;</span><br><span class="line">	@handler CategoryListHandler</span><br><span class="line">	get /v1/category/list (CategoryListRequest) returns (CategoryListResponse)</span><br><span class="line">	@doc &quot;购物车列表&quot;</span><br><span class="line">	@handler CartListHandler</span><br><span class="line">	get /v1/cart/list (CartListRequest) returns (CartListResponse)</span><br><span class="line"></span><br><span class="line">	@doc &quot;商品评论列表&quot;</span><br><span class="line">	@handler ProductCommentHandler</span><br><span class="line">	get /v1/product/comment (ProductCommentRequest) returns (ProductCommentResponse)</span><br><span class="line"></span><br><span class="line">	@doc &quot;订单列表&quot;</span><br><span class="line">	@handler OrderListHandler</span><br><span class="line">	get /v1/order/list (OrderListRequest) returns (OrderListResponse)</span><br><span class="line"></span><br><span class="line">	@doc &quot;商品详情&quot;</span><br><span class="line">	@handler ProductDetailHandler</span><br><span class="line">	get /v1/product/detail (ProductDetailRequest) returns (ProductDetailResponse)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>定义好api后，我们使用如下命令重新生成项目代码，输出如下信息表明生成成功</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">PS E:\proj\gowork\studyGoZero\apps\app\api&gt; goctl api go -api api.api -dir .</span><br><span class="line">Done.</span><br><span class="line"></span><br><span class="line">// 查看目录</span><br><span class="line">PS E:\proj\gowork\studyGoZero\apps\app\api&gt; tree /f</span><br><span class="line">E:.</span><br><span class="line">│  api.api</span><br><span class="line">│  api.go</span><br><span class="line">│</span><br><span class="line">├─etc</span><br><span class="line">│      api-api.yaml</span><br><span class="line">│</span><br><span class="line">└─internal</span><br><span class="line">    ├─config</span><br><span class="line">    │      config.go</span><br><span class="line">    │</span><br><span class="line">    ├─handler</span><br><span class="line">    │      cartlisthandler.go</span><br><span class="line">    │      categorylisthandler.go</span><br><span class="line">    │      flashsalehandler.go</span><br><span class="line">    │      homebannerhandler.go</span><br><span class="line">    │      orderlisthandler.go</span><br><span class="line">    │      productcommenthandler.go</span><br><span class="line">    │      productdetailhandler.go</span><br><span class="line">    │      recommendhandler.go</span><br><span class="line">    │      routes.go</span><br><span class="line">    │</span><br><span class="line">    ├─logic</span><br><span class="line">    │      cartlistlogic.go</span><br><span class="line">    │      categorylistlogic.go</span><br><span class="line">    │      flashsalelogic.go</span><br><span class="line">    │      homebannerlogic.go</span><br><span class="line">    │      orderlistlogic.go</span><br><span class="line">    │      productcommentlogic.go</span><br><span class="line">    │      productdetaillogic.go</span><br><span class="line">    │      recommendlogic.go</span><br><span class="line">    │</span><br><span class="line">    ├─svc</span><br><span class="line">    │      servicecontext.go</span><br><span class="line">    │</span><br><span class="line">    └─types</span><br><span class="line">            types.go</span><br></pre></td></tr></table></figure>

<h2 id="admin-层代码"><a href="#admin-层代码" class="headerlink" title="admin 层代码"></a>admin 层代码</h2><h3 id="order目录"><a href="#order目录" class="headerlink" title="order目录"></a>order目录</h3><ul>
<li><p>目录为： E:\proj\gowork\studyGoZero\apps\order</p>
</li>
<li><p>执行如下命令即可初始化<code>order admin</code>代码，注意<code>order admin</code>为<code>api</code>服务，<strong>直接对前端提供HTTP接口</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E:\proj\gowork\studyGoZero\apps\order&gt; goctl api new admin</span><br></pre></td></tr></table></figure>
</li>
<li><p>代码结构如下</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">─admin</span><br><span class="line">│  │  admin.api</span><br><span class="line">│  │  admin.go</span><br><span class="line">│  │</span><br><span class="line">│  ├─etc</span><br><span class="line">│  │      admin-api.yaml</span><br><span class="line">│  │</span><br></pre></td></tr></table></figure>

<ul>
<li><p>生成的服务代码我们可以直接运行<code>go run admin.go</code>，默认侦听在8888端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS E:\proj\gowork\studyGoZero\apps\order\admin&gt; go run .\admin.go </span><br><span class="line">Starting server at 0.0.0.0:8888...</span><br></pre></td></tr></table></figure>
</li>
<li><p>对于rmq服务我们会使用go-zero提供的 <a target="_blank" rel="noopener" href="https://github.com/zeromicro/go-queue/tree/master/kq">kq</a> 功能，这里先初始化<code>main.go</code></p>
</li>
</ul>
<h3 id="其他层"><a href="#其他层" class="headerlink" title="其他层"></a>其他层</h3><ul>
<li>pay、pruduct、recommend、reply、user 等按照同样的方式进行初始化</li>
</ul>
<h2 id="rpc服务层"><a href="#rpc服务层" class="headerlink" title="rpc服务层"></a>rpc服务层</h2><ul>
<li><p>Goctl Rpc是<code>goctl</code>脚手架下的一个rpc服务代码生成模块，支持proto模板生成和rpc服务代码生成，通过此工具生成代码你只需要关注业务逻辑编写而不用去编写一些重复性的代码</p>
</li>
<li><p>作者博客中初始化rpc使用的这种 <code>goctl rpc new rpc</code> ，并不推荐，研究代码后发现和作者提供的仓库代码不一致，使用的第二种方式生成的rpc服务层的代码和目录：<code>通过指定proto生成rpc服务</code></p>
</li>
<li><p>因为BFF只负责数据的组装工作，数据真正的来源是各个微服务通过RPC接口提供，接下来我们来定义各个微服务的proto。如下展示的订单列表页面由两部分数据组成，分别是订单数据和商品数据，也就是我们的BFF需要依赖order-rpc和product-rpc来完成该页面数据的组装，下面我们分别来定义order-rpc和product-rpc</p>
</li>
</ul>
<p><img src="/aposts/4d2d858d/image-20230725100643383.png" alt="image-20230725100643383"></p>
<h3 id="order层"><a href="#order层" class="headerlink" title="order层"></a>order层</h3><ul>
<li>在<code>E:\proj\gowork\studyGoZero\apps\order\rpc\order.proto</code>，定义如下，<code>service</code>名字为<code>Order</code>，添加了<code>Orders</code>获取订单列表<code>rpc</code>接口。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">syntax = &quot;proto3&quot;;</span><br><span class="line"></span><br><span class="line">package order;</span><br><span class="line">option go_package = &quot;./order&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">service Order &#123;</span><br><span class="line">  rpc Orders(OrdersRequest) returns(OrdersResponse);</span><br><span class="line">  rpc CreateOrder(CreateOrderRequest) returns (CreateOrderResponse);</span><br><span class="line">  rpc CreateOrderCheck(CreateOrderRequest) returns (CreateOrderResponse);</span><br><span class="line">  rpc RollbackOrder (CreateOrderRequest) returns (CreateOrderResponse);</span><br><span class="line">  rpc CreateOrderDTM(AddOrderReq) returns (AddOrderResp);</span><br><span class="line">  rpc CreateOrderDTMRevert(AddOrderReq) returns(AddOrderResp);</span><br><span class="line">  rpc GetOrderById(GetOrderByIdReq) returns (GetOrderByIdResp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">....</span><br></pre></td></tr></table></figure>

<p>使用如下命令重新生成代码，注意这里需要依赖<strong>protoc-gen-go</strong>和<strong>protoc-gen-go-grpc</strong>两个插件，木有安装的话执行下面命令会报错:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS E:\proj\gowork\studyGoZero\apps\order\rpc&gt;  goctl rpc protoc order.proto --go_out=. --go-grpc_out=. --zrpc_out=.</span><br><span class="line">Done.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意最终生成的服务端的代码目录为：E:\proj\gowork\studyGoZero\apps\order\rpc\orderclient\order.go</p>
</blockquote>
<p>目录结构如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">PS E:\proj\gowork\studyGoZero\apps\order\rpc&gt; tree /f</span><br><span class="line">卷 软件盘 的文件夹 PATH 列表</span><br><span class="line">卷序列号为 240F-1787</span><br><span class="line">E:.</span><br><span class="line">│  order.go</span><br><span class="line">│  order.proto</span><br><span class="line">│</span><br><span class="line">├─etc</span><br><span class="line">│      order.yaml</span><br><span class="line">│</span><br><span class="line">├─internal</span><br><span class="line">│  ├─config</span><br><span class="line">│  │      config.go</span><br><span class="line">│  │</span><br><span class="line">│  ├─logic</span><br><span class="line">│  │      createorderchecklogic.go</span><br><span class="line">│  │      createorderdtmlogic.go</span><br><span class="line">│  │      createorderdtmrevertlogic.go</span><br><span class="line">│  │      createorderlogic.go</span><br><span class="line">│  │      getorderbyidlogic.go</span><br><span class="line">│  │      orderslogic.go</span><br><span class="line">│  │      rollbackorderlogic.go</span><br><span class="line">│  │</span><br><span class="line">│  ├─server</span><br><span class="line">│  │      orderserver.go</span><br><span class="line">│  │</span><br><span class="line">│  └─svc</span><br><span class="line">│          servicecontext.go</span><br><span class="line">│</span><br><span class="line">├─order</span><br><span class="line">│      order.pb.go</span><br><span class="line">│      order_grpc.pb.go</span><br><span class="line">│</span><br><span class="line">└─orderclient</span><br><span class="line">        order.go</span><br></pre></td></tr></table></figure>

<ul>
<li>本地安装<a target="_blank" rel="noopener" href="https://github.com/etcd-io/etcd/releases">etcd</a>，打开<code>E:\app\etcd-v3.4.27-windows-amd64\etcd.exe</code>启动服务</li>
</ul>
<blockquote>
<p> etcd是一个分布式一致性键值存储，其主要用于分布式系统的共享配置和服务发现。</p>
<p> etcd由Go语言编写</p>
</blockquote>
<ul>
<li>生成好后然后启动<code>order-rpc</code>服务，需要连接etcd服务</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PS E:\proj\gowork\studyGoZero\apps\order\rpc&gt; go run .\order.go</span><br><span class="line">Starting rpc server at 0.0.0.0:8080...</span><br><span class="line">&#123;&quot;@timestamp&quot;:&quot;2023-07-24T17:03:51.723+08:00&quot;,&quot;caller&quot;:&quot;stat/usage.go:61&quot;,&quot;content&quot;:&quot;CPU: 0m, MEMORY: Alloc=3.2Mi, TotalAlloc=6.1Mi, Sys=17.9Mi, NumGC=3&quot;,&quot;level&quot;:&quot;stat&quot;&#125;</span><br><span class="line">&#123;&quot;@timestamp&quot;:&quot;2023-07-24T17:03:51.737+08:00&quot;,&quot;caller&quot;:&quot;load/sheddingstat.go:61&quot;,&quot;content&quot;:&quot;(rpc) shedding_stat [1m], cpu: 0, total: 0, pass: 0, drop: 0&quot;,&quot;level&quot;:&quot;stat&quot;&#125;</span><br><span class="line">&#123;&quot;@timestamp&quot;:&quot;2023-07-24T17:04:51.711+08:00&quot;,&quot;caller&quot;:&quot;stat/usage.go:61&quot;,&quot;content&quot;:</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在E:\proj\gowork\studyGoZero\apps\order\rpc\etc\order.yaml中，可以看到etcd的连接服务器地址，和order-rpc启动的地址信息：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Name:</span> <span class="string">order.rpc</span></span><br><span class="line"><span class="attr">ListenOn:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:8080</span></span><br><span class="line"><span class="attr">Etcd:</span></span><br><span class="line"><span class="attr">Hosts:</span></span><br><span class="line">	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:2379</span></span><br><span class="line"><span class="attr">Key:</span> <span class="string">order.rpc</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="product"><a href="#product" class="headerlink" title="product"></a>product</h3><p>在<code>E:\proj\gowork\studyGoZero\apps\product\rpc\product.proto</code>，定义如下，<code>service</code>名字为<code>Order</code>，添加了<code>product</code>产品的<code>rpc</code>接口。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">syntax = &quot;proto3&quot;;</span><br><span class="line"></span><br><span class="line">package product;</span><br><span class="line">option go_package = &quot;./product&quot;;</span><br><span class="line"></span><br><span class="line">service Product &#123;</span><br><span class="line">  rpc Product(ProductItemRequest) returns (ProductItem) ;</span><br><span class="line">  rpc Products(ProductRequest) returns(ProductResponse);</span><br><span class="line">  rpc ProductList(ProductListRequest) returns(ProductListResponse);</span><br><span class="line">  rpc OperationProducts(OperationProductsRequest) returns (OperationProductsResponse);</span><br><span class="line">  rpc UpdateProductStock(UpdateProductStockRequest) returns (UpdateProductStockResponse);</span><br><span class="line">  rpc CheckAndUpdateStock(CheckAndUpdateStockRequest) returns (CheckAndUpdateStockResponse);</span><br><span class="line">  rpc CheckProductStock(UpdateProductStockRequest) returns (UpdateProductStockResponse);</span><br><span class="line">  rpc RollbackProductStock(UpdateProductStockRequest) returns (UpdateProductStockResponse);</span><br><span class="line">  rpc DecrStock(DecrStockRequest) returns(DecrStockResponse);</span><br><span class="line">  rpc DecrStockRevert(DecrStockRequest) returns(DecrStockResponse);</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>在<code>E:\proj\gowork\studyGoZero\apps\product\rpc\etc\product.yaml</code>配置启动服务地址端口为8081</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Name: product.rpc</span><br><span class="line">ListenOn: 0.0.0.0:8081</span><br><span class="line">Etcd:</span><br><span class="line">  Hosts:</span><br><span class="line">  - 127.0.0.1:2379</span><br><span class="line">  Key: product.rpc</span><br></pre></td></tr></table></figure>

<ul>
<li>启动<code>product-rpc</code>服务，需要连接etcd服务</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS E:\proj\gowork\studyGoZero\apps\product\rpc&gt; go run .\product.go</span><br><span class="line">Starting rpc server at 0.0.0.0:8081...</span><br></pre></td></tr></table></figure>

<h2 id="BUFF-层配置"><a href="#BUFF-层配置" class="headerlink" title="BUFF 层配置"></a>BUFF 层配置</h2><ul>
<li><p>因为我们的BFF需要依赖order.rpc和product.rpc，我们需要先添加配置文件(<code>E:\proj\gowork\studyGoZero\apps\app\api\etc\api-api.yaml</code>)，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Name: api-api</span><br><span class="line">Host: 0.0.0.0</span><br><span class="line">Port: 8888</span><br><span class="line">OrderRPC:</span><br><span class="line">    Etcd:</span><br><span class="line">        Hosts:</span><br><span class="line">          - 127.0.0.1:2379</span><br><span class="line">        Key: order.rpc</span><br><span class="line">ProductRPC:</span><br><span class="line">  Etcd:</span><br><span class="line">    Hosts:</span><br><span class="line">      - 127.0.0.1:2379</span><br><span class="line">    Key: product.rpc</span><br></pre></td></tr></table></figure>
</li>
<li><p>然后在<code>E:\proj\gowork\studyGoZero\apps\app\api\internal\svc\servicecontext.go</code>中添加RPC的客户端，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">package svc</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;example.com/studyGoZero/apps/app/api/internal/config&quot;</span><br><span class="line">	&quot;example.com/studyGoZero/apps/order/rpc/orderclient&quot;</span><br><span class="line">	&quot;example.com/studyGoZero/apps/product/rpc/productclient&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">type ServiceContext struct &#123;</span><br><span class="line">	Config     config.Config</span><br><span class="line">	OrderRPC   orderclient.Order</span><br><span class="line">	ProductRPC productclient.Product</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func NewServiceContext(c config.Config) *ServiceContext &#123;</span><br><span class="line">	return &amp;ServiceContext&#123;</span><br><span class="line">		Config: c,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<p>最后只要在订单接口的<code>E:\proj\gowork\studyGoZero\apps\app\api\internal\logic\orderlistlogic.go</code>方法中添加逻辑就可以啦，这里只是演示，所以会比较简单：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">func (l *OrderListLogic) OrderList(req *types.OrderListRequest) (resp *types.OrderListResponse, err error) &#123;</span><br><span class="line">	orderRet, err := l.svcCtx.OrderRPC.Orders(l.ctx, &amp;order.OrdersRequest&#123;UserId: req.UID&#125;)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		return nil, err</span><br><span class="line">	&#125;</span><br><span class="line">	var pids []string</span><br><span class="line">	for _, o := range orderRet.Orders &#123;</span><br><span class="line">		pids = append(pids, strconv.Itoa(int(o.Id)))</span><br><span class="line">	&#125;</span><br><span class="line">	productRet, err := l.svcCtx.ProductRPC.Products(l.ctx, &amp;product.ProductRequest&#123;ProductIds: strings.Join(pids, &quot;,&quot;)&#125;)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		return nil, err</span><br><span class="line">	&#125;</span><br><span class="line">	var orders []*types.Order</span><br><span class="line">	for _, o := range orderRet.Orders &#123;</span><br><span class="line">		if p, ok := productRet.Products[o.Id]; ok &#123;</span><br><span class="line">			orders = append(orders, &amp;types.Order&#123;</span><br><span class="line">				OrderID:     o.Orderid,</span><br><span class="line">				ProductName: p.Name,</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	return &amp;types.OrderListResponse&#123;Orders: orders&#125;, nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><ul>
<li>请确保order、product 的rpc服务器已经启动</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PS E:\proj\gowork\studyGoZero\apps\product\rpc&gt; go run .\product.go</span><br><span class="line">Starting rpc server at 0.0.0.0:8081...</span><br><span class="line"></span><br><span class="line">PS E:\proj\gowork\studyGoZero\apps\order\rpc&gt; go run .\order.go</span><br><span class="line">Starting rpc server at 0.0.0.0:8080...</span><br></pre></td></tr></table></figure>

<ul>
<li>启动api层服务</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">E:\proj\gowork\studyGoZero\apps\app\api&gt;go run .\api.go</span><br><span class="line">Starting rpc server at 0.0.0.0:8888...</span><br></pre></td></tr></table></figure>

<ul>
<li>浏览器打开<code>http://127.0.0.1:8888/v1/order/list?uid=123</code> 发现报错空指针</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;content&quot;:&quot;(/v1/order/list?uid=123 - 127.0.0.1:57933) runtime error: invalid memory address or nil pointer dereference\ngoroutine 57 [running]:\nruntime/debug.Stack()\n\tE:/app/Go/src/runtime/debug/stack.go:24 +0x65\ngithub.com/zeromicro/go-zero/rest/handler.RecoverHandler.func1.1()\n\tC:/Users/Administrator/go/pkg/mod/github.com/zeromicro/go-zero@v1.5.4/rest/handler/recoverhandler.go:16 +0x66\npanic(&#123;0x1f56680, 0x331f9d0&#125;)\n\tE:/app/Go/src/runtime/panic.go:884 +0x213\nexample.com/studyGoZero/apps/app/api/internal/logic.(*OrderListLogic).OrderList(0xc0002cfcf8, 0xc00011e380)\n\tE:/proj/gowork/studyGoZero/apps/app/api/internal/logic/orderlistlogic.go:31</span><br></pre></td></tr></table></figure>

<ul>
<li>虽然报错 了，但是可以知道整个服务已经是通的，因为现在并没有订单的任何数据</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li>api层- 对外的BFF服务。接受来自客户端的请求，暴露HTTP接口。本次实例启动了api.go，并且连接了order和product的rpc</li>
<li><code>api/api.api</code> 为具体的对我暴露的请求</li>
<li><code>app\api\internal\logic</code> 对应<code>api/api.api</code>为对外暴露请求的具体逻辑，具体代码又调用了order和product的rpc的逻辑</li>
</ul>
<p><img src="/aposts/4d2d858d/image-20230725145056412.png" alt="image-20230725145056412"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">


    <div class="sidebar-inner">



      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt=""
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name"></p>
  <div class="site-description" itemprop="description">一个正经的测试工程师</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">154</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">63</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Louis-me" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Louis-me" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:shikun.job@foxmail.com" title="E-Mail → mailto:shikun.job@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>
  <!-- 标签云 -->

<script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script>
<div class="widget-wrap">
    <!--<h3 class="widget-title">Tag Cloud</h3> -->
    <div id="myCanvasContainer" class="widget tagcloud">
        <canvas width="250" height="250" id="resCanvas" style="width=100%">
            <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AWVS/" rel="tag">AWVS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/" rel="tag">Android</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Burp-Site/" rel="tag">Burp Site</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DVWA/" rel="tag">DVWA</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dependency-Check/" rel="tag">Dependency-Check</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/H5/" rel="tag">H5</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hadoop/" rel="tag">Hadoop</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hive/" rel="tag">Hive</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jenkins/" rel="tag">Jenkins</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Metasploit/" rel="tag">Metasploit</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nessus/" rel="tag">Nessus</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sonic/" rel="tag">Sonic</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/airtest/" rel="tag">airtest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/" rel="tag">android</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/" rel="tag">android性能测试</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/app%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/" rel="tag">app安全测试</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aritest/" rel="tag">aritest</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/centos/" rel="tag">centos</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/chrome/" rel="tag">chrome</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/datax/" rel="tag">datax</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/django/" rel="tag">django</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/drozer/" rel="tag">drozer</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fisco-bcos/" rel="tag">fisco-bcos</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flink/" rel="tag">flink</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gin/" rel="tag">gin</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go/" rel="tag">go</a><span class="tag-list-count">16</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go-zero/" rel="tag">go-zero</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hive/" rel="tag">hive</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/httprunner/" rel="tag">httprunner</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jmeter/" rel="tag">jmeter</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kafka/" rel="tag">kafka</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kail/" rel="tag">kail</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/leetcode/" rel="tag">leetcode</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/leetcode-%E6%95%B0%E7%BB%84/" rel="tag">leetcode-数组</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mitmproxy/" rel="tag">mitmproxy</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/" rel="tag">mongodb</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/monkey/" rel="tag">monkey</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pandas/" rel="tag">pandas</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pc%E8%87%AA%E5%8A%A8%E5%8C%96/" rel="tag">pc自动化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/playwright/" rel="tag">playwright</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pytest/" rel="tag">pytest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a><span class="tag-list-count">23</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/" rel="tag">redis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/selenium/" rel="tag">selenium</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqlite/" rel="tag">sqlite</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqlmap/" rel="tag">sqlmap</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tkinter/" rel="tag">tkinter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue3/" rel="tag">vue3</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8/" rel="tag">云服务器</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/" rel="tag">区块链</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" rel="tag">大数据</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/" rel="tag">安全测试</a><span class="tag-list-count">29</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/" rel="tag">性能测试</a><span class="tag-list-count">17</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%88%AC%E8%99%AB/" rel="tag">爬虫</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" rel="tag">环境搭建</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/" rel="tag">自动化测试</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%8B%B1%E8%AF%AD%E5%AD%A6%E4%B9%A0/" rel="tag">英语学习</a><span class="tag-list-count">1</span></li></ul>
        </canvas>
    </div>
</div>

</div>
<!-- 标签云 -->
    </div>

  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  <a href="https://beian.miit.gov.cn/" target="_blank">湘ICP备2022002212号-1</a><br />
  <!--
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder"></span>
  -->
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>


        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


<script src='../../../js/src/av-min.js'></script>
<script src='../../../js/src/Valine.min.js'></script>

<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : true,
      notify     : false,
      appId      : 'mhSm1aOQmnVeiAUJxrsKIFg5-gzGzoHsz',
      appKey     : 'kW6GQVoeJac7wDgKvy9vXhn6',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

  
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
